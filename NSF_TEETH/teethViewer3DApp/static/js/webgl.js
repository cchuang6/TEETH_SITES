function _log(e){if(_canLog){var t=Array.prototype.slice.apply(arguments,[1]),i=new Date,n=i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+"."+i.getMilliseconds();t[0]=n+" - "+t[0];try{switch(e){case"info":window.console.info.apply(window.console,t);break;case"warn":window.console.warn.apply(window.console,t);break;default:window.console.log.apply(window.console,t)}}catch(r){window.console||(_canLog=!1)}}}function logMsg(){Array.prototype.unshift.apply(arguments,["debug"]),_log.apply(this,arguments)}function apprise(e,t,i){function n(e,t){$(".appriseOverlay").remove(),$(".appriseOuter").remove(),i(e,t)}var r={confirm:!1,verify:!1,input:!1,memoTitle:!1,memo:!1,animate:!1,textOk:"Ok",textCancel:"Cancel",textYes:"Yes",textNo:"No",validation:null,validationfailerror:""};if(t)for(var o in r)"undefined"==typeof t[o]&&(t[o]=r[o]);var a=$(document).height(),s=$(document).width();if($("body").append('<div class="appriseOverlay" id="aOverlay"></div>'),$(".appriseOverlay").css("height",a).css("width",s).fadeIn(100),$("body").append('<div class="appriseOuter"></div>'),$(".appriseOuter").append('<div class="appriseInner"></div>'),$(".appriseInner").append(e),$(".appriseOuter").css("left",($(window).width()-$(".appriseOuter").width())/2+$(window).scrollLeft()+"px"),t)if(t.animate){var l=t.animate;isNaN(l)&&(l=400),$(".appriseOuter").css("top","-200px").show().animate({top:"100px"},l)}else $(".appriseOuter").css("top","100px").fadeIn(200);else $(".appriseOuter").css("top","100px").fadeIn(200);t&&(t.input&&("string"==typeof t.input?$(".appriseInner").append('<div class="aInput"><input type="text" class="aTextbox" t="aTextbox" value="'+t.input+'" /></div>'):$(".appriseInner").append('<div class="aInput"><input type="text" class="aTextbox" t="aTextbox" /></div>'),$(".aTextbox").focus()),t.memoTitle&&$(".appriseInner").append(t.memoTitle),t.memo&&$(".appriseInner").append('<div class="aInput"><textarea style="resize: none;" class="aMemobox" t="aMemobox" rows="4"></textarea></div>')),$(".appriseInner").append('<div class="aButtons"></div>'),t?t.confirm||t.input?($(".aButtons").append('<button value="ok">'+t.textOk+"</button>"),$(".aButtons").append('<button value="cancel">'+t.textCancel+"</button>")):t.verify?($(".aButtons").append('<button value="ok">'+t.textYes+"</button>"),$(".aButtons").append('<button value="cancel">'+t.textNo+"</button>")):$(".aButtons").append('<button value="ok">'+t.textOk+"</button>"):$(".aButtons").append('<button value="ok">Ok</button>'),$(document).keydown(function(e){$(".appriseOverlay").is(":visible")&&(13==e.keyCode&&$('.aButtons > button[value="ok"]').click(),27==e.keyCode&&$('.aButtons > button[value="cancel"]').click())});var h=$(".aTextbox").val(),c="";h||(h=!1),$(".aTextbox").keyup(function(){h=""==$(this).val()?" ":$(this).val()}),$(".aMemobox").keyup(function(){c=""==$(this).val()?" ":$(this).val()}),$(".aButtons > button").click(function(){if(i){var e=$(this).attr("value");"ok"==e?t?t.input?t.validation?t.validation(h)?n(h,c):$(".appriseInner").append("<br>"+t.validationfailerror):n(h,c):n(!0,null):n(!0,null):"cancel"==e&&n(!1,null)}else $(".appriseOverlay").remove(),$(".appriseOuter").remove()})}function da(){return function(){}}function ha(){function e(t,i){t.children.forEach(function(t){t instanceof THREE.Mesh?i.push(t):t instanceof THREE.Object3D&&e(t,i)})}function t(t){if(t instanceof THREE.Object3D){var n,r,o,a=[];if(disp_model=new la,disp_model.geometries=[],e(t,a),0==a.length)return K;for(t=a[0].geometry.boundingBox.max.clone(),n=a[0].geometry.boundingBox.min.clone(),o=a.length,r=1;o>r;r+=1)t.x=t.x>a[r].geometry.boundingBox.max.x?t.x:a[r].geometry.boundingBox.max.x,t.y=t.y>a[r].geometry.boundingBox.max.y?t.y:a[r].geometry.boundingBox.max.y,t.z=t.z>a[r].geometry.boundingBox.max.z?t.z:a[r].geometry.boundingBox.max.z,n.x=n.x<a[r].geometry.boundingBox.min.x?n.x:a[r].geometry.boundingBox.min.x,n.y=n.y<a[r].geometry.boundingBox.min.y?n.y:a[r].geometry.boundingBox.min.y,n.z=n.z<a[r].geometry.boundingBox.min.z?n.z:a[r].geometry.boundingBox.min.z;for(r=0;o>r;r+=1)a[r].geometry.j=a[r],disp_model.geometries.push(a[r].geometry);return i(n,t),p=disp_model,G}return a=t.boundingBox.max.clone(),n=t.boundingBox.min.clone(),disp_model=new la,disp_model.geometries=[],disp_model.geometries.push(t),i(n,a),p=disp_model,G}function i(e,t){var i,n,r,o,a=disp_model,s=tpModelMaxLength;o=t.y-e.y;var l=t.z-e.z,h=t.x-e.x;n=a.geometries.length,a.area=0,a.volume=0;var c,p,f,m,g,v,E,y,x,T,b,_;for(i=0;n>i;i+=1){for(r=a.geometries[i],r.area=0,c=r.volume=0,p=r.faces.length;p>c;c++)f=r.faces[c],m=r.vertices[f.a],g=r.vertices[f.b],v=r.vertices[f.c],E=m.x<g.x?m.x:g.x,E=E<v.x?E:v.x,y=m.y<g.y?m.y:g.y,y=y<v.y?y:v.y,T=m.z<g.z?m.z:g.z,T=T<v.z?T:v.z,b=m.x>g.x?m.x:g.x,b=b>v.x?b:v.x,x=m.y>g.y?m.y:g.y,x=x>v.y?x:v.y,_=m.z>g.z?m.z:g.z,_=_>v.z?_:v.z,f.bound_min={x:E,y:y,z:T},f.bound_max={x:b,y:x,z:_},E=v.x-g.x,y=v.y-g.y,x=v.z-g.z,T=m.x-g.x,b=m.y-g.y,_=m.z-g.z,f=y*_-x*b,x=x*T-E*_,E=E*b-y*T,f=Math.sqrt(f*f+x*x+E*E),r.area+=f/2,f=v.x*g.y*m.z,E=g.x*v.y*m.z,y=v.x*m.y*g.z,T=m.x*v.y*g.z,b=g.x*m.y*v.z,m=m.x*g.y*v.z,r.volume+=1/6*(-f+E+y-T-b+m);r.volume=Math.abs(r.volume),a.volume+=r.volume,a.area+=r.area}for(a.massComputed=K,h=Math.max(h,o),h=Math.max(h,l),h=s/h,a.scaleFactor=h,s=new ma((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,h),s.scale(t),s.scale(e),a.min=e.clone(),a.max=t.clone(),i=0;n>i;i+=1){for(r=a.geometries[i],r.boundingSphere===J&&(r.boundingSphere=new THREE.Sphere),r.boundingSphere.center=new THREE.Vector3(0,0,0),r.boundingSphere.radius=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),l=r.vertices.length,o=0;l>o;++o)r.vertices[o].W!==u&&r.vertices[o].W||(s.scale(r.vertices[o]),r.vertices[o].W=G);for(o=r.faces.length,l=0;o>l;++l)s.scale(r.faces[l].bound_min),s.scale(r.faces[l].bound_max);s.scale(r.boundingBox.max),s.scale(r.boundingBox.min),r.parentPartNode=a}a.breps=a.geometries,a.children=[],a.unitToMM="1.0",a.isContainer=K,a.texture=d}var n,r,o,a,s,l,h,c,d=J,p=J,f=J,m=J;return this.init=this.init=function(e){n=e.width===u?window.innerWidth:e.width,r=e.height===u?window.innerHeight:e.height,tpDOM=new pa,tpDebug=new TPVIEWER.ka,tpDebug.Qa(),tpModelQuery=new TPVIEWER.T,tpUnitManager=new qa,tpModelMaxLength=100,o=tpDOM.createElement({className:"tp_viewer",parent:e.containerID==u?document.body:document.getElementById(e.containerID),k:"width:"+n+"px;height:"+r+"px;"}),o.width=n,o.height=r,m=new sa,m.init(o),c=m.ta()},this.resizeScene=this.resizeScene=function(e){return f===u||f==J?K:(n=e.width===u?o.width:e.width,r=e.height===u?o.height:e.height,tpDOM.k(o,"width:"+n+"px;height:"+r+"px;"),o.width=n,o.height=r,f.Ja(n,r),G)},this.load=this.load=function(e){a=e.URL===u?"":e.URL,s=e.textureURL===u?"":e.textureURL,l=e.mtlURL===u?"":e.mtlURL,given_format=e.format===u?"":e.format;var i,n=[{m:".tptx",format:"TPTX"},{m:".tptx.lz",format:"TPTX"},{m:".stl",format:"STL"},{m:".obj",format:"OBJ"},{m:".ctm",format:"CTM"},{m:".mtl",format:"MTL"},{m:".tptx.m.lz",format:"CTM"}],r=0;if(""==given_format){for(r=0;r<n.length;++r)-1!==a.toLowerCase().indexOf(n[r].m,a.length-n[r].m.length)&&(given_format=n[r].format);if(""===given_format)return e.onLoadFailed!==u&&e.onLoadFailed("unsupported file format"),void 0}c.show(),c.message("Downloading ..."),"OBJ"===given_format&&""!=l?(n=new THREE.OBJMTLLoader,e.imageURLlookup!==u&&(n.imageURLlookup=e.imageURLlookup),n.load(a,l,function(i){t(i),c.G(),c.hide(),p==J?e.onLoadFailed!==u&&e.onLoadFailed("Failed to load OBJ and MTL"):(model_info=ta(p),e.onLoadFinished!==u&&e.onLoadFinished(model_info))})):(n=new ua,n.init({url:a,responseType:"STL"==given_format||"CTM"==given_format||"TPTX"==given_format?"arraybuffer":"",ya:function(e){e.lengthComputable&&(e=100*(e.loaded/e.total),90>e?c.update("Load",e):(c.update("Load",0),c.V(),c.message("Building 3D models ...")))},xa:function(n){function r(n){"TPTX"===given_format&&(p=THREE.TPXLoader.prototype.createTPXModel(new Uint8Array(n.response)),p==J)?(c.G(),c.hide(),e.onLoadFailed!==u&&e.onLoadFailed("Failed to load: not supported old version")):("STL"===given_format&&(i=THREE.STLLoader.prototype.parse(n.response),t(i)),"OBJ"===given_format&&(i=THREE.OBJLoader.prototype.parse(n.response),t(i)),"CTM"===given_format&&(n=new CTM.Stream(new Uint8Array(n.response)),n=new CTM.File(n),THREE.CTMLoader.prototype.createModelClassic(n,t)),c.G(),c.hide(),p==J?e.onLoadFailed!==u&&e.onLoadFailed("Invalid TPTZ format"):(n=ta(p),e.onLoadFinished!==u&&e.onLoadFinished(n)))}tpDebug.timeEnd("loading");var o;(o=n.getResponseHeader("Content-disposition"))?h=o.split("=")[1].replace(/"/g,""):(o=a.split("/"),(o==J||0==o.length)&&(h=""),h=o[o.length-1]),h=unescape(h),""!=s?THREE.ImageUtils.loadTexture(s,u,function(e){d=e,r(n)},function(){d=J,r(n)}):r(n)},onError:function(t){c.hide(),e.onLoadFailed!==u&&e.onLoadFailed(t)}}),tpDebug.timeStart(),n.oa())},this.getFileName=this.getFileName=function(){return h},this.showProgressMessage=this.showProgressMessage=function(e,t){c.show(),c.message(e),t&&c.V()},this.hideProgressMessage=this.hideProgressMessage=function(){c.G(),c.hide()},this.render=this.render=function(){f.startScene()},this.startScene=this.startScene=function(e){p&&p.unitToMM!==u&&tpUnitManager.Oa(p.unitToMM),f=new va,f.init({dispModel:p,ab:m,width:n,height:r,B:o,eb:"WebGL",hoverOnObjects:e.hoverOnObjects,hoverHighlightColor:e.hoverHighlightColor,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onMouseWheel:e.onMouseWheel,postRenderCallback:e.postRenderCallback,R:e.boundingRadius}),f.startScene()},this.explodeObjects=this.explodeObjects=function(e){return f.explodeObjects(e)},this.clipView=this.clipView=function(e){f.clipView(e)},this.setCamera=this.setCamera=function(e){f.setCamera(e)},this.getCameraInfo=this.getCameraInfo=function(){return f.getCameraInfo()},this.setTrackballEvents=this.setTrackballOperations=function(e){return f.Pa(e)},this.startHover=this.startHover=function(e){return f.startHover(e)},this.stopHover=this.stopHover=function(){return f.stopHover()},this.getObjectsClipBound=function(e){return f.sa(e)},this.addObject=this.J=function(e){return f.J(e)},this.showObject=this.I=function(e){return f.I(e)},this.hideObject=this.hideObject=function(e){return f.hideObject(e)},this.hideOtherObjects=this.hideOtherObjects=function(e){return f.hideOtherObjects(e)},this.showAllObject=this.showAllObject=function(){return f.showAllObject()},this.hideAllObject=this.hideAllObject=function(){return f.hideAllObject()},this.setObjectOpacity=this.setObjectOpacity=function(e,t){return f.setObjectOpacity(e,t)},this.resetObjectOpacity=this.resetObjectOpacity=function(e){return f.setObjectOpacity(e,"reset")},this.setObjectColor=this.setObjectColor=function(e,t){return f.setObjectColor(e,t)},this.resetObjectColor=this.M=function(e){return f.M(e)},this.setObjectEmissiveColor=this.setObjectEmissiveColor=function(e,t){return f.setObjectEmissiveColor(e,t)},this.resetObjectEmissiveColor=this.resetObjectEmissiveColor=function(e){return f.resetObjectEmissiveColor(e)},this.setObjectHoverColor=this.setObjectHoverColor=function(e,t){return f.setObjectHoverColor(e,t)},this.resetObjectHoverColor=this.resetObjectHoverColor=function(e){return f.resetObjectHoverColor(e)},this.setObjectMaterial=this.setObjectMaterial=function(e,t){return f.setObjectMaterial(e,t)},this.resetObjectMaterial=this.resetObjectMaterial=function(e){return f.resetObjectMaterial(e)},this.enableShadowCast=this.enableShadowCast=function(e){return f.enableShadowCast(e)},this.disableShadowCast=this.disableShadowCast=function(e){return f.disableShadowCast(e)},this.setRotationCenter=this.setRotationCenter=function(e){return f.setRotationCenter(e)},this.resetRotationCenter=this.resetRotationCenter=function(){return f.resetRotationCenter()},this.showAxis=this.showAxis=function(){return f.showAxis()},this.hideAxis=this.hideAxis=function(){return f.hideAxis()},this.getModelInfo=this.qa=function(){return ta(p)},this.getObjectInfo=this.getObjectInfo=function(e){return tpModelQuery.getObjectInfo(e)},this.changeTextureSource=this.changeTextureSource=function(e,t){return f.changeTextureSource(e,t)},this.saveAsSTL=this.saveAsSTL=function(e,t){var i=t===u?h+".stl":t;return".stl"==h&&(h="(no name).stl"),f.saveAsSTL({objectID:e,name:i})},this.captureScreen=this.captureScreen=function(e){var t="png";return e!==u&&"png"===e&&(t="png"),f.captureScreen(t)},this.showCustomObject=this.showCustomObject=function(e){return f.showCustomObject(e)},this.hideCustomObject=this.hideCustomObject=function(e){return f.hideCustomObject(e)},this.scaleCustomObject=this.N=function(e,t,i,n){return f.N(e,t,i,n)},this.moveCustomObject=this.moveCustomObject=function(e,t,i,n){return f.moveCustomObject(e,t,i,n)},this.addCustomImageObject=this.Z=function(e){return f.$(e)},this.addCustomShadowFloorObject=this.addCustomShadowFloorObject=function(e){return f.ba(e)},this.addCustomAxisNormalPlaneObject=this.addCustomAxisNormalPlaneObject=function(e){return f.Y(e)},this.updateCustomAxisNormalPlaneObject=this.updateCustomAxisNormalPlaneObject=function(e,t){return f.Ra(e,t)},this.getCustomAxisNormalPlaneObjectInfo=this.getCustomAxisNormalPlaneObjectInfo=function(e){return f.pa(e)},this.addCustomLineObject=this.addCustomLineObject=function(e){return f.aa(e)},this.addCustomSphereObject=this.addCustomSphereObject=function(e){return f.ca(e)},this.updateCustomLineObject=this.updateCustomLineObject=function(e,t){return f.Sa(e,t)},this}function wa(e){function t(e){var t,i,n,p={},m={},E={};if(e.offsetX&&e.offsetY)i=e.offsetX,n=e.offsetY;else{for(i=e.target,n=t=0;i;)n+=i.offsetLeft?i.offsetLeft:0,t+=i.offsetTop?i.offsetTop:0,i=i.offsetParent?i.offsetParent:i.parentNode;i=e.pageX-n,n=e.pageY-t}if(t=i,i=n,p.x=t,p.y=i,T.screenPoint=p,T.eventType=TPVIEWER.EVENT_TYPE.MOUSE_MOVE,T.objectID=J,T.objectPoint=J,T.objectNormal=J,T.nativeMouseEvent=e,r==J?e=J:(e=new THREE.Vector3(2*(t/o)-1,2*-(i/a)+1,1),l.unprojectVector(e,s),e=new THREE.Raycaster(s.position,e.sub(s.position).normalize()).intersectObjects(r),e=0<e.length?e[0]:J),e){g!=e.object&&-1!=f&&(g&&g.material.emissive!==u&&g.material.emissive.setHex(g.material.t),g=e.object,g.material.emissive!==u&&(g.material.t=g.material.emissive.getHex()),g.material.emissive!==u&&g.material.emissive.setHex(f),d()),m.x=e.point.x*h+c.x,m.y=e.point.y*h+c.y,m.z=e.point.z*h+c.z,T.objectPoint=m,e.face!==u&&(E.x=e.face.normal.x,E.y=e.face.normal.y,E.z=e.face.normal.z,T.objectNormal=E);var y,m=e.object;try{if(m.geometry!==u&&m.geometry){var x=m.geometry;y=x.parentPartNode!==u&&x.parentPartNode?x.parentPartNode.F:J}else y=J}catch(b){y=J}T.objectID=y}else g&&-1!=f&&(g.material.emissive!==u&&g.material.emissive.setHex(g.material.t),d()),g=J,T&&(T.objectPoint=J);v!==u&&v(T)}function i(e){e.preventDefault(),T&&(T.eventType=TPVIEWER.EVENT_TYPE.MOUSE_WHEEL,T.nativeMouseEvent=e),x!==u&&x(T)}var n,r,o,a,s,l,h,c,d,p,f,m,g,v,E,y,x,T={};n=e.B,r=e.Ma,c=e.translate,h=e.scale,s=e.camera,o=e.width,a=e.height,m=f=(p=e.hoverOnObjects===u?K:e.hoverOnObjects)?e.hoverHighlightColor===u?-1:e.hoverHighlightColor:-1,d=e.Ha,v=e.onMouseMove,E=e.onMouseDown,y=e.onMouseUp,x=e.onMouseWheel,l=new THREE.Projector,n.addEventListener("mousemove",function(e){return e.preventDefault(),p?t(e):void 0},K),n.addEventListener("mouseup",function(e){e.preventDefault(),t(e),T&&(T.eventType=2==e.button?TPVIEWER.EVENT_TYPE.RIGHT_UP:TPVIEWER.EVENT_TYPE.LEFT_UP),y!==u&&y(T)},K),n.addEventListener("mousedown",function(e){e.preventDefault(),t(e),T&&(T.eventType=2==e.button?TPVIEWER.EVENT_TYPE.RIGHT_DOWN:TPVIEWER.EVENT_TYPE.LEFT_DOWN),E!==u&&E(T)},K),n.addEventListener("DOMMouseScroll",i,K),n.addEventListener("mousewheel",i,K),this.startHover=function(e){p=G,e===u?f=m:(e.hoverHighlightColor===u?f=m?m:-1:m=f=e.hoverHighlightColor,e.onMouseMove!==u&&(v=e.onMouseMove))},this.stopHover=function(){p=K,f=-1},this.setSize=function(e,t){o=e,a=t}}function xa(e){var t,i;t=e.va,i=e.wa,this.save=function(e,n){var r=e.name!==u?e.name:"savedFromTPPlayer.stl";try{var o,a,s,l,h,c,d,p,f,m,g,v,E,y,x,T,b,_,R,w,S,H,M,C,D,A,I,P=0;for(l=0;l<n.length;++l)P+=n[l].geometry.faces.length;for(o=new ArrayBuffer(84+50*P),a=new DataView(o),l=s=0;80>l;++l)a.setInt8(s++,0);for(a.setInt32(s,P,G),s+=4,h=0;h<n.length;++h)for(d=n[h].geometry,c=d.faces.length,l=0;c>l;++l)p=d.faces[l],f=d.vertices[p.a].x*t+i.x,m=d.vertices[p.a].y*t+i.y,g=d.vertices[p.a].z*t+i.z,v=d.vertices[p.b].x*t+i.x,E=d.vertices[p.b].y*t+i.y,y=d.vertices[p.b].z*t+i.z,x=d.vertices[p.c].x*t+i.x,T=d.vertices[p.c].y*t+i.y,b=d.vertices[p.c].z*t+i.z,_=x-v,R=T-E,w=b-y,S=f-v,H=m-E,M=g-y,C=R*M-w*H,D=w*S-_*M,A=_*H-R*S,I=Math.sqrt(C*C+D*D+A*A),I>1e-7&&(C/=I,D/=I,A/=I),a.setFloat32(s,C,G),s+=4,a.setFloat32(s,D,G),s+=4,a.setFloat32(s,A,G),s+=4,a.setFloat32(s,f,G),s+=4,a.setFloat32(s,m,G),s+=4,a.setFloat32(s,g,G),s+=4,a.setFloat32(s,v,G),s+=4,a.setFloat32(s,E,G),s+=4,a.setFloat32(s,y,G),s+=4,a.setFloat32(s,x,G),s+=4,a.setFloat32(s,T,G),s+=4,a.setFloat32(s,b,G),s+=4,a.setInt8(s++,0,G),a.setInt8(s++,0,G);if(!(stlBuffer=o))return TPVIEWER.ERROR_CODE.NO_DATA;try{var L,k,O=new Uint8Array(stlBuffer);try{k=new Blob([O])}catch(N){try{L=new BlobBuilder,L.append(ab),k=L.getBlob()}catch(z){try{L=new WebKitBlobBuilder,L.append(ab),k=L.getBlob()}catch(V){L=new MozBlobBuilder,L.append(ab),k=L.getBlob()}}}saveAs(k,r)}catch(F){return TPVIEWER.ERROR_CODE.BROWSER_NOT_SUPPORTED}return TPVIEWER.ERROR_CODE.SUCCESS}catch(U){return TPVIEWER.ERROR_CODE.BROWSER_NOT_SUPPORTED}}}function sa(){var e;this.init=function(t){e=new za(t)},this.gb=da(),this.ta=function(){return e}}function za(e){var t,i,n,r,o,a,s=e.width,l=e.height;o=.3*s,a=.06*l,a>25&&(a=25),t=tpDOM.createElement({id:"progress",parent:e,k:"width:"+o+"px;height:"+a+"px;left:"+(s-o)/2+"px;top:"+(l-a)/2+"px;"}),r=tpDOM.createElement({id:"message",parent:t,k:"top:"+.1*a+"px;left:"+.3*o+"px;"}),i=tpDOM.createElement({id:"indicator",parent:t}),n=tpDOM.createElement({id:"spinner",parent:t,k:"top:"+(a-20)/2+"px;left:2px;"}),tpDOM.hide(n),this.show=function(){tpDOM.show(t)},this.hide=function(){tpDOM.hide(t)},this.message=function(e){tpDOM.html(r,e)},this.update=function(e,t){tpDOM.k(i,"width:"+t+"%")},this.V=function(){tpDOM.show(n)},this.G=function(){tpDOM.hide(n)}}function ma(e,t,i,n){this.scale=function(r){r.x-=e,r.x*=n,r.y-=t,r.y*=n,r.z-=i,r.z*=n}}function qa(){var e=1,t=[{name:"mm",e:1},{name:"cm",e:10},{name:"meter",e:1e3},{name:"km",e:1e6},{name:"inch",e:25.4},{name:"feet",e:304.8},{name:"yard",e:914.4},{name:"mile",e:1609344},{name:"fathom",e:1828},{name:"micron",e:.001},{name:"thou",e:.0254}];this.Oa=function(t){e=t},this.ra=function(){return e},this.fb=da(),this.toString=function(e){var i,n;for(i=0,n=t.length;n>i;++i)if(1e-10>Math.abs(e-t[i].e))return t[i].name;return"unknown"},this.ib=function(e){for(i=0,len=t.length;len>i;++i)if(-1!=e.indexOf(t[i].name))return t[i].e;return 1}}function ua(){var e,t,i,n,r="",o=K;this.init=function(a){a.url!=u&&(e=a.url,r=a.responseType,t=a.ya,i=a.xa,n=a.onError,o=G)},this.oa=function(){if(o){var a,s=0;a=new XMLHttpRequest,a.onreadystatechange=function(){4==a.readyState?200==a.status||0==a.status?i!=u&&i(a):n!=u&&n(a.responseText):3==a.readyState?0==s&&(s=a.getResponseHeader("Content-Length")):2==a.readyState&&(s=a.getResponseHeader("Content-Length"))},t!=u&&(a.onprogress=t),a.open("GET",e,G),""!=r&&(a.responseType=r),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.setRequestHeader("Content-Type","text/plain"),a.send(J)}}}function pa(){this.createElement=function(e){var t=document.createElement("div");return e.className!==u&&(t.className=e.className),e.id!==u&&(t.id=e.id),e.parent!==u&&e.parent.appendChild(t),e.k!==u&&(t.style.cssText=e.k),t},this.k=function(e,t){e.style.cssText=t},this.show=function(e){e.style.visibility="visible"},this.hide=function(e){e.style.visibility="hidden"},this.html=function(e,t){e.innerHTML=t},this.Wa=function(e){var t=0,i=0;do t+=e.offsetTop||0,i+=e.offsetLeft||0,e=e.offsetParent;while(e);return{top:t,left:i}}}function la(e){this.textureURL="";var t;this.F=t="tpObj"+la.prototype.count,la.prototype.count+=1,la.prototype.S[t]=this,this.D=e===u?J:e}function ta(e){if(e.part===u||!e.part)return{objectID:e.F,type:TPVIEWER.MODEL_TYPE.MESH};var t={},e=e.part.children[0];return t.objectID=e.F,t.type=0<e.children.length?TPVIEWER.MODEL_TYPE.CAD_ASSEMBLY:TPVIEWER.MODEL_TYPE.CAD_PART,t.unit=tpUnitManager.toString(tpUnitManager.ra()),t}function Aa(e){try{var t=la.prototype.S[e]}catch(i){return J}return t===u?J:t}function Ba(e){function t(e,i){var n,r;for(n=0,r=e.breps.length;r>n;++n)i.push(e.breps[n].j);for(n=0,r=e.children.length;r>n;++n)t(e.children[n],i)}var i=[],e=Aa(e);return e?e.breps===u?(i.push(e.f[0]),i):(t(e,i),i):J}function va(){function e(e){e.x=(e.x-d.x)/S,e.y=(e.y-d.y)/S,e.z=(e.z-d.z)/S}function t(){C!==u&&C?C.render(.5):(x.da(g.C()),T.render(y,g.C())),b!==u&&b()}function r(){requestAnimationFrame(r),E.update()}function o(e,t){H[e]=t,++M,y.add(t)}function a(e,t,i,n){var r,o;for(r=0,o=e.length;o>r;r+=1)if(e[r]!==u)if(i&&e[r].material!==u)if("opacity"===t)"reset"===n?(e[r].material.opacity=e[r].material.U,e[r].material.transparent=1==e[r].material.opacity?K:G,e[r].i!==u&&(e[r].i.visible=0==e[r].material.opacity?K:G)):(n>=1?(e[r].material.transparent=K,e[r].material.opacity=1):(e[r].material.transparent=G,e[r].material.opacity=n),0==n?e[r].i!==u&&(e[r].i.visible=K):e[r].i!==u&&(e[r].i.visible=G));else if("color"===t)"reset"===n?e[r].material.H!==u&&(e[r].material.color=e[r].material.H):e[r].material.color=new THREE.Color(n);else if("material"==t)if("reset"===n)v.Ia(e[r].material);else{if(n.materialIndex===u)break;n.materialIndex==TPVIEWER.MATERIAL.CUSTOM?v.ea(e[r].material,n.material):v.fa(e[r].material,n.materialIndex)}else"emcolor"==t?"reset"===n?(e[r].material.t=0,e[r].material.emissive.setHex(0)):(e[r].material.t=n,e[r].material.emissive.setHex(n)):"hvcolor"==t?"reset"===n?e[r].material.emissive.setHex(e[r].material.t):(e[r].material.t===u&&(e[r].material.t=e[r].material.emissive.getHex()),e[r].material.emissive.setHex(n)):e[r].material[t]=n;else e[r][t]=n,e[r].i!==u&&(e[r].i[t]=n)}function s(e,i,n,r){var o,a={};return o=g.getCameraInfo(),a.animate=e,a.viewDirection=TPVIEWER.VIEW_DIR.CUSTOM,o.lookAt.x=i,o.lookAt.y=n,o.lookAt.z=r,a.camera=o,g.setCamera(a),t(),TPVIEWER.ERROR_CODE.SUCCESS}var l,h,c,d,p,f,g,v,E,y,x,T,b,_,R,w,S=1,H=[],M=0,C=J,D=-1e3;this.init=function(e){function r(e,t){var i,n,o,a={};for(i=0,n=e.breps.length;n>i;i+=1)o=e.breps[i],o.j!==u&&(o.j.u={},o.j.u.x=(o.min.x+o.max.x)/2-t.x,o.j.u.y=(o.min.y+o.max.y)/2-t.y,o.j.u.z=(o.min.z+o.max.z)/2-t.z);for(a.x=(e.min.x+e.max.x)/2,a.y=(e.min.y+e.max.y)/2,a.z=(e.min.z+e.max.z)/2,i=0,n=e.children.length;n>i;i+=1)r(e.children[i],a)}l=e.dispModel,h=e.B,p=e.width,f=e.height,b=e.postRenderCallback,v=new Ca,l?(S=l.scaleFactor!==u?1/l.scaleFactor:1,c=new THREE.Vector3((l.max.x-l.min.x)/2,(l.max.y-l.min.y)/2,(l.max.z-l.min.z)/2),d=c.clone().multiplyScalar(S),v.envMap=l.envMap):(S=1,c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,0,0),v.envMap=J),tpModelQuery.scale=S,tpModelQuery.v={x:d.x,y:d.y,z:d.z},p*=1,f*=1;var o=new THREE.Scene;if(o.fog=new THREE.Fog(13426943,500,1e4),y=o,l){var a,s,m,H,M,C,o=y,A=l.geometries,I={},P=0,L=0,k=0,O=0,N=0,z=G;for(l.f=[],l.ua=[],l.cb=[],def_mat=Da(v),s=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,color:3355443,opacity:1,wireframe:G,wireframeLinewidth:1}),v.A(s),l.ambients!=u&&l.ambients.length==A.length&&(z=K),P=0,L=A.length;L>P;P+=1)if(A[P].j!==u&&A[P].j!=J?(C=A[P].j,a=C.material,a.side=THREE.DoubleSide,Ea(C.material)):(z?a=def_mat:(I.ambient=l.ambients[P],I.diffuse=l.diffuses[P],I.shininess=l.shinesses[P],I.scene=o,a=v.createMaterial(I),v.A(a)),C=new THREE.Mesh(A[P],a)),A[P].j=C,(A[P].K&&0<A[P].K[0].length||A[P].faceVertexUvs&&0<A[P].faceVertexUvs[0].length)&&l.texture!==u&&l.texture&&(a.map=l.texture),v.A(a),o.add(C),l.f.push(C),A[P].edges!==u&&0!=A[P].edges.length){for(a=new THREE.Geometry,k=O=0,N=A[P].edges.length;N>k;++k){for(m=0,H=A[P].edges[k].length;H>m;++m)M=A[P].edges[k][m],a.vertices.push(A[P].vertices[M/3]);for(m=0;H-1>m;++m)A[P].edges[k][m]!=A[P].edges[k][m+1]&&a.faces.push(new THREE.Face3(m+O,m+1+O,m+O));O+=H}a=new THREE.Mesh(a,s),C.i=a,l.ua.push(a),o.add(a)}}if(new THREE.Projector,x=new Fa(y),e.R!==u)o=e.R;else{for(o=l.geometries,i=A=0,n=o.length;n>i;i+=1)o[i].boundingSphere&&(A=o[i].boundingSphere.radius>A?o[i].boundingSphere.radius:A);o=A}if(D=o,o=new Ga({B:h,rad:D,Ua:p,Ta:f}),o.C().X.addEventListener("change",t),g=o,E=g.C().X,renderer_local=new THREE.WebGLRenderer({antialias:G}),renderer_local.sortObjects=K,renderer_local.setSize(p,f),renderer_local.setClearColor(16777215,1),renderer_local.autoClear=G,h.appendChild(renderer_local.domElement),renderer_local.shadowMapEnabled=G,renderer_local.hb=G,T=renderer_local,R=new xa({va:S,wa:d}),o=y,A=.52*tpModelMaxLength,I=new THREE.Object3D,object=new THREE.ArrowHelper(new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,0),15,16711680),object.position.set(-A,-A,-A),I.add(object),object=new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,0),15,65280),object.position.set(-A,-A,-A),I.add(object),object=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),15,255),object.position.set(-A,-A,-A),I.add(object),o.add(I),w=I,l!=J&&l.part!==u)for(o={},s=l.part.children[0],o.x=(s.min.x+s.max.x)/2,o.y=(s.min.y+s.max.y)/2,o.z=(s.min.z+s.max.z)/2,A=0,I=s.children.length;I>A;A+=1)r(s.children[A],o);return _=new wa({B:T.domElement,Ma:l==J?J:l.f,width:p,height:f,camera:g.C(),translate:d,scale:S,Ha:t,hoverOnObjects:e.hoverOnObjects,hoverHighlightColor:e.hoverHighlightColor,onMouseMove:e.onMouseMove,onMouseUp:e.onMouseUp,onMouseDown:e.onMouseDown,onMouseWheel:e.onMouseWheel}),this},this.startScene=function(){t(),r()},this.setObjectColor=function(e,i){var n=Ba(e);return n?(a(n,"color",G,i),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.M=function(e){return(e=Ba(e))?(a(e,"color",G,"reset"),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.setObjectEmissiveColor=function(e,i){var n=Ba(e);return n?(a(n,"emcolor",G,i),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.resetObjectEmissiveColor=function(e){return(e=Ba(e))?(a(e,"emcolor",G,"reset"),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.setObjectHoverColor=function(e,i){var n=Ba(e);return n?(a(n,"hvcolor",G,i),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.resetObjectHoverColor=function(e){return(e=Ba(e))?(a(e,"hvcolor",G,"reset"),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.J=function(e){return e.type!==u&&e.type==TPVIEWER.MODEL_TYPE.POINTCLOUD?(m=new THREE.ParticleSystem(e.geometry,new THREE.ParticleBasicMaterial({size:e.Da!==u?e.Da:2,vertexColors:G})),y.add(m),t(),TPVIEWER.ERROR_CODE.SUCCESS):void 0},this.I=function(e){return(e=Ba(e))?(a(e,"visible",K,G),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.hideObject=function(e){return(e=Ba(e))?(a(e,"visible",K,K),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.hideOtherObjects=function(e){return a(l.f,"visible",K,K),this.I(e)},this.setObjectOpacity=function(e,i){var n=Ba(e);return n?(a(n,"opacity",G,i),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.showAllObject=function(){return a(l.f,"visible",K,G),t(),TPVIEWER.ERROR_CODE.SUCCESS},this.hideAllObject=function(){return a(l.f,"visible",K,K),t(),TPVIEWER.ERROR_CODE.SUCCESS},this.setObjectMaterial=function(e,i){var n=Ba(e);return n?(a(n,"material",G,i),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.resetObjectMaterial=function(e){return(e=Ba(e))?(a(e,"material",G,"reset"),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.enableShadowCast=function(e){return(e=Ba(e))?(a(e,"castShadow",K,G),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.disableShadowCast=function(e){return(e=Ba(e))?(a(e,"castShadow",K,K),t(),TPVIEWER.ERROR_CODE.SUCCESS):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.setRotationCenter=function(e,t){var i=Aa(e);if(!i)return TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID;var n;return n=i.min===u?i.D.min:i.min,n!==u&&n?(i=i.max===u?i.D.max:i.max,s(t,(n.x+i.x)/2,(n.y+i.y)/2,(n.z+i.z)/2)):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.resetRotationCenter=function(e){return s(e,0,0,0)},this.hideAxis=function(){var e,i;if(w&&w.children){for(e=0,i=w.children.length;i>e;++e)w.children[e].cone.visible=K,w.children[e].line.visible=K,w.children[e].visible=K;w.visible=K,t()}return TPVIEWER.ERROR_CODE.SUCCESS},this.showAxis=function(){var e,i;if(w&&w.children){for(e=0,i=w.children.length;i>e;++e)w.children[e].cone.visible=G,w.children[e].line.visible=G,w.children[e].visible=G;w.visible=G,t()}return TPVIEWER.ERROR_CODE.SUCCESS},this.explodeObjects=function(e){if(l!=J&&!(l.f===u||0>l.f.length)){var i,n,r,o,a,s;for(i=0,n=l.f.length;n>i;i+=1)r=l.f[i],r.u!==u&&(o=r.u.x*e,a=r.u.y*e,s=r.u.z*e,r.position.set(o,a,s),r.i!==u&&r.i.position.set(o,a,s));t()}},this.captureScreen=function(e){return t(),T.domElement.toDataURL("image/"+e)},this.clipView=function(e){if(e.mode!==u&&v.d("clipStatus",e.mode),e.direction!==u)switch(e.direction){case TPVIEWER.SECTION_DIR.POS_X:v.d("clipXDirection",0),v.d("clipYDirection",2),v.d("clipZDirection",2);break;case TPVIEWER.SECTION_DIR.NEG_X:v.d("clipXDirection",1),v.d("clipYDirection",2),v.d("clipZDirection",2);break;case TPVIEWER.SECTION_DIR.POS_Y:v.d("clipYDirection",0),v.d("clipXDirection",2),v.d("clipZDirection",2);break;case TPVIEWER.SECTION_DIR.NEG_Y:v.d("clipYDirection",1),v.d("clipXDirection",2),v.d("clipZDirection",2);break;case TPVIEWER.SECTION_DIR.POS_Z:v.d("clipZDirection",0),v.d("clipYDirection",2),v.d("clipXDirection",2);break;case TPVIEWER.SECTION_DIR.NEG_Z:v.d("clipZDirection",1),v.d("clipYDirection",2),v.d("clipXDirection",2)}e.x!==u&&v.d("clipXPosition",(e.x-d.x)/S),e.y!==u&&v.d("clipYPosition",(e.y-d.y)/S),e.z!==u&&v.d("clipZPosition",(e.z-d.z)/S),t()},this.getCameraInfo=function(){return g.getCameraInfo()},this.setCamera=function(e){g.setCamera(e,t)},this.startHover=function(e){_.startHover(e)},this.stopHover=function(){_.stopHover()},this.Pa=function(e){E.noZoom=e.zoomEnabled!==u?!e.zoomEnabled:K,E.noPan=e.panEnabled!==u?!e.panEnabled:K,E.noRotate=e.rotateEnabled!==u?!e.rotateEnabled:K},this.changeTextureSource=function(e,i){var n,r=G;if(targetMeshes=Ba(e),!targetMeshes)return TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID;for(l.textureURL=i,n=0;n<targetMeshes.length;n+=1)targetMeshes[n].geometry.K&&0<targetMeshes[n].geometry.K[0].length||targetMeshes[n].geometry.faceVertexUvs&&0<targetMeshes[n].geometry.faceVertexUvs[0].length?(targetMeshes[n].material.map=THREE.ImageUtils.loadTexture(l.textureURL),targetMeshes[n].material.needsUpdate=G,targetMeshes[n].material.map.needsUpdate=G):r=K;return t(),r?TPVIEWER.ERROR_CODE.SUCCESS:TPVIEWER.ERROR_CODE.NO_DATA},this.sa=function(e){var t,i,n,r,o,a=e.Ea!==u?e.Ea:0,s=e.Fa!==u?e.Fa:0,h=e.Ga!==u?e.Ga:0,c=e.la!==u?e.la:1,d=e.ma!==u?e.ma:0,e=e.na!==u?e.na:0,p=Infinityy,f=-1/0;for(t=Math.sqrt(c*c+d*d+e*e),c/=t,d/=t,e/=t,o=l.min,i=l.max,t=[],t.push({x:o.x,y:o.y,z:o.z}),t.push({x:o.x,y:i.y,z:o.z}),t.push({x:i.x,y:o.y,z:o.z}),t.push({x:i.x,y:i.y,z:o.z}),t.push({x:o.x,y:o.y,z:i.z}),t.push({x:o.x,y:i.y,z:i.z}),t.push({x:i.x,y:o.y,z:i.z}),t.push({x:i.x,y:i.y,z:i.z}),o=0;8>o;++o)i=t[o].x-a,n=t[o].y-s,r=t[o].z-h,i=Math.abs(i*c+n*d+r*e),p>i&&(p=i),i>f&&(f=i);return{near:p,far:f}},this.Ja=function(e,i){T&&(T.setSize(e,i),g.Na(e,i),_.setSize(e,i),t())},this.saveAsSTL=function(e){var t=l.f;return e.objectID===u||(t=Ba(e.objectID))?R.save(e,t):TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID},this.Y=function(i){var n=i.name!==u?i.name:"customObj"+M,r=i.width!==u?i.width/S:200,a=i.height!==u?i.height/S:200,s=i.color!==u?i.color:10066329,l=i.opacity!==u?i.opacity:.5,h=i.axis!==u?i.axis:"y",c=i.clippable!==u?i.clippable:G,d=i.showWire!==u?i.showWire:K,p=i.doubleSide!==u?i.doubleSide:K,f=i.segW!==u?i.segW:10,m=i.segH!==u?i.segH:10;return 1>f&&(f=1),1>m&&(m=1),r=new THREE.PlaneGeometry(r,a,f,m),s=new THREE.MeshBasicMaterial({color:s,wireframe:d,transparent:G,opacity:l}),p&&(s.side=THREE.DoubleSide),c&&v.A(s),c=new THREE.Mesh(r,s),i.position!==u&&(c.position.x=i.position.x!==u?i.position.x:c.position.x,c.position.y=i.position.y!==u?i.position.y:c.position.y,c.position.z=i.position.z!==u?i.position.z:c.position.z),e(c.position),"x"==h?c.rotation.y=Math.PI/2:"z"!=h&&(c.rotation.x=-Math.PI/2),o(n,c),t(),n},this.Ra=function(e,i){var n;n=H[e],n!==u&&n&&(n.position.x=i.position.x!==u?(i.position.x-d.x)/S:n.position.x,n.position.y=i.position.y!==u?(i.position.y-d.y)/S:n.position.y,n.position.z=i.position.z!==u?(i.position.z-d.z)/S:n.position.z,t())
},this.pa=function(e){var t={},e=H[e];return e!==u&&e?(t.position={},t.position.x=e.position.x*S+d.x,t.position.y=e.position.y*S+d.y,t.position.z=e.position.z*S+d.z,t.rotation={},t.rotation.x=e.rotation.x,t.rotation.y=e.rotation.y,t.rotation.z=e.rotation.z,t):t},this.ba=function(i){var n,r=i.name!==u?i.name:"customObj"+M,a=i.width!==u?i.width/S:200,s=i.height!==u?i.height/S:200,l=i.lightColor!==u?i.lightColor:16777215,h=i.axis!==u?i.axis:"y",c=i.darkness!==u?i.darkness:.3;n=i.ia!==u?i.ia:10;var d=i.ga!==u?i.ga:10,p=document.createElement("canvas");p.width=128,p.height=128;var f=p.getContext("2d"),m=f.createRadialGradient(p.width/2,p.height/2,0,p.width/2,p.height/2,p.width/2);return m.addColorStop(.1,"rgba(210,210,210,1)"),m.addColorStop(1,"rgba(255,255,255,1)"),f.fillStyle=m,f.fillRect(0,0,p.width,p.height),p=new THREE.Texture(p),p.needsUpdate=G,1>n&&(n=1),1>d&&(d=1),a=new THREE.PlaneGeometry(a,s,n,d),s=new THREE.MeshBasicMaterial({map:p}),v.A(s),a=new THREE.Mesh(a,s),i.position!==u&&(a.position.x=i.position.x!==u?i.position.x:a.position.x,a.position.y=i.position.y!==u?i.position.y:a.position.y,a.position.z=i.position.z!==u?i.position.z:a.position.z),e(a.position),i=a.position.x,s=a.position.y,n=a.position.z,"x"==h?(a.rotation.y=Math.PI/2,i+=200):"z"==h?n+=200:(a.rotation.x=-Math.PI/2,s+=200),o(r,a),a.receiveShadow=G,l=x.ja(i,s,n,l,c),o(r+"light",l),t(),r},this.lb=da(),this.kb=da(),this.jb=da(),this.ca=function(i){var n,r,a,s,l,h=i.name!==u?i.name:"customObj"+M;return n=i.cx!==u?i.cx:0,r=i.cy!==u?i.cy:0,a=i.cz!==u?i.cz:0,l=i.opacity!==u?i.opacity:1,s=i.rad!==u?i.rad/S:5,n={x:n,y:r,z:a},e(n),r=i.color!==u?i.color:16777215,i=i.numSegments!==u?i.numSegments:6,s=new THREE.SphereGeometry(s,i,i),l=new THREE.Mesh(s,Da(v,r,l)),l.position.set(n.x,n.y,n.z),o(h,l),t(),h},this.aa=function(i){var n,r,a,s,l,h,c=i.name!==u?i.name:"customObj"+M;return n=i.sx!==u?i.sx:0,r=i.sy!==u?i.sy:0,a=i.sz!==u?i.sz:0,s=i.ex!==u?i.ex:0,l=i.ey!==u?i.ey:0,h=i.ez!==u?i.ez:0,n={x:n,y:r,z:a},s={x:s,y:l,z:h},e(n),e(s),i=new THREE.LineBasicMaterial({color:i.color!==u?i.color:16777215,opacity:i.opacity!==u?i.opacity:1,linewidth:i.width!==u?i.width:2}),l=new THREE.Geometry,l.vertices.push(new THREE.Vector3(n.x,n.y,n.z)),l.vertices.push(new THREE.Vector3(s.x,s.y,s.z)),i=new THREE.Line(l,i),o(c,i),t(),c},this.Sa=function(i,n){var r,o,a,s,l,h,c,d;c=H[i],c!==u&&c&&(d=c.geometry,c=c.material,r=n.sx!==u?n.sx:d.vertices[0].x,o=n.sy!==u?n.sy:d.vertices[0].y,a=n.sz!==u?n.sz:d.vertices[0].z,s=n.ex!==u?n.ex:d.vertices[1].x,l=n.ey!==u?n.ey:d.vertices[1].y,h=n.ez!==u?n.ez:d.vertices[1].z,model_start={x:r,y:o,z:a},model_end={x:s,y:l,z:h},n.sx!==u&&e(model_start),n.ex!==u&&e(model_end),o=n.color!==u?n.color:c.color,r=n.width!==u?n.width:c.width,a=n.L!==u?n.L:c.opacity,d.vertices[0].set(model_start.x,model_start.y,model_start.z),d.vertices[1].set(model_end.x,model_end.y,model_end.z),d.verticesNeedUpdate=G,c.color=o,c.width=r,c.opacity=a,t())},this.$=function(i){var n,r,a=i.name!==u?i.name:"customObj"+M;n={x:i.x!==u?i.x:0,y:i.x!==u?i.y:0,z:i.x!==u?i.z:0},e(n),scaleX=i.Ka!==u?i.Ka:1,scaleY=i.La!==u?i.La:1,scaleX/=S,scaleY/=S,r=i.bb;var s=i.color!==u?i.color:16777215,i=i.L!==u?i.L:1;return r===u?r=J:(s=s!==u?s:16777215,i=i!==u?i:1,r=THREE.ImageUtils.loadTexture(r),r=new THREE.SpriteMaterial({map:r,mb:K,color:s}),r.uvScale.set(2,2),r.uvOffset.set(-.5,-.5),r.opacity=i),r=new THREE.Sprite(r),r.position.set(n.x,n.y,n.z),r.scale.set(scaleX,scaleY,1),o(a,r),t(),a},this.moveCustomObject=function(i,n,r,o){try{var a=H[i];if(a===u||!a)return;i={x:n,y:r,z:o},e(i),a.position.set(i.x,i.y,i.z)}catch(s){}t()},this.showCustomObject=function(e){try{var i=H[e];if(i===u||!i)return;i.visible=G}catch(n){}t()},this.hideCustomObject=function(e){try{var i=H[e];if(i===u||!i)return;i.visible=K}catch(n){}t()},this.N=function(e,i,n,r){try{var o=H[e];if(o===u||!o)return;var a=o.scale;H[e].scale.set(a.x*(i/S),a.y*(n/S),a.z*(r/S))}catch(s){}t()}}function Fa(e){var t=J,i=J,n=J,r=J,o=new THREE.Matrix4,t=new THREE.DirectionalLight(16777215);t.position.set(1,1,1),t.position.normalize(),e.add(t),i=new THREE.SpotLight(16777215,.6,500),i.color.r=i.color.g=i.color.b=.9,i.position.set(0,500,0),e.add(i),this.da=function(e){var a;a=e.position,r||(r=new THREE.Vector3(0,0,0)),e=e.up,n||(n=new THREE.Vector3),n.subVectors(a,r).normalize(),0===n.length()&&(n.z=1),o.lookAt(a,r,e),a=n,t.position.set(a.x,a.y,a.z),i.position.set(500*a.x,500*a.y,500*a.z)},this.ja=function(e,t,i,n,r){return n=new THREE.DirectionalLight(n,1.35),n.position.set(e,t,i),n.castShadow=G,n.shadowCameraLeft=-100,n.shadowCameraRight=100,n.shadowCameraTop=100,n.shadowCameraBottom=-100,n.shadowCameraNear=1,n.shadowCameraFar=220,n.shadowMapWidth=1024,n.shadowMapHeight=1024,n.shadowBias=-.005,n.shadowDarkness=r,n}}function Ga(e){var t,i,n,r=0,o=[];for(t=e.B,r=e.rad,i=new THREE.PerspectiveCamera(30,e.Ua/e.Ta,1,1e3),n=new THREE.TrackballControls(i,t),n.rotateSpeed=1.5,n.zoomSpeed=2,n.panSpeed=.8,n.noZoom=K,n.noPan=K,n.staticMoving=G,n.dynamicDampingFactor=.3,n.keys=[65,83,68],n.target.set(0,0,0),t=2*(r/Math.sin(30*(Math.PI/180)))/1.5,i.position.set(t,t,t),e=0;e<TPVIEWER.VIEW_DIR.CUSTOM;e+=1)switch(o[e]={},o[e].fov=0==e?i.fov:1.5*i.fov,o[e].position=0==e?i.position.clone():new THREE.Vector3(0,0,0),o[e].up=0==e?i.up.clone():new THREE.Vector3(0,0,0),o[e].lookAt=n.target.clone(),e){case TPVIEWER.VIEW_DIR.TOP:o[e].position.y=t,o[e].up.z=-1;break;case TPVIEWER.VIEW_DIR.BOTTOM:o[e].position.y=-t,o[e].up.z=1;break;case TPVIEWER.VIEW_DIR.LEFT:o[e].position.x=-t,o[e].up.y=1;break;case TPVIEWER.VIEW_DIR.RIGHT:o[e].position.x=t,o[e].up.y=1;break;case TPVIEWER.VIEW_DIR.FRONT:o[e].position.z=t,o[e].up.y=1;break;case TPVIEWER.VIEW_DIR.BACK:o[e].position.z=-t,o[e].up.y=1}return i.X=n,n.update(),this.C=function(){return i},this.getCameraInfo=function(){return{fov:i.fov,position:{x:i.position.x,y:i.position.y,z:i.position.z},lookAt:{x:n.target.x,y:n.target.y,z:n.target.z},up:{x:i.up.x,y:i.up.y,z:i.up.z},near:i.near,far:i.far}},this.setCamera=function(e){var t,r,a,s,l,h=i.near,c=i.far,d=e.numFrames!==u?e.numFrames:10,p=0;if(e.viewDirection!==u&&0<=e.viewDirection&&e.viewDirection<TPVIEWER.VIEW_DIR.CUSTOM)t=o[e.viewDirection],r=t.fov,a=t.position,s=t.up,l=t.lookAt;else{if(e.camera===u)return;r=e.camera.fov,a=e.camera.position,s=e.camera.up,l=e.camera.lookAt,h=e.camera.near!==u?e.camera.near:i.near,c=e.camera.far!==u?e.camera.far:i.far}if(e.animate!==u&&e.animate)start_fov=i.fov,start_position=i.position,start_up=i.up,start_lookAt=n.target,window.setTimeout(function m(){if(!(p+1>d)){window.setTimeout(m,1e3/30);var e=a,t=s,o=l,h=(p+1)/d,c=start_fov,u=start_position,f=start_up,g=start_lookAt;i.fov=c+(r-c)*h,i.position.set(u.x+(e.x-u.x)*h,u.y+(e.y-u.y)*h,u.z+(e.z-u.z)*h),i.up.set(f.x+(t.x-f.x)*h,f.y+(t.y-f.y)*h,f.z+(t.z-f.z)*h),n.target.set(g.x+(o.x-g.x)*h,g.y+(o.y-g.y)*h,g.z+(o.z-g.z)*h),i.updateProjectionMatrix(),n.update(),p++}},1e3/30);else{e=a,t=s;var f=l;i.fov=r,i.position.set(e.x,e.y,e.z),i.up.set(t.x,t.y,t.z),i.near=h,i.far=c,n.target.set(f.x,f.y,f.z),i.updateProjectionMatrix(),n.update()}},this.Na=function(e,t){i.aspect=e/t,i.updateProjectionMatrix()},this}function Ca(){var e=[],t=[{ambient:new THREE.Color(W([0,0,0])),specular:new THREE.Color(W([0,0,0])),shininess:0,n:K},{ambient:new THREE.Color(W([.05,.05,0])),specular:new THREE.Color(W([.7,.7,.7])),shininess:78,n:K},{ambient:new THREE.Color(W([.2125,.1275,.054])),specular:new THREE.Color(W([.393548,.271906,.166721])),diffuse:new THREE.Color(W([.714,.4284,.18144])),shininess:20,n:G},{ambient:new THREE.Color(W([.19225,.19225,.19225])),specular:new THREE.Color(W([.508273,.508273,.508273])),diffuse:new THREE.Color(W([.50754,.50754,.50754])),shininess:40,n:G},{ambient:new THREE.Color(W([.24725,.1995,.0745])),specular:new THREE.Color(W([.628281,.555802,.366065])),diffuse:new THREE.Color(W([.75164,.60648,.22648])),shininess:40,n:G},{ambient:new THREE.Color(W([.05,.05,0])),specular:new THREE.Color(W([.7,.7,.7])),shininess:78,n:K},{ambient:new THREE.Color(W([.25,.25,.25])),specular:new THREE.Color(W([.774597,.774597,.774597])),diffuse:new THREE.Color(W([.4,.4,.4])),shininess:60,n:G},{ambient:new THREE.Color(W([.329412,.223529,.027451])),specular:new THREE.Color(W([.992157,.941176,.807843])),diffuse:new THREE.Color(W([.780392,.568627,.113725])),shininess:22,n:G},{ambient:new THREE.Color(W([.25,.25,.25])),specular:new THREE.Color(W([.774597,.774597,.774597])),diffuse:new THREE.Color(W([.4,.4,.4])),shininess:60,n:G}];this.Q=G,this.Za=function(){return 1},this.$a=function(){return 1},this.ea=function(e,t){t.diffuse!==u&&t.diffuse!=J&&(e.color=new THREE.Color(t.diffuse)),t.ambient!==u&&t.ambient!=J&&(e.ambient=new THREE.Color(t.ambient)),t.specular!==u&&t.specular!=J&&(e.specular=new THREE.Color(t.specular)),t.shininess!==u&&t.shininess!=J&&(e.shininess=t.shininess),t.reflectivity!==u&&t.reflectivity!=J&&(e.reflectivity=t.reflectivity)},this.fa=function(e,i){i!==u&&(i-=1,i>=t.length||0>i||(e.color=t[i].diffuse!=u?t[i].diffuse:e.H,e.ambient=t[i].ambient,e.specular=t[i].specular,e.shininess=t[i].shininess))},this.Ia=function(e){e.opacity=e.U,e.transparent=1<=e.opacity?K:G,e.color=e.H,e.ambient=e.za,e.specular=e.Ca,e.shininess=e.Ba,e.reflectivity=e.Aa},this.A=function(t){e.push(t)},this.d=function(t,i){for(var n,r=0;r<e.length;r++)n=e[r],n.uniforms===u||n.uniforms==J||n.uniforms[t]===u||n.uniforms[t]==J||(n.uniforms[t].value=i)}}function W(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}function Ea(e){e.U=e.opacity===u?1:e.opacity,e.H=e.color.clone(),e.za=e.ambient===u?new THREE.Color(0):e.ambient.clone(),e.Ba=e.shininess===u?0:e.shininess,e.Ca=e.specular===u?new THREE.Color(0):e.specular.clone(),e.Aa=e.reflectivity===u?0:e.reflectivity}function Da(e,t,i){return offset_units=offset_factor=1,t=new THREE.MeshLambertMaterial({vertexColors:THREE.VertexColors,color:t!==u?t:14737632,polygonOffset:G,polygonOffsetFactor:offset_factor,polygonOffsetUnits:offset_units,blending:THREE.NormalBlending,opacity:i!==u?i:1,specular:0,shininess:0,shading:THREE.SmoothShading}),e.Q&&(t.side=THREE.DoubleSide),Ea(t),t}function Ha(e,t,i,n,r,o){if(n===u&&Ia("Missing required offset argument"),r===u&&Ia("Missing required value argument"),(0>n||n+i>e.byteLength)&&Ia("Invalid index: "+n),1===i||!!o===Ja)if(0===(e.byteOffset+n)%i)new t(e.buffer,e.byteOffset+n,1)[0]=r;else for(new t(Ka.buffer)[0]=r,t=0;i>t;t++)e.P[t+n]=Ka[t];else for(new t(Ka.buffer)[0]=r,t=0;i>t;t++)e.P[n+t]=Ka[i-1-t]}function Ia(e){throw Error(e)}function _intToFloatCoord(e){return e/1e4}function _intToFloatMaterial(e){return e/100}function _getNormalVal(e,t,i){var n=0,r=0,o=0,e=e/1e3,t=t/1e3,o=Math.sin(t);xy=Math.cos(t),n=xy*Math.cos(e),r=xy*Math.sin(e),i.x=n,i.y=r,i.z=o}function _checkDiffuseColor(e){for(var t=0;4>t;++t)0>e[t]&&(e[t]=0),1<e[t]&&(e[t]=1);1e-4>e[0]+e[1]+e[2]&&(e[0]=.8,e[1]=.8,e[2]=.8,e[3]=1)}function _readMassProperties(e,t){t.min=new THREE.Vector3,t.max=new THREE.Vector3,t.min.x=_intToFloatCoord(e.readInt32()),t.min.y=_intToFloatCoord(e.readInt32()),t.min.z=_intToFloatCoord(e.readInt32()),t.max.x=_intToFloatCoord(e.readInt32()),t.max.y=_intToFloatCoord(e.readInt32()),t.max.z=_intToFloatCoord(e.readInt32()),t.area=e.readInt32(),t.volume=e.readInt32(),t.massComputed=!1}!function($){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},s={array:function(e){var t,i,n,r,o=["["],a=e.length;for(n=0;a>n;n+=1)r=e[n],i=s[typeof r],i&&(r=i(r),"string"==typeof r&&(t&&(o[o.length]=","),o[o.length]=r,t=!0));return o[o.length]="]",o.join("")},"boolean":function(e){return String(e)},"null":function(){return"null"},number:function(e){return isFinite(e)?String(e):"null"},object:function(e){if(e){if(e instanceof Array)return s.array(e);var t,i,n,r,o=["{"];for(n in e)r=e[n],i=s[typeof r],i&&(r=i(r),"string"==typeof r&&(t&&(o[o.length]=","),o.push(s.string(n),":",r),t=!0));return o[o.length]="}",o.join("")}return"null"},string:function(e){return/["\\\x00-\x1f]/.test(e)&&(e=e.replace(/([\x00-\x1f\\"])/g,function(e,t){var i=m[t];return i?i:(i=t.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))})),'"'+e+'"'}};$.toJSON=function(e){var t=isNaN(e)?s[typeof e]:s.number;return t?t(e):void 0},$.parseJSON=function(v,safe){return void 0===safe&&(safe=$.parseJSON.safe),safe&&!/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/.test(v)?void 0:eval("("+v+")")},$.parseJSON.safe=!1}(jQuery),function(e,t){function i(t,i){var r=t.nodeName.toLowerCase();if("area"===r){var o,a=t.parentNode,s=a.name;return t.href&&s&&"map"===a.nodeName.toLowerCase()?(o=e("img[usemap=#"+s+"]")[0],!!o&&n(o)):!1}return(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"==r?t.href||i:i)&&n(t)}function n(t){return!e(t).parents().andSelf().filter(function(){return"hidden"===e.curCSS(this,"visibility")||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.8.24",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,i){return"number"==typeof t?this.each(function(){var n=this;setTimeout(function(){e(n).focus(),i&&i.call(n)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,r,o=e(this[0]);o.length&&o[0]!==document;){if(n=o.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function r(t,i,n,r){return e.each(o,function(){i-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,n&&(i-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),r&&(i-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],a=n.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?s["inner"+n].call(this):this.each(function(){e(this).css(a,r(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?s["outer"+n].call(this,t):this.each(function(){e(this).css(a,r(this,t,!0,i)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement("div"));i.offsetHeight,e.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart="onselectstart"in i,t.removeChild(i).style.display="none"}),e.curCSS||(e.curCSS=e.css),e.extend(e.ui,{plugin:{add:function(t,i,n){var r=e.ui[t].prototype;for(var o in n)r.plugins[o]=r.plugins[o]||[],r.plugins[o].push([i,n[o]])},call:function(e,t,i){var n=e.plugins[t];if(n&&e.element[0].parentNode)for(var r=0;r<n.length;r++)e.options[n[r][0]]&&n[r][1].apply(e.element,i)}},contains:function(e,t){return document.compareDocumentPosition?16&e.compareDocumentPosition(t):e!==t&&e.contains(t)},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return t[n]>0?!0:(t[n]=1,r=t[n]>0,t[n]=0,r)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,n,r,o,a){return e.ui.isOverAxis(t,n,o)&&e.ui.isOverAxis(i,r,a)}}))}(jQuery),function(e,t){if(e.cleanData){var i=e.cleanData;e.cleanData=function(t){for(var n,r=0;null!=(n=t[r]);r++)try{e(n).triggerHandler("remove")}catch(o){}i(t)}}else{var n=e.fn.remove;e.fn.remove=function(t,i){return this.each(function(){return i||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),n.call(e(this),t,i)})}}e.widget=function(t,i,n){var r,o=t.split(".")[0];t=t.split(".")[1],r=o+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][r]=function(i){return!!e.data(i,t)},e[o]=e[o]||{},e[o][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var a=new i;a.options=e.extend(!0,{},a.options),e[o][t].prototype=e.extend(!0,a,{namespace:o,widgetName:t,widgetEventPrefix:e[o][t].prototype.widgetEventPrefix||t,widgetBaseClass:r},n),e.widget.bridge(t,e[o][t])},e.widget.bridge=function(i,n){e.fn[i]=function(r){var o="string"==typeof r,a=Array.prototype.slice.call(arguments,1),s=this;return r=!o&&a.length?e.extend.apply(null,[!0,r].concat(a)):r,o&&"_"===r.charAt(0)?s:(o?this.each(function(){var n=e.data(this,i),o=n&&e.isFunction(n[r])?n[r].apply(n,a):n;return o!==n&&o!==t?(s=o,!1):void 0}):this.each(function(){var t=e.data(this,i);t?t.option(r||{})._init():e.data(this,i,new n(r,this))}),s)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,i){e.data(i,this.widgetName,this),this.element=e(i),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var n=this;this.element.bind("remove."+this.widgetName,function(){n.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(i,n){var r=i;if(0===arguments.length)return e.extend({},this.options);if("string"==typeof i){if(n===t)return this.options[i];r={},r[i]=n}return this._setOptions(r),this},_setOptions:function(t){var i=this;return e.each(t,function(e,t){i._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,i,n){var r,o,a=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent,o)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(e.isFunction(a)&&a.call(this.element[0],i,n)===!1||i.isDefaultPrevented())}}}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,r=1==i.which,o="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return r&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.browser.msie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e){e.ui=e.ui||{};var t=/left|center|right/,i=/top|center|bottom/,n="center",r={},o=e.fn.position,a=e.fn.offset;e.fn.position=function(a){if(!a||!a.of)return o.apply(this,arguments);a=e.extend({},a);var s,l,h,c=e(a.of),d=c[0],u=(a.collision||"flip").split(" "),p=a.offset?a.offset.split(" "):[0,0];return 9===d.nodeType?(s=c.width(),l=c.height(),h={top:0,left:0}):d.setTimeout?(s=c.width(),l=c.height(),h={top:c.scrollTop(),left:c.scrollLeft()}):d.preventDefault?(a.at="left top",s=l=0,h={top:a.of.pageY,left:a.of.pageX}):(s=c.outerWidth(),l=c.outerHeight(),h=c.offset()),e.each(["my","at"],function(){var e=(a[this]||"").split(" ");1===e.length&&(e=t.test(e[0])?e.concat([n]):i.test(e[0])?[n].concat(e):[n,n]),e[0]=t.test(e[0])?e[0]:n,e[1]=i.test(e[1])?e[1]:n,a[this]=e}),1===u.length&&(u[1]=u[0]),p[0]=parseInt(p[0],10)||0,1===p.length&&(p[1]=p[0]),p[1]=parseInt(p[1],10)||0,"right"===a.at[0]?h.left+=s:a.at[0]===n&&(h.left+=s/2),"bottom"===a.at[1]?h.top+=l:a.at[1]===n&&(h.top+=l/2),h.left+=p[0],h.top+=p[1],this.each(function(){var t,i=e(this),o=i.outerWidth(),c=i.outerHeight(),d=parseInt(e.curCSS(this,"marginLeft",!0))||0,f=parseInt(e.curCSS(this,"marginTop",!0))||0,m=o+d+(parseInt(e.curCSS(this,"marginRight",!0))||0),g=c+f+(parseInt(e.curCSS(this,"marginBottom",!0))||0),v=e.extend({},h);"right"===a.my[0]?v.left-=o:a.my[0]===n&&(v.left-=o/2),"bottom"===a.my[1]?v.top-=c:a.my[1]===n&&(v.top-=c/2),r.fractions||(v.left=Math.round(v.left),v.top=Math.round(v.top)),t={left:v.left-d,top:v.top-f},e.each(["left","top"],function(i,n){e.ui.position[u[i]]&&e.ui.position[u[i]][n](v,{targetWidth:s,targetHeight:l,elemWidth:o,elemHeight:c,collisionPosition:t,collisionWidth:m,collisionHeight:g,offset:p,my:a.my,at:a.at})}),e.fn.bgiframe&&i.bgiframe(),i.offset(e.extend(v,{using:a.using}))})},e.ui.position={fit:{left:function(t,i){var n=e(window),r=i.collisionPosition.left+i.collisionWidth-n.width()-n.scrollLeft();t.left=r>0?t.left-r:Math.max(t.left-i.collisionPosition.left,t.left)},top:function(t,i){var n=e(window),r=i.collisionPosition.top+i.collisionHeight-n.height()-n.scrollTop();t.top=r>0?t.top-r:Math.max(t.top-i.collisionPosition.top,t.top)}},flip:{left:function(t,i){if(i.at[0]!==n){var r=e(window),o=i.collisionPosition.left+i.collisionWidth-r.width()-r.scrollLeft(),a="left"===i.my[0]?-i.elemWidth:"right"===i.my[0]?i.elemWidth:0,s="left"===i.at[0]?i.targetWidth:-i.targetWidth,l=-2*i.offset[0];t.left+=i.collisionPosition.left<0?a+s+l:o>0?a+s+l:0}},top:function(t,i){if(i.at[1]!==n){var r=e(window),o=i.collisionPosition.top+i.collisionHeight-r.height()-r.scrollTop(),a="top"===i.my[1]?-i.elemHeight:"bottom"===i.my[1]?i.elemHeight:0,s="top"===i.at[1]?i.targetHeight:-i.targetHeight,l=-2*i.offset[1];t.top+=i.collisionPosition.top<0?a+s+l:o>0?a+s+l:0}}}},e.offset.setOffset||(e.offset.setOffset=function(t,i){/static/.test(e.curCSS(t,"position"))&&(t.style.position="relative");var n=e(t),r=n.offset(),o=parseInt(e.curCSS(t,"top",!0),10)||0,a=parseInt(e.curCSS(t,"left",!0),10)||0,s={top:i.top-r.top+o,left:i.left-r.left+a};"using"in i?i.using.call(t,s):n.css(s)},e.fn.offset=function(t){var i=this[0];return i&&i.ownerDocument?t?e.isFunction(t)?this.each(function(i){e(this).offset(t.call(this,i,e(this).offset()))}):this.each(function(){e.offset.setOffset(this,t)}):a.call(this):null}),e.curCSS||(e.curCSS=e.css),function(){var t,i,n,o,a,s=document.getElementsByTagName("body")[0],l=document.createElement("div");t=document.createElement(s?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(var h in n)t.style[h]=n[h];t.appendChild(l),i=s||document.documentElement,i.insertBefore(t,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",o=e(l).offset(function(e,t){return t}).offset(),t.innerHTML="",i.removeChild(t),a=o.top+o.left+(s?2e3:0),r.fractions=a>21&&22>a}()}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){return this.element.data("draggable")?(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this):void 0},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(i.iframeFix&&e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var n=this.element[0],r=!1;n&&(n=n.parentNode);)n==document&&(r=!0);if(!r&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var o=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){o._trigger("stop",t)!==!1&&o._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]!=this.element[0]&&!/(fixed|absolute)/.test(n.css("position"))&&n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);
else{var i=e(t.containment),n=i[0];if(!n)return;var r=(i.offset(),"hidden"!=e(n).css("overflow"));this.containment=[(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0),(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0),(r?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(r?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,r=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n),left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n)}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(n[0].tagName),o=t.pageX,a=t.pageY;if(this.originalPosition){var s;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();s=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else s=this.containment;t.pageX-this.offset.click.left<s[0]&&(o=s[0]+this.offset.click.left),t.pageY-this.offset.click.top<s[1]&&(a=s[1]+this.offset.click.top),t.pageX-this.offset.click.left>s[2]&&(o=s[2]+this.offset.click.left),t.pageY-this.offset.click.top>s[3]&&(a=s[3]+this.offset.click.top)}if(i.grid){var h=i.grid[1]?this.originalPageY+Math.round((a-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;a=s?h-this.offset.click.top<s[1]||h-this.offset.click.top>s[3]?h-this.offset.click.top<s[1]?h+i.grid[1]:h-i.grid[1]:h:h;var c=i.grid[0]?this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;o=s?c-this.offset.click.left<s[0]||c-this.offset.click.left>s[2]?c-this.offset.click.left<s[0]?c+i.grid[0]:c-i.grid[0]:c:c}}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:n.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&e.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.extend(e.ui.draggable,{version:"1.8.24"}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("draggable"),r=n.options,o=e.extend({},i,{item:n.element});n.sortables=[],e(r.connectToSortable).each(function(){var i=e.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,o))})},stop:function(t,i){var n=e(this).data("draggable"),r=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,r))})},drag:function(t,i){var n=e(this).data("draggable"),r=this;e.each(n.sortables,function(){this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(r).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),r=e(this).data("draggable").options;n.css("opacity")&&(r._opacity=n.css("opacity")),n.css("opacity",r.opacity)},stop:function(t,i){var n=e(this).data("draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("draggable"),n=i.options,r=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(n.axis&&"x"==n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"==n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"==n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"==n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){for(var n=e(this).data("draggable"),r=n.options,o=r.snapTolerance,a=i.offset.left,s=a+n.helperProportions.width,l=i.offset.top,h=l+n.helperProportions.height,c=n.snapElements.length-1;c>=0;c--){var d=n.snapElements[c].left,u=d+n.snapElements[c].width,p=n.snapElements[c].top,f=p+n.snapElements[c].height;if(a>d-o&&u+o>a&&l>p-o&&f+o>l||a>d-o&&u+o>a&&h>p-o&&f+o>h||s>d-o&&u+o>s&&l>p-o&&f+o>l||s>d-o&&u+o>s&&h>p-o&&f+o>h){if("inner"!=r.snapMode){var m=Math.abs(p-h)<=o,g=Math.abs(f-l)<=o,v=Math.abs(d-s)<=o,E=Math.abs(u-a)<=o;m&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d-n.helperProportions.width}).left-n.margins.left),E&&(i.position.left=n._convertPositionTo("relative",{top:0,left:u}).left-n.margins.left)}var y=m||g||v||E;if("outer"!=r.snapMode){var m=Math.abs(p-l)<=o,g=Math.abs(f-h)<=o,v=Math.abs(d-a)<=o,E=Math.abs(u-s)<=o;m&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f-n.helperProportions.height,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d}).left-n.margins.left),E&&(i.position.left=n._convertPositionTo("relative",{top:0,left:u-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[c].snapping&&(m||g||v||E||y)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=m||g||v||E||y}else n.snapElements[c].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options,i=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});if(i.length){var n=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=n+e}),this[0].style.zIndex=n+i.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),r=e(this).data("draggable").options;n.css("zIndex")&&(r._zIndex=n.css("zIndex")),n.css("zIndex",r.zIndex)},stop:function(t,i){var n=e(this).data("draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(e){e.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],i=0;i<t.length;i++)t[i]==this&&t.splice(i,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(t,i){"accept"==t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return!1;var r=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope==n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(r=!0,!1):void 0}),r?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.extend(e.ui.droppable,{version:"1.8.24"}),e.ui.intersect=function(t,i,n){if(!i.offset)return!1;var r=(t.positionAbs||t.position.absolute).left,o=r+t.helperProportions.width,a=(t.positionAbs||t.position.absolute).top,s=a+t.helperProportions.height,l=i.offset.left,h=l+i.proportions.width,c=i.offset.top,d=c+i.proportions.height;switch(n){case"fit":return r>=l&&h>=o&&a>=c&&d>=s;case"intersect":return l<r+t.helperProportions.width/2&&o-t.helperProportions.width/2<h&&c<a+t.helperProportions.height/2&&s-t.helperProportions.height/2<d;case"pointer":var u=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,f=e.ui.isOver(p,u,c,l,i.proportions.height,i.proportions.width);return f;case"touch":return(a>=c&&d>=a||s>=c&&d>=s||c>a&&s>d)&&(r>=l&&h>=r||o>=l&&h>=o||l>r&&o>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n=e.ui.ddmanager.droppables[t.options.scope]||[],r=i?i.type:null,o=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var a=0;a<n.length;a++)if(!(n[a].options.disabled||t&&!n[a].accept.call(n[a].element[0],t.currentItem||t.element))){for(var s=0;s<o.length;s++)if(o[s]==n[a].element[0]){n[a].proportions.height=0;continue e}n[a].visible="none"!=n[a].element.css("display"),n[a].visible&&("mousedown"==r&&n[a]._activate.call(n[a],i),n[a].offset=n[a].element.offset(),n[a].proportions={width:n[a].element[0].offsetWidth,height:n[a].element[0].offsetHeight})}},drop:function(t,i){var n=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parents(":not(body,html)").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n=e.ui.intersect(t,this,this.options.tolerance),r=n||1!=this.isover?n&&0==this.isover?"isover":null:"isout";if(r){var o;if(this.options.greedy){var a=this.options.scope,s=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===a});s.length&&(o=e.data(s[0],"droppable"),o.greedyChild="isover"==r?1:0)}o&&"isover"==r&&(o.isover=0,o.isout=1,o._out.call(o,i)),this[r]=1,this["isout"==r?"isover":"isout"]=0,this["isover"==r?"_over":"_out"].call(this,i),o&&"isout"==r&&(o.isout=0,o.isover=1,o._over.call(o,i))}}})},dragStop:function(t,i){t.element.parents(":not(body,html)").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e){e.widget("ui.resizable",e.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,i=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=i.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var n=this.handles.split(",");this.handles={};for(var r=0;r<n.length;r++){var o=e.trim(n[r]),a="ui-resizable-"+o,s=e('<div class="ui-resizable-handle '+a+'"></div>');s.css({zIndex:i.zIndex}),"se"==o&&s.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[o]=".ui-resizable-"+o,this.element.append(s)}}this._renderAxis=function(t){t=t||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var n=e(this.handles[i],this.element),r=0;r=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth();var o=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");t.css(o,r),this._proportionallyResize()}e(this.handles[i]).length}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),i.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").hover(function(){i.disabled||(e(this).removeClass("ui-resizable-autohide"),t._handles.show())},function(){i.disabled||t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var i=this.element;i.after(this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")})).remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var i=!1;for(var n in this.handles)e(this.handles[n])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var n=this.options,r=this.element.position(),o=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(o.is(".ui-draggable")||/absolute/.test(o.css("position")))&&o.css({position:"absolute",top:r.top,left:r.left}),this._renderProxy();var a=t(this.helper.css("left")),s=t(this.helper.css("top"));n.containment&&(a+=e(n.containment).scrollLeft()||0,s+=e(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:a,top:s},this.size=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.originalPosition={left:a,top:s},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1;var l=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor","auto"==l?this.axis+"-resize":l),o.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(t){var i=this.helper,n=(this.options,this.originalMousePosition),r=this.axis,o=t.pageX-n.left||0,a=t.pageY-n.top||0,s=this._change[r];if(!s)return!1;{var l=s.apply(this,[t,o,a]);e.browser.msie&&e.browser.version<7,this.sizeDiff}return this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(l=this._updateRatio(l,t)),l=this._respectSize(l,t),this._propagate("resize",t),i.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",t,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var i=this.options,n=this;if(this._helper){var r=this._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),a=o&&e.ui.hasScroll(r[0],"left")?0:n.sizeDiff.height,s=o?0:n.sizeDiff.width,l={width:n.helper.width()-s,height:n.helper.height()-a},h=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,c=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;i.animate||this.element.css(e.extend(l,{top:c,left:h})),n.helper.height(n.size.height),n.helper.width(n.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,r,o,a,s=this.options;a={minWidth:i(s.minWidth)?s.minWidth:0,maxWidth:i(s.maxWidth)?s.maxWidth:1/0,minHeight:i(s.minHeight)?s.minHeight:0,maxHeight:i(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,r=a.minWidth/this.aspectRatio,n=a.maxHeight*this.aspectRatio,o=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),r>a.minHeight&&(a.minHeight=r),n<a.maxWidth&&(a.maxWidth=n),o<a.maxHeight&&(a.maxHeight=o)),this._vBoundaries=a},_updateCache:function(e){this.options;this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=(this.options,this.position),n=this.size,r=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"==r&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"==r&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e,t){var n=(this.helper,this._vBoundaries),r=(this._aspectRatio||t.shiftKey,this.axis),o=i(e.width)&&n.maxWidth&&n.maxWidth<e.width,a=i(e.height)&&n.maxHeight&&n.maxHeight<e.height,s=i(e.width)&&n.minWidth&&n.minWidth>e.width,l=i(e.height)&&n.minHeight&&n.minHeight>e.height;s&&(e.width=n.minWidth),l&&(e.height=n.minHeight),o&&(e.width=n.maxWidth),a&&(e.height=n.maxHeight);var h=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,d=/sw|nw|w/.test(r),u=/nw|ne|n/.test(r);s&&d&&(e.left=h-n.minWidth),o&&d&&(e.left=h-n.maxWidth),l&&u&&(e.top=c-n.minHeight),a&&u&&(e.top=c-n.maxHeight);var p=!e.width&&!e.height;return p&&!e.left&&e.top?e.top=null:p&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){this.options;if(this._proportionallyResizeElements.length)for(var t=this.helper||this.element,i=0;i<this._proportionallyResizeElements.length;i++){var n=this._proportionallyResizeElements[i];if(!this.borderDif){var r=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],o=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")];this.borderDif=e.map(r,function(e,t){var i=parseInt(e,10)||0,n=parseInt(o[t],10)||0;return i+n})}e.browser.msie&&(e(t).is(":hidden")||e(t).parents(":hidden").length)||n.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,i=this.options;if(this.elementOffset=t.offset(),this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var n=e.browser.msie&&e.browser.version<7,r=n?1:0,o=n?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+o,height:this.element.outerHeight()+o,position:"absolute",left:this.elementOffset.left-r+"px",top:this.elementOffset.top-r+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=(this.options,this.originalSize),n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=(this.options,this.originalSize),r=this.originalPosition;return{top:r.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!=t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.extend(e.ui.resizable,{version:"1.8.24"}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("resizable"),r=n.options,o=n.originalSize,a=n.originalPosition,s={height:n.size.height-o.height||0,width:n.size.width-o.width||0,top:n.position.top-a.top||0,left:n.position.left-a.left||0},l=function(t,n){e(t).each(function(){var t=e(this),r=e(this).data("resizable-alsoresize"),o={},a=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var i=(r[t]||0)+(s[t]||0);i&&i>=0&&(o[t]=i||null)}),t.css(o)})};"object"!=typeof r.alsoResize||r.alsoResize.nodeType?l(r.alsoResize):e.each(r.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("resizable"),n=i.options,r=i._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),a=o&&e.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,s=o?0:i.sizeDiff.width,l={width:i.size.width-s,height:i.size.height-a},h=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&h?{top:c,left:h}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&e(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i=e(this).data("resizable"),n=i.options,r=i.element,o=n.containment,a=o instanceof e?o.get(0):/parent/.test(o)?r.parent().get(0):o;if(a)if(i.containerElement=e(a),/document/.test(o)||o==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var s=e(a),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,i){l[e]=t(s.css("padding"+i))}),i.containerOffset=s.offset(),i.containerPosition=s.position(),i.containerSize={height:s.innerHeight()-l[3],width:s.innerWidth()-l[1]};var h=i.containerOffset,c=i.containerSize.height,d=i.containerSize.width,u=e.ui.hasScroll(a,"left")?a.scrollWidth:d,p=e.ui.hasScroll(a)?a.scrollHeight:c;i.parentData={element:a,left:h.left,top:h.top,width:u,height:p}}},resize:function(t){var i=e(this).data("resizable"),n=i.options,r=(i.containerSize,i.containerOffset),o=(i.size,i.position),a=i._aspectRatio||t.shiftKey,s={top:0,left:0},l=i.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(s=r),o.left<(i._helper?r.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-r.left:i.position.left-s.left),a&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=n.helper?r.left:0),o.top<(i._helper?r.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-r.top:i.position.top),a&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?r.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var h=Math.abs((i._helper?i.offset.left-s.left:i.offset.left-s.left)+i.sizeDiff.width),c=Math.abs((i._helper?i.offset.top-s.top:i.offset.top-r.top)+i.sizeDiff.height),d=i.containerElement.get(0)==i.element.parent().get(0),u=/relative|absolute/.test(i.containerElement.css("position"));d&&u&&(h-=i.parentData.left),h+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-h,a&&(i.size.height=i.size.width/i.aspectRatio)),c+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-c,a&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=e(this).data("resizable"),i=t.options,n=(t.position,t.containerOffset),r=t.containerPosition,o=t.containerElement,a=e(t.helper),s=a.offset(),l=a.outerWidth()-t.sizeDiff.width,h=a.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:s.left-r.left-n.left,width:l,height:h}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:s.left-r.left-n.left,width:l,height:h})}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),i=t.options,n=t.size;
t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){{var t=e(this).data("resizable");t.options}t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){{var t=e(this).data("resizable");t.options}t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t){{var i=e(this).data("resizable"),n=i.options,r=i.size,o=i.originalSize,a=i.originalPosition,s=i.axis;n._aspectRatio||t.shiftKey}n.grid="number"==typeof n.grid?[n.grid,n.grid]:n.grid;var l=Math.round((r.width-o.width)/(n.grid[0]||1))*(n.grid[0]||1),h=Math.round((r.height-o.height)/(n.grid[1]||1))*(n.grid[1]||1);/^(se|s|e)$/.test(s)?(i.size.width=o.width+l,i.size.height=o.height+h):/^(ne)$/.test(s)?(i.size.width=o.width+l,i.size.height=o.height+h,i.position.top=a.top-h):/^(sw)$/.test(s)?(i.size.width=o.width+l,i.size.height=o.height+h,i.position.left=a.left-l):(i.size.width=o.width+l,i.size.height=o.height+h,i.position.top=a.top-h,i.position.left=a.left-l)}});var t=function(e){return parseInt(e,10)||0},i=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var i;this.refresh=function(){i=e(t.options.filter,t.element[0]),i.addClass("ui-selectee"),i.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=i.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(t){var i=this;if(this.opos=[t.pageX,t.pageY],!this.options.disabled){var n=this.options;this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,!t.metaKey&&!t.ctrlKey&&(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().andSelf().each(function(){var n=e.data(this,"selectable-item");if(n){var r=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected");return n.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),n.unselecting=!r,n.selecting=r,n.selected=r,r?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1}})}},_mouseDrag:function(t){var i=this;if(this.dragged=!0,!this.options.disabled){var n=this.options,r=this.opos[0],o=this.opos[1],a=t.pageX,s=t.pageY;if(r>a){var l=a;a=r,r=l}if(o>s){var l=s;s=o,o=l}return this.helper.css({left:r,top:o,width:a-r,height:s-o}),this.selectees.each(function(){var l=e.data(this,"selectable-item");if(l&&l.element!=i.element[0]){var h=!1;"touch"==n.tolerance?h=!(l.left>a||l.right<r||l.top>s||l.bottom<o):"fit"==n.tolerance&&(h=l.left>r&&l.right<a&&l.top>o&&l.bottom<s),h?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,i._trigger("selecting",t,{selecting:l.element}))):(l.selecting&&((t.metaKey||t.ctrlKey)&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),i._trigger("unselecting",t,{unselecting:l.element}))),l.selected&&!t.metaKey&&!t.ctrlKey&&!l.startselected&&(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,i._trigger("unselecting",t,{unselecting:l.element})))}}),!1}},_mouseStop:function(t){var i=this;this.dragged=!1;this.options;return e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.extend(e.ui.selectable,{version:"1.8.24"})}(jQuery),function(e){e.widget("ui.sortable",e.ui.mouse,{widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},destroy:function(){e.Widget.prototype.destroy.call(this),this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget()[i?"addClass":"removeClass"]("ui-sortable-disabled")):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(t);{var r=null,o=this;e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")==o?(r=e(this),!1):void 0})}if(e.data(t.target,n.widgetName+"-item")==o&&(r=e(t.target)),!r)return!1;if(this.options.handle&&!i){var a=!1;if(e(this.options.handle,r).find("*").andSelf().each(function(){this==t.target&&(a=!0)}),!a)return!1}return this.currentItem=r,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,n){var r=this.options,o=this;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",r.cursor)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(var a=this.containers.length-1;a>=0;a--)this.containers[a]._trigger("activate",t,o._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,n=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(document).scrollTop()<i.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)),t.pageX-e(document).scrollLeft()<i.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))),n!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var r=this.items.length-1;r>=0;r--){var o=this.items[r],a=o.item[0],s=this._intersectsWithPointer(o);if(s&&o.instance===this.currentContainer&&a!=this.currentItem[0]&&this.placeholder[1==s?"next":"prev"]()[0]!=a&&!e.ui.contains(this.placeholder[0],a)&&("semi-dynamic"==this.options.type?!e.ui.contains(this.element[0],a):!0)){if(this.direction=1==s?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(o))break;this._rearrange(t,o),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,r=n.placeholder.offset();n.reverting=!0,e(this.helper).animate({left:r.left-this.offset.parent.left-n.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:r.top-this.offset.parent.top-n.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){var t=this;if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("deactivate",null,t._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",null,t._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,o=e.left,a=o+e.width,s=e.top,l=s+e.height,h=this.offset.click.top,c=this.offset.click.left,d=n+h>s&&l>n+h&&t+c>o&&a>t+c;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?d:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<a&&s<n+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),r=i&&n,o=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return r?this.floating?a&&"right"==a||"down"==o?2:1:o&&("down"==o?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"==o&&n||"left"==o&&!n:r&&("down"==r&&i||"up"==r&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],n=[],r=this._connectWith();if(r&&t)for(var o=r.length-1;o>=0;o--)for(var a=e(r[o]),s=a.length-1;s>=0;s--){var l=e.data(a[s],this.widgetName);l&&l!=this&&!l.options.disabled&&n.push([e.isFunction(l.options.items)?l.options.items.call(l.element):e(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}n.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var o=n.length-1;o>=0;o--)n[o][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){for(var e=this.currentItem.find(":data("+this.widgetName+"-item)"),t=0;t<this.items.length;t++)for(var i=0;i<e.length;i++)e[i]==this.items[t].item[0]&&this.items.splice(t,1)},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,n=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],r=this._connectWith();if(r&&this.ready)for(var o=r.length-1;o>=0;o--)for(var a=e(r[o]),s=a.length-1;s>=0;s--){var l=e.data(a[s],this.widgetName);l&&l!=this&&!l.options.disabled&&(n.push([e.isFunction(l.options.items)?l.options.items.call(l.element[0],t,{item:this.currentItem}):e(l.options.items,l.element),l]),this.containers.push(l))}for(var o=n.length-1;o>=0;o--)for(var h=n[o][1],c=n[o][0],s=0,d=c.length;d>s;s++){var u=e(c[s]);u.data(this.widgetName+"-item",h),i.push({item:u,instance:h,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.instance==this.currentContainer||!this.currentContainer||n.item[0]==this.currentItem[0]){var r=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item;t||(n.width=r.outerWidth(),n.height=r.outerHeight());var o=r.offset();n.left=o.left,n.top=o.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var o=this.containers[i].element.offset();this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){var i=t||this,n=i.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;n.placeholder={element:function(){var t=e(document.createElement(i.currentItem[0].nodeName)).addClass(r||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(t.style.visibility="hidden"),t},update:function(e,t){(!r||n.forcePlaceholderSize)&&(t.height()||t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10)))}}}i.placeholder=e(n.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),n.placeholder.update(i,i.placeholder)},_contactContainers:function(t){for(var i=null,n=null,r=this.containers.length-1;r>=0;r--)if(!e.ui.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(i&&e.ui.contains(this.containers[r].element[0],i.element[0]))continue;i=this.containers[r],n=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",t,this._uiHash(this)),this.containers[r].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1;else if(this.currentContainer!=this.containers[n]){for(var o=1e4,a=null,s=this.positionAbs[this.containers[n].floating?"left":"top"],l=this.items.length-1;l>=0;l--)if(e.ui.contains(this.containers[n].element[0],this.items[l].item[0])){var h=this.containers[n].floating?this.items[l].item.offset().left:this.items[l].item.offset().top;Math.abs(h-s)<o&&(o=Math.abs(h-s),a=this.items[l],this.direction=h-s>0?"down":"up")}if(!a&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[n],a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[n].element,!0),this._trigger("change",t,this._uiHash()),this.containers[n]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(""==n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],n=e(t.containment).offset(),r="hidden"!=e(i).css("overflow");this.containment=[n.left+(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,r=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-(e.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n),left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-(e.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n)}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(n[0].tagName);"relative"==this.cssPosition&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var o=t.pageX,a=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),i.grid)){var s=this.originalPageY+Math.round((a-this.originalPageY)/i.grid[1])*i.grid[1];a=this.containment?s-this.offset.click.top<this.containment[1]||s-this.offset.click.top>this.containment[3]?s-this.offset.click.top<this.containment[1]?s+i.grid[1]:s-i.grid[1]:s:s;var l=this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0];o=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:n.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:n.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this,o=this.counter;window.setTimeout(function(){o==r.counter&&r.refreshPositions(!n)},0)},_clear:function(t,i){this.reverting=!1;var n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var r in this._storedCSS)("auto"==this._storedCSS[r]||"static"==this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!i&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!i&&n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(i||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var r=this.containers.length-1;r>=0;r--)i||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",t,this._uiHash());for(var r=0;r<n.length;r++)n[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var r=0;r<n.length;r++)n[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.extend(e.ui.sortable,{version:"1.8.24"})}(jQuery),function(e){e.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:!0,clearStyle:!1,collapsible:!1,event:"click",fillSpace:!1,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var t=this,i=t.options;if(t.running=0,t.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix"),t.headers=t.element.find(i.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){i.disabled||e(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){i.disabled||e(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){i.disabled||e(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){i.disabled||e(this).removeClass("ui-state-focus")}),t.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom"),i.navigation){var n=t.element.find("a").filter(i.navigationFilter).eq(0);if(n.length){var r=n.closest(".ui-accordion-header");t.active=r.length?r:n.closest(".ui-accordion-content").prev()}}t.active=t._findActive(t.active||i.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top"),t.active.next().addClass("ui-accordion-content-active"),t._createIcons(),t.resize(),t.element.attr("role","tablist"),t.headers.attr("role","tab").bind("keydown.accordion",function(e){return t._keydown(e)}).next().attr("role","tabpanel"),t.headers.not(t.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide(),t.active.length?t.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):t.headers.eq(0).attr("tabIndex",0),e.browser.safari||t.headers.find("a").attr("tabIndex",-1),i.event&&t.headers.bind(i.event.split(" ").join(".accordion ")+".accordion",function(e){t._clickHandler.call(t,e,this),e.preventDefault()})},_createIcons:function(){var t=this.options;t.icons&&(e("<span></span>").addClass("ui-icon "+t.icons.header).prependTo(this.headers),this.active.children(".ui-icon").toggleClass(t.icons.header).toggleClass(t.icons.headerSelected),this.element.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.children(".ui-icon").remove(),this.element.removeClass("ui-accordion-icons")},destroy:function(){var t=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex"),this.headers.find("a").removeAttr("tabIndex"),this._destroyIcons();var i=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");return(t.autoHeight||t.fillHeight)&&i.css("height",""),e.Widget.prototype.destroy.call(this)},_setOption:function(t,i){e.Widget.prototype._setOption.apply(this,arguments),"active"==t&&this.activate(i),"icons"==t&&(this._destroyIcons(),i&&this._createIcons()),"disabled"==t&&this.headers.add(this.headers.next())[i?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(t){if(!(this.options.disabled||t.altKey||t.ctrlKey)){var i=e.ui.keyCode,n=this.headers.length,r=this.headers.index(t.target),o=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(r+1)%n];break;case i.LEFT:case i.UP:o=this.headers[(r-1+n)%n];break;case i.SPACE:case i.ENTER:this._clickHandler({target:t.target},t.target),t.preventDefault()
}return o?(e(t.target).attr("tabIndex",-1),e(o).attr("tabIndex",0),o.focus(),!1):!0}},resize:function(){var t,i=this.options;if(i.fillSpace){if(e.browser.msie){var n=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}t=this.element.parent().height(),e.browser.msie&&this.element.parent().css("overflow",n),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")}else i.autoHeight&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).height("").height())}).height(t));return this},activate:function(e){this.options.active=e;var t=this._findActive(e)[0];return this._clickHandler({target:t},t),this},_findActive:function(t){return t?"number"==typeof t?this.headers.filter(":eq("+t+")"):this.headers.not(this.headers.not(t)):t===!1?e([]):this.headers.filter(":eq(0)")},_clickHandler:function(t,i){var n=this.options;if(!n.disabled){if(!t.target){if(!n.collapsible)return;this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(n.icons.headerSelected).addClass(n.icons.header),this.active.next().addClass("ui-accordion-content-active");var r=this.active.next(),o={options:n,newHeader:e([]),oldHeader:n.active,newContent:e([]),oldContent:r},a=this.active=e([]);return this._toggle(a,r,o),void 0}var s=e(t.currentTarget||i),l=s[0]===this.active[0];if(n.active=n.collapsible&&l?!1:this.headers.index(s),!(this.running||!n.collapsible&&l)){var h=this.active,a=s.next(),r=this.active.next(),o={options:n,newHeader:l&&n.collapsible?e([]):s,oldHeader:this.active,newContent:l&&n.collapsible?e([]):a,oldContent:r},c=this.headers.index(this.active[0])>this.headers.index(s[0]);this.active=l?e([]):s,this._toggle(a,r,o,l,c),h.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(n.icons.headerSelected).addClass(n.icons.header),l||(s.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(n.icons.header).addClass(n.icons.headerSelected),s.next().addClass("ui-accordion-content-active"))}}},_toggle:function(t,i,n,r,o){var a=this,s=a.options;a.toShow=t,a.toHide=i,a.data=n;var l=function(){return a?a._completed.apply(a,arguments):void 0};if(a._trigger("changestart",null,a.data),a.running=0===i.size()?t.size():i.size(),s.animated){var h={};h=s.collapsible&&r?{toShow:e([]),toHide:i,complete:l,down:o,autoHeight:s.autoHeight||s.fillSpace}:{toShow:t,toHide:i,complete:l,down:o,autoHeight:s.autoHeight||s.fillSpace},s.proxied||(s.proxied=s.animated),s.proxiedDuration||(s.proxiedDuration=s.duration),s.animated=e.isFunction(s.proxied)?s.proxied(h):s.proxied,s.duration=e.isFunction(s.proxiedDuration)?s.proxiedDuration(h):s.proxiedDuration;var c=e.ui.accordion.animations,d=s.duration,u=s.animated;u&&!c[u]&&!e.easing[u]&&(u="slide"),c[u]||(c[u]=function(e){this.slide(e,{easing:u,duration:d||700})}),c[u](h)}else s.collapsible&&r?t.toggle():(i.hide(),t.show()),l(!0);i.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur(),t.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(e){this.running=e?0:--this.running,this.running||(this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""}),this.toHide.removeClass("ui-accordion-content-active"),this.toHide.length&&(this.toHide.parent()[0].className=this.toHide.parent()[0].className),this._trigger("change",null,this.data))}}),e.extend(e.ui.accordion,{version:"1.8.24",animations:{slide:function(t,i){if(t=e.extend({easing:"swing",duration:300},t,i),!t.toHide.size())return t.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},t),void 0;if(!t.toShow.size())return t.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},t),void 0;var n,r=t.toShow.css("overflow"),o=0,a={},s={},l=["height","paddingTop","paddingBottom"],h=t.toShow;n=h[0].style.width,h.width(h.parent().width()-parseFloat(h.css("paddingLeft"))-parseFloat(h.css("paddingRight"))-(parseFloat(h.css("borderLeftWidth"))||0)-(parseFloat(h.css("borderRightWidth"))||0)),e.each(l,function(i,n){s[n]="hide";var r=(""+e.css(t.toShow[0],n)).match(/^([\d+-.]+)(.*)$/);a[n]={value:r[1],unit:r[2]||"px"}}),t.toShow.css({height:0,overflow:"hidden"}).show(),t.toHide.filter(":hidden").each(t.complete).end().filter(":visible").animate(s,{step:function(e,i){"height"==i.prop&&(o=i.end-i.start===0?0:(i.now-i.start)/(i.end-i.start)),t.toShow[0].style[i.prop]=o*a[i.prop].value+a[i.prop].unit},duration:t.duration,easing:t.easing,complete:function(){t.autoHeight||t.toShow.css("height",""),t.toShow.css({width:n,overflow:r}),t.complete()}})},bounceslide:function(e){this.slide(e,{easing:e.down?"easeOutBounce":"swing",duration:e.down?1e3:200})}}})}(jQuery),function(e){var t=0;e.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var t,i=this,n=this.element[0].ownerDocument;this.isMultiLine=this.element.is("textarea"),this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(!i.options.disabled&&!i.element.propAttr("readOnly")){t=!1;var r=e.ui.keyCode;switch(n.keyCode){case r.PAGE_UP:i._move("previousPage",n);break;case r.PAGE_DOWN:i._move("nextPage",n);break;case r.UP:i._keyEvent("previous",n);break;case r.DOWN:i._keyEvent("next",n);break;case r.ENTER:case r.NUMPAD_ENTER:i.menu.active&&(t=!0,n.preventDefault());case r.TAB:if(!i.menu.active)return;i.menu.select(n);break;case r.ESCAPE:i.element.val(i.term),i.close(n);break;default:clearTimeout(i.searching),i.searching=setTimeout(function(){i.term!=i.element.val()&&(i.selectedItem=null,i.search(null,n))},i.options.delay)}}}).bind("keypress.autocomplete",function(e){t&&(t=!1,e.preventDefault())}).bind("focus.autocomplete",function(){i.options.disabled||(i.selectedItem=null,i.previous=i.element.val())}).bind("blur.autocomplete",function(e){i.options.disabled||(clearTimeout(i.searching),i.closing=setTimeout(function(){i.close(e),i._change(e)},150))}),this._initSource(),this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(t){var n=i.menu.element[0];e(t.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(t){t.target!==i.element[0]&&t.target!==n&&!e.ui.contains(n,t.target)&&i.close()})},1),setTimeout(function(){clearTimeout(i.closing)},13)}).menu({focus:function(e,t){var n=t.item.data("item.autocomplete");!1!==i._trigger("focus",e,{item:n})&&/^key/.test(e.originalEvent.type)&&i.element.val(n.value)},selected:function(e,t){var r=t.item.data("item.autocomplete"),o=i.previous;i.element[0]!==n.activeElement&&(i.element.focus(),i.previous=o,setTimeout(function(){i.previous=o,i.selectedItem=r},1)),!1!==i._trigger("select",e,{item:r})&&i.element.val(r.value),i.term=i.element.val(),i.close(e),i.selectedItem=r},blur:function(){i.menu.element.is(":visible")&&i.element.val()!==i.term&&i.element.val(i.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),e.fn.bgiframe&&this.menu.element.bgiframe(),i.beforeunloadHandler=function(){i.element.removeAttr("autocomplete")},e(window).bind("beforeunload",i.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),e(window).unbind("beforeunload",this.beforeunloadHandler),e.Widget.prototype.destroy.call(this)},_setOption:function(t,i){e.Widget.prototype._setOption.apply(this,arguments),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(e(i||"body",this.element[0].ownerDocument)[0]),"disabled"===t&&i&&this.xhr&&this.xhr.abort()},_initSource:function(){var t,i,n=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,n){n(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,r){n.xhr&&n.xhr.abort(),n.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){r(e)},error:function(){r([])}})}):this.source=this.options.source},search:function(e,t){return e=null!=e?e:this.element.val(),this.term=this.element.val(),e.length<this.options.minLength?this.close(t):(clearTimeout(this.closing),this._trigger("search",t)!==!1?this._search(e):void 0)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:e},this._response())},_response:function(){var e=this,i=++t;return function(n){i===t&&e.__response(n),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){!this.options.disabled&&e&&e.length?(e=this._normalize(e),this._suggest(e),this._trigger("open")):this.close()},close:function(e){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",e))},_change:function(e){this.previous!==this.element.val()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(i,t),this.menu.deactivate(),this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new e.Event("mouseover"))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var n=this;e.each(i,function(e,i){n._renderItem(t,i)})},_renderItem:function(t,i){return e("<li></li>").data("item.autocomplete",i).append(e("<a></a>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)?(this.element.val(this.term),this.menu.deactivate(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,i){var n=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return n.test(e.label||e.value||e)})}})}(jQuery),function(e){e.widget("ui.menu",{_create:function(){var t=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(i){e(i.target).closest(".ui-menu-item a").length&&(i.preventDefault(),t.select(i))}),this.refresh()},refresh:function(){var t=this,i=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");i.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(i){t.activate(i,e(this).parent())}).mouseleave(function(){t.deactivate()})},activate:function(e,t){if(this.deactivate(),this.hasScroll()){var i=t.offset().top-this.element.offset().top,n=this.element.scrollTop(),r=this.element.height();0>i?this.element.scrollTop(n+i):i>=r&&this.element.scrollTop(n+i-r+t.height())}this.active=t.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",e,{item:t})},deactivate:function(){this.active&&(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,t,i){if(!this.active)return this.activate(i,this.element.children(t)),void 0;var n=this.active[e+"All"](".ui-menu-item").eq(0);n.length?this.activate(i,n):this.activate(i,this.element.children(t))},nextPage:function(t){if(this.hasScroll()){if(!this.active||this.last())return this.activate(t,this.element.children(".ui-menu-item:first")),void 0;var i=this.active.offset().top,n=this.element.height(),r=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-i-n+e(this).height();return 10>t&&t>-10});r.length||(r=this.element.children(".ui-menu-item:last")),this.activate(t,r)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(t){if(this.hasScroll()){if(!this.active||this.first())return this.activate(t,this.element.children(".ui-menu-item:last")),void 0;var i=this.active.offset().top,n=this.element.height(),r=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-i+n-e(this).height();return 10>t&&t>-10});r.length||(r=this.element.children(".ui-menu-item:first")),this.activate(t,r)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[e.fn.prop?"prop":"attr"]("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})}(jQuery),function(e){var t,i,n,r,o="ui-button ui-widget ui-state-default ui-corner-all",a="ui-state-hover ui-state-active ",s="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",l=function(){var t=e(this).find(":ui-button");setTimeout(function(){t.button("refresh")},1)},h=function(t){var i=t.name,n=t.form,r=e([]);return i&&(r=n?e(n).find("[name='"+i+"']"):e("[name='"+i+"']",t.ownerDocument).filter(function(){return!this.form})),r};e.widget("ui.button",{options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",l),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.propAttr("disabled"):this.element.propAttr("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var a=this,s=this.options,c="checkbox"===this.type||"radio"===this.type,d="ui-state-hover"+(c?"":" ui-state-active"),u="ui-state-focus";null===s.label&&(s.label=this.buttonElement.html()),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter.button",function(){s.disabled||(e(this).addClass("ui-state-hover"),this===t&&e(this).addClass("ui-state-active"))}).bind("mouseleave.button",function(){s.disabled||e(this).removeClass(d)}).bind("click.button",function(e){s.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus.button",function(){a.buttonElement.addClass(u)}).bind("blur.button",function(){a.buttonElement.removeClass(u)}),c&&(this.element.bind("change.button",function(){r||a.refresh()}),this.buttonElement.bind("mousedown.button",function(e){s.disabled||(r=!1,i=e.pageX,n=e.pageY)}).bind("mouseup.button",function(e){s.disabled||(i!==e.pageX||n!==e.pageY)&&(r=!0)})),"checkbox"===this.type?this.buttonElement.bind("click.button",function(){return s.disabled||r?!1:(e(this).toggleClass("ui-state-active"),a.buttonElement.attr("aria-pressed",a.element[0].checked),void 0)}):"radio"===this.type?this.buttonElement.bind("click.button",function(){if(s.disabled||r)return!1;e(this).addClass("ui-state-active"),a.buttonElement.attr("aria-pressed","true");var t=a.element[0];h(t).not(t).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown.button",function(){return s.disabled?!1:(e(this).addClass("ui-state-active"),t=this,e(document).one("mouseup",function(){t=null}),void 0)}).bind("mouseup.button",function(){return s.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown.button",function(t){return s.disabled?!1:((t.keyCode==e.ui.keyCode.SPACE||t.keyCode==e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup.button",function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",s.disabled),this._resetButton()},_determineButtonType:function(){if(this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type){var e=this.element.parents().filter(":last"),t="label[for='"+this.element.attr("id")+"']";this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible");var i=this.element.is(":checked");i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.attr("aria-pressed",i)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" "+a+" "+s).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title"),e.Widget.prototype.destroy.call(this)},_setOption:function(t,i){return e.Widget.prototype._setOption.apply(this,arguments),"disabled"===t?(i?this.element.propAttr("disabled",!0):this.element.propAttr("disabled",!1),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is(":disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?h(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(s),i=e("<span></span>",this.element[0].ownerDocument).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),n=this.options.icons,r=n.primary&&n.secondary,o=[];n.primary||n.secondary?(this.options.text&&o.push("ui-button-text-icon"+(r?"s":n.primary?"-primary":"-secondary")),n.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+n.primary+"'></span>"),n.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+n.secondary+"'></span>"),this.options.text||(o.push(r?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",i))):o.push("ui-button-text-only"),t.addClass(o.join(" "))}}),e.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,i){"disabled"===t&&this.buttons.button("option",t,i),e.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var t="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy"),e.Widget.prototype.destroy.call(this)}})}(jQuery),function(e,t){var i="ui-dialog ui-widget ui-widget-content ui-corner-all ",n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},r={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),"string"!=typeof this.originalTitle&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;{var t=this,n=t.options,r=n.title||"&#160;",o=e.ui.dialog.getTitleId(t.element),a=(t.uiDialog=e("<div></div>")).appendTo(document.body).hide().addClass(i+n.dialogClass).css({zIndex:n.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(i){n.closeOnEscape&&!i.isDefaultPrevented()&&i.keyCode&&i.keyCode===e.ui.keyCode.ESCAPE&&(t.close(i),i.preventDefault())}).attr({role:"dialog","aria-labelledby":o}).mousedown(function(e){t.moveToTop(!1,e)}),s=(t.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(a),(t.uiDialogTitlebar=e("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(a)),l=e('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){l.addClass("ui-state-hover")},function(){l.removeClass("ui-state-hover")}).focus(function(){l.addClass("ui-state-focus")}).blur(function(){l.removeClass("ui-state-focus")}).click(function(e){return t.close(e),!1}).appendTo(s);(t.uiDialogTitlebarCloseText=e("<span></span>")).addClass("ui-icon ui-icon-closethick").text(n.closeText).appendTo(l),e("<span></span>").addClass("ui-dialog-title").attr("id",o).html(r).prependTo(s)}e.isFunction(n.beforeclose)&&!e.isFunction(n.beforeClose)&&(n.beforeClose=n.beforeclose),s.find("*").add(s).disableSelection(),n.draggable&&e.fn.draggable&&t._makeDraggable(),n.resizable&&e.fn.resizable&&t._makeResizable(),t._createButtons(n.buttons),t._isOpen=!1,e.fn.bgiframe&&a.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var e=this;return e.overlay&&e.overlay.destroy(),e.uiDialog.hide(),e.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),e.uiDialog.remove(),e.originalTitle&&e.element.attr("title",e.originalTitle),e},widget:function(){return this.uiDialog},close:function(t){var i,n,r=this;if(!1!==r._trigger("beforeClose",t))return r.overlay&&r.overlay.destroy(),r.uiDialog.unbind("keypress.ui-dialog"),r._isOpen=!1,r.options.hide?r.uiDialog.hide(r.options.hide,function(){r._trigger("close",t)}):(r.uiDialog.hide(),r._trigger("close",t)),e.ui.dialog.overlay.resize(),r.options.modal&&(i=0,e(".ui-dialog").each(function(){this!==r.uiDialog[0]&&(n=e(this).css("z-index"),isNaN(n)||(i=Math.max(i,n)))}),e.ui.dialog.maxZ=i),r},isOpen:function(){return this._isOpen},moveToTop:function(t,i){var n,r=this,o=r.options;return o.modal&&!t||!o.stack&&!o.modal?r._trigger("focus",i):(o.zIndex>e.ui.dialog.maxZ&&(e.ui.dialog.maxZ=o.zIndex),r.overlay&&(e.ui.dialog.maxZ+=1,r.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ)),n={scrollTop:r.element.scrollTop(),scrollLeft:r.element.scrollLeft()},e.ui.dialog.maxZ+=1,r.uiDialog.css("z-index",e.ui.dialog.maxZ),r.element.attr(n),r._trigger("focus",i),r)},open:function(){if(!this._isOpen){var t=this,i=t.options,n=t.uiDialog;return t.overlay=i.modal?new e.ui.dialog.overlay(t):null,t._size(),t._position(i.position),n.show(i.show),t.moveToTop(!0),i.modal&&n.bind("keydown.ui-dialog",function(t){if(t.keyCode===e.ui.keyCode.TAB){var i=e(":tabbable",this),n=i.filter(":first"),r=i.filter(":last");return t.target!==r[0]||t.shiftKey?t.target===n[0]&&t.shiftKey?(r.focus(1),!1):void 0:(n.focus(1),!1)}}),e(t.element.find(":tabbable").get().concat(n.find(".ui-dialog-buttonpane :tabbable").get().concat(n.get()))).eq(0).focus(),t._isOpen=!0,t._trigger("open"),t}},_createButtons:function(t){var i=this,n=!1,r=e("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),o=e("<div></div>").addClass("ui-dialog-buttonset").appendTo(r);i.uiDialog.find(".ui-dialog-buttonpane").remove(),"object"==typeof t&&null!==t&&e.each(t,function(){return!(n=!0)}),n&&(e.each(t,function(t,n){n=e.isFunction(n)?{click:n,text:t}:n;var r=e('<button type="button"></button>').click(function(){n.click.apply(i.element[0],arguments)}).appendTo(o);e.each(n,function(e,t){"click"!==e&&(e in r?r[e](t):r.attr(e,t))}),e.fn.button&&r.button()}),r.appendTo(i.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i,n=this,r=n.options,o=e(document);n.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(o,a){i="auto"===r.height?"auto":e(this).height(),e(this).height(e(this).height()).addClass("ui-dialog-dragging"),n._trigger("dragStart",o,t(a))},drag:function(e,i){n._trigger("drag",e,t(i))},stop:function(a,s){r.position=[s.position.left-o.scrollLeft(),s.position.top-o.scrollTop()],e(this).removeClass("ui-dialog-dragging").height(i),n._trigger("dragStop",a,t(s)),e.ui.dialog.overlay.resize()}})},_makeResizable:function(i){function n(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}i=i===t?this.options.resizable:i;var r=this,o=r.options,a=r.uiDialog.css("position"),s="string"==typeof i?i:"n,e,s,w,se,sw,ne,nw";r.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:r.element,maxWidth:o.maxWidth,maxHeight:o.maxHeight,minWidth:o.minWidth,minHeight:r._minHeight(),handles:s,start:function(t,i){e(this).addClass("ui-dialog-resizing"),r._trigger("resizeStart",t,n(i))},resize:function(e,t){r._trigger("resize",e,n(t))},stop:function(t,i){e(this).removeClass("ui-dialog-resizing"),o.height=e(this).height(),o.width=e(this).width(),r._trigger("resizeStop",t,n(i)),e.ui.dialog.overlay.resize()}}).css("position",a).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t){var i,n=[],r=[0,0];t?(("string"==typeof t||"object"==typeof t&&"0"in t)&&(n=t.split?t.split(" "):[t[0],t[1]],1===n.length&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t={my:n.join(" "),at:n.join(" "),offset:r.join(" ")}),t=e.extend({},e.ui.dialog.prototype.options.position,t)):t=e.ui.dialog.prototype.options.position,i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(e.extend({of:window},t)),i||this.uiDialog.hide()},_setOptions:function(t){var i=this,o={},a=!1;e.each(t,function(e,t){i._setOption(e,t),e in n&&(a=!0),e in r&&(o[e]=t)}),a&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",o)},_setOption:function(t,n){var r=this,o=r.uiDialog;switch(t){case"beforeclose":t="beforeClose";break;case"buttons":r._createButtons(n);break;case"closeText":r.uiDialogTitlebarCloseText.text(""+n);break;case"dialogClass":o.removeClass(r.options.dialogClass).addClass(i+n);break;case"disabled":n?o.addClass("ui-dialog-disabled"):o.removeClass("ui-dialog-disabled");break;case"draggable":var a=o.is(":data(draggable)");a&&!n&&o.draggable("destroy"),!a&&n&&r._makeDraggable();break;case"position":r._position(n);break;case"resizable":var s=o.is(":data(resizable)");s&&!n&&o.resizable("destroy"),s&&"string"==typeof n&&o.resizable("option","handles",n),!s&&n!==!1&&r._makeResizable(n);break;case"title":e(".ui-dialog-title",r.uiDialogTitlebar).html(""+(n||"&#160;"))}e.Widget.prototype._setOption.apply(r,arguments)},_size:function(){var t,i,n=this.options,r=this.uiDialog.is(":visible");if(this.element.show().css({width:"auto",minHeight:0,height:0}),n.minWidth>n.width&&(n.width=n.minWidth),t=this.uiDialog.css({height:"auto",width:n.width}).height(),i=Math.max(0,n.minHeight-t),"auto"===n.height)if(e.support.minHeight)this.element.css({minHeight:i,height:"auto"});else{this.uiDialog.show();var o=this.element.css("height","auto").height();r||this.uiDialog.hide(),this.element.height(Math.max(o,i))}else this.element.height(Math.max(n.height-t,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),e.extend(e.ui.dialog,{version:"1.8.24",uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}}),e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(t){0===this.instances.length&&(setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(t){return e(t.target).zIndex()<e.ui.dialog.overlay.maxZ?!1:void 0})},1),e(document).bind("keydown.dialog-overlay",function(i){t.options.closeOnEscape&&!i.isDefaultPrevented()&&i.keyCode&&i.keyCode===e.ui.keyCode.ESCAPE&&(t.close(i),i.preventDefault())}),e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize));var i=(this.oldInstances.pop()||e("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return e.fn.bgiframe&&i.bgiframe(),this.instances.push(i),i},destroy:function(t){var i=e.inArray(t,this.instances);-1!=i&&this.oldInstances.push(this.instances.splice(i,1)[0]),0===this.instances.length&&e([document,window]).unbind(".dialog-overlay"),t.remove();var n=0;e.each(this.instances,function(){n=Math.max(n,this.css("z-index"))}),this.maxZ=n},height:function(){var t,i;return e.browser.msie&&e.browser.version<7?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),i=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),i>t?e(window).height()+"px":t+"px"):e(document).height()+"px"},width:function(){var t,i;return e.browser.msie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),i=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),i>t?e(window).width()+"px":t+"px"):e(document).width()+"px"},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}}),e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var i=this,n=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",a=n.values&&n.values.length||1,s=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(n.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),n.range&&(n.range===!0&&(n.values||(n.values=[this._valueMin(),this._valueMin()]),n.values.length&&2!==n.values.length&&(n.values=[n.values[0],n.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===n.range||"max"===n.range?" ui-slider-range-"+n.range:"")));for(var l=r.length;a>l;l+=1)s.push(o);this.handles=r.add(e(s.join("")).appendTo(i.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).hover(function(){n.disabled||e(this).addClass("ui-state-hover")
},function(){e(this).removeClass("ui-state-hover")}).focus(function(){n.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("index.ui-slider-handle",t)}),this.handles.keydown(function(n){var r,o,a,s,l=e(this).data("index.ui-slider-handle");if(!i.options.disabled){switch(n.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(n.preventDefault(),!i._keySliding&&(i._keySliding=!0,e(this).addClass("ui-state-active"),r=i._start(n,l),r===!1))return}switch(s=i.options.step,o=a=i.options.values&&i.options.values.length?i.values(l):i.value(),n.keyCode){case e.ui.keyCode.HOME:a=i._valueMin();break;case e.ui.keyCode.END:a=i._valueMax();break;case e.ui.keyCode.PAGE_UP:a=i._trimAlignValue(o+(i._valueMax()-i._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:a=i._trimAlignValue(o-(i._valueMax()-i._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(o===i._valueMax())return;a=i._trimAlignValue(o+s);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(o===i._valueMin())return;a=i._trimAlignValue(o-s)}i._slide(n,l,a)}}).keyup(function(t){var n=e(this).data("index.ui-slider-handle");i._keySliding&&(i._keySliding=!1,i._stop(t,n),i._change(t,n),e(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(t){var i,n,r,o,a,s,l,h,c,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),r=this._valueMax()-this._valueMin()+1,a=this,this.handles.each(function(t){var i=Math.abs(n-a.values(t));r>i&&(r=i,o=e(this),s=t)}),d.range===!0&&this.values(1)===d.min&&(s+=1,o=e(this.handles[s])),l=this._start(t,s),l===!1?!1:(this._mouseSliding=!0,a._handleIndex=s,o.addClass("ui-state-active").focus(),h=o.offset(),c=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-h.left-o.width()/2,top:t.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,r,o;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),r=this._valueMax()-this._valueMin(),o=this._valueMin()+n*r,this._trimAlignValue(o)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,r,o;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>n||1===t&&n>i)&&(i=n),i!==this.values(t)&&(r=this.values(),r[t]=i,o=this._trigger("slide",e,{handle:this.handles[t],value:i,values:r}),n=this.values(t?0:1),o!==!1&&this.values(t,i,!0))):i!==this.value()&&(o=this._trigger("slide",e,{handle:this.handles[t],value:i}),o!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var n,r,o;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,r=arguments[0],o=0;o<n.length;o+=1)n[o]=this._trimAlignValue(r[o]),this._change(null,o);this._refreshValue()},_setOption:function(t,i){var n,r=0;switch(e.isArray(this.options.values)&&(r=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;r>n;n+=1)this._change(null,n);this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,r,o,a=this.options.range,s=this.options,l=this,h=this._animateOff?!1:s.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(n){t=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=t+"%",e(this).stop(1,1)[h?"animate":"css"](c,s.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[h?"animate":"css"]({left:t+"%"},s.animate),1===n&&l.range[h?"animate":"css"]({width:t-i+"%"},{queue:!1,duration:s.animate})):(0===n&&l.range.stop(1,1)[h?"animate":"css"]({bottom:t+"%"},s.animate),1===n&&l.range[h?"animate":"css"]({height:t-i+"%"},{queue:!1,duration:s.animate}))),i=t}):(n=this.value(),r=this._valueMin(),o=this._valueMax(),t=o!==r?(n-r)/(o-r)*100:0,c["horizontal"===l.orientation?"left":"bottom"]=t+"%",this.handle.stop(1,1)[h?"animate":"css"](c,s.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:t+"%"},s.animate),"max"===a&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-t+"%"},{queue:!1,duration:s.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:t+"%"},s.animate),"max"===a&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-t+"%"},{queue:!1,duration:s.animate}))}}),e.extend(e.ui.slider,{version:"1.8.24"})}(jQuery),function(e,t){function i(){return++r}function n(){return++o}var r=0,o=0;e.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(!0)},_setOption:function(e,t){if("selected"==e){if(this.options.collapsible&&t==this.options.selected)return;this.select(t)}else this.options[e]=t,this._tabify()},_tabId:function(e){return e.title&&e.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+i()},_sanitizeSelector:function(e){return e.replace(/:/g,"\\:")},_cookie:function(){var t=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+n());return e.cookie.apply(null,[t].concat(e.makeArray(arguments)))},_ui:function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var t=e(this);t.html(t.data("label.tabs")).removeData("label.tabs")})},_tabify:function(i){function n(t,i){t.css("display",""),!e.support.opacity&&i.opacity&&t[0].style.removeAttribute("filter")}var r=this,o=this.options,a=/^#.+/;this.list=this.element.find("ol,ul").eq(0),this.lis=e(" > li:has(a[href])",this.list),this.anchors=this.lis.map(function(){return e("a",this)[0]}),this.panels=e([]),this.anchors.each(function(t,i){var n,s=e(i).attr("href"),l=s.split("#")[0];if(l&&(l===location.toString().split("#")[0]||(n=e("base")[0])&&l===n.href)&&(s=i.hash,i.href=s),a.test(s))r.panels=r.panels.add(r.element.find(r._sanitizeSelector(s)));else if(s&&"#"!==s){e.data(i,"href.tabs",s),e.data(i,"load.tabs",s.replace(/#.*$/,""));var h=r._tabId(i);i.href="#"+h;var c=r.element.find("#"+h);c.length||(c=e(o.panelTemplate).attr("id",h).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(r.panels[t-1]||r.list),c.data("destroy.tabs",!0)),r.panels=r.panels.add(c)}else o.disabled.push(t)}),i?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),o.selected===t?(location.hash&&this.anchors.each(function(e,t){return t.hash==location.hash?(o.selected=e,!1):void 0}),"number"!=typeof o.selected&&o.cookie&&(o.selected=parseInt(r._cookie(),10)),"number"!=typeof o.selected&&this.lis.filter(".ui-tabs-selected").length&&(o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"))),o.selected=o.selected||(this.lis.length?0:-1)):null===o.selected&&(o.selected=-1),o.selected=o.selected>=0&&this.anchors[o.selected]||o.selected<0?o.selected:0,o.disabled=e.unique(o.disabled.concat(e.map(this.lis.filter(".ui-state-disabled"),function(e){return r.lis.index(e)}))).sort(),-1!=e.inArray(o.selected,o.disabled)&&o.disabled.splice(e.inArray(o.selected,o.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),o.selected>=0&&this.anchors.length&&(r.element.find(r._sanitizeSelector(r.anchors[o.selected].hash)).removeClass("ui-tabs-hide"),this.lis.eq(o.selected).addClass("ui-tabs-selected ui-state-active"),r.element.queue("tabs",function(){r._trigger("show",null,r._ui(r.anchors[o.selected],r.element.find(r._sanitizeSelector(r.anchors[o.selected].hash))[0]))}),this.load(o.selected)),e(window).bind("unload",function(){r.lis.add(r.anchors).unbind(".tabs"),r.lis=r.anchors=r.panels=null})):o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected")),this.element[o.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible"),o.cookie&&this._cookie(o.selected,o.cookie);for(var s,l=0;s=this.lis[l];l++)e(s)[-1==e.inArray(l,o.disabled)||e(s).hasClass("ui-tabs-selected")?"removeClass":"addClass"]("ui-state-disabled");if(o.cache===!1&&this.anchors.removeData("cache.tabs"),this.lis.add(this.anchors).unbind(".tabs"),"mouseover"!==o.event){var h=function(e,t){t.is(":not(.ui-state-disabled)")&&t.addClass("ui-state-"+e)},c=function(e,t){t.removeClass("ui-state-"+e)};this.lis.bind("mouseover.tabs",function(){h("hover",e(this))}),this.lis.bind("mouseout.tabs",function(){c("hover",e(this))}),this.anchors.bind("focus.tabs",function(){h("focus",e(this).closest("li"))}),this.anchors.bind("blur.tabs",function(){c("focus",e(this).closest("li"))})}var d,u;o.fx&&(e.isArray(o.fx)?(d=o.fx[0],u=o.fx[1]):d=u=o.fx);var p=u?function(t,i){e(t).closest("li").addClass("ui-tabs-selected ui-state-active"),i.hide().removeClass("ui-tabs-hide").animate(u,u.duration||"normal",function(){n(i,u),r._trigger("show",null,r._ui(t,i[0]))})}:function(t,i){e(t).closest("li").addClass("ui-tabs-selected ui-state-active"),i.removeClass("ui-tabs-hide"),r._trigger("show",null,r._ui(t,i[0]))},f=d?function(e,t){t.animate(d,d.duration||"normal",function(){r.lis.removeClass("ui-tabs-selected ui-state-active"),t.addClass("ui-tabs-hide"),n(t,d),r.element.dequeue("tabs")})}:function(e,t){r.lis.removeClass("ui-tabs-selected ui-state-active"),t.addClass("ui-tabs-hide"),r.element.dequeue("tabs")};this.anchors.bind(o.event+".tabs",function(){var t=this,i=e(t).closest("li"),n=r.panels.filter(":not(.ui-tabs-hide)"),a=r.element.find(r._sanitizeSelector(t.hash));if(i.hasClass("ui-tabs-selected")&&!o.collapsible||i.hasClass("ui-state-disabled")||i.hasClass("ui-state-processing")||r.panels.filter(":animated").length||r._trigger("select",null,r._ui(this,a[0]))===!1)return this.blur(),!1;if(o.selected=r.anchors.index(this),r.abort(),o.collapsible){if(i.hasClass("ui-tabs-selected"))return o.selected=-1,o.cookie&&r._cookie(o.selected,o.cookie),r.element.queue("tabs",function(){f(t,n)}).dequeue("tabs"),this.blur(),!1;if(!n.length)return o.cookie&&r._cookie(o.selected,o.cookie),r.element.queue("tabs",function(){p(t,a)}),r.load(r.anchors.index(this)),this.blur(),!1}if(o.cookie&&r._cookie(o.selected,o.cookie),!a.length)throw"jQuery UI Tabs: Mismatching fragment identifier.";n.length&&r.element.queue("tabs",function(){f(t,n)}),r.element.queue("tabs",function(){p(t,a)}),r.load(r.anchors.index(this)),e.browser.msie&&this.blur()}),this.anchors.bind("click.tabs",function(){return!1})},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},destroy:function(){var t=this.options;return this.abort(),this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs"),this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.anchors.each(function(){var t=e.data(this,"href.tabs");t&&(this.href=t);var i=e(this).unbind(".tabs");e.each(["href","load","cache"],function(e,t){i.removeData(t+".tabs")})}),this.lis.unbind(".tabs").add(this.panels).each(function(){e.data(this,"destroy.tabs")?e(this).remove():e(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-selected","ui-state-active","ui-state-hover","ui-state-focus","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom","ui-tabs-hide"].join(" "))}),t.cookie&&this._cookie(null,t.cookie),this},add:function(i,n,r){r===t&&(r=this.anchors.length);var o=this,a=this.options,s=e(a.tabTemplate.replace(/#\{href\}/g,i).replace(/#\{label\}/g,n)),l=i.indexOf("#")?this._tabId(e("a",s)[0]):i.replace("#","");s.addClass("ui-state-default ui-corner-top").data("destroy.tabs",!0);var h=o.element.find("#"+l);return h.length||(h=e(a.panelTemplate).attr("id",l).data("destroy.tabs",!0)),h.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"),r>=this.lis.length?(s.appendTo(this.list),h.appendTo(this.list[0].parentNode)):(s.insertBefore(this.lis[r]),h.insertBefore(this.panels[r])),a.disabled=e.map(a.disabled,function(e){return e>=r?++e:e}),this._tabify(),1==this.anchors.length&&(a.selected=0,s.addClass("ui-tabs-selected ui-state-active"),h.removeClass("ui-tabs-hide"),this.element.queue("tabs",function(){o._trigger("show",null,o._ui(o.anchors[0],o.panels[0]))}),this.load(0)),this._trigger("add",null,this._ui(this.anchors[r],this.panels[r])),this},remove:function(t){t=this._getIndex(t);var i=this.options,n=this.lis.eq(t).remove(),r=this.panels.eq(t).remove();return n.hasClass("ui-tabs-selected")&&this.anchors.length>1&&this.select(t+(t+1<this.anchors.length?1:-1)),i.disabled=e.map(e.grep(i.disabled,function(e){return e!=t}),function(e){return e>=t?--e:e}),this._tabify(),this._trigger("remove",null,this._ui(n.find("a")[0],r[0])),this},enable:function(t){t=this._getIndex(t);var i=this.options;if(-1!=e.inArray(t,i.disabled))return this.lis.eq(t).removeClass("ui-state-disabled"),i.disabled=e.grep(i.disabled,function(e){return e!=t}),this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t])),this},disable:function(e){e=this._getIndex(e);var t=this.options;return e!=t.selected&&(this.lis.eq(e).addClass("ui-state-disabled"),t.disabled.push(e),t.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[e],this.panels[e]))),this},select:function(e){if(e=this._getIndex(e),-1==e){if(!this.options.collapsible||-1==this.options.selected)return this;e=this.options.selected}return this.anchors.eq(e).trigger(this.options.event+".tabs"),this},load:function(t){t=this._getIndex(t);var i=this,n=this.options,r=this.anchors.eq(t)[0],o=e.data(r,"load.tabs");if(this.abort(),!o||0!==this.element.queue("tabs").length&&e.data(r,"cache.tabs"))return this.element.dequeue("tabs"),void 0;if(this.lis.eq(t).addClass("ui-state-processing"),n.spinner){var a=e("span",r);a.data("label.tabs",a.html()).html(n.spinner)}return this.xhr=e.ajax(e.extend({},n.ajaxOptions,{url:o,success:function(o,a){i.element.find(i._sanitizeSelector(r.hash)).html(o),i._cleanup(),n.cache&&e.data(r,"cache.tabs",!0),i._trigger("load",null,i._ui(i.anchors[t],i.panels[t]));try{n.ajaxOptions.success(o,a)}catch(s){}},error:function(e,o){i._cleanup(),i._trigger("load",null,i._ui(i.anchors[t],i.panels[t]));try{n.ajaxOptions.error(e,o,t,r)}catch(a){}}})),i.element.dequeue("tabs"),this},abort:function(){return this.element.queue([]),this.panels.stop(!1,!0),this.element.queue("tabs",this.element.queue("tabs").splice(-2,2)),this.xhr&&(this.xhr.abort(),delete this.xhr),this._cleanup(),this},url:function(e,t){return this.anchors.eq(e).removeData("cache.tabs").data("load.tabs",t),this},length:function(){return this.anchors.length}}),e.extend(e.ui.tabs,{version:"1.8.24"}),e.extend(e.ui.tabs.prototype,{rotation:null,rotate:function(e,t){var i=this,n=this.options,r=i._rotate||(i._rotate=function(t){clearTimeout(i.rotation),i.rotation=setTimeout(function(){var e=n.selected;i.select(++e<i.anchors.length?e:0)},e),t&&t.stopPropagation()}),o=i._unrotate||(i._unrotate=t?function(){r()}:function(e){e.clientX&&i.rotate(null)});return e?(this.element.bind("tabsshow",r),this.anchors.bind(n.event+".tabs",o),r()):(clearTimeout(i.rotation),this.element.unbind("tabsshow",r),this.anchors.unbind(n.event+".tabs",o),delete this._rotate,delete this._unrotate),this}})}(jQuery),function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.bind("mouseout",function(e){var i=$(e.target).closest(t);i.length&&i.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(i){var n=$(i.target).closest(t);!$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])&&n.length&&(n.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),n.addClass("ui-state-hover"),n.hasClass("ui-datepicker-prev")&&n.addClass("ui-datepicker-prev-hover"),n.hasClass("ui-datepicker-next")&&n.addClass("ui-datepicker-next-hover"))})}function extendRemove(e,t){$.extend(e,t);for(var i in t)(null==t[i]||t[i]==undefined)&&(e[i]=t[i]);return e}function isArray(e){return e&&($.browser.safari&&"object"==typeof e&&e.length||e.constructor&&e.constructor.toString().match(/\Array\(\)/))}$.extend($.ui,{datepicker:{version:"1.8.24"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline="div"==nodeName||"span"==nodeName;target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),"input"==nodeName?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(e,t){var i=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:i,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(e,t){var i=$(e);t.append=$([]),t.trigger=$([]),i.hasClass(this.markerClassName)||(this._attachments(i,t),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,i,n){t.settings[i]=n}).bind("getData.datepicker",function(e,i){return this._get(t,i)}),this._autoSize(t),$.data(e,PROP_NAME,t),t.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,t){var i=this._get(t,"appendText"),n=this._get(t,"isRTL");t.append&&t.append.remove(),i&&(t.append=$('<span class="'+this._appendClass+'">'+i+"</span>"),e[n?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove();var r=this._get(t,"showOn");if(("focus"==r||"both"==r)&&e.focus(this._showDatepicker),"button"==r||"both"==r){var o=this._get(t,"buttonText"),a=this._get(t,"buttonImage");t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:a,alt:o,title:o}):$('<button type="button"></button>').addClass(this._triggerClass).html(""==a?o:$("<img/>").attr({src:a,alt:o,title:o}))),e[n?"before":"after"](t.trigger),t.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==e[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!=e[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(e[0])):$.datepicker._showDatepicker(e[0]),!1})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),i=this._get(e,"dateFormat");if(i.match(/[DM]/)){var n=function(e){for(var t=0,i=0,n=0;n<e.length;n++)e[n].length>t&&(t=e[n].length,i=n);return i};t.setMonth(n(this._get(e,i.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(n(this._get(e,i.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var i=$(e);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,i,n){t.settings[i]=n}).bind("getData.datepicker",function(e,i){return this._get(t,i)}),$.data(e,PROP_NAME,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block"))},_dialogDatepicker:function(e,t,i,n,r){var o=this._dialogInst;if(!o){this.uuid+=1;var a="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+a+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),o=this._dialogInst=this._newInst(this._dialogInput,!1),o.settings={},$.data(this._dialogInput[0],PROP_NAME,o)}if(extendRemove(o.settings,n||{}),t=t&&t.constructor==Date?this._formatDate(o,t):t,this._dialogInput.val(t),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,!this._pos){var s=document.documentElement.clientWidth,l=document.documentElement.clientHeight,h=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[s/2-100+h,l/2-150+c]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),o.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,o),this},_destroyDatepicker:function(e){var t=$(e),i=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var n=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),"input"==n?(i.append.remove(),i.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==n||"span"==n)&&t.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(e){var t=$(e),i=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var n=e.nodeName.toLowerCase();if("input"==n)e.disabled=!1,i.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==n||"span"==n){var r=t.children("."+this._inlineClass);r.children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t})}},_disableDatepicker:function(e){var t=$(e),i=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var n=e.nodeName.toLowerCase();if("input"==n)e.disabled=!0,i.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==n||"span"==n){var r=t.children("."+this._inlineClass);r.children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t}),this._disabledInputs[this._disabledInputs.length]=e}},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==e)return!0;return!1},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,i){var n=this._getInst(e);if(2==arguments.length&&"string"==typeof t)return"defaults"==t?$.extend({},$.datepicker._defaults):n?"all"==t?$.extend({},n.settings):this._get(n,t):null;var r=t||{};if("string"==typeof t&&(r={},r[t]=i),n){this._curInst==n&&this._hideDatepicker();var o=this._getDateDatepicker(e,!0),a=this._getMinMaxDate(n,"min"),s=this._getMinMaxDate(n,"max");extendRemove(n.settings,r),null!==a&&r.dateFormat!==undefined&&r.minDate===undefined&&(n.settings.minDate=this._formatDate(n,a)),null!==s&&r.dateFormat!==undefined&&r.maxDate===undefined&&(n.settings.maxDate=this._formatDate(n,s)),this._attachments($(e),n),this._autoSize(n),this._setDate(n,o),this._updateAlternate(n),this._updateDatepicker(n)}},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target),i=!0,n=t.dpDiv.is(".ui-datepicker-rtl");if(t._keyEvent=!0,$.datepicker._datepickerShowing)switch(e.keyCode){case 9:$.datepicker._hideDatepicker(),i=!1;break;case 13:var r=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);r[0]&&$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,r[0]);var o=$.datepicker._get(t,"onSelect");if(o){var a=$.datepicker._formatDate(t);o.apply(t.input?t.input[0]:null,[a,t])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&$.datepicker._clearDate(e.target),i=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&$.datepicker._gotoToday(e.target),i=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,n?1:-1,"D"),i=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,-7,"D"),i=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,n?-1:1,"D"),i=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,7,"D"),i=e.ctrlKey||e.metaKey;break;default:i=!1}else 36==e.keyCode&&e.ctrlKey?$.datepicker._showDatepicker(this):i=!1;i&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var i=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),n=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||" ">n||!i||i.indexOf(n)>-1}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);if(t.input.val()!=t.lastVal)try{var i=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));i&&($.datepicker._setDateFromField(t),$.datepicker._updateAlternate(t),$.datepicker._updateDatepicker(t))
}catch(n){$.datepicker.log(n)}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!=e.nodeName.toLowerCase()&&(e=$("input",e.parentNode)[0]),!$.datepicker._isDisabledDatepicker(e)&&$.datepicker._lastInput!=e){var t=$.datepicker._getInst(e);$.datepicker._curInst&&$.datepicker._curInst!=t&&($.datepicker._curInst.dpDiv.stop(!0,!0),t&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var i=$.datepicker._get(t,"beforeShow"),n=i?i.apply(e,[e,t]):{};if(n!==!1){extendRemove(t.settings,n),t.lastVal=null,$.datepicker._lastInput=e,$.datepicker._setDateFromField(t),$.datepicker._inDialog&&(e.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(e),$.datepicker._pos[1]+=e.offsetHeight);var r=!1;$(e).parents().each(function(){return r|="fixed"==$(this).css("position"),!r}),r&&$.browser.opera&&($.datepicker._pos[0]-=document.documentElement.scrollLeft,$.datepicker._pos[1]-=document.documentElement.scrollTop);var o={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};if($.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(t),o=$.datepicker._checkOffset(t,o,r),t.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":r?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),!t.inline){var a=$.datepicker._get(t,"showAnim"),s=$.datepicker._get(t,"duration"),l=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(e.length){var i=$.datepicker._getBorders(t.dpDiv);e.css({left:-i[0],top:-i[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex($(e).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&$.effects[a]?t.dpDiv.show(a,$.datepicker._get(t,"showOptions"),s,l):t.dpDiv[a||"show"](a?s:null,l),(!a||!s)&&l(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),$.datepicker._curInst=t}}}},_updateDatepicker:function(e){var t=this;t.maxRows=4;var i=$.datepicker._getBorders(e.dpDiv);instActive=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var n=e.dpDiv.find("iframe.ui-datepicker-cover");!n.length||n.css({left:-i[0],top:-i[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var r=this._getNumberOfMonths(e),o=r[1],a=17;if(e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),o>1&&e.dpDiv.addClass("ui-datepicker-multi-"+o).css("width",a*o+"em"),e.dpDiv[(1!=r[0]||1!=r[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus(),e.yearshtml){var s=e.yearshtml;setTimeout(function(){s===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),s=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,i){var n=e.dpDiv.outerWidth(),r=e.dpDiv.outerHeight(),o=e.input?e.input.outerWidth():0,a=e.input?e.input.outerHeight():0,s=document.documentElement.clientWidth+(i?0:$(document).scrollLeft()),l=document.documentElement.clientHeight+(i?0:$(document).scrollTop());return t.left-=this._get(e,"isRTL")?n-o:0,t.left-=i&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=i&&t.top==e.input.offset().top+a?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+n>s&&s>n?Math.abs(t.left+n-s):0),t.top-=Math.min(t.top,t.top+r>l&&l>r?Math.abs(r+a):0),t},_findPos:function(e){for(var t=this._getInst(e),i=this._get(t,"isRTL");e&&("hidden"==e.type||1!=e.nodeType||$.expr.filters.hidden(e));)e=e[i?"previousSibling":"nextSibling"];var n=$(e).offset();return[n.left,n.top]},_hideDatepicker:function(e){var t=this._curInst;if(t&&(!e||t==$.data(e,PROP_NAME))&&this._datepickerShowing){var i=this._get(t,"showAnim"),n=this._get(t,"duration"),r=function(){$.datepicker._tidyDialog(t)};$.effects&&$.effects[i]?t.dpDiv.hide(i,$.datepicker._get(t,"showOptions"),n,r):t.dpDiv["slideDown"==i?"slideUp":"fadeIn"==i?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1;var o=this._get(t,"onClose");o&&o.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if($.datepicker._curInst){var t=$(e.target),i=$.datepicker._getInst(t[0]);(t[0].id!=$.datepicker._mainDivId&&0==t.parents("#"+$.datepicker._mainDivId).length&&!t.hasClass($.datepicker.markerClassName)&&!t.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||t.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=i)&&$.datepicker._hideDatepicker()}},_adjustDate:function(e,t,i){var n=$(e),r=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(r,t+("M"==i?this._get(r,"showCurrentAtPos"):0),i),this._updateDatepicker(r))},_gotoToday:function(e){var t=$(e),i=this._getInst(t[0]);if(this._get(i,"gotoCurrent")&&i.currentDay)i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear;else{var n=new Date;i.selectedDay=n.getDate(),i.drawMonth=i.selectedMonth=n.getMonth(),i.drawYear=i.selectedYear=n.getFullYear()}this._notifyChange(i),this._adjustDate(t)},_selectMonthYear:function(e,t,i){var n=$(e),r=this._getInst(n[0]);r["selected"+("M"==i?"Month":"Year")]=r["draw"+("M"==i?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(r),this._adjustDate(n)},_selectDay:function(e,t,i,n){var r=$(e);if(!$(n).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(r[0])){var o=this._getInst(r[0]);o.selectedDay=o.currentDay=$("a",n).html(),o.selectedMonth=o.currentMonth=t,o.selectedYear=o.currentYear=i,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear))}},_clearDate:function(e){{var t=$(e);this._getInst(t[0])}this._selectDate(t,"")},_selectDate:function(e,t){var i=$(e),n=this._getInst(i[0]);t=null!=t?t:this._formatDate(n),n.input&&n.input.val(t),this._updateAlternate(n);var r=this._get(n,"onSelect");r?r.apply(n.input?n.input[0]:null,[t,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],"object"!=typeof n.input[0]&&n.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var i=this._get(e,"altFormat")||this._get(e,"dateFormat"),n=this._getDate(e),r=this.formatDate(i,n,this._getFormatConfig(e));$(t).each(function(){$(this).val(r)})}},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var i=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((i-t)/864e5)/7)+1},parseDate:function(e,t,i){if(null==e||null==t)throw"Invalid arguments";if(t="object"==typeof t?t.toString():t+"",""==t)return null;var n=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff;n="string"!=typeof n?n:(new Date).getFullYear()%100+parseInt(n,10);for(var r=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,s=(i?i.monthNames:null)||this._defaults.monthNames,l=-1,h=-1,c=-1,d=-1,u=!1,p=function(t){var i=E+1<e.length&&e.charAt(E+1)==t;return i&&E++,i},f=function(e){var i=p(e),n="@"==e?14:"!"==e?20:"y"==e&&i?4:"o"==e?3:2,r=new RegExp("^\\d{1,"+n+"}"),o=t.substring(v).match(r);if(!o)throw"Missing number at position "+v;return v+=o[0].length,parseInt(o[0],10)},m=function(e,i,n){var r=$.map(p(e)?n:i,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)}),o=-1;if($.each(r,function(e,i){var n=i[1];return t.substr(v,n.length).toLowerCase()==n.toLowerCase()?(o=i[0],v+=n.length,!1):void 0}),-1!=o)return o+1;throw"Unknown name at position "+v},g=function(){if(t.charAt(v)!=e.charAt(E))throw"Unexpected literal at position "+v;v++},v=0,E=0;E<e.length;E++)if(u)"'"!=e.charAt(E)||p("'")?g():u=!1;else switch(e.charAt(E)){case"d":c=f("d");break;case"D":m("D",r,o);break;case"o":d=f("o");break;case"m":h=f("m");break;case"M":h=m("M",a,s);break;case"y":l=f("y");break;case"@":var y=new Date(f("@"));l=y.getFullYear(),h=y.getMonth()+1,c=y.getDate();break;case"!":var y=new Date((f("!")-this._ticksTo1970)/1e4);l=y.getFullYear(),h=y.getMonth()+1,c=y.getDate();break;case"'":p("'")?g():u=!0;break;default:g()}if(v<t.length)throw"Extra/unparsed characters found in date: "+t.substring(v);if(-1==l?l=(new Date).getFullYear():100>l&&(l+=(new Date).getFullYear()-(new Date).getFullYear()%100+(n>=l?0:-100)),d>-1)for(h=1,c=d;;){var x=this._getDaysInMonth(l,h-1);if(x>=c)break;h++,c-=x}var y=this._daylightSavingAdjust(new Date(l,h-1,c));if(y.getFullYear()!=l||y.getMonth()+1!=h||y.getDate()!=c)throw"Invalid date";return y},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,r=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,s=function(t){var i=u+1<e.length&&e.charAt(u+1)==t;return i&&u++,i},l=function(e,t,i){var n=""+t;if(s(e))for(;n.length<i;)n="0"+n;return n},h=function(e,t,i,n){return s(e)?n[t]:i[t]},c="",d=!1;if(t)for(var u=0;u<e.length;u++)if(d)"'"!=e.charAt(u)||s("'")?c+=e.charAt(u):d=!1;else switch(e.charAt(u)){case"d":c+=l("d",t.getDate(),2);break;case"D":c+=h("D",t.getDay(),n,r);break;case"o":c+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=l("m",t.getMonth()+1,2);break;case"M":c+=h("M",t.getMonth(),o,a);break;case"y":c+=s("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":c+=t.getTime();break;case"!":c+=1e4*t.getTime()+this._ticksTo1970;break;case"'":s("'")?c+="'":d=!0;break;default:c+=e.charAt(u)}return c},_possibleChars:function(e){for(var t="",i=!1,n=function(t){var i=r+1<e.length&&e.charAt(r+1)==t;return i&&r++,i},r=0;r<e.length;r++)if(i)"'"!=e.charAt(r)||n("'")?t+=e.charAt(r):i=!1;else switch(e.charAt(r)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":n("'")?t+="'":i=!0;break;default:t+=e.charAt(r)}return t},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!=e.lastVal){var i,n,r=this._get(e,"dateFormat"),o=e.lastVal=e.input?e.input.val():null;i=n=this._getDefaultDate(e);var a=this._getFormatConfig(e);try{i=this.parseDate(r,o,a)||n}catch(s){this.log(s),o=t?"":o}e.selectedDay=i.getDate(),e.drawMonth=e.selectedMonth=i.getMonth(),e.drawYear=e.selectedYear=i.getFullYear(),e.currentDay=o?i.getDate():0,e.currentMonth=o?i.getMonth():0,e.currentYear=o?i.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,i){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},r=function(t){try{return $.datepicker.parseDate($.datepicker._get(e,"dateFormat"),t,$.datepicker._getFormatConfig(e))}catch(i){}for(var n=(t.toLowerCase().match(/^c/)?$.datepicker._getDate(e):null)||new Date,r=n.getFullYear(),o=n.getMonth(),a=n.getDate(),s=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=s.exec(t);l;){switch(l[2]||"d"){case"d":case"D":a+=parseInt(l[1],10);break;case"w":case"W":a+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),a=Math.min(a,$.datepicker._getDaysInMonth(r,o));break;case"y":case"Y":r+=parseInt(l[1],10),a=Math.min(a,$.datepicker._getDaysInMonth(r,o))}l=s.exec(t)}return new Date(r,o,a)},o=null==t||""===t?i:"string"==typeof t?r(t):"number"==typeof t?isNaN(t)?i:n(t):new Date(t.getTime());return o=o&&"Invalid Date"==o.toString()?i:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var n=!t,r=e.selectedMonth,o=e.selectedYear,a=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=a.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=a.getMonth(),e.drawYear=e.selectedYear=e.currentYear=a.getFullYear(),(r!=e.selectedMonth||o!=e.selectedYear)&&!i&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(n?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""==e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),i="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(i,-t,"M")},next:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(i,+t,"M")},hide:function(){window["DP_jQuery_"+dpuuid].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+dpuuid].datepicker._gotoToday(i)},selectDay:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(i,this,"Y"),!1}};$(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var i=this._get(e,"isRTL"),n=this._get(e,"showButtonPanel"),r=this._get(e,"hideIfNoPrevNext"),o=this._get(e,"navigationAsDateFormat"),a=this._getNumberOfMonths(e),s=this._get(e,"showCurrentAtPos"),l=this._get(e,"stepMonths"),h=1!=a[0]||1!=a[1],c=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),d=this._getMinMaxDate(e,"min"),u=this._getMinMaxDate(e,"max"),p=e.drawMonth-s,f=e.drawYear;if(0>p&&(p+=12,f--),u){var m=this._daylightSavingAdjust(new Date(u.getFullYear(),u.getMonth()-a[0]*a[1]+1,u.getDate()));for(m=d&&d>m?d:m;this._daylightSavingAdjust(new Date(f,p,1))>m;)p--,0>p&&(p=11,f--)}e.drawMonth=p,e.drawYear=f;var g=this._get(e,"prevText");g=o?this.formatDate(g,this._daylightSavingAdjust(new Date(f,p-l,1)),this._getFormatConfig(e)):g;var v=this._canAdjustMonth(e,-1,f,p)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+g+"</span></a>":r?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+g+"</span></a>",E=this._get(e,"nextText");E=o?this.formatDate(E,this._daylightSavingAdjust(new Date(f,p+l,1)),this._getFormatConfig(e)):E;var y=this._canAdjustMonth(e,1,f,p)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+E+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+E+"</span></a>":r?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+E+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+E+"</span></a>",x=this._get(e,"currentText"),T=this._get(e,"gotoCurrent")&&e.currentDay?c:t;x=o?this.formatDate(x,T,this._getFormatConfig(e)):x;var b=e.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(e,"closeText")+"</button>",_=n?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(i?b:"")+(this._isInRange(e,T)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+x+"</button>":"")+(i?"":b)+"</div>":"",R=parseInt(this._get(e,"firstDay"),10);R=isNaN(R)?0:R;for(var w=this._get(e,"showWeek"),S=this._get(e,"dayNames"),H=(this._get(e,"dayNamesShort"),this._get(e,"dayNamesMin")),M=this._get(e,"monthNames"),C=this._get(e,"monthNamesShort"),D=this._get(e,"beforeShowDay"),A=this._get(e,"showOtherMonths"),I=this._get(e,"selectOtherMonths"),P=(this._get(e,"calculateWeek")||this.iso8601Week,this._getDefaultDate(e)),L="",k=0;k<a[0];k++){var O="";this.maxRows=4;for(var N=0;N<a[1];N++){var z=this._daylightSavingAdjust(new Date(f,p,e.selectedDay)),V=" ui-corner-all",F="";if(h){if(F+='<div class="ui-datepicker-group',a[1]>1)switch(N){case 0:F+=" ui-datepicker-group-first",V=" ui-corner-"+(i?"right":"left");break;case a[1]-1:F+=" ui-datepicker-group-last",V=" ui-corner-"+(i?"left":"right");break;default:F+=" ui-datepicker-group-middle",V=""}F+='">'}F+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+V+'">'+(/all|left/.test(V)&&0==k?i?y:v:"")+(/all|right/.test(V)&&0==k?i?v:y:"")+this._generateMonthYearHeader(e,p,f,d,u,k>0||N>0,M,C)+'</div><table class="ui-datepicker-calendar"><thead><tr>';for(var U=w?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"",B=0;7>B;B++){var G=(B+R)%7;U+="<th"+((B+R+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+S[G]+'">'+H[G]+"</span></th>"}F+=U+"</tr></thead><tbody>";var W=this._getDaysInMonth(f,p);f==e.selectedYear&&p==e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,W));var j=(this._getFirstDayOfMonth(f,p)-R+7)%7,X=Math.ceil((j+W)/7),Y=h?this.maxRows>X?this.maxRows:X:X;this.maxRows=Y;for(var K=this._daylightSavingAdjust(new Date(f,p,1-j)),q=0;Y>q;q++){F+="<tr>";for(var Z=w?'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(K)+"</td>":"",B=0;7>B;B++){var J=D?D.apply(e.input?e.input[0]:null,[K]):[!0,""],Q=K.getMonth()!=p,et=Q&&!I||!J[0]||d&&d>K||u&&K>u;Z+='<td class="'+((B+R+6)%7>=5?" ui-datepicker-week-end":"")+(Q?" ui-datepicker-other-month":"")+(K.getTime()==z.getTime()&&p==e.selectedMonth&&e._keyEvent||P.getTime()==K.getTime()&&P.getTime()==z.getTime()?" "+this._dayOverClass:"")+(et?" "+this._unselectableClass+" ui-state-disabled":"")+(Q&&!A?"":" "+J[1]+(K.getTime()==c.getTime()?" "+this._currentClass:"")+(K.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+(Q&&!A||!J[2]?"":' title="'+J[2]+'"')+(et?"":' data-handler="selectDay" data-event="click" data-month="'+K.getMonth()+'" data-year="'+K.getFullYear()+'"')+">"+(Q&&!A?"&#xa0;":et?'<span class="ui-state-default">'+K.getDate()+"</span>":'<a class="ui-state-default'+(K.getTime()==t.getTime()?" ui-state-highlight":"")+(K.getTime()==c.getTime()?" ui-state-active":"")+(Q?" ui-priority-secondary":"")+'" href="#">'+K.getDate()+"</a>")+"</td>",K.setDate(K.getDate()+1),K=this._daylightSavingAdjust(K)}F+=Z+"</tr>"}p++,p>11&&(p=0,f++),F+="</tbody></table>"+(h?"</div>"+(a[0]>0&&N==a[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),O+=F}L+=O}return L+=_+($.browser.msie&&parseInt($.browser.version,10)<7&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),e._keyEvent=!1,L},_generateMonthYearHeader:function(e,t,i,n,r,o,a,s){var l=this._get(e,"changeMonth"),h=this._get(e,"changeYear"),c=this._get(e,"showMonthAfterYear"),d='<div class="ui-datepicker-title">',u="";if(o||!l)u+='<span class="ui-datepicker-month">'+a[t]+"</span>";else{var p=n&&n.getFullYear()==i,f=r&&r.getFullYear()==i;u+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var m=0;12>m;m++)(!p||m>=n.getMonth())&&(!f||m<=r.getMonth())&&(u+='<option value="'+m+'"'+(m==t?' selected="selected"':"")+">"+s[m]+"</option>");u+="</select>"}if(c||(d+=u+(!o&&l&&h?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!h)d+='<span class="ui-datepicker-year">'+i+"</span>";else{var g=this._get(e,"yearRange").split(":"),v=(new Date).getFullYear(),E=function(e){var t=e.match(/c[+-].*/)?i+parseInt(e.substring(1),10):e.match(/[+-].*/)?v+parseInt(e,10):parseInt(e,10);return isNaN(t)?v:t},y=E(g[0]),x=Math.max(y,E(g[1]||""));for(y=n?Math.max(y,n.getFullYear()):y,x=r?Math.min(x,r.getFullYear()):x,e.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';x>=y;y++)e.yearshtml+='<option value="'+y+'"'+(y==i?' selected="selected"':"")+">"+y+"</option>";e.yearshtml+="</select>",d+=e.yearshtml,e.yearshtml=null}return d+=this._get(e,"yearSuffix"),c&&(d+=(!o&&l&&h?"":"&#xa0;")+u),d+="</div>"},_adjustInstDate:function(e,t,i){var n=e.drawYear+("Y"==i?t:0),r=e.drawMonth+("M"==i?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(n,r))+("D"==i?t:0),a=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(n,r,o)));e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),("M"==i||"Y"==i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=i&&i>t?i:t;return r=n&&r>n?n:r},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,n){var r=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(i,n+(0>t?t:r[0]*r[1]),1));return 0>t&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max");return(!i||t.getTime()>=i.getTime())&&(!n||t.getTime()<=n.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,n){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var r=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(n,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),r,this._getFormatConfig(e))}}),$.fn.datepicker=function(e){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv),$.datepicker.initialized=!0);var t=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!=e&&"getDate"!=e&&"widget"!=e?"option"==e&&2==arguments.length&&"string"==typeof arguments[1]?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t)):this.each(function(){"string"==typeof e?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e)}):$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.8.24",window["DP_jQuery_"+dpuuid]=$}(jQuery),function(e,t){e.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove(),e.Widget.prototype.destroy.apply(this,arguments)},value:function(e){return e===t?this._value():(this._setOption("value",e),this)},_setOption:function(t,i){"value"===t&&(this.options.value=i,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),e.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var e=this.options.value;return"number"!=typeof e&&(e=0),Math.min(this.options.max,Math.max(this.min,e))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var e=this.value(),t=this._percentage();this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),this.valueDiv.toggle(e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%"),this.element.attr("aria-valuenow",e)}}),e.extend(e.ui.progressbar,{version:"1.8.24"})}(jQuery),jQuery.effects||function(e,t){function i(t){var i;return t&&t.constructor==Array&&3==t.length?t:(i=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))?[parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10)]:(i=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[2.55*parseFloat(i[1]),2.55*parseFloat(i[2]),2.55*parseFloat(i[3])]:(i=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:(i=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]:(i=/rgba\(0, 0, 0, 0\)/.exec(t))?h.transparent:h[e.trim(t).toLowerCase()]}function n(t,n){var r;do{if(r=(e.curCSS||e.css)(t,n),""!=r&&"transparent"!=r||e.nodeName(t,"body"))break;n="backgroundColor"}while(t=t.parentNode);return i(r)}function r(){var e,t,i=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,n={};if(i&&i.length&&i[0]&&i[i[0]])for(var r=i.length;r--;)e=i[r],"string"==typeof i[e]&&(t=e.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),n[t]=i[e]);else for(e in i)"string"==typeof i[e]&&(n[e]=i[e]);return n}function o(t){var i,n;for(i in t)n=t[i],(null==n||e.isFunction(n)||i in d||/scrollbar/.test(i)||!/color/i.test(i)&&isNaN(parseFloat(n)))&&delete t[i];return t}function a(e,t){var i,n={_:0};for(i in t)e[i]!=t[i]&&(n[i]=t[i]);return n}function s(t,i,n,r){return"object"==typeof t&&(r=i,n=null,i=t,t=i.effect),e.isFunction(i)&&(r=i,n=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(r=n,n=i,i={}),e.isFunction(n)&&(r=n,n=null),i=i||{},n=n||i.duration,n=e.fx.off?0:"number"==typeof n?n:n in e.fx.speeds?e.fx.speeds[n]:e.fx.speeds._default,r=r||i.complete,[t,i,n,r]}function l(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects[t]?!1:!0}e.effects={},e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(t,r){e.fx.step[r]=function(e){e.colorInit||(e.start=n(e.elem,r),e.end=i(e.end),e.colorInit=!0),e.elem.style[r]="rgb("+Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2],10),255),0)+")"}});var h={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},c=["add","remove","toggle"],d={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.effects.animateClass=function(t,i,n,s){return e.isFunction(n)&&(s=n,n=null),this.queue(function(){var l,h=e(this),d=h.attr("style")||" ",u=o(r.call(this)),p=h.attr("class")||"";e.each(c,function(e,i){t[i]&&h[i+"Class"](t[i])}),l=o(r.call(this)),h.attr("class",p),h.animate(a(u,l),{queue:!1,duration:i,easing:n,complete:function(){e.each(c,function(e,i){t[i]&&h[i+"Class"](t[i])}),"object"==typeof h.attr("style")?(h.attr("style").cssText="",h.attr("style").cssText=d):h.attr("style",d),s&&s.apply(this,arguments),e.dequeue(this)}})})},e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,i,n,r){return i?e.effects.animateClass.apply(this,[{add:t},i,n,r]):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,i,n,r){return i?e.effects.animateClass.apply(this,[{remove:t},i,n,r]):this._removeClass(t)},_toggleClass:e.fn.toggleClass,toggleClass:function(i,n,r,o,a){return"boolean"==typeof n||n===t?r?e.effects.animateClass.apply(this,[n?{add:i}:{remove:i},r,o,a]):this._toggleClass(i,n):e.effects.animateClass.apply(this,[{toggle:i},n,r,o])},switchClass:function(t,i,n,r,o){return e.effects.animateClass.apply(this,[{add:i,remove:t},n,r,o])}}),e.extend(e.effects,{version:"1.8.24",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data("ec.storage."+t[i],e[0].style[t[i]])},restore:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.css(t[i],e.data("ec.storage."+t[i]))},setMode:function(e,t){return"toggle"==t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,n;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=e[1]/t.width}return{x:n,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},n=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r=document.activeElement;try{r.id}catch(o){r=document.body}return t.wrap(n),(t[0]===r||e.contains(t[0],r))&&e(r).focus(),n=t.parent(),"static"==t.css("position")?(n.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,n){i[n]=t.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),n.css(i).show()},removeWrapper:function(t){var i,n=document.activeElement;return t.parent().is(".ui-effects-wrapper")?(i=t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus(),i):t},setTransition:function(t,i,n,r){return r=r||{},e.each(i,function(e,i){var o=t.cssUnit(i);o[0]>0&&(r[i]=o[0]*n+o[1])}),r}}),e.fn.extend({effect:function(t){var i=s.apply(this,arguments),n={options:i[1],duration:i[2],callback:i[3]},r=n.options.mode,o=e.effects[t];return e.fx.off||!o?r?this[r](n.duration,n.callback):this.each(function(){n.callback&&n.callback.call(this)}):o.call(this,n)},_show:e.fn.show,show:function(e){if(l(e))return this._show.apply(this,arguments);var t=s.apply(this,arguments);return t[1].mode="show",this.effect.apply(this,t)},_hide:e.fn.hide,hide:function(e){if(l(e))return this._hide.apply(this,arguments);var t=s.apply(this,arguments);return t[1].mode="hide",this.effect.apply(this,t)},__toggle:e.fn.toggle,toggle:function(t){if(l(t)||"boolean"==typeof t||e.isFunction(t))return this.__toggle.apply(this,arguments);var i=s.apply(this,arguments);return i[1].mode="toggle",this.effect.apply(this,i)
},cssUnit:function(t){var i=this.css(t),n=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(n=[parseFloat(i),t])}),n}});var u={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,t){u[t]=function(t){return Math.pow(t,e+2)}}),e.extend(u,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(u,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:i(-2*e+2)/-2+1}})}(jQuery),function(e){e.effects.blind=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right"],r=e.effects.setMode(i,t.options.mode||"hide"),o=t.options.direction||"vertical";e.effects.save(i,n),i.show();var a=e.effects.createWrapper(i).css({overflow:"hidden"}),s="vertical"==o?"height":"width",l="vertical"==o?a.height():a.width();"show"==r&&a.css(s,0);var h={};h[s]="show"==r?l:0,a.animate(h,t.duration,t.options.easing,function(){"hide"==r&&i.hide(),e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(i[0],arguments),i.dequeue()})})}}(jQuery),function(e){e.effects.bounce=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right"],r=e.effects.setMode(i,t.options.mode||"effect"),o=t.options.direction||"up",a=t.options.distance||20,s=t.options.times||5,l=t.duration||250;/show|hide/.test(r)&&n.push("opacity"),e.effects.save(i,n),i.show(),e.effects.createWrapper(i);var h="up"==o||"down"==o?"top":"left",c="up"==o||"left"==o?"pos":"neg",a=t.options.distance||("top"==h?i.outerHeight(!0)/3:i.outerWidth(!0)/3);if("show"==r&&i.css("opacity",0).css(h,"pos"==c?-a:a),"hide"==r&&(a/=2*s),"hide"!=r&&s--,"show"==r){var d={opacity:1};d[h]=("pos"==c?"+=":"-=")+a,i.animate(d,l/2,t.options.easing),a/=2,s--}for(var u=0;s>u;u++){var p={},f={};p[h]=("pos"==c?"-=":"+=")+a,f[h]=("pos"==c?"+=":"-=")+a,i.animate(p,l/2,t.options.easing).animate(f,l/2,t.options.easing),a="hide"==r?2*a:a/2}if("hide"==r){var d={opacity:0};d[h]=("pos"==c?"-=":"+=")+a,i.animate(d,l/2,t.options.easing,function(){i.hide(),e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(this,arguments)})}else{var p={},f={};p[h]=("pos"==c?"-=":"+=")+a,f[h]=("pos"==c?"+=":"-=")+a,i.animate(p,l/2,t.options.easing).animate(f,l/2,t.options.easing,function(){e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(this,arguments)})}i.queue("fx",function(){i.dequeue()}),i.dequeue()})}}(jQuery),function(e){e.effects.clip=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(i,t.options.mode||"hide"),o=t.options.direction||"vertical";e.effects.save(i,n),i.show();var a=e.effects.createWrapper(i).css({overflow:"hidden"}),s="IMG"==i[0].tagName?a:i,l={size:"vertical"==o?"height":"width",position:"vertical"==o?"top":"left"},h="vertical"==o?s.height():s.width();"show"==r&&(s.css(l.size,0),s.css(l.position,h/2));var c={};c[l.size]="show"==r?h:0,c[l.position]="show"==r?0:h/2,s.animate(c,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){"hide"==r&&i.hide(),e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(i[0],arguments),i.dequeue()}})})}}(jQuery),function(e){e.effects.drop=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right","opacity"],r=e.effects.setMode(i,t.options.mode||"hide"),o=t.options.direction||"left";e.effects.save(i,n),i.show(),e.effects.createWrapper(i);var a="up"==o||"down"==o?"top":"left",s="up"==o||"left"==o?"pos":"neg",l=t.options.distance||("top"==a?i.outerHeight(!0)/2:i.outerWidth(!0)/2);"show"==r&&i.css("opacity",0).css(a,"pos"==s?-l:l);var h={opacity:"show"==r?1:0};h[a]=("show"==r?"pos"==s?"+=":"-=":"pos"==s?"-=":"+=")+l,i.animate(h,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){"hide"==r&&i.hide(),e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(this,arguments),i.dequeue()}})})}}(jQuery),function(e){e.effects.explode=function(t){return this.queue(function(){var i=t.options.pieces?Math.round(Math.sqrt(t.options.pieces)):3,n=t.options.pieces?Math.round(Math.sqrt(t.options.pieces)):3;t.options.mode="toggle"==t.options.mode?e(this).is(":visible")?"hide":"show":t.options.mode;var r=e(this).show().css("visibility","hidden"),o=r.offset();o.top-=parseInt(r.css("marginTop"),10)||0,o.left-=parseInt(r.css("marginLeft"),10)||0;for(var a=r.outerWidth(!0),s=r.outerHeight(!0),l=0;i>l;l++)for(var h=0;n>h;h++)r.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-h*(a/n),top:-l*(s/i)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:a/n,height:s/i,left:o.left+h*(a/n)+("show"==t.options.mode?(h-Math.floor(n/2))*(a/n):0),top:o.top+l*(s/i)+("show"==t.options.mode?(l-Math.floor(i/2))*(s/i):0),opacity:"show"==t.options.mode?0:1}).animate({left:o.left+h*(a/n)+("show"==t.options.mode?0:(h-Math.floor(n/2))*(a/n)),top:o.top+l*(s/i)+("show"==t.options.mode?0:(l-Math.floor(i/2))*(s/i)),opacity:"show"==t.options.mode?1:0},t.duration||500);setTimeout(function(){"show"==t.options.mode?r.css({visibility:"visible"}):r.css({visibility:"visible"}).hide(),t.callback&&t.callback.apply(r[0]),r.dequeue(),e("div.ui-effects-explode").remove()},t.duration||500)})}}(jQuery),function(e){e.effects.fade=function(t){return this.queue(function(){var i=e(this),n=e.effects.setMode(i,t.options.mode||"hide");i.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){t.callback&&t.callback.apply(this,arguments),i.dequeue()}})})}}(jQuery),function(e){e.effects.fold=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right"],r=e.effects.setMode(i,t.options.mode||"hide"),o=t.options.size||15,a=!!t.options.horizFirst,s=t.duration?t.duration/2:e.fx.speeds._default/2;e.effects.save(i,n),i.show();var l=e.effects.createWrapper(i).css({overflow:"hidden"}),h="show"==r!=a,c=h?["width","height"]:["height","width"],d=h?[l.width(),l.height()]:[l.height(),l.width()],u=/([0-9]+)%/.exec(o);u&&(o=parseInt(u[1],10)/100*d["hide"==r?0:1]),"show"==r&&l.css(a?{height:0,width:o}:{height:o,width:0});var p={},f={};p[c[0]]="show"==r?d[0]:o,f[c[1]]="show"==r?d[1]:0,l.animate(p,s,t.options.easing).animate(f,s,t.options.easing,function(){"hide"==r&&i.hide(),e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(i[0],arguments),i.dequeue()})})}}(jQuery),function(e){e.effects.highlight=function(t){return this.queue(function(){var i=e(this),n=["backgroundImage","backgroundColor","opacity"],r=e.effects.setMode(i,t.options.mode||"show"),o={backgroundColor:i.css("backgroundColor")};"hide"==r&&(o.opacity=0),e.effects.save(i,n),i.show().css({backgroundImage:"none",backgroundColor:t.options.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){"hide"==r&&i.hide(),e.effects.restore(i,n),"show"==r&&!e.support.opacity&&this.style.removeAttribute("filter"),t.callback&&t.callback.apply(this,arguments),i.dequeue()}})})}}(jQuery),function(e){e.effects.pulsate=function(t){return this.queue(function(){var i=e(this),n=e.effects.setMode(i,t.options.mode||"show"),r=2*(t.options.times||5)-1,o=t.duration?t.duration/2:e.fx.speeds._default/2,a=i.is(":visible"),s=0;a||(i.css("opacity",0).show(),s=1),("hide"==n&&a||"show"==n&&!a)&&r--;for(var l=0;r>l;l++)i.animate({opacity:s},o,t.options.easing),s=(s+1)%2;i.animate({opacity:s},o,t.options.easing,function(){0==s&&i.hide(),t.callback&&t.callback.apply(this,arguments)}),i.queue("fx",function(){i.dequeue()}).dequeue()})}}(jQuery),function(e){e.effects.puff=function(t){return this.queue(function(){var i=e(this),n=e.effects.setMode(i,t.options.mode||"hide"),r=parseInt(t.options.percent,10)||150,o=r/100,a={height:i.height(),width:i.width()};e.extend(t.options,{fade:!0,mode:n,percent:"hide"==n?r:100,from:"hide"==n?a:{height:a.height*o,width:a.width*o}}),i.effect("scale",t.options,t.duration,t.callback),i.dequeue()})},e.effects.scale=function(t){return this.queue(function(){var i=e(this),n=e.extend(!0,{},t.options),r=e.effects.setMode(i,t.options.mode||"effect"),o=parseInt(t.options.percent,10)||(0==parseInt(t.options.percent,10)?0:"hide"==r?0:100),a=t.options.direction||"both",s=t.options.origin;"effect"!=r&&(n.origin=s||["middle","center"],n.restore=!0);var l={height:i.height(),width:i.width()};i.from=t.options.from||("show"==r?{height:0,width:0}:l);var h={y:"horizontal"!=a?o/100:1,x:"vertical"!=a?o/100:1};i.to={height:l.height*h.y,width:l.width*h.x},t.options.fade&&("show"==r&&(i.from.opacity=0,i.to.opacity=1),"hide"==r&&(i.from.opacity=1,i.to.opacity=0)),n.from=i.from,n.to=i.to,n.mode=r,i.effect("size",n,t.duration,t.callback),i.dequeue()})},e.effects.size=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right","width","height","overflow","opacity"],r=["position","top","bottom","left","right","overflow","opacity"],o=["width","height","overflow"],a=["fontSize"],s=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],h=e.effects.setMode(i,t.options.mode||"effect"),c=t.options.restore||!1,d=t.options.scale||"both",u=t.options.origin,p={height:i.height(),width:i.width()};if(i.from=t.options.from||p,i.to=t.options.to||p,u){var f=e.effects.getBaseline(u,p);i.from.top=(p.height-i.from.height)*f.y,i.from.left=(p.width-i.from.width)*f.x,i.to.top=(p.height-i.to.height)*f.y,i.to.left=(p.width-i.to.width)*f.x}var m={from:{y:i.from.height/p.height,x:i.from.width/p.width},to:{y:i.to.height/p.height,x:i.to.width/p.width}};("box"==d||"both"==d)&&(m.from.y!=m.to.y&&(n=n.concat(s),i.from=e.effects.setTransition(i,s,m.from.y,i.from),i.to=e.effects.setTransition(i,s,m.to.y,i.to)),m.from.x!=m.to.x&&(n=n.concat(l),i.from=e.effects.setTransition(i,l,m.from.x,i.from),i.to=e.effects.setTransition(i,l,m.to.x,i.to))),("content"==d||"both"==d)&&m.from.y!=m.to.y&&(n=n.concat(a),i.from=e.effects.setTransition(i,a,m.from.y,i.from),i.to=e.effects.setTransition(i,a,m.to.y,i.to)),e.effects.save(i,c?n:r),i.show(),e.effects.createWrapper(i),i.css("overflow","hidden").css(i.from),("content"==d||"both"==d)&&(s=s.concat(["marginTop","marginBottom"]).concat(a),l=l.concat(["marginLeft","marginRight"]),o=n.concat(s).concat(l),i.find("*[width]").each(function(){var i=e(this);c&&e.effects.save(i,o);var n={height:i.height(),width:i.width()};i.from={height:n.height*m.from.y,width:n.width*m.from.x},i.to={height:n.height*m.to.y,width:n.width*m.to.x},m.from.y!=m.to.y&&(i.from=e.effects.setTransition(i,s,m.from.y,i.from),i.to=e.effects.setTransition(i,s,m.to.y,i.to)),m.from.x!=m.to.x&&(i.from=e.effects.setTransition(i,l,m.from.x,i.from),i.to=e.effects.setTransition(i,l,m.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.options.easing,function(){c&&e.effects.restore(i,o)})})),i.animate(i.to,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){0===i.to.opacity&&i.css("opacity",i.from.opacity),"hide"==h&&i.hide(),e.effects.restore(i,c?n:r),e.effects.removeWrapper(i),t.callback&&t.callback.apply(this,arguments),i.dequeue()}})})}}(jQuery),function(e){e.effects.shake=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right"],r=(e.effects.setMode(i,t.options.mode||"effect"),t.options.direction||"left"),o=t.options.distance||20,a=t.options.times||3,s=t.duration||t.options.duration||140;e.effects.save(i,n),i.show(),e.effects.createWrapper(i);var l="up"==r||"down"==r?"top":"left",h="up"==r||"left"==r?"pos":"neg",c={},d={},u={};c[l]=("pos"==h?"-=":"+=")+o,d[l]=("pos"==h?"+=":"-=")+2*o,u[l]=("pos"==h?"-=":"+=")+2*o,i.animate(c,s,t.options.easing);for(var p=1;a>p;p++)i.animate(d,s,t.options.easing).animate(u,s,t.options.easing);i.animate(d,s,t.options.easing).animate(c,s/2,t.options.easing,function(){e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(this,arguments)}),i.queue("fx",function(){i.dequeue()}),i.dequeue()})}}(jQuery),function(e){e.effects.slide=function(t){return this.queue(function(){var i=e(this),n=["position","top","bottom","left","right"],r=e.effects.setMode(i,t.options.mode||"show"),o=t.options.direction||"left";e.effects.save(i,n),i.show(),e.effects.createWrapper(i).css({overflow:"hidden"});var a="up"==o||"down"==o?"top":"left",s="up"==o||"left"==o?"pos":"neg",l=t.options.distance||("top"==a?i.outerHeight(!0):i.outerWidth(!0));"show"==r&&i.css(a,"pos"==s?isNaN(l)?"-"+l:-l:l);var h={};h[a]=("show"==r?"pos"==s?"+=":"-=":"pos"==s?"-=":"+=")+l,i.animate(h,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){"hide"==r&&i.hide(),e.effects.restore(i,n),e.effects.removeWrapper(i),t.callback&&t.callback.apply(this,arguments),i.dequeue()}})})}}(jQuery),function(e){e.effects.transfer=function(t){return this.queue(function(){var i=e(this),n=e(t.options.to),r=n.offset(),o={top:r.top,left:r.left,height:n.innerHeight(),width:n.innerWidth()},a=i.offset(),s=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(t.options.className).css({top:a.top,left:a.left,height:i.innerHeight(),width:i.innerWidth(),position:"absolute"}).animate(o,t.duration,t.options.easing,function(){s.remove(),t.callback&&t.callback.apply(i[0],arguments),i.dequeue()})})}}(jQuery),jQuery&&function(){$.extend($.fn,{contextMenu:function(e,t){return void 0==e.menu?!1:(void 0==e.inSpeed&&(e.inSpeed=150),void 0==e.outSpeed&&(e.outSpeed=75),0==e.inSpeed&&(e.inSpeed=-1),0==e.outSpeed&&(e.outSpeed=-1),$(this).each(function(){var i=$(this),n=$(i).offset();$("#"+e.menu).addClass("contextMenu"),$(this).mousedown(function(r){var o=r;o.stopPropagation(),o.preventDefault(),$(this).mouseup(function(r){r.stopPropagation(),r.preventDefault();var a=$(this);if($(this).unbind("mouseup"),2==o.button){$(".contextMenu").hide();var s=$("#"+e.menu);if($(i).hasClass("disabled"))return!1;var l,h,c={};self.innerHeight?(c.pageYOffset=self.pageYOffset,c.pageXOffset=self.pageXOffset,c.innerHeight=self.innerHeight,c.innerWidth=self.innerWidth):document.documentElement&&document.documentElement.clientHeight?(c.pageYOffset=document.documentElement.scrollTop,c.pageXOffset=document.documentElement.scrollLeft,c.innerHeight=document.documentElement.clientHeight,c.innerWidth=document.documentElement.clientWidth):document.body&&(c.pageYOffset=document.body.scrollTop,c.pageXOffset=document.body.scrollLeft,c.innerHeight=document.body.clientHeight,c.innerWidth=document.body.clientWidth),l=r.pageX?r.pageX:r.clientX+c.scrollLeft,h=r.pageY?r.pageY:r.clientY+c.scrollTop,$(document).unbind("click"),$(s).fadeIn(e.inSpeed).offset({top:h,left:l}),$(s).find("A").mouseover(function(){$(s).find("LI.hover").removeClass("hover"),$(this).parent().addClass("hover")}).mouseout(function(){$(s).find("LI.hover").removeClass("hover")}),$(document).keypress(function(e){switch(e.keyCode){case 38:0==$(s).find("LI.hover").size()?$(s).find("LI:last").addClass("hover"):($(s).find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(s).find("LI.hover").size()&&$(s).find("LI:last").addClass("hover"));break;case 40:0==$(s).find("LI.hover").size()?$(s).find("LI:first").addClass("hover"):($(s).find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(s).find("LI.hover").size()&&$(s).find("LI:first").addClass("hover"));break;case 13:$(s).find("LI.hover A").trigger("click");break;case 27:$(document).trigger("click")}}),$("#"+e.menu).find("A").unbind("click"),$("#"+e.menu).find("LI:not(.disabled) A").click(function(){return $(document).unbind("click").unbind("keypress"),$(".contextMenu").hide(),t&&t($(this).attr("href").substr(1),$(a),{x:l-n.left,y:h-n.top,docX:l,docY:h}),!1}),setTimeout(function(){$(document).click(function(){return $(document).unbind("click").unbind("keypress"),$(s).fadeOut(e.outSpeed),!1})},0)}})}),$.browser.mozilla?$("#"+e.menu).each(function(){$(this).css({MozUserSelect:"none"})}):$.browser.msie?$("#"+e.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return!1})}):$("#"+e.menu).each(function(){$(this).bind("mousedown.disableTextSelect",function(){return!1})}),$(i).add($("UL.contextMenu")).bind("contextmenu",function(){return!1})}),$(this))},disableContextMenuItems:function(e){return void 0==e?($(this).find("LI").addClass("disabled"),$(this)):($(this).each(function(){if(void 0!=e)for(var t=e.split(","),i=0;i<t.length;i++)$(this).find('A[href="'+t[i]+'"]').parent().addClass("disabled")}),$(this))},enableContextMenuItems:function(e){return void 0==e?($(this).find("LI.disabled").removeClass("disabled"),$(this)):($(this).each(function(){if(void 0!=e)for(var t=e.split(","),i=0;i<t.length;i++)$(this).find('A[href="'+t[i]+'"]').parent().removeClass("disabled")}),$(this))},disableContextMenu:function(){return $(this).each(function(){$(this).addClass("disabled")}),$(this)},enableContextMenu:function(){return $(this).each(function(){$(this).removeClass("disabled")}),$(this)},destroyContextMenu:function(){return $(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")}),$(this)},showMenu:function(e,t,i,n,r){$(".contextMenu").hide();var o=$("#"+e);$(document).unbind("click"),$(o).fadeIn(150).offset({top:i,left:t}),$(o).find("A").mouseover(function(){$(o).find("LI.hover").removeClass("hover"),$(this).parent().addClass("hover")}).mouseout(function(){$(o).find("LI.hover").removeClass("hover")}),$(document).keypress(function(e){switch(e.keyCode){case 38:0==$(o).find("LI.hover").size()?$(o).find("LI:last").addClass("hover"):($(o).find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(o).find("LI.hover").size()&&$(o).find("LI:last").addClass("hover"));break;case 40:0==$(o).find("LI.hover").size()?$(o).find("LI:first").addClass("hover"):($(o).find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(o).find("LI.hover").size()&&$(o).find("LI:first").addClass("hover"));break;case 13:$(o).find("LI.hover A").trigger("click");break;case 27:$(document).trigger("click")}}),$("#"+e).find("A").unbind("click"),$("#"+e).find("LI:not(.disabled) A").click(function(){return $(document).unbind("click").unbind("keypress"),$(".contextMenu").hide(),n&&n($(this).attr("href").substr(1)),!1}),setTimeout(function(){$(document).click(function(){return void 0!==r&&r(),$(document).unbind("click").unbind("keypress"),$(o).fadeOut(75),!1})},0)}})}(jQuery);var _canLog=!0,getDynaTreePersistData=null,DTNodeStatus_Error=-1,DTNodeStatus_Loading=1,DTNodeStatus_Ok=0;!function($){function getDtNodeFromElement(e){return alert("getDtNodeFromElement is deprecated"),$.ui.dynatree.getNode(e)}function noop(){}function _initDragAndDrop(e){var t=e.options.dnd||null;t&&(t.onDragStart||t.onDrop)&&_registerDnd(),t&&t.onDragStart&&e.$tree.draggable({addClasses:!1,appendTo:"body",containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToDynatree:!0,helper:function(e){var t=$.ui.dynatree.getNode(e.target);return t?t.tree._onDragEvent("helper",t,null,e,null,null):"<div></div>"},start:function(e,t){var i=t.helper.data("dtSourceNode");return!!i},_last:null}),t&&t.onDrop&&e.$tree.droppable({addClasses:!1,tolerance:"intersect",greedy:!1,_last:null})}var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}},DynaTreeNode=Class.create();DynaTreeNode.prototype={initialize:function(e,t,i){this.parent=e,this.tree=t,"string"==typeof i&&(i={title:i}),void 0===i.key&&(i.key="_"+t._nodeCount++),this.data=$.extend({},$.ui.dynatree.nodedatadefaults,i),this.li=null,this.span=null,this.ul=null,this.childList=null,this._isLoading=!1,this.hasSubSel=!1,this.bExpanded=!1,this.bSelected=!1},toString:function(){return"DynaTreeNode<"+this.data.key+">: '"+this.data.title+"'"},toDict:function(e,t){var i=$.extend({},this.data);if(i.activate=this.tree.activeNode===this,i.focus=this.tree.focusNode===this,i.expand=this.bExpanded,i.select=this.bSelected,t&&t(i),e&&this.childList){i.children=[];for(var n=0,r=this.childList.length;r>n;n++)i.children.push(this.childList[n].toDict(!0,t))}else delete i.children;return i},fromDict:function(e){var t=e.children;return void 0===t?(this.data=$.extend(this.data,e),this.render(),void 0):(e=$.extend({},e),e.children=void 0,this.data=$.extend(this.data,e),this.removeChildren(),this.addChild(t),void 0)},_getInnerHtml:function(){var e,t=this.tree,i=t.options,n=t.cache,r=this.getLevel(),o=this.data,a="";r<i.minExpandLevel?r>1&&(a+=n.tagConnector):a+=this.hasChildren()!==!1?n.tagExpander:n.tagConnector,i.checkbox&&o.hideCheckbox!==!0&&!o.isStatusNode&&(a+=n.tagCheckbox),o.icon?(e="/"===o.icon.charAt(0)?o.icon:i.imagePath+o.icon,a+="<img src='"+e+"' alt='' />"):o.icon===!1||(a+=n.tagNodeIcon);var s="";if(i.onCustomRender&&(s=i.onCustomRender.call(t,this)||""),!s){var l=o.tooltip?' title="'+o.tooltip.replace(/\"/g,"&quot;")+'"':"",h=o.href||"#";s=i.noLink||o.noLink?'<span style="display:inline-block;" class="'+i.classNames.title+'"'+l+">"+o.title+"</span>":'<a href="'+h+'" class="'+i.classNames.title+'"'+l+">"+o.title+"</a>"}return a+=s},_fixOrder:function(){var e=this.childList;if(e&&this.ul)for(var t=this.ul.firstChild,i=0,n=e.length-1;n>i;i++){var r=e[i],o=t.dtnode;r!==o?(this.tree.logDebug("_fixOrder: mismatch at index "+i+": "+r+" != "+o),this.ul.insertBefore(r.li,o.li)):t=t.nextSibling}},render:function(e,t){var i=this.tree,n=this.parent,r=this.data,o=i.options,a=o.classNames,s=this.isLastSibling(),l=!1;if(n||this.ul){if(n){this.li||(l=!0,this.li=document.createElement("li"),this.li.dtnode=this,r.key&&o.generateIds&&(this.li.id=o.idPrefix+r.key),this.span=document.createElement("span"),this.span.className=a.title,this.li.appendChild(this.span),n.ul||(n.ul=document.createElement("ul"),n.ul.style.display="none",n.li.appendChild(n.ul)),n.ul.appendChild(this.li)),this.span.innerHTML=this._getInnerHtml();var h=[];h.push(a.node),r.isFolder&&h.push(a.folder),this.bExpanded&&h.push(a.expanded),this.hasChildren()!==!1&&h.push(a.hasChildren),r.isLazy&&null===this.childList&&h.push(a.lazy),s&&h.push(a.lastsib),this.bSelected&&h.push(a.selected),this.hasSubSel&&h.push(a.partsel),i.activeNode===this&&h.push(a.active),r.addClass&&h.push(r.addClass),h.push(a.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(r.isLazy&&null===this.childList?"d":"")+(s?"l":"")),h.push(a.combinedIconPrefix+(this.bExpanded?"e":"c")+(r.isFolder?"f":"")),this.span.className=h.join(" "),this.li.className=s?a.lastsib:"",l&&o.onCreate&&o.onCreate.call(i,this,this.span),o.onRender&&o.onRender.call(i,this,this.span)}}else this.li=this.span=null,this.ul=document.createElement("ul"),this.ul.className=o.minExpandLevel>1?a.container+" "+a.noConnector:a.container;if((this.bExpanded||t===!0)&&this.childList){for(var c=0,d=this.childList.length;d>c;c++)this.childList[c].render(!1,t);this._fixOrder()}if(this.ul){var u="none"===this.ul.style.display,p=!!this.bExpanded;if(e&&o.fx&&u===p){var f=o.fx.duration||200;$(this.ul).animate(o.fx,f)}else this.ul.style.display=this.bExpanded||!n?"":"none"}},getKeyPath:function(e){var t=[];return this.visitParents(function(e){e.parent&&t.unshift(e.data.key)},!e),"/"+t.join(this.tree.options.keyPathSeparator)},getParent:function(){return this.parent},getChildren:function(){return void 0===this.hasChildren()?void 0:this.childList},hasChildren:function(){return this.data.isLazy?null===this.childList||void 0===this.childList?void 0:0===this.childList.length?!1:1===this.childList.length&&this.childList[0].isStatusNode()?void 0:!0:!!this.childList},isFirstSibling:function(){var e=this.parent;return!e||e.childList[0]===this},isLastSibling:function(){var e=this.parent;return!e||e.childList[e.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent)return null;for(var e=this.parent.childList,t=1,i=e.length;i>t;t++)if(e[t]===this)return e[t-1];return null},getNextSibling:function(){if(!this.parent)return null;for(var e=this.parent.childList,t=0,i=e.length-1;i>t;t++)if(e[t]===this)return e[t+1];return null},isStatusNode:function(){return this.data.isStatusNode===!0},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e)return!1;for(var t=this.parent;t;){if(t===e)return!0;t=t.parent}return!1},countChildren:function(){var e=this.childList;if(!e)return 0;for(var t=e.length,i=0,n=t;n>i;i++){var r=e[i];t+=r.countChildren()}return t},sortChildren:function(e,t){var i=this.childList;if(i){if(e=e||function(e,t){var i=e.data.title.toLowerCase(),n=t.data.title.toLowerCase();return i===n?0:i>n?1:-1},i.sort(e),t)for(var n=0,r=i.length;r>n;n++)i[n].childList&&i[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render()}},_setStatusNode:function(e){var t=this.childList?this.childList[0]:null;if(e)t?(e.isStatusNode=!0,e.key="_statusNode",t.data=e,t.render()):(e.isStatusNode=!0,e.key="_statusNode",t=this.addChild(e));else if(t&&t.isStatusNode()){try{this.ul&&(this.ul.removeChild(t.li),t.li=null)}catch(i){}1===this.childList.length?this.childList=[]:this.childList.shift()}},setLazyNodeStatus:function(e,t){var i=t&&t.tooltip?t.tooltip:null,n=t&&t.info?" ("+t.info+")":"";switch(e){case DTNodeStatus_Ok:this._setStatusNode(null),$(this.span).removeClass(this.tree.options.classNames.nodeLoading),this._isLoading=!1,this.tree.options.autoFocus&&(this===this.tree.tnRoot&&this.childList&&this.childList.length>0?this.childList[0].focus():this.focus());break;case DTNodeStatus_Loading:this._isLoading=!0,$(this.span).addClass(this.tree.options.classNames.nodeLoading),this.parent||this._setStatusNode({title:this.tree.options.strings.loading+n,tooltip:i,addClass:this.tree.options.classNames.nodeWait});break;case DTNodeStatus_Error:this._isLoading=!1,this._setStatusNode({title:this.tree.options.strings.loadError+n,tooltip:i,addClass:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+e+"'."}},_parentList:function(e,t){for(var i=[],n=t?this:this.parent;n;)(e||n.parent)&&i.unshift(n),n=n.parent;return i},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},_getTypeForOuterNodeEvent:function(e){var t=this.tree.options.classNames,i=e.target;if(i.className.indexOf(t.node)<0)return null;for(var n=e.pageX-i.offsetLeft,r=e.pageY-i.offsetTop,o=0,a=i.childNodes.length;a>o;o++){var s=i.childNodes[o],l=s.offsetLeft-i.offsetLeft,h=s.offsetTop-i.offsetTop,c=s.clientWidth,d=s.clientHeight;if(n>=l&&l+c>=n&&r>=h&&h+d>=r){if(s.className==t.title)return"title";if(s.className==t.expander)return"expander";if(s.className==t.checkbox)return"checkbox";if(s.className==t.nodeIcon)return"icon"}}return"prefix"},getEventTargetType:function(e){var t=e&&e.target?e.target.className:"",i=this.tree.options.classNames;return t===i.title?"title":t===i.expander?"expander":t===i.checkbox?"checkbox":t===i.nodeIcon?"icon":t===i.empty||t===i.vline||t===i.connector?"prefix":t.indexOf(i.node)>=0?this._getTypeForOuterNodeEvent(e):null},isVisible:function(){for(var e=this._parentList(!0,!1),t=0,i=e.length;i>t;t++)if(!e[t].bExpanded)return!1;return!0},makeVisible:function(){for(var e=this._parentList(!0,!1),t=0,i=e.length;i>t;t++)e[t]._expand(!0)},focus:function(){this.makeVisible();try{$(this.span).find(">a").focus()}catch(e){}},isFocused:function(){return this.tree.tnFocused===this},_activate:function(e,t){this.tree.logDebug("dtnode._activate(%o, fireEvents=%o) - %o",e,t,this);var i=this.tree.options;if(!(this.data.isStatusNode||t&&i.onQueryActivate&&i.onQueryActivate.call(this.tree,e,this)===!1))if(e){if(this.tree.activeNode){if(this.tree.activeNode===this)return;this.tree.activeNode.deactivate()}i.activeVisible&&this.makeVisible(),this.tree.activeNode=this,i.persist&&$.cookie(i.cookieId+"-active",this.data.key,i.cookie),this.tree.persistence.activeKey=this.data.key,$(this.span).addClass(i.classNames.active),t&&i.onActivate&&i.onActivate.call(this.tree,this)}else if(this.tree.activeNode===this){if(i.onQueryActivate&&i.onQueryActivate.call(this.tree,!1,this)===!1)return;$(this.span).removeClass(i.classNames.active),i.persist&&$.cookie(i.cookieId+"-active","",i.cookie),this.tree.persistence.activeKey=null,this.tree.activeNode=null,t&&i.onDeactivate&&i.onDeactivate.call(this.tree,this)}},activate:function(){this._activate(!0,!0)},activateSilently:function(){this._activate(!0,!1)},deactivate:function(){this._activate(!1,!0)},isActive:function(){return this.tree.activeNode===this},_userActivate:function(){var e=!0,t=!1;if(this.data.isFolder)switch(this.tree.options.clickFolderMode){case 2:e=!1,t=!0;break;case 3:e=t=!0}null===this.parent&&(t=!1),t&&(this.toggleExpand(),this.focus()),e&&this.activate()},_setSubSel:function(e){e?(this.hasSubSel=!0,$(this.span).addClass(this.tree.options.classNames.partsel)):(this.hasSubSel=!1,$(this.span).removeClass(this.tree.options.classNames.partsel))},_updatePartSelectionState:function(){var e;if(!this.hasChildren())return e=this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode,this._setSubSel(!1),e;var t,i,n=this.childList,r=!0,o=!0;for(t=0,i=n.length;i>t;t++){var a=n[t],s=a._updatePartSelectionState();s!==!1&&(o=!1),s!==!0&&(r=!1)}return e=r?!0:o?!1:void 0,this._setSubSel(void 0===e),this.bSelected=e===!0,e},_fixSelectionState:function(){var e,t,i;if(this.bSelected)for(this.visit(function(e){e.parent._setSubSel(!0),e.data.unselectable||e._select(!0,!1,!1)}),e=this.parent;e;){e._setSubSel(!0);var n=!0;for(t=0,i=e.childList.length;i>t;t++){var r=e.childList[t];if(!r.bSelected&&!r.data.isStatusNode&&!r.data.unselectable){n=!1;break}}n&&e._select(!0,!1,!1),e=e.parent}else for(this._setSubSel(!1),this.visit(function(e){e._setSubSel(!1),e._select(!1,!1,!1)}),e=this.parent;e;){e._select(!1,!1,!1);var o=!1;for(t=0,i=e.childList.length;i>t;t++)if(e.childList[t].bSelected||e.childList[t].hasSubSel){o=!0;break}e._setSubSel(o),e=e.parent}},_select:function(e,t,i){var n=this.tree.options;this.data.isStatusNode||this.bSelected!==e&&(t&&n.onQuerySelect&&n.onQuerySelect.call(this.tree,e,this)===!1||(1==n.selectMode&&e&&this.tree.visit(function(e){return e.bSelected?(e._select(!1,!1,!1),!1):void 0}),this.bSelected=e,e?(n.persist&&this.tree.persistence.addSelect(this.data.key),$(this.span).addClass(n.classNames.selected),i&&3===n.selectMode&&this._fixSelectionState(),t&&n.onSelect&&n.onSelect.call(this.tree,!0,this)):(n.persist&&this.tree.persistence.clearSelect(this.data.key),$(this.span).removeClass(n.classNames.selected),i&&3===n.selectMode&&this._fixSelectionState(),t&&n.onSelect&&n.onSelect.call(this.tree,!1,this))))},select:function(e){return this.data.unselectable?this.bSelected:this._select(e!==!1,!0,!0)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(){try{var e=this.tree.options;this.tree.logDebug("_loadContent: start - %o",this),this.setLazyNodeStatus(DTNodeStatus_Loading),!0===e.onLazyRead.call(this.tree,this)&&(this.setLazyNodeStatus(DTNodeStatus_Ok),this.tree.logDebug("_loadContent: succeeded - %o",this))}catch(t){this.tree.logWarning("_loadContent: failed - %o",t),this.setLazyNodeStatus(DTNodeStatus_Error,{tooltip:""+t})}},_expand:function(e,t){if(this.bExpanded===e)return this.tree.logDebug("dtnode._expand(%o) IGNORED - %o",e,this),void 0;this.tree.logDebug("dtnode._expand(%o) - %o",e,this);var i=this.tree.options;if(!e&&this.getLevel()<i.minExpandLevel)return this.tree.logDebug("dtnode._expand(%o) prevented collapse - %o",e,this),void 0;if(!i.onQueryExpand||i.onQueryExpand.call(this.tree,e,this)!==!1){this.bExpanded=e,i.persist&&(e?this.tree.persistence.addExpand(this.data.key):this.tree.persistence.clearExpand(this.data.key));var n=!(this.data.isLazy&&null===this.childList||this._isLoading||t);if(this.render(n),this.bExpanded&&this.parent&&i.autoCollapse)for(var r=this._parentList(!1,!0),o=0,a=r.length;a>o;o++)r[o].collapseSiblings();return i.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()&&this.tree.activeNode.deactivate(),e&&this.data.isLazy&&null===this.childList&&!this._isLoading?(this._loadContent(),void 0):(i.onExpand&&i.onExpand.call(this.tree,e,this),void 0)}},isExpanded:function(){return this.bExpanded},expand:function(e){e=e!==!1,(this.childList||this.data.isLazy||!e)&&(null!==this.parent||e)&&this._expand(e)
},scheduleAction:function(e,t){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.logDebug("clearTimeout(%o)",this.tree.timer));var i=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){i.tree.logDebug("setTimeout: trigger expand"),i.expand(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){i.tree.logDebug("setTimeout: trigger activate"),i.activate()},t);break;default:throw"Invalid mode "+e}this.tree.logDebug("setTimeout(%s, %s): %s",e,t,this.tree.timer)},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(null!==this.parent)for(var e=this.parent.childList,t=0,i=e.length;i>t;t++)e[t]!==this&&e[t].bExpanded&&e[t]._expand(!1)},_onClick:function(e){var t=this.getEventTargetType(e);if("expander"===t)this.toggleExpand(),this.focus();else if("checkbox"===t)this.toggleSelect(),this.focus();else{this._userActivate();var i=this.span.getElementsByTagName("a");if(!i[0])return!0;$.browser.msie&&parseInt($.browser.version,10)<9||i[0].focus()}e.preventDefault()},_onDblClick:function(){},_onKeydown:function(e){var t,i=!0;switch(e.which){case 107:case 187:this.bExpanded||this.toggleExpand();break;case 109:case 189:this.bExpanded&&this.toggleExpand();break;case 32:this._userActivate();break;case 8:this.parent&&this.parent.focus();break;case 37:this.bExpanded?(this.toggleExpand(),this.focus()):this.parent&&this.parent.parent&&this.parent.focus();break;case 39:this.bExpanded||!this.childList&&!this.data.isLazy?this.childList&&this.childList[0].focus():(this.toggleExpand(),this.focus());break;case 38:for(t=this.getPrevSibling();t&&t.bExpanded&&t.childList;)t=t.childList[t.childList.length-1];!t&&this.parent&&this.parent.parent&&(t=this.parent),t&&t.focus();break;case 40:if(this.bExpanded&&this.childList)t=this.childList[0];else for(var n=this._parentList(!1,!0),r=n.length-1;r>=0&&!(t=n[r].getNextSibling());r--);t&&t.focus();break;default:i=!1}i&&e.preventDefault()},_onKeypress:function(){},_onFocus:function(e){var t=this.tree.options;"blur"==e.type||"focusout"==e.type?(t.onBlur&&t.onBlur.call(this.tree,this),this.tree.tnFocused&&$(this.tree.tnFocused.span).removeClass(t.classNames.focused),this.tree.tnFocused=null,t.persist&&$.cookie(t.cookieId+"-focus","",t.cookie)):("focus"==e.type||"focusin"==e.type)&&(this.tree.tnFocused&&this.tree.tnFocused!==this&&(this.tree.logDebug("dtnode.onFocus: out of sync: curFocus: %o",this.tree.tnFocused),$(this.tree.tnFocused.span).removeClass(t.classNames.focused)),this.tree.tnFocused=this,t.onFocus&&t.onFocus.call(this.tree,this),$(this.tree.tnFocused.span).addClass(t.classNames.focused),t.persist&&$.cookie(t.cookieId+"-focus",this.data.key,t.cookie))},visit:function(e,t){var i=!0;if(t===!0&&(i=e(this),i===!1||"skip"==i))return i;if(this.childList)for(var n=0,r=this.childList.length;r>n&&(i=this.childList[n].visit(e,!0),i!==!1);n++);return i},visitParents:function(e,t){if(t&&e(this)===!1)return!1;for(var i=this.parent;i;){if(e(i)===!1)return!1;i=i.parent}return!0},remove:function(){if(this===this.tree.root)throw"Cannot remove system root";return this.parent.removeChild(this)},removeChild:function(e){var t=this.childList;if(1==t.length){if(e!==t[0])throw"removeChild: invalid child";return this.removeChildren()}e===this.tree.activeNode&&e.deactivate(),this.tree.options.persist&&(e.bSelected&&this.tree.persistence.clearSelect(e.data.key),e.bExpanded&&this.tree.persistence.clearExpand(e.data.key)),e.removeChildren(!0),this.ul.removeChild(e.li);for(var i=0,n=t.length;n>i;i++)if(t[i]===e){this.childList.splice(i,1);break}},removeChildren:function(e,t){this.tree.logDebug("%s.removeChildren(%o)",this,e);var i=this.tree,n=this.childList;if(n){for(var r=0,o=n.length;o>r;r++){var a=n[r];a!==i.activeNode||t||a.deactivate(),this.tree.options.persist&&!t&&(a.bSelected&&this.tree.persistence.clearSelect(a.data.key),a.bExpanded&&this.tree.persistence.clearExpand(a.data.key)),a.removeChildren(!0,t),this.ul&&$("li",$(this.ul)).remove()}this.childList=null}e||(this._isLoading=!1,this.render())},setTitle:function(e){this.fromDict({title:e})},reload:function(){throw"Use reloadChildren() instead"},reloadChildren:function(e){if(null===this.parent)throw"Use tree.reload() instead";if(!this.data.isLazy)throw"node.reloadChildren() requires lazy nodes.";if(e){var t=this,i="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;this.tree.$tree.bind(i,function(n,r,o){if(t.tree.$tree.unbind(i),t.tree.logDebug("loaded %o, %o, %o",n,r,o),r!==t)throw"got invalid load event";e.call(t.tree,r,o)})}this.removeChildren(),this._loadContent()},_loadKeyPath:function(e,t){var i=this.tree;if(i.logDebug("%s._loadKeyPath(%s)",this,e),""===e)throw"Key path must not be empty";var n=e.split(i.options.keyPathSeparator);if(""===n[0])throw"Key path must be relative (don't start with '/')";var r=n.shift();if(this.childList)for(var o=0,a=this.childList.length;a>o;o++){var s=this.childList[o];if(s.data.key===r){if(0===n.length)t.call(i,s,"ok");else if(!s.data.isLazy||null!==s.childList&&void 0!==s.childList)t.call(i,s,"loaded"),s._loadKeyPath(n.join(i.options.keyPathSeparator),t);else{i.logDebug("%s._loadKeyPath(%s) -> reloading %s...",this,e,s);var l=this;s.reloadChildren(function(r,o){o?(i.logDebug("%s._loadKeyPath(%s) -> reloaded %s.",r,e,r),t.call(i,s,"loaded"),r._loadKeyPath(n.join(i.options.keyPathSeparator),t)):(i.logWarning("%s._loadKeyPath(%s) -> reloadChildren() failed.",l,e),t.call(i,s,"error"))})}return}}t.call(i,void 0,"notfound",r,0===n.length),i.logWarning("Node not found: "+r)},resetLazy:function(){if(null===this.parent)throw"Use tree.reload() instead";if(!this.data.isLazy)throw"node.resetLazy() requires lazy nodes.";this.expand(!1),this.removeChildren()},_addChildNode:function(e,t){var i=this.tree,n=i.options,r=i.persistence;if(e.parent=this,null===this.childList?this.childList=[]:t||this.childList.length>0&&$(this.childList[this.childList.length-1].span).removeClass(n.classNames.lastsib),t){var o=$.inArray(t,this.childList);if(0>o)throw"<beforeNode> must be a child of <this>";this.childList.splice(o,0,e)}else this.childList.push(e);var a=i.isInitializing();if(n.persist&&r.cookiesFound&&a?(r.activeKey===e.data.key&&(i.activeNode=e),r.focusedKey===e.data.key&&(i.focusNode=e),e.bExpanded=$.inArray(e.data.key,r.expandedKeyList)>=0,e.bSelected=$.inArray(e.data.key,r.selectedKeyList)>=0):(e.data.activate&&(i.activeNode=e,n.persist&&(r.activeKey=e.data.key)),e.data.focus&&(i.focusNode=e,n.persist&&(r.focusedKey=e.data.key)),e.bExpanded=e.data.expand===!0,e.bExpanded&&n.persist&&r.addExpand(e.data.key),e.bSelected=e.data.select===!0,e.bSelected&&n.persist&&r.addSelect(e.data.key)),n.minExpandLevel>=e.getLevel()&&(this.bExpanded=!0),e.bSelected&&3==n.selectMode)for(var s=this;s;)s.hasSubSel||s._setSubSel(!0),s=s.parent;return i.bEnableUpdate&&this.render(),e},addChild:function(e,t){if("string"==typeof e)throw"Invalid data type for "+e;if(e&&0!==e.length){if(e instanceof DynaTreeNode)return this._addChildNode(e,t);e.length||(e=[e]);for(var i=this.tree.enableUpdate(!1),n=null,r=0,o=e.length;o>r;r++){var a=e[r],s=this._addChildNode(new DynaTreeNode(this,this.tree,a),t);n||(n=s),a.children&&s.addChild(a.children,null)}return this.tree.enableUpdate(i),n}},append:function(e){return this.tree.logWarning("node.append() is deprecated (use node.addChild() instead)."),this.addChild(e,null)},appendAjax:function(e){var t=this;if(this.removeChildren(!1,!0),this.setLazyNodeStatus(DTNodeStatus_Loading),e.debugLazyDelay){var i=e.debugLazyDelay;return e.debugLazyDelay=0,this.tree.logInfo("appendAjax: waiting for debugLazyDelay "+i),setTimeout(function(){t.appendAjax(e)},i),void 0}var n=e.success,r=e.error,o="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key,a=$.extend({},this.tree.options.ajaxDefaults,e,{success:function(e,i){var r=t.tree.phase;t.tree.phase="init",a.postProcess?e=a.postProcess.call(this,e,this.dataType):e&&e.hasOwnProperty("d")&&(e="string"==typeof e.d?$.parseJSON(e.d):e.d),$.isArray(e)&&0===e.length||t.addChild(e,null),t.tree.phase="postInit",n&&n.call(a,t,e,i),t.tree.logDebug("trigger "+o),t.tree.$tree.trigger(o,[t,!0]),t.tree.phase=r,t.setLazyNodeStatus(DTNodeStatus_Ok),$.isArray(e)&&0===e.length&&(t.childList=[],t.render())},error:function(e,i,n){t.tree.logWarning("appendAjax failed:",i,":\n",e,"\n",n),r&&r.call(a,t,e,i,n),t.tree.$tree.trigger(o,[t,!1]),t.setLazyNodeStatus(DTNodeStatus_Error,{info:i,tooltip:""+n})}});$.ajax(a)},move:function(e,t){var i;if(this!==e){if(!this.parent)throw"Cannot move system root";(void 0===t||"over"==t)&&(t="child");var n=this.parent,r="child"===t?e:e.parent;if(r.isDescendantOf(this))throw"Cannot move a node to it's own descendant";if(1==this.parent.childList.length)this.parent.childList=this.parent.data.isLazy?[]:null,this.parent.bExpanded=!1;else{if(i=$.inArray(this,this.parent.childList),0>i)throw"Internal error";this.parent.childList.splice(i,1)}if(this.parent.ul&&this.parent.ul.removeChild(this.li),this.parent=r,r.hasChildren())switch(t){case"child":r.childList.push(this);break;case"before":if(i=$.inArray(e,r.childList),0>i)throw"Internal error";r.childList.splice(i,0,this);break;case"after":if(i=$.inArray(e,r.childList),0>i)throw"Internal error";r.childList.splice(i+1,0,this);break;default:throw"Invalid mode "+t}else r.childList=[this];if(r.ul||(r.ul=document.createElement("ul"),r.ul.style.display="none",r.li.appendChild(r.ul)),this.li&&r.ul.appendChild(this.li),this.tree!==e.tree)throw this.visit(function(t){t.tree=e.tree},null,!0),"Not yet implemented.";n.isDescendantOf(r)||n.render(),r.isDescendantOf(n)||r.render()}},lastentry:void 0};var DynaTreeStatus=Class.create();DynaTreeStatus._getTreePersistData=function(e,t){var i=new DynaTreeStatus(e,t);return i.read(),i.toDict()},getDynaTreePersistData=DynaTreeStatus._getTreePersistData,DynaTreeStatus.prototype={initialize:function(e,t){void 0===e&&(e=$.ui.dynatree.prototype.options.cookieId),t=$.extend({},$.ui.dynatree.prototype.options.cookie,t),this.cookieId=e,this.cookieOpts=t,this.cookiesFound=void 0,this.activeKey=null,this.focusedKey=null,this.expandedKeyList=null,this.selectedKeyList=null},_log:function(){Array.prototype.unshift.apply(arguments,["debug"]),_log.apply(this,arguments)},read:function(){this.cookiesFound=!1;var e=$.cookie(this.cookieId+"-active");this.activeKey=null===e?"":e,null!==e&&(this.cookiesFound=!0),e=$.cookie(this.cookieId+"-focus"),this.focusedKey=null===e?"":e,null!==e&&(this.cookiesFound=!0),e=$.cookie(this.cookieId+"-expand"),this.expandedKeyList=null===e?[]:e.split(","),null!==e&&(this.cookiesFound=!0),e=$.cookie(this.cookieId+"-select"),this.selectedKeyList=null===e?[]:e.split(","),null!==e&&(this.cookiesFound=!0)},write:function(){$.cookie(this.cookieId+"-active",null===this.activeKey?"":this.activeKey,this.cookieOpts),$.cookie(this.cookieId+"-focus",null===this.focusedKey?"":this.focusedKey,this.cookieOpts),$.cookie(this.cookieId+"-expand",null===this.expandedKeyList?"":this.expandedKeyList.join(","),this.cookieOpts),$.cookie(this.cookieId+"-select",null===this.selectedKeyList?"":this.selectedKeyList.join(","),this.cookieOpts)},addExpand:function(e){$.inArray(e,this.expandedKeyList)<0&&(this.expandedKeyList.push(e),$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts))},clearExpand:function(e){var t=$.inArray(e,this.expandedKeyList);t>=0&&(this.expandedKeyList.splice(t,1),$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts))},addSelect:function(e){$.inArray(e,this.selectedKeyList)<0&&(this.selectedKeyList.push(e),$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts))},clearSelect:function(e){var t=$.inArray(e,this.selectedKeyList);t>=0&&(this.selectedKeyList.splice(t,1),$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts))},isReloading:function(){return this.cookiesFound===!0},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,selectedKeyList:this.selectedKeyList}},lastentry:void 0};var DynaTree=Class.create();DynaTree.version="$Version: 1.2.2$",DynaTree.prototype={initialize:function(e){this.phase="init",this.$widget=e,this.options=e.options,this.$tree=e.element,this.timer=null,this.divTree=this.$tree.get(0),_initDragAndDrop(this)},_load:function(e){var t=(this.$widget,this.options),i=this;this.bEnableUpdate=!0,this._nodeCount=1,this.activeNode=null,this.focusNode=null,void 0!==t.rootVisible&&this.logWarning("Option 'rootVisible' is no longer supported."),t.minExpandLevel<1&&(this.logWarning("Option 'minExpandLevel' must be >= 1."),t.minExpandLevel=1),t.classNames!==$.ui.dynatree.prototype.options.classNames&&(t.classNames=$.extend({},$.ui.dynatree.prototype.options.classNames,t.classNames)),t.ajaxDefaults!==$.ui.dynatree.prototype.options.ajaxDefaults&&(t.ajaxDefaults=$.extend({},$.ui.dynatree.prototype.options.ajaxDefaults,t.ajaxDefaults)),t.dnd!==$.ui.dynatree.prototype.options.dnd&&(t.dnd=$.extend({},$.ui.dynatree.prototype.options.dnd,t.dnd)),t.imagePath||$("script").each(function(){var e=/.*dynatree[^\/]*\.js$/i;return this.src.search(e)>=0?(t.imagePath=this.src.indexOf("/")>=0?this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/":"skin/",i.logDebug("Guessing imagePath from '%s': '%s'",this.src,t.imagePath),!1):void 0}),this.persistence=new DynaTreeStatus(t.cookieId,t.cookie),t.persist&&($.cookie||_log("warn","Please include jquery.cookie.js to use persistence."),this.persistence.read()),this.logDebug("DynaTree.persistence: %o",this.persistence.toDict()),this.cache={tagEmpty:"<span class='"+t.classNames.empty+"'></span>",tagVline:"<span class='"+t.classNames.vline+"'></span>",tagExpander:"<span class='"+t.classNames.expander+"'></span>",tagConnector:"<span class='"+t.classNames.connector+"'></span>",tagNodeIcon:"<span class='"+t.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+t.classNames.checkbox+"'></span>",lastentry:void 0},(t.children||t.initAjax&&t.initAjax.url||t.initId)&&$(this.divTree).empty();var n=this.$tree.find(">ul:first").hide();this.tnRoot=new DynaTreeNode(null,this,{}),this.tnRoot.bExpanded=!0,this.tnRoot.render(),this.divTree.appendChild(this.tnRoot.ul);var r=this.tnRoot,o=t.persist&&this.persistence.isReloading(),a=!1,s=this.enableUpdate(!1);this.logDebug("Dynatree._load(): read tree structure..."),t.children?r.addChild(t.children):t.initAjax&&t.initAjax.url?(a=!0,r.data.isLazy=!0,this._reloadAjax(e)):t.initId?this._createFromTag(r,$("#"+t.initId)):(this._createFromTag(r,n),n.remove()),this._checkConsistency(),a||3!=t.selectMode||r._updatePartSelectionState(),this.logDebug("Dynatree._load(): render nodes..."),this.enableUpdate(s),this.logDebug("Dynatree._load(): bind events..."),this.$widget.bind(),this.logDebug("Dynatree._load(): postInit..."),this.phase="postInit",t.persist&&this.persistence.write(),this.focusNode&&this.focusNode.isVisible()&&(this.logDebug("Focus on init: %o",this.focusNode),this.focusNode.focus()),a||(t.onPostInit&&t.onPostInit.call(this,o,!1),e&&e.call(this,"ok")),this.phase="idle"},_reloadAjax:function(e){var t=this.options;if(!t.initAjax||!t.initAjax.url)throw"tree.reload() requires 'initAjax' mode.";var i=this.persistence,n=$.extend({},t.initAjax);n.addActiveKey&&(n.data.activeKey=i.activeKey),n.addFocusedKey&&(n.data.focusedKey=i.focusedKey),n.addExpandedKeyList&&(n.data.expandedKeyList=i.expandedKeyList.join(",")),n.addSelectedKeyList&&(n.data.selectedKeyList=i.selectedKeyList.join(",")),n.success&&this.logWarning("initAjax: success callback is ignored; use onPostInit instead."),n.error&&this.logWarning("initAjax: error callback is ignored; use onPostInit instead.");var r=i.isReloading();n.success=function(i){3==t.selectMode&&i.tree.tnRoot._updatePartSelectionState(),t.onPostInit&&t.onPostInit.call(i.tree,r,!1),e&&e.call(i.tree,"ok")},n.error=function(i,n,o,a){t.onPostInit&&t.onPostInit.call(i.tree,r,!0,n,o,a),e&&e.call(i.tree,"error",n,o,a)},this.logDebug("Dynatree._init(): send Ajax request..."),this.tnRoot.appendAjax(n)},toString:function(){return"Dynatree '"+this.$tree.attr("id")+"'"},toDict:function(){return this.tnRoot.toDict(!0)},serializeArray:function(e){for(var t=this.getSelectedNodes(e),i=this.$tree.attr("name")||this.$tree.attr("id"),n=[],r=0,o=t.length;o>r;r++)n.push({name:i,value:t[r].data.key});return n},getPersistData:function(){return this.persistence.toDict()},logDebug:function(){this.options.debugLevel>=2&&(Array.prototype.unshift.apply(arguments,["debug"]),_log.apply(this,arguments))},logInfo:function(){this.options.debugLevel>=1&&(Array.prototype.unshift.apply(arguments,["info"]),_log.apply(this,arguments))},logWarning:function(){Array.prototype.unshift.apply(arguments,["warn"]),_log.apply(this,arguments)},isInitializing:function(){return"init"==this.phase||"postInit"==this.phase},isReloading:function(){return("init"==this.phase||"postInit"==this.phase)&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return"userEvent"==this.phase},redraw:function(){this.tnRoot.render(!1,!1)},renderInvisibleNodes:function(){this.tnRoot.render(!1,!0)},reload:function(e){this._load(e)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(e){var t=document.getElementById(this.options.idPrefix+e);if(t)return t.dtnode?t.dtnode:null;var i=null;return this.visit(function(t){return t.data.key==e?(i=t,!1):void 0},!0),i},getActiveNode:function(){return this.activeNode},reactivate:function(e){var t=this.activeNode;t&&(this.activeNode=null,t.activate(),e&&t.focus())},getSelectedNodes:function(e){var t=[];return this.tnRoot.visit(function(i){return i.bSelected&&(t.push(i),e===!0)?"skip":void 0}),t},activateKey:function(e){var t=null===e?null:this.getNodeByKey(e);return t?(t.focus(),t.activate(),t):(this.activeNode&&this.activeNode.deactivate(),this.activeNode=null,null)},loadKeyPath:function(e,t){var i=e.split(this.options.keyPathSeparator);return""===i[0]&&i.shift(),i[0]==this.tnRoot.data.key&&(this.logDebug("Removed leading root key."),i.shift()),e=i.join(this.options.keyPathSeparator),this.tnRoot._loadKeyPath(e,t)},selectKey:function(e,t){var i=this.getNodeByKey(e);return i?(i.select(t),i):null},enableUpdate:function(e){return this.bEnableUpdate==e?e:(this.bEnableUpdate=e,e&&this.redraw(),!e)},count:function(){return this.tnRoot.countChildren()},visit:function(e,t){return this.tnRoot.visit(e,t)},_createFromTag:function(parentTreeNode,$ulParent){var self=this;$ulParent.find(">li").each(function(){var $li=$(this),$liSpan=$li.find(">span:first"),$liA=$li.find(">a:first"),title,href=null,target=null,tooltip;if($liSpan.length)title=$liSpan.html();else if($liA.length)title=$liA.html(),href=$liA.attr("href"),target=$liA.attr("target"),tooltip=$liA.attr("title");else{title=$li.html();var iPos=title.search(/<ul/i);title=iPos>=0?$.trim(title.substring(0,iPos)):$.trim(title)}var data={title:title,tooltip:tooltip,isFolder:$li.hasClass("folder"),isLazy:$li.hasClass("lazy"),expand:$li.hasClass("expanded"),select:$li.hasClass("selected"),activate:$li.hasClass("active"),focus:$li.hasClass("focused"),noLink:$li.hasClass("noLink")};if(href&&(data.href=href,data.target=target),$li.attr("title")&&(data.tooltip=$li.attr("title")),$li.attr("id")&&(data.key=$li.attr("id")),$li.attr("data")){var dataAttr=$.trim($li.attr("data"));if(dataAttr){"{"!=dataAttr.charAt(0)&&(dataAttr="{"+dataAttr+"}");try{$.extend(data,eval("("+dataAttr+")"))}catch(e){throw"Error parsing node data: "+e+"\ndata:\n'"+dataAttr+"'"}}}var childNode=parentTreeNode.addChild(data),$ul=$li.find(">ul:first");$ul.length&&self._createFromTag(childNode,$ul)})},_checkConsistency:function(){},_setDndStatus:function(e,t,i,n,r){var o=e?$(e.span):null,a=$(t.span);if(this.$dndMarker||(this.$dndMarker=$("<div id='dynatree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo($(this.divTree).parent())),"after"===n||"before"===n||"over"===n){var s="0 0";switch(n){case"before":this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-over"),this.$dndMarker.addClass("dynatree-drop-before"),s="0 -8";break;case"after":this.$dndMarker.removeClass("dynatree-drop-before dynatree-drop-over"),this.$dndMarker.addClass("dynatree-drop-after"),s="0 8";break;default:this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-before"),this.$dndMarker.addClass("dynatree-drop-over"),a.addClass("dynatree-drop-target"),s="8 0"}this.$dndMarker.show().position({my:"left top",at:"left top",of:a,offset:s})}else a.removeClass("dynatree-drop-target"),this.$dndMarker.hide();"after"===n?a.addClass("dynatree-drop-after"):a.removeClass("dynatree-drop-after"),"before"===n?a.addClass("dynatree-drop-before"):a.removeClass("dynatree-drop-before"),r===!0?(o&&o.addClass("dynatree-drop-accept"),a.addClass("dynatree-drop-accept"),i.addClass("dynatree-drop-accept")):(o&&o.removeClass("dynatree-drop-accept"),a.removeClass("dynatree-drop-accept"),i.removeClass("dynatree-drop-accept")),r===!1?(o&&o.addClass("dynatree-drop-reject"),a.addClass("dynatree-drop-reject"),i.addClass("dynatree-drop-reject")):(o&&o.removeClass("dynatree-drop-reject"),a.removeClass("dynatree-drop-reject"),i.removeClass("dynatree-drop-reject"))},_onDragEvent:function(e,t,i,n,r,o){var a,s,l=(this.options,this.options.dnd),h=null,c=$(t.span);switch(e){case"helper":var d=$("<div class='dynatree-drag-helper'><span class='dynatree-drag-helper-img' /></div>").append($(n.target).closest("a").clone());$("ul.dynatree-container",t.tree.divTree).append(d),d.data("dtSourceNode",t),h=d;break;case"start":t.isStatusNode()?h=!1:l.onDragStart&&(h=l.onDragStart(t)),h===!1?(this.logDebug("tree.onDragStart() cancelled"),r.helper.trigger("mouseup"),r.helper.hide()):c.addClass("dynatree-drag-source");break;case"enter":h=l.onDragEnter?l.onDragEnter(t,i):null,h=h?{over:h===!0||"over"===h||$.inArray("over",h)>=0,before:h===!0||"before"===h||$.inArray("before",h)>=0,after:h===!0||"after"===h||$.inArray("after",h)>=0}:!1,r.helper.data("enterResponse",h);break;case"over":if(s=r.helper.data("enterResponse"),a=null,s===!1);else if("string"==typeof s)a=s;else{var u=c.offset(),p={x:n.pageX-u.left,y:n.pageY-u.top},f={x:p.x/c.width(),y:p.y/c.height()};s.after&&f.y>.75?a="after":!s.over&&s.after&&f.y>.5?a="after":s.before&&f.y<=.25?a="before":!s.over&&s.before&&f.y<=.5?a="before":s.over&&(a="over"),l.preventVoidMoves&&(t===i?a=null:"before"===a&&i&&t===i.getNextSibling()?a=null:"after"===a&&i&&t===i.getPrevSibling()?a=null:"over"===a&&i&&i.parent===t&&i.isLastSibling()&&(a=null)),r.helper.data("hitMode",a)}"over"===a&&l.autoExpandMS&&t.hasChildren()!==!1&&!t.bExpanded&&t.scheduleAction("expand",l.autoExpandMS),a&&l.onDragOver&&(h=l.onDragOver(t,i,a),("over"===h||"before"===h||"after"===h)&&(a=h)),this._setDndStatus(i,t,r.helper,a,h!==!1&&null!==a);break;case"drop":var m=r.helper.hasClass("dynatree-drop-reject");a=r.helper.data("hitMode"),a&&l.onDrop&&!m&&l.onDrop(t,i,a,r,o);break;case"leave":t.scheduleAction("cancel"),r.helper.data("enterResponse",null),r.helper.data("hitMode",null),this._setDndStatus(i,t,r.helper,"out",void 0),l.onDragLeave&&l.onDragLeave(t,i);break;case"stop":c.removeClass("dynatree-drag-source"),l.onDragStop&&l.onDragStop(t);break;default:throw"Unsupported drag event: "+e}return h},cancelDrag:function(){var e=$.ui.ddmanager.current;e&&e.cancel()},lastentry:void 0},$.widget("ui.dynatree",{_init:function(){return parseFloat($.ui.version)<1.8?(this.options.debugLevel>=0&&_log("warn","ui.dynatree._init() was called; you should upgrade to jquery.ui.core.js v1.8 or higher."),this._create()):(this.options.debugLevel>=2&&_log("debug","ui.dynatree._init() was called; no current default functionality."),void 0)},_create:function(){var e=this.options;e.debugLevel>=1&&logMsg("Dynatree._create(): version='%s', debugLevel=%o.",$.ui.dynatree.version,this.options.debugLevel),this.options.event+=".dynatree";this.element.get(0);this.tree=new DynaTree(this),this.tree._load(),this.tree.logDebug("Dynatree._init(): done.")},bind:function(){function e(e){e=$.event.fix(e||window.event);var t=$.ui.dynatree.getNode(e.target);return t?t._onFocus(e):!1}this.unbind();var t="click.dynatree dblclick.dynatree";this.options.keyboard&&(t+=" keypress.dynatree keydown.dynatree"),this.element.bind(t,function(e){var t=$.ui.dynatree.getNode(e.target);if(!t)return!0;var i=t.tree,n=i.options;i.logDebug("event(%s): dtnode: %s",e.type,t);var r=i.phase;i.phase="userEvent";try{switch(e.type){case"click":return n.onClick&&n.onClick.call(i,t,e)===!1?!1:t._onClick(e);case"dblclick":return n.onDblClick&&n.onDblClick.call(i,t,e)===!1?!1:t._onDblClick(e);case"keydown":return n.onKeydown&&n.onKeydown.call(i,t,e)===!1?!1:t._onKeydown(e);case"keypress":return n.onKeypress&&n.onKeypress.call(i,t,e)===!1?!1:t._onKeypress(e)}}catch(o){i.logWarning("bind(%o): dtnode: %o, error: %o",e,t,o)}finally{i.phase=r}});var i=this.tree.divTree;i.addEventListener?(i.addEventListener("focus",e,!0),i.addEventListener("blur",e,!0)):i.onfocusin=i.onfocusout=e},unbind:function(){this.element.unbind(".dynatree")},enable:function(){this.bind(),$.Widget.prototype.enable.apply(this,arguments)},disable:function(){this.unbind(),$.Widget.prototype.disable.apply(this,arguments)},getTree:function(){return this.tree},getRoot:function(){return this.tree.getRoot()},getActiveNode:function(){return this.tree.getActiveNode()},getSelectedNodes:function(){return this.tree.getSelectedNodes()},lastentry:void 0}),parseFloat($.ui.version)<1.8&&($.ui.dynatree.getter="getTree getRoot getActiveNode getSelectedNodes"),$.ui.dynatree.version="$Version: 1.2.2$",$.ui.dynatree.getNode=function(e){if(e instanceof DynaTreeNode)return e;for(void 0!==e.selector&&(e=e[0]);e;){if(e.dtnode)return e.dtnode;e=e.parentNode}return null},$.ui.dynatree.getPersistData=DynaTreeStatus._getTreePersistData,$.ui.dynatree.prototype.options={title:"Dynatree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:!0,keyboard:!0,persist:!1,autoCollapse:!1,clickFolderMode:3,activeVisible:!0,checkbox:!1,selectMode:2,fx:null,noLink:!1,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,autoExpandMS:1e3,preventVoidMoves:!0,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:!1,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},generateIds:!1,idPrefix:"dynatree-id-",keyPathSeparator:"/",cookieId:"dynatree",cookie:{expires:null},classNames:{container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",nodeIcon:"dynatree-icon",title:"dynatree-title",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",nodeLoading:"dynatree-loading",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},debugLevel:1,lastentry:void 0},parseFloat($.ui.version)<1.8&&($.ui.dynatree.defaults=$.ui.dynatree.prototype.options),$.ui.dynatree.nodedatadefaults={title:null,key:null,isFolder:!1,isLazy:!1,tooltip:null,href:null,icon:null,addClass:null,noLink:!1,activate:!1,focus:!1,expand:!1,select:!1,hideCheckbox:!1,unselectable:!1,children:null,lastentry:void 0};var didRegisterDnd=!1,_registerDnd=function(){didRegisterDnd||($.ui.plugin.add("draggable","connectToDynatree",{start:function(e,t){var i=$(this).data("draggable"),n=t.helper.data("dtSourceNode")||null;return n?(i.offset.click.top=-2,i.offset.click.left=16,n.tree._onDragEvent("start",n,null,e,t,i)):void 0},drag:function(e,t){var i=$(this).data("draggable"),n=t.helper.data("dtSourceNode")||null,r=t.helper.data("dtTargetNode")||null,o=$.ui.dynatree.getNode(e.target);if(e.target&&!o){var a=$(e.target).closest("div.dynatree-drag-helper,#dynatree-drop-marker").length>0;if(a)return}t.helper.data("dtTargetNode",o),r&&r!==o&&r.tree._onDragEvent("leave",r,n,e,t,i),o&&o.tree.options.dnd.onDrop&&(o===r?o.tree._onDragEvent("over",o,n,e,t,i):o.tree._onDragEvent("enter",o,n,e,t,i))},stop:function(e,t){var i=$(this).data("draggable"),n=t.helper.data("dtSourceNode")||null,r=t.helper.data("dtTargetNode")||null,o=(i._mouseDownEvent,e.type),a="mouseup"==o&&1==e.which;a||logMsg("Drag was cancelled"),r&&(a&&r.tree._onDragEvent("drop",r,n,e,t,i),r.tree._onDragEvent("leave",r,n,e,t,i)),n&&n.tree._onDragEvent("stop",n,null,e,t,i)}}),didRegisterDnd=!0)}}(jQuery),function(e){function t(t,i,n){var r=n.relative?t.position().top:t.offset().top,o=n.relative?t.position().left:t.offset().left,a=n.position[0];r-=i.outerHeight()-n.offset[0],o+=t.outerWidth()+n.offset[1],/iPad/i.test(navigator.userAgent)&&(r-=e(window).scrollTop());var s=i.outerHeight()+t.outerHeight();return"center"==a&&(r+=s/2),"bottom"==a&&(r+=s),a=n.position[1],t=i.outerWidth()+t.outerWidth(),"center"==a&&(o-=t/2),"left"==a&&(o-=t),{top:r,left:o}}function i(i,r){var o,a,s=this,l=i.add(s),h=0,c=0,d=i.attr("title"),u=i.attr("data-tooltip"),p=n[r.effect],f=i.is(":input"),m=f&&i.is(":checkbox, :radio, select, :button, :submit"),g=i.attr("type"),v=r.events[g]||r.events[f?m?"widget":"input":"def"];if(!p)throw'Nonexistent effect "'+r.effect+'"';if(v=v.split(/,\s*/),2!=v.length)throw"Tooltip: bad events configuration for "+g;i.bind(v[0],function(e){clearTimeout(h),r.predelay?c=setTimeout(function(){s.show(e)},r.predelay):s.show(e)}).bind(v[1],function(e){clearTimeout(c),r.delay?h=setTimeout(function(){s.hide(e)},r.delay):s.hide(e)}),d&&r.cancelDefault&&(i.removeAttr("title"),i.data("title",d)),e.extend(s,{show:function(n){if(!o&&(u?o=e(u):r.tip?o=e(r.tip).eq(0):d?o=e(r.layout).addClass(r.tipClass).appendTo(document.body).hide().append(d):(o=i.next(),o.length||(o=i.parent().next())),!o.length))throw"Cannot find tooltip for "+i;if(s.isShown())return s;o.stop(!0,!0);var f=t(i,o,r);return r.tip&&o.html(i.data("title")),n=n||e.Event(),n.type="onBeforeShow",l.trigger(n,[f]),n.isDefaultPrevented()?s:(f=t(i,o,r),o.css({position:"absolute",top:f.top,left:f.left}),a=!0,p[0].call(s,function(){n.type="onShow",a="full",l.trigger(n)}),f=r.events.tooltip.split(/,\s*/),o.data("__set")||(o.bind(f[0],function(){clearTimeout(h),clearTimeout(c)}),f[1]&&!i.is("input:not(:checkbox, :radio), textarea")&&o.bind(f[1],function(e){e.relatedTarget!=i[0]&&i.trigger(v[1].split(" ")[0])}),o.data("__set",!0)),s)},hide:function(t){return o&&s.isShown()?(t=t||e.Event(),t.type="onBeforeHide",l.trigger(t),t.isDefaultPrevented()?void 0:(a=!1,n[r.effect][1].call(s,function(){t.type="onHide",l.trigger(t)}),s)):s},isShown:function(e){return e?"full"==a:a},getConf:function(){return r},getTip:function(){return o},getTrigger:function(){return i}}),e.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(t,i){e.isFunction(r[i])&&e(s).bind(i,r[i]),s[i]=function(t){return t&&e(s).bind(i,t),s}})}e.tools=e.tools||{version:"1.2.5"},e.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(e,t,i){n[e]=[t,i]}};var n={toggle:[function(e){var t=this.getConf(),i=this.getTip();t=t.opacity,1>t&&i.css({opacity:t}),i.show(),e.call()},function(e){this.getTip().hide(),e.call()}],fade:[function(e){var t=this.getConf();this.getTip().fadeTo(t.fadeInSpeed,t.opacity,e)},function(e){this.getTip().fadeOut(this.getConf().fadeOutSpeed,e)}]};e.fn.tooltip=function(t){var n=this.data("tooltip");return n?n:(t=e.extend(!0,{},e.tools.tooltip.conf,t),"string"==typeof t.position&&(t.position=t.position.split(/,?\s/)),this.each(function(){n=new i(e(this),t),e(this).data("tooltip",n)}),t.api?n:this)}}(jQuery);var u=void 0,G=!0,J=null,K=!1,TPVIEWER=TPVIEWER||{Va:"3D SYSTEMS",VERSION:"0.5b"};if(ha.prototype.detectBrowserSupport=function(){var e={};e.canvas=!!window.CanvasRenderingContext2D;var t;try{t=!!window.WebGLRenderingContext}catch(i){t=K}e.webgl=t;var n;e:{var r=["webgl","experimental-webgl","moz-webgl","webkit-3d"];
for(t=0;4>t;t++)try{if(document.createElement("canvas").getContext(r[t])){n=G;break e}}catch(o){}n=K}return e.webglEnabled=n,e},TPVIEWER.ERROR_CODE={},TPVIEWER.VIEW_DIR={},TPVIEWER.MATERIAL={},TPVIEWER.MODEL_TYPE={},TPVIEWER.EVENT_TYPE={},TPVIEWER.SECTION_MODE={},TPVIEWER.SECTION_DIR={},window.TPVIEWER=TPVIEWER,window.TPVIEWER.ERROR_CODE=TPVIEWER.ERROR_CODE,window.TPVIEWER.VIEW_DIR=TPVIEWER.VIEW_DIR,window.TPVIEWER.MATERIAL=TPVIEWER.MATERIAL,window.TPVIEWER.MODEL_TYPE=TPVIEWER.MODEL_TYPE,window.TPVIEWER.SECTION_MODE=TPVIEWER.SECTION_MODE,window.TPVIEWER.SECTION_DIR=TPVIEWER.SECTION_DIR,window.TPVIEWER.player=ha,window.TPVIEWER.dispModel=la,window.TPVIEWER.scaler=ma,TPVIEWER.ERROR_CODE.SUCCESS=1,TPVIEWER.ERROR_CODE.INVALID_OBJECT_ID=2,TPVIEWER.ERROR_CODE.NO_DATA=3,TPVIEWER.ERROR_CODE.BROWSER_NOT_SUPPORTED=4,TPVIEWER.VIEW_DIR.ORTHO=0,TPVIEWER.VIEW_DIR.TOP=1,TPVIEWER.VIEW_DIR.BOTTOM=2,TPVIEWER.VIEW_DIR.LEFT=3,TPVIEWER.VIEW_DIR.RIGHT=4,TPVIEWER.VIEW_DIR.FRONT=5,TPVIEWER.VIEW_DIR.BACK=6,TPVIEWER.VIEW_DIR.CUSTOM=7,TPVIEWER.MATERIAL.CUSTOM=0,TPVIEWER.MATERIAL.PLASTIC=1,TPVIEWER.MATERIAL.CERAMICS=2,TPVIEWER.MATERIAL.BRONZE=3,TPVIEWER.MATERIAL.SILVER=4,TPVIEWER.MATERIAL.GOLD=5,TPVIEWER.MODEL_TYPE.CAD_PART=1,TPVIEWER.MODEL_TYPE.CAD_ASSEMBLY=2,TPVIEWER.MODEL_TYPE.MESH=3,TPVIEWER.MODEL_TYPE.POINTCLOUD=4,TPVIEWER.EVENT_TYPE.MOUSE_MOVE=1,TPVIEWER.EVENT_TYPE.LEFT_UP=2,TPVIEWER.EVENT_TYPE.LEFT_DOWN=3,TPVIEWER.EVENT_TYPE.RIGHT_UP=4,TPVIEWER.EVENT_TYPE.RIGHT_DOWN=5,TPVIEWER.EVENT_TYPE.MOUSE_WHEEL=6,TPVIEWER.SECTION_MODE.DISABLED=0,TPVIEWER.SECTION_MODE.ENABLED=1,TPVIEWER.SECTION_DIR.POS_X=0,TPVIEWER.SECTION_DIR.POS_Y=1,TPVIEWER.SECTION_DIR.POS_Z=2,TPVIEWER.SECTION_DIR.NEG_X=3,TPVIEWER.SECTION_DIR.NEG_Y=4,TPVIEWER.SECTION_DIR.NEG_Z=5,TPVIEWER.ka=function(){var e=K,t="";this.Qa=function(){e=G},this.Ya=function(){e=K},this.Xa=function(){},this.isDebug=function(){return e},this.timeStart=function(){t="loading",e&&console.time(t)},this.timeEnd=function(){e&&console.timeEnd(t)},this.print=function(t){e&&console.log("TP: "+t)},this.printInt=function(t,i){e&&console.log("TP: "+t+"%d",i)}},la.prototype.count=0,la.prototype.S=[],TPVIEWER.T=da(),TPVIEWER.T.prototype.getObjectInfo=function(e){var t=Aa(e);if(!t)return J;var i,n,r=0,o=Ba(e);if(o)for(i=0,n=o.length;n>i;i+=1)o[i]!==u&&(r+=o[i].geometry.faces.length);if(i={},n={},o={},i.name=t.name,i.area=t.massComputed?t.area*this.scale*this.scale:t.area,i.volume=t.massComputed?t.volume*this.scale*this.scale*this.scale:t.volume,n.x=t.min.x*this.scale+this.v.x,n.y=t.min.y*this.scale+this.v.y,n.z=t.min.z*this.scale+this.v.z,o.x=t.max.x*this.scale+this.v.x,o.y=t.max.y*this.scale+this.v.y,o.z=t.max.z*this.scale+this.v.z,i.min=n,i.max=o,i.numBreps=t.breps===u?0:t.breps.length,i.isContainer=t.isContainer,i.objectID=e,i.parentID=t.D!==u&&t.D?t.D.F:J,o=[],t.children!==u)for(e=0,n=t.children.length;n>e;++e)o.push(t.children[e].F);return i.childrenIDs=o,i.facetCount=r,i},Ca.prototype.createMaterial=function(e){var t,i,n,r,o=e.reflectivity===u?.5:e.reflectivity,a=K;return t=e.ambient,i=e.diffuse,n=e.shininess==u?10:100*e.shininess,e=e.specular==u?5592405:e.specular,r=i[3],1>r&&(a=G,.6>r&&(r=.6)),t=new THREE.MeshLambertMaterial({ambient:W(t),polygonOffset:G,polygonOffsetFactor:1,polygonOffsetUnits:1,color:W(i),opacity:r,specular:e,blending:THREE.NormalBlending,shininess:n,transparent:a,shading:THREE.SmoothShading,reflectivity:o}),Ea(t),this.Q&&(t.side=THREE.DoubleSide),t},!this.O){this.ArrayBuffer||Ia("ArrayBuffer not supported"),Object.defineProperties||Ia("This module requires ECMAScript 5");var Ja=1===new Int8Array(new Int32Array([1]).buffer)[0],Ka=new Uint8Array(8);this.O=function(e,t,i){e instanceof ArrayBuffer||Ia("Bad ArrayBuffer"),t=t||0,i=i||e.byteLength-t,(0>t||0>i||t+i>e.byteLength)&&Ia("Illegal offset and/or length"),Object.defineProperties(this,{buffer:{value:e,enumerable:K,writable:K,configurable:K},byteOffset:{value:t,enumerable:K,writable:K,configurable:K},byteLength:{value:i,enumerable:K,writable:K,configurable:K},P:{value:new Uint8Array(e,t,i),enumerable:K,writable:K,configurable:K}})},this.O.prototype={setInt8:function(e,t){Ha(this,Int8Array,1,e,t)},setInt32:function(e,t,i){Ha(this,Int32Array,4,e,t,i)},setFloat32:function(e,t,i){Ha(this,Float32Array,4,e,t,i)}}}var THREE={REVISION:"63"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},THREE.extend=function(e,t){if(Object.keys)for(var i=Object.keys(t),n=0,r=i.length;r>n;n++){var o=i[n];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else for(o in i={}.hasOwnProperty,t)i.call(t,o)&&(e[o]=t[o]);return e},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!self.requestAnimationFrame;++i)self.requestAnimationFrame=self[t[i]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[i]+"CancelAnimationFrame"]||self[t[i]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var i=Date.now(),n=Math.max(0,16-(i-e)),r=self.setTimeout(function(){t(i+n)},n);return e=i+n,r}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return void 0!==e&&this.set(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var n=function(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+6*(t-e)*(2/3-i):e},t=.5>=i?i*(1+t):i+t-i*t,i=2*i-t;this.r=n(i,t,e+1/3),this.g=n(i,t,e),this.b=n(i,t,e-1/3)}return this},setStyle:function(e){return/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)?(e=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e),this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this):/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)?(e=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e),this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this):/^\#([0-9a-f]{6})$/i.test(e)?(e=/^\#([0-9a-f]{6})$/i.exec(e),this.setHex(parseInt(e[1],16)),this):/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)?(e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e),this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this):/^(\w+)$/i.test(e)?(this.setHex(THREE.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),a=Math.min(i,n,r),s=(a+o)/2;if(a===o)a=t=0;else{var l=o-a,a=.5>=s?l/(o+a):l/(2-o-a);switch(o){case i:t=(n-r)/l+(r>n?6:0);break;case n:t=(r-i)/l+2;break;case r:t=(i-n)/l+4}t/=6}return e.h=t,e.s=a,e.l=s,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){if(!1==e instanceof THREE.Euler)throw Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var i=Math.cos(e._x/2),n=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"YXZ"===e.order?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"ZXY"===e.order?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"ZYX"===e.order?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"YZX"===e.order?(this._x=o*n*r+i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r-o*a*s):"XZY"===e.order&&(this._x=o*n*r-i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r+o*a*s),!1!==t&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._updateEuler(),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],e=t[4],n=t[8],r=t[1],o=t[5],a=t[9],s=t[2],l=t[6],t=t[10],h=i+o+t;return h>0?(i=.5/Math.sqrt(h+1),this._w=.25/i,this._x=(l-a)*i,this._y=(n-s)*i,this._z=(r-e)*i):i>o&&i>t?(i=2*Math.sqrt(1+i-o-t),this._w=(l-a)/i,this._x=.25*i,this._y=(e+r)/i,this._z=(n+s)/i):o>t?(i=2*Math.sqrt(1+o-i-t),this._w=(n-s)/i,this._x=(e+r)/i,this._y=.25*i,this._z=(a+l)/i):(i=2*Math.sqrt(1+t-i-o),this._w=(r-e)/i,this._x=(n+s)/i,this._y=(a+l)/i,this._z=.25*i),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,h=t._w;return this._x=i*h+o*a+n*l-r*s,this._y=n*h+o*s+r*a-i*l,this._z=r*h+o*l+i*s-n*a,this._w=o*h-i*a-n*s-r*l,this._updateEuler(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this._x,n=this._y,r=this._z,o=this._w,a=o*e._w+i*e._x+n*e._y+r*e._z;if(0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);return.001>Math.abs(l)?(this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this):(a=Math.sin((1-t)*s)/l,s=Math.sin(t*s)/l,this._w=o*a+this._w*s,this._x=i*a+this._x*s,this._y=n*a+this._y*s,this._z=r*a+this._z*s,this._updateEuler(),this)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(e,t,i,n){return i.copy(e).slerp(t,n)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e):this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[3]*i+e[6]*n,this.y=e[1]*t+e[4]*i+e[7]*n,this.z=e[2]*t+e[5]*i+e[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n+e[12],this.y=e[1]*t+e[5]*i+e[9]*n+e[13],this.z=e[2]*t+e[6]*i+e[10]*n+e[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements,r=1/(e[3]*t+e[7]*i+e[11]*n+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*n+e[12])*r,this.y=(e[1]*t+e[5]*i+e[9]*n+e[13])*r,this.z=(e[2]*t+e[6]*i+e[10]*n+e[14])*r,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,e=e.w,s=e*t+o*n-a*i,l=e*i+a*t-r*n,h=e*n+r*i-o*t,t=-r*t-o*i-a*n;return this.x=s*e+t*-r+l*-a-h*-o,this.y=l*e+t*-o+h*-r-s*-a,this.z=h*e+t*-a+s*-o-l*-r,this},transformDirection:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n,this.y=e[1]*t+e[5]*i+e[9]*n,this.z=e[2]*t+e[6]*i+e[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},angleTo:function(e){return e=this.dot(e)/(this.length()*e.length()),Math.acos(THREE.Math.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,e=this.z-e.z;return t*t+i*i+e*e},setEulerFromRotationMatrix:function(){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=e,this},getColumnFromMatrix:function(e,t){var i=4*e,n=t.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.extend(THREE.Vector3.prototype,{applyEuler:function(){var e=new THREE.Quaternion;return function(t){return!1==t instanceof THREE.Euler&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e=new THREE.Quaternion;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i)),this}}(),projectOnVector:function(){var e=new THREE.Vector3;return function(t){return e.copy(t).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t).multiplyScalar(2),this.subVectors(e,this)}}()}),THREE.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n+e[12]*r,this.y=e[1]*t+e[5]*i+e[9]*n+e[13]*r,this.z=e[2]*t+e[6]*i+e[10]*n+e[14]*r,this.w=e[3]*t+e[7]*i+e[11]*n+e[15]*r,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,e=e.elements,r=e[0];n=e[4];var o=e[8],a=e[1],s=e[5],l=e[9];i=e[2],t=e[6];var h=e[10];return.01>Math.abs(n-a)&&.01>Math.abs(o-i)&&.01>Math.abs(l-t)?.1>Math.abs(n+a)&&.1>Math.abs(o+i)&&.1>Math.abs(l+t)&&.1>Math.abs(r+s+h-3)?(this.set(1,0,0,0),this):(e=Math.PI,r=(r+1)/2,s=(s+1)/2,h=(h+1)/2,n=(n+a)/4,o=(o+i)/4,l=(l+t)/4,r>s&&r>h?.01>r?(t=0,n=i=.707106781):(t=Math.sqrt(r),i=n/t,n=o/t):s>h?.01>s?(t=.707106781,i=0,n=.707106781):(i=Math.sqrt(s),t=n/i,n=l/i):.01>h?(i=t=.707106781,n=0):(n=Math.sqrt(h),t=o/n,i=l/n),this.set(t,i,n,e),this):(e=Math.sqrt((t-l)*(t-l)+(o-i)*(o-i)+(a-n)*(a-n)),.001>Math.abs(e)&&(e=1),this.x=(t-l)/e,this.y=(o-i)/e,this.z=(a-n)/e,this.w=Math.acos((r+s+h-1)/2),this)},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.elements,r=n[0],o=n[4],a=n[8],s=n[1],l=n[5],h=n[9],c=n[2],d=n[6],n=n[10],t=t||this._order;return"XYZ"===t?(this._y=Math.asin(i(a)),.99999>Math.abs(a)?(this._x=Math.atan2(-h,n),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(h)),.99999>Math.abs(h)?(this._y=Math.atan2(a,n),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,r),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(d)),.99999>Math.abs(d)?(this._y=Math.atan2(-c,n),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r))):"ZYX"===t?(this._y=Math.asin(-i(c)),.99999>Math.abs(c)?(this._x=Math.atan2(d,n),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(i(s)),.99999>Math.abs(s)?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,n))):"XZY"===t?(this._z=Math.asin(-i(o)),.99999>Math.abs(o)?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,n),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this
},setFromQuaternion:function(e,t,i){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,o=e.y*e.y,a=e.z*e.z,s=e.w*e.w,t=t||this._order;return"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-r-o+a),this._y=Math.asin(n(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+r-o-a)):"YXZ"===t?(this._x=Math.asin(n(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-r-o+a),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-r+o-a)):"ZXY"===t?(this._x=Math.asin(n(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-r-o+a),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-r+o-a)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-r-o+a),this._y=Math.asin(n(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+r-o-a)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-r+o-a),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+r-o-a),this._z=Math.asin(n(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-r+o-a),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+r-o-a),this._z=Math.asin(n(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==i&&this._updateQuaternion(),this},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new THREE.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),r=t.dot(e)/r;return n&&(r=THREE.Math.clamp(r,0,1)),r}}(),closestPointToPoint:function(e,t,i){return e=this.closestPointToPointParameter(e,t),i=i||new THREE.Vector3,this.delta(i).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-1/0,-1/0)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e){return new THREE.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var t=1,i=e.length;i>t;t++)this.addPoint(e[t])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var n=t.geometry.vertices,r=0,o=n.length;o>r;r++)e.copy(n[r]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e){return new THREE.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){return t=t||new THREE.Sphere,t.center=this.center(),t.radius=.5*this.size(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,i,n,r,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,n||0,void 0!==r?r:1,o||0,a||0,s||0,void 0!==l?l:1)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,i,n,r,o,a,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=n,h[4]=r,h[7]=o,h[2]=a,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var i=0,n=t.length;n>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyMatrix3(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],e=e[8];return t*o*e-t*a*l-i*r*e+i*a*s+n*r*l-n*o*s},getInverse:function(e,t){var i=e.elements,n=this.elements;if(n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4],i=i[0]*n[0]+i[1]*n[3]+i[2]*n[6],0===i){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,i,n,r,o,a,s,l,h,c,d,u,p,f,m){var g=this.elements=new Float32Array(16);g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=i||0,g[12]=n||0,g[1]=r||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=h||0,g[10]=void 0!==c?c:1,g[14]=d||0,g[3]=u||0,g[7]=p||0,g[11]=f||0,g[15]=void 0!==m?m:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,n,r,o,a,s,l,h,c,d,u,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=d,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var i=this.elements,t=t.elements,n=1/e.set(t[0],t[1],t[2]).length(),r=1/e.set(t[4],t[5],t[6]).length(),o=1/e.set(t[8],t[9],t[10]).length();return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,this}}(),makeRotationFromEuler:function(e){!1==e instanceof THREE.Euler&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),i=Math.sin(i),a=Math.cos(n),n=Math.sin(n),s=Math.cos(r),r=Math.sin(r);if("XYZ"===e.order){var e=o*s,l=o*r,h=i*s,c=i*r;t[0]=a*s,t[4]=-a*r,t[8]=n,t[1]=l+h*n,t[5]=e-c*n,t[9]=-i*a,t[2]=c-e*n,t[6]=h+l*n,t[10]=o*a}else"YXZ"===e.order?(e=a*s,l=a*r,h=n*s,c=n*r,t[0]=e+c*i,t[4]=h*i-l,t[8]=o*n,t[1]=o*r,t[5]=o*s,t[9]=-i,t[2]=l*i-h,t[6]=c+e*i,t[10]=o*a):"ZXY"===e.order?(e=a*s,l=a*r,h=n*s,c=n*r,t[0]=e-c*i,t[4]=-o*r,t[8]=h+l*i,t[1]=l+h*i,t[5]=o*s,t[9]=c-e*i,t[2]=-o*n,t[6]=i,t[10]=o*a):"ZYX"===e.order?(e=o*s,l=o*r,h=i*s,c=i*r,t[0]=a*s,t[4]=h*n-l,t[8]=e*n+c,t[1]=a*r,t[5]=c*n+e,t[9]=l*n-h,t[2]=-n,t[6]=i*a,t[10]=o*a):"YZX"===e.order?(e=o*a,l=o*n,h=i*a,c=i*n,t[0]=a*s,t[4]=c-e*r,t[8]=h*r+l,t[1]=r,t[5]=o*s,t[9]=-i*s,t[2]=-n*s,t[6]=l*r+h,t[10]=e-c*r):"XZY"===e.order&&(e=o*a,l=o*n,h=i*a,c=i*n,t[0]=a*s,t[4]=-r,t[8]=n*s,t[1]=e*r+c,t[5]=o*s,t[9]=l*r-h,t[2]=h*r-l,t[6]=i*s,t[10]=c*r+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,a=i+i,s=n+n,l=r+r,e=i*a,h=i*s,i=i*l,c=n*s,n=n*l,r=r*l,a=o*a,s=o*s,o=o*l;return t[0]=1-(c+r),t[4]=h-o,t[8]=i+s,t[1]=h+o,t[5]=1-(e+r),t[9]=n-a,t[2]=i-s,t[6]=n+a,t[10]=1-(e+c),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r,o){var a=this.elements;return i.subVectors(n,r).normalize(),0===i.length()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.length()&&(i.x+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),a[0]=e.x,a[4]=t.x,a[8]=i.x,a[1]=e.y,a[5]=t.y,a[9]=i.y,a[2]=e.z,a[6]=t.z,a[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],h=i[1],c=i[5],d=i[9],u=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],E=i[7],y=i[11],i=i[15],x=n[0],T=n[4],b=n[8],_=n[12],R=n[1],w=n[5],S=n[9],H=n[13],M=n[2],C=n[6],D=n[10],A=n[14],I=n[3],P=n[7],L=n[11],n=n[15];return r[0]=o*x+a*R+s*M+l*I,r[4]=o*T+a*w+s*C+l*P,r[8]=o*b+a*S+s*D+l*L,r[12]=o*_+a*H+s*A+l*n,r[1]=h*x+c*R+d*M+u*I,r[5]=h*T+c*w+d*C+u*P,r[9]=h*b+c*S+d*D+u*L,r[13]=h*_+c*H+d*A+u*n,r[2]=p*x+f*R+m*M+g*I,r[6]=p*T+f*w+m*C+g*P,r[10]=p*b+f*S+m*D+g*L,r[14]=p*_+f*H+m*A+g*n,r[3]=v*x+E*R+y*M+i*I,r[7]=v*T+E*w+y*C+i*P,r[11]=v*b+E*S+y*D+i*L,r[15]=v*_+E*H+y*A+i*n,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var i=0,n=t.length;n>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyProjection(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],h=e[2],c=e[6],d=e[10],u=e[14];return e[3]*(+r*s*c-n*l*c-r*a*d+i*l*d+n*a*u-i*s*u)+e[7]*(+t*s*u-t*l*d+r*o*d-n*o*u+n*l*h-r*s*h)+e[11]*(+t*l*c-t*a*u-r*o*c+i*o*u+r*a*h-i*l*h)+e[15]*(-n*a*h-t*s*c+t*a*d+n*o*c-i*o*d+i*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[4],a=n[8],s=n[12],l=n[1],h=n[5],c=n[9],d=n[13],u=n[2],p=n[6],f=n[10],m=n[14],g=n[3],v=n[7],E=n[11],n=n[15];if(i[0]=c*m*v-d*f*v+d*p*E-h*m*E-c*p*n+h*f*n,i[4]=s*f*v-a*m*v-s*p*E+o*m*E+a*p*n-o*f*n,i[8]=a*d*v-s*c*v+s*h*E-o*d*E-a*h*n+o*c*n,i[12]=s*c*p-a*d*p-s*h*f+o*d*f+a*h*m-o*c*m,i[1]=d*f*g-c*m*g-d*u*E+l*m*E+c*u*n-l*f*n,i[5]=a*m*g-s*f*g+s*u*E-r*m*E-a*u*n+r*f*n,i[9]=s*c*g-a*d*g-s*l*E+r*d*E+a*l*n-r*c*n,i[13]=a*d*u-s*c*u+s*l*f-r*d*f-a*l*m+r*c*m,i[2]=h*m*g-d*p*g+d*u*v-l*m*v-h*u*n+l*p*n,i[6]=s*p*g-o*m*g-s*u*v+r*m*v+o*u*n-r*p*n,i[10]=o*d*g-s*h*g+s*l*v-r*d*v-o*l*n+r*h*n,i[14]=s*h*u-o*d*u-s*l*p+r*d*p+o*l*m-r*h*m,i[3]=c*p*g-h*f*g-c*u*v+l*f*v+h*u*E-l*p*E,i[7]=o*f*g-a*p*g+a*u*v-r*f*v-o*u*E+r*p*E,i[11]=a*h*g-o*c*g-a*l*v+r*c*v+o*l*E-r*h*E,i[15]=o*c*u-a*h*u+a*l*p-r*c*p-o*l*f+r*h*f,i=r*i[0]+l*i[4]+u*i[8]+g*i[12],0==i){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},translate:function(){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,n=e.y,e=e.z;return t[0]*=i,t[4]*=n,t[8]*=e,t[1]*=i,t[5]*=n,t[9]*=e,t[2]*=i,t[6]*=n,t[10]*=e,t[3]*=i,t[7]*=n,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,s=e.z,l=r*o,h=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,h*a+i,h*s-n*o,0,l*s-n*a,h*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new THREE.Vector3,t=new THREE.Matrix4;return function(i,n,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var i=1/a,o=1/s,h=1/l;return t.elements[0]*=i,t.elements[1]*=i,t.elements[2]*=i,t.elements[4]*=o,t.elements[5]*=o,t.elements[6]*=o,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,n.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makeFrustum:function(e,t,i,n,r,o){var a=this.elements;return a[0]=2*r/(t-e),a[4]=0,a[8]=(t+e)/(t-e),a[12]=0,a[1]=0,a[5]=2*r/(n-i),a[9]=(n+i)/(n-i),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+r)/(o-r),a[14]=-2*o*r/(o-r),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,i,n){var e=i*Math.tan(THREE.Math.degToRad(.5*e)),r=-e;return this.makeFrustum(r*t,e*t,r,e,i,n)},makeOrthographic:function(e,t,i,n,r,o){var a=this.elements,s=t-e,l=i-n,h=o-r;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-((t+e)/s),a[1]=0,a[5]=2/l,a[9]=0,a[13]=-((i+n)/l),a[2]=0,a[6]=0,a[10]=-2/h,a[14]=-((o+r)/h),a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new THREE.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new THREE.Vector3;i.subVectors(e,this.origin);var n=i.dot(this.direction);return 0>n?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return 0>i?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,i,n){var r,o,a=e.clone().add(t).multiplyScalar(.5),s=t.clone().sub(e).normalize(),l=.5*e.distanceTo(t),h=this.origin.clone().sub(a),e=-this.direction.dot(s),t=h.dot(this.direction),c=-h.dot(s),d=h.lengthSq(),u=Math.abs(1-e*e);return u>=0?(h=e*c-t,r=e*t-c,o=l*u,h>=0?r>=-o?o>=r?(l=1/u,h*=l,r*=l,e=h*(h+e*r+2*t)+r*(e*h+r+2*c)+d):(r=l,h=Math.max(0,-(e*r+t)),e=-h*h+r*(r+2*c)+d):(r=-l,h=Math.max(0,-(e*r+t)),e=-h*h+r*(r+2*c)+d):-o>=r?(h=Math.max(0,-(-e*l+t)),r=h>0?-l:Math.min(Math.max(-l,-c),l),e=-h*h+r*(r+2*c)+d):o>=r?(h=0,r=Math.min(Math.max(-l,-c),l),e=r*(r+2*c)+d):(h=Math.max(0,-(e*l+t)),r=h>0?l:Math.min(Math.max(-l,-c),l),e=-h*h+r*(r+2*c)+d)):(r=e>0?-l:l,h=Math.max(0,-(e*r+t)),e=-h*h+r*(r+2*c)+d),i&&i.copy(this.direction.clone().multiplyScalar(h).add(this.origin)),n&&n.copy(s.clone().multiplyScalar(r).add(a)),e},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0==t?0==e.distanceToPoint(this.origin)?0:null:(e=-(this.origin.dot(e.normal)+e.constant)/t,e>=0?e:null)},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var i,n,r,o,a;n=1/this.direction.x,o=1/this.direction.y,a=1/this.direction.z;var s=this.origin;return n>=0?(i=(e.min.x-s.x)*n,n*=e.max.x-s.x):(i=(e.max.x-s.x)*n,n*=e.min.x-s.x),o>=0?(r=(e.min.y-s.y)*o,o*=e.max.y-s.y):(r=(e.max.y-s.y)*o,o*=e.min.y-s.y),i>o||r>n?null:((r>i||i!==i)&&(i=r),(n>o||n!==n)&&(n=o),a>=0?(r=(e.min.z-s.z)*a,a*=e.max.z-s.z):(r=(e.max.z-s.z)*a,a*=e.min.z-s.z),i>a||r>n?null:((r>i||i!==i)&&(i=r),(n>a||n!==n)&&(n=a),0>n?null:this.at(i>=0?i:n,t)))},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3;return function(r,o,a,s,l){if(t.subVectors(o,r),i.subVectors(a,r),n.crossVectors(t,i),o=this.direction.dot(n),o>0){if(s)return null;s=1}else{if(!(0>o))return null;s=-1,o=-o}return e.subVectors(this.origin,r),r=s*this.direction.dot(i.crossVectors(e,i)),0>r?null:(a=s*this.direction.dot(t.cross(e)),0>a||r+a>o?null:(r=-s*e.dot(n),0>r?null:this.at(r/o,l)))}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,i){var n=this.center;void 0!==i?n.copy(i):e.setFromPoints(t).center(n);for(var r=0,o=0,a=t.length;a>o;o++)r=Math.max(r,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),n=t||new THREE.Vector3;return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){return e=e||new THREE.Box3,e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,i,n,r,o){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,e=i[0],n=i[1],r=i[2],o=i[3],a=i[4],s=i[5],l=i[6],h=i[7],c=i[8],d=i[9],u=i[10],p=i[11],f=i[12],m=i[13],g=i[14],i=i[15];return t[0].setComponents(o-e,h-a,p-c,i-f).normalize(),t[1].setComponents(o+e,h+a,p+c,i+f).normalize(),t[2].setComponents(o+n,h+s,p+d,i+m).normalize(),t[3].setComponents(o-n,h-s,p-d,i-m).normalize(),t[4].setComponents(o-r,h-l,p-u,i-g).normalize(),t[5].setComponents(o+r,h+l,p+u,i+g).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,e=-e.radius,n=0;6>n;n++)if(t[n].distanceToPoint(i)<e)return!1;return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){for(var n=this.planes,r=0;6>r;r++){var o=n[r];e.x=0<o.normal.x?i.min.x:i.max.x,t.x=0<o.normal.x?i.max.x:i.min.x,e.y=0<o.normal.y?i.min.y:i.max.y,t.y=0<o.normal.y?i.max.y:i.min.y,e.z=0<o.normal.z?i.min.z:i.max.z,t.z=0<o.normal.z?i.max.z:i.min.z;var a=o.distanceToPoint(e),o=o.distanceToPoint(t);if(0>a&&0>o)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(0>t[i].distanceToPoint(e))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n,r){return n=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize(),this.setFromNormalAndCoplanarPoint(n,i),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new THREE.Vector3).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return 0>t&&e>0||0>e&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,i){var n=i||new THREE.Vector3,r=t.delta(e),o=this.normal.dot(r);return 0!=o?(o=-(t.start.dot(this.normal)+this.constant)/o,0>o||o>1?void 0:n.copy(r).multiplyScalar(o).add(t.start)):0==this.distanceToPoint(t.start)?n.copy(t.start):void 0}}(),coplanarPoint:function(e){return(e||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n){var n=n||(new THREE.Matrix3).getNormalMatrix(i),r=e.copy(this.normal).applyMatrix3(n),o=this.coplanarPoint(t);return o.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(r,o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={PI2:2*Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=Array(36),n=0;return function(){for(var r=0;36>r;r++)8==r||13==r||18==r||23==r?i[r]="-":14==r?i[r]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,i[r]=t[19==r?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},smoothstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))
},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},THREE.Spline=function(e){function t(e,t,i,n,r,o,a){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*a+(-3*(t-i)-2*e-n)*o+e*r+t}this.points=e;var i,n,r,o,a,s,l,h,c,d=[],u={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,n=Math.floor(i),r=i-n,d[0]=0===n?n:n-1,d[1]=n,d[2]=n>this.points.length-2?this.points.length-1:n+1,d[3]=n>this.points.length-3?this.points.length-1:n+2,s=this.points[d[0]],l=this.points[d[1]],h=this.points[d[2]],c=this.points[d[3]],o=r*r,a=r*o,u.x=t(s.x,l.x,h.x,c.x,r,o,a),u.y=t(s.y,l.y,h.y,c.y,r,o,a),u.z=t(s.z,l.z,h.z,c.z,r,o,a),u},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;i>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,i,n,r=t=t=0,o=new THREE.Vector3,a=new THREE.Vector3,s=[],l=0;for(s[0]=0,e||(e=100),i=this.points.length*e,o.copy(this.points[0]),e=1;i>e;e++)t=e/i,n=this.getPoint(t),a.copy(n),l+=a.distanceTo(o),o.copy(n),t*=this.points.length-1,t=Math.floor(t),t!=r&&(s[t]=l,r=t);return s[s.length]=l,{chunks:s,total:l}},this.reparametrizeByArcLength=function(e){var t,i,n,r,o,a,s=[],l=new THREE.Vector3,h=this.getLength();for(s.push(l.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(i=h.chunks[t]-h.chunks[t-1],a=Math.ceil(e*i/h.total),r=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;a-1>i;i++)n=r+i*(1/a)*(o-r),n=this.getPoint(n),s.push(l.copy(n).clone());s.push(l.copy(this.points[t]).clone())}this.points=s}},THREE.Triangle=function(e,t,i){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==i?i:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,i,n,r){return r=r||new THREE.Vector3,r.subVectors(n,i),e.subVectors(t,i),r.cross(e),t=r.lengthSq(),t>0?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r,o,a,s){e.subVectors(a,r),t.subVectors(o,r),i.subVectors(n,r);var n=e.dot(e),r=e.dot(t),o=e.dot(i),l=t.dot(t),a=t.dot(i),h=n*l-r*r,s=s||new THREE.Vector3;return 0==h?s.set(-2,-1,-1):(h=1/h,l=(l*o-r*a)*h,n=(n*a-r*o)*h,s.set(1-l-n,n,l))}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,i,n,r){return t=THREE.Triangle.barycoordFromPoint(t,i,n,r,e),0<=t.x&&0<=t.y&&1>=t.x+t.y}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new THREE.Vector2(e,t)},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}},dispatchEvent:function(){var e=[];return function(t){if(void 0!==this._listeners){var i=this._listeners[t.type];if(void 0!==i){t.target=this;for(var n=i.length,r=0;n>r;r++)e[r]=i[r];for(r=0;n>r;r++)e[r].call(this,t)}}}}()},function(e){e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),this.near=n||0,this.far=r||1/0};var t=new e.Sphere,i=new e.Ray;new e.Plane,new e.Vector3;var n=new e.Vector3,r=new e.Matrix4,o=function(e,t){return e.distance-t.distance},a=new e.Vector3,s=new e.Vector3,l=new e.Vector3,h=function(o,c,d){if(o instanceof e.Sprite){n.getPositionFromMatrix(o.matrixWorld);var u=c.ray.distanceToPoint(n);if(u>o.scale.x)return d;d.push({distance:u,point:o.position,face:null,object:o})}else if(o instanceof e.LOD)n.getPositionFromMatrix(o.matrixWorld),u=c.ray.origin.distanceTo(n),h(o.getObjectForDistance(u),c,d);else if(o instanceof e.Mesh){var p=o.geometry;if(null===p.boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(o.matrixWorld),!1===c.ray.isIntersectionSphere(t))return d;if(r.getInverse(o.matrixWorld),i.copy(c.ray).applyMatrix4(r),null!==p.boundingBox&&!1===i.isIntersectionBox(p.boundingBox))return d;if(p instanceof e.BufferGeometry){var f=o.material;if(void 0===f||!1===p.dynamic)return d;var m,g,v=c.precision;if(void 0!==p.attributes.index)for(var E=p.offsets,y=p.attributes.index.array,x=p.attributes.position.array,T=p.offsets.length,b=p.attributes.index.array.length/3,b=0;T>b;++b)for(var u=E[b].start,_=E[b].index,p=u,R=u+E[b].count;R>p;p+=3)u=_+y[p],m=_+y[p+1],g=_+y[p+2],a.set(x[3*u],x[3*u+1],x[3*u+2]),s.set(x[3*m],x[3*m+1],x[3*m+2]),l.set(x[3*g],x[3*g+1],x[3*g+2]),m=f.side===e.BackSide?i.intersectTriangle(l,s,a,!0):i.intersectTriangle(a,s,l,f.side!==e.DoubleSide),null!==m&&(m.applyMatrix4(o.matrixWorld),u=c.ray.origin.distanceTo(m),v>u||u<c.near||u>c.far||d.push({distance:u,point:m,face:null,faceIndex:null,object:o}));else for(x=p.attributes.position.array,b=p.attributes.position.array.length,p=0;b>p;p+=3)u=p,m=p+1,g=p+2,a.set(x[3*u],x[3*u+1],x[3*u+2]),s.set(x[3*m],x[3*m+1],x[3*m+2]),l.set(x[3*g],x[3*g+1],x[3*g+2]),m=f.side===e.BackSide?i.intersectTriangle(l,s,a,!0):i.intersectTriangle(a,s,l,f.side!==e.DoubleSide),null!==m&&(m.applyMatrix4(o.matrixWorld),u=c.ray.origin.distanceTo(m),v>u||u<c.near||u>c.far||d.push({distance:u,point:m,face:null,faceIndex:null,object:o}))}else if(p instanceof e.Geometry)for(y=o.material instanceof e.MeshFaceMaterial,x=!0===y?o.material.materials:null,v=c.precision,E=p.vertices,T=0,b=p.faces.length;b>T;T++)_=p.faces[T],f=!0===y?x[_.materialIndex]:o.material,void 0!==f&&(u=E[_.a],m=E[_.b],g=E[_.c],m=f.side===e.BackSide?i.intersectTriangle(g,m,u,!0):i.intersectTriangle(u,m,g,f.side!==e.DoubleSide),null!==m&&(m.applyMatrix4(o.matrixWorld),u=c.ray.origin.distanceTo(m),v>u||u<c.near||u>c.far||d.push({distance:u,point:m,face:_,faceIndex:T,object:o})))}else if(o instanceof e.Line){if(v=c.linePrecision,f=v*v,p=o.geometry,null===p.boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(o.matrixWorld),!1===c.ray.isIntersectionSphere(t))return d;if(r.getInverse(o.matrixWorld),i.copy(c.ray).applyMatrix4(r),p instanceof e.Geometry)for(E=p.vertices,v=E.length,m=new e.Vector3,g=new e.Vector3,b=o.type===e.LineStrip?1:2,p=0;v-1>p;p+=b)i.distanceSqToSegment(E[p],E[p+1],g,m)>f||(u=i.origin.distanceTo(g),u<c.near||u>c.far||d.push({distance:u,point:m.clone().applyMatrix4(o.matrixWorld),face:null,faceIndex:null,object:o}))}},c=function(e,t,i){for(var e=e.getDescendants(),n=0,r=e.length;r>n;n++)h(e[n],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return!0===t&&c(e,this,i),h(e,this,i),i.sort(o),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],n=0,r=e.length;r>n;n++)h(e[n],this,i),!0===t&&c(e[n],this,i);return i.sort(o),i}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this._rotation=new THREE.Euler,this._quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.visible=this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(){var e=new THREE.Matrix4;return function(t){this.matrix.multiplyMatrices(t,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),e.extractRotation(this.matrix),this.quaternion.setFromRotationMatrix(e)}}(),setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,i){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){for(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1),t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;i>t;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.id===e||!0===t&&(r=r.getObjectById(e,t),void 0!==r))return r}},getObjectByName:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.name===e||!0===t&&(r=r.getObjectByName(e,t),void 0!==r))return r}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;i>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===e)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){if(void 0===e&&(e=new THREE.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var i=0;i<this.children.length;i++)e.add(this.children[i].clone());return e}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(a===v){var e=new THREE.RenderableVertex;return g.push(e),v++,a++,e}return g[a++]}function t(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function i(e,t){var i=0,n=1,r=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return r>=0&&o>=0&&a>=0&&s>=0?!0:0>r&&0>o||0>a&&0>s?!1:(0>r?i=Math.max(i,r/(r-o)):0>o&&(n=Math.min(n,r/(r-o))),0>a?i=Math.max(i,a/(a-s)):0>s&&(n=Math.min(n,a/(a-s))),i>n?!1:(e.lerp(t,i),t.lerp(e,1-n),!0))}var n,r,o,a,s,l,h,c,d,u,p,f=[],m=0,g=[],v=0,E=[],y=0,x=[],T=0,b=[],_=0,R={objects:[],sprites:[],lights:[],elements:[]},w=new THREE.Vector3,S=new THREE.Vector4,H=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),M=new THREE.Box3,C=Array(3),D=new THREE.Matrix4,A=new THREE.Matrix4,I=new THREE.Matrix4,P=new THREE.Matrix3,L=new THREE.Matrix3,k=new THREE.Vector3,O=new THREE.Frustum,N=new THREE.Vector4,z=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),A.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(A)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),A.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(A)},this.pickingRay=function(e,t){e.z=-1;var i=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new THREE.Raycaster(e,i)};var V=function(e){if(r===m){var t=new THREE.RenderableObject;f.push(t),m++,r++,n=t}else n=f[r++];return n.id=e.id,n.object=e,null!==e.renderDepth?n.z=e.renderDepth:(w.getPositionFromMatrix(e.matrixWorld),w.applyProjection(A),n.z=w.z),n},F=function(e){if(!1!==e.visible){e instanceof THREE.Light?R.lights.push(e):e instanceof THREE.Mesh||e instanceof THREE.Line?(!1===e.frustumCulled||!0===O.intersectsObject(e))&&R.objects.push(V(e)):e instanceof THREE.Sprite&&R.sprites.push(V(e));for(var t=0,i=e.children.length;i>t;t++)F(e.children[t])}};this.projectScene=function(n,f,m,v){var w,V,U,B,G,W,j,$,X,Y,K,q,Z=!1;for(u=c=l=0,R.elements.length=0,!0===n.autoUpdate&&n.updateMatrixWorld(),void 0===f.parent&&f.updateMatrixWorld(),D.copy(f.matrixWorldInverse.getInverse(f.matrixWorld)),A.multiplyMatrices(f.projectionMatrix,D),L.getNormalMatrix(D),O.setFromMatrix(A),r=0,R.objects.length=0,R.sprites.length=0,R.lights.length=0,F(n),!0===m&&R.objects.sort(t),n=0,m=R.objects.length;m>n;n++)if(j=R.objects[n].object,p=j.matrixWorld,a=0,j instanceof THREE.Mesh){for($=j.geometry,U=$.vertices,X=$.faces,$=$.faceVertexUvs,P.getNormalMatrix(p),K=j.material instanceof THREE.MeshFaceMaterial,q=!0===K?j.material:null,w=0,V=U.length;V>w;w++){o=e(),o.positionWorld.copy(U[w]).applyMatrix4(p),o.positionScreen.copy(o.positionWorld).applyMatrix4(A);var J=1/o.positionScreen.w;o.positionScreen.x*=J,o.positionScreen.y*=J,o.positionScreen.z*=J,o.visible=!(-1>o.positionScreen.x||1<o.positionScreen.x||-1>o.positionScreen.y||1<o.positionScreen.y||-1>o.positionScreen.z||1<o.positionScreen.z)}for(U=0,w=X.length;w>U;U++)if(V=X[U],J=!0===K?q.materials[V.materialIndex]:j.material,void 0!==J&&(W=J.side,B=g[V.a],G=g[V.b],Y=g[V.c],C[0]=B.positionScreen,C[1]=G.positionScreen,C[2]=Y.positionScreen,!0===B.visible||!0===G.visible||!0===Y.visible||H.isIntersectionBox(M.setFromPoints(C)))&&(Z=0>(Y.positionScreen.x-B.positionScreen.x)*(G.positionScreen.y-B.positionScreen.y)-(Y.positionScreen.y-B.positionScreen.y)*(G.positionScreen.x-B.positionScreen.x),W===THREE.DoubleSide||Z===(W===THREE.FrontSide))){if(l===y){var Q=new THREE.RenderableFace3;E.push(Q),y++,l++,s=Q}else s=E[l++];for(s.id=j.id,s.v1.copy(B),s.v2.copy(G),s.v3.copy(Y),s.normalModel.copy(V.normal),!1===Z&&(W===THREE.BackSide||W===THREE.DoubleSide)&&s.normalModel.negate(),s.normalModel.applyMatrix3(P).normalize(),s.normalModelView.copy(s.normalModel).applyMatrix3(L),s.centroidModel.copy(V.centroid).applyMatrix4(p),Y=V.vertexNormals,B=0,G=Math.min(Y.length,3);G>B;B++)Q=s.vertexNormalsModel[B],Q.copy(Y[B]),!1===Z&&(W===THREE.BackSide||W===THREE.DoubleSide)&&Q.negate(),Q.applyMatrix3(P).normalize(),s.vertexNormalsModelView[B].copy(Q).applyMatrix3(L);for(s.vertexNormalsLength=Y.length,Z=0,B=Math.min($.length,3);B>Z;Z++)if(Y=$[Z][U],void 0!==Y)for(G=0,W=Y.length;W>G;G++)s.uvs[Z][G]=Y[G];s.color=V.color,s.material=J,k.copy(s.centroidModel).applyProjection(A),s.z=k.z,R.elements.push(s)}}else if(j instanceof THREE.Line)for(I.multiplyMatrices(A,p),U=j.geometry.vertices,B=e(),B.positionScreen.copy(U[0]).applyMatrix4(I),X=j.type===THREE.LinePieces?2:1,w=1,V=U.length;V>w;w++)B=e(),B.positionScreen.copy(U[w]).applyMatrix4(I),(w+1)%X>0||(G=g[a-2],N.copy(B.positionScreen),z.copy(G.positionScreen),!0===i(N,z)&&(N.multiplyScalar(1/N.w),z.multiplyScalar(1/z.w),c===T?($=new THREE.RenderableLine,x.push($),T++,c++,h=$):h=x[c++],h.id=j.id,h.v1.positionScreen.copy(N),h.v2.positionScreen.copy(z),h.z=Math.max(N.z,z.z),h.material=j.material,j.material.vertexColors===THREE.VertexColors&&(h.vertexColors[0].copy(j.geometry.colors[w]),h.vertexColors[1].copy(j.geometry.colors[w-1])),R.elements.push(h)));for(n=0,m=R.sprites.length;m>n;n++)j=R.sprites[n].object,p=j.matrixWorld,j instanceof THREE.Sprite&&(S.set(p.elements[12],p.elements[13],p.elements[14],1),S.applyMatrix4(A),J=1/S.w,S.z*=J,-1<S.z&&1>S.z&&(u===_?(X=new THREE.RenderableSprite,b.push(X),_++,u++,d=X):d=b[u++],d.id=j.id,d.x=S.x*J,d.y=S.y*J,d.z=S.z,d.object=j,d.rotation=j.rotation,d.scale.x=j.scale.x*Math.abs(d.x-(S.x+f.projectionMatrix.elements[0])/(S.w+f.projectionMatrix.elements[12])),d.scale.y=j.scale.y*Math.abs(d.y-(S.y+f.projectionMatrix.elements[5])/(S.w+f.projectionMatrix.elements[13])),d.material=j.material,R.elements.push(d)));return!0===v&&R.elements.sort(t),R}},THREE.Face3=function(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,i,n,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,i,r,o,a)},THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),i=0,n=this.vertices.length;n>i;i++)this.vertices[i].applyMatrix4(e);for(i=0,n=this.faces.length;n>i;i++){var r=this.faces[i];r.normal.applyMatrix3(t).normalize();for(var o=0,a=r.vertexNormals.length;a>o;o++)r.vertexNormals[o].applyMatrix3(t).normalize();r.centroid.applyMatrix4(e)}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i.centroid.set(0,0,0),i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,i=0,n=this.faces.length;n>i;i++){var r=this.faces[i],o=this.vertices[r.a],a=this.vertices[r.b];e.subVectors(this.vertices[r.c],a),t.subVectors(o,a),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,i,n,r;if(void 0===this.__tmpVertices){for(r=this.__tmpVertices=Array(this.vertices.length),t=0,i=this.vertices.length;i>t;t++)r[t]=new THREE.Vector3;for(t=0,i=this.faces.length;i>t;t++)n=this.faces[t],n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else for(r=this.__tmpVertices,t=0,i=this.vertices.length;i>t;t++)r[t].set(0,0,0);if(e){var o,a,s=new THREE.Vector3,l=new THREE.Vector3;for(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,t=0,i=this.faces.length;i>t;t++)n=this.faces[t],e=this.vertices[n.a],o=this.vertices[n.b],a=this.vertices[n.c],s.subVectors(a,o),l.subVectors(e,o),s.cross(l),r[n.a].add(s),r[n.b].add(s),r[n.c].add(s)}else for(t=0,i=this.faces.length;i>t;t++)n=this.faces[t],r[n.a].add(n.normal),r[n.b].add(n.normal),r[n.c].add(n.normal);for(t=0,i=this.vertices.length;i>t;t++)r[t].normalize();for(t=0,i=this.faces.length;i>t;t++)n=this.faces[t],n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c])},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;n>i;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;t>e;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[],r=this.morphNormals[e].faceNormals;var a,s,l=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;n>i;i++)a=new THREE.Vector3,s={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},r.push(a),l.push(s)}for(l=this.morphNormals[e],o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,n=this.faces.length;n>i;i++)r=this.faces[i],a=l.faceNormals[i],s=l.vertexNormals[i],a.copy(r.normal),s.a.copy(r.vertexNormals[0]),s.b.copy(r.vertexNormals[1]),s.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){var e,t,i,n,r,o,a,s,l,h,c,d,u,p,f,m,g,v=[],E=[];i=new THREE.Vector3;var y=new THREE.Vector3,x=new THREE.Vector3,T=new THREE.Vector3,b=new THREE.Vector3;for(e=0,t=this.vertices.length;t>e;e++)v[e]=new THREE.Vector3,E[e]=new THREE.Vector3;for(e=0,t=this.faces.length;t>e;e++)r=this.faces[e],o=this.faceVertexUvs[0][e],n=r.a,g=r.b,r=r.c,a=this.vertices[n],s=this.vertices[g],l=this.vertices[r],h=o[0],c=o[1],d=o[2],o=s.x-a.x,u=l.x-a.x,p=s.y-a.y,f=l.y-a.y,s=s.z-a.z,a=l.z-a.z,l=c.x-h.x,m=d.x-h.x,c=c.y-h.y,h=d.y-h.y,d=1/(l*h-m*c),i.set((h*o-c*u)*d,(h*p-c*f)*d,(h*s-c*a)*d),y.set((l*u-m*o)*d,(l*f-m*p)*d,(l*a-m*s)*d),v[n].add(i),v[g].add(i),v[r].add(i),E[n].add(y),E[g].add(y),E[r].add(y);for(y=["a","b","c","d"],e=0,t=this.faces.length;t>e;e++)for(r=this.faces[e],i=0;i<Math.min(r.vertexNormals.length,3);i++)b.copy(r.vertexNormals[i]),n=r[y[i]],g=v[n],x.copy(g),x.sub(b.multiplyScalar(b.dot(g))).normalize(),T.crossVectors(r.vertexNormals[i],g),n=T.dot(E[n]),n=0>n?-1:1,r.vertexTangents[i]=new THREE.Vector4(x.x,x.y,x.z,n);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;n>i;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e,t,i,n={},r=[],o=[],a=Math.pow(10,4);for(this.__tmpVertices=void 0,t=0,i=this.vertices.length;i>t;t++)e=this.vertices[t],e=Math.round(e.x*a)+"_"+Math.round(e.y*a)+"_"+Math.round(e.z*a),void 0===n[e]?(n[e]=t,r.push(this.vertices[t]),o[t]=r.length-1):o[t]=o[n[e]];for(n=[],t=0,i=this.faces.length;i>t;t++)for(a=this.faces[t],a.a=o[a.a],a.b=o[a.b],a.c=o[a.c],a=[a.a,a.b,a.c],e=0;3>e;e++)if(a[e]==a[(e+1)%3]){n.push(t);break}for(t=n.length-1;t>=0;t--)for(a=n[t],this.faces.splice(a,1),o=0,i=this.faceVertexUvs.length;i>o;o++)this.faceVertexUvs[o].splice(a,1);return t=this.vertices.length-r.length,this.vertices=r,t},clone:function(){for(var e=new THREE.Geometry,t=this.vertices,i=0,n=t.length;n>i;i++)e.vertices.push(t[i].clone());for(t=this.faces,i=0,n=t.length;n>i;i++)e.faces.push(t[i].clone());for(t=this.faceVertexUvs[0],i=0,n=t.length;n>i;i++){for(var r=t[i],o=[],a=0,s=r.length;s>a;a++)o.push(new THREE.Vector2(r[a].x,r[a].y));e.faceVertexUvs[0].push(o)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t,i,n){this.attributes[e]={itemSize:n,array:new t(i*n)}},applyMatrix:function(e){var t,i;this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==i&&((new THREE.Matrix3).getNormalMatrix(e).multiplyVector3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t,i,n,r=this.boundingBox;3<=e.length&&(r.min.x=r.max.x=e[0],r.min.y=r.max.y=e[1],r.min.z=r.max.z=e[2]);for(var o=3,a=e.length;a>o;o+=3)t=e[o],i=e[o+1],n=e[o+2],t<r.min.x?r.min.x=t:t>r.max.x&&(r.max.x=t),i<r.min.y?r.min.y=i:i>r.max.y&&(r.max.y=i),n<r.min.z?r.min.z=n:n>r.max.z&&(r.max.z=n)}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var i=this.attributes.position.array;if(i){for(var n=this.boundingSphere.center,r=0,o=i.length;o>r;r+=3)t.set(i[r],i[r+1],i[r+2]),e.addPoint(t);e.center(n);for(var a=0,r=0,o=i.length;o>r;r+=3)t.set(i[r],i[r+1],i[r+2]),a=Math.max(a,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,t,i,n;if(e=this.attributes.position.array.length,void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(e)};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var r,o,a,s,l,h,c=this.attributes.position.array,d=this.attributes.normal.array,u=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3;if(this.attributes.index){var v=this.attributes.index.array,E=this.offsets;for(i=0,n=E.length;n>i;++i){t=E[i].start,r=E[i].count;var y=E[i].index;for(e=t,t+=r;t>e;e+=3)r=y+v[e],o=y+v[e+1],a=y+v[e+2],s=c[3*r],l=c[3*r+1],h=c[3*r+2],u.set(s,l,h),s=c[3*o],l=c[3*o+1],h=c[3*o+2],p.set(s,l,h),s=c[3*a],l=c[3*a+1],h=c[3*a+2],f.set(s,l,h),m.subVectors(f,p),g.subVectors(u,p),m.cross(g),d[3*r]+=m.x,d[3*r+1]+=m.y,d[3*r+2]+=m.z,d[3*o]+=m.x,d[3*o+1]+=m.y,d[3*o+2]+=m.z,d[3*a]+=m.x,d[3*a+1]+=m.y,d[3*a+2]+=m.z}}else for(e=0,t=c.length;t>e;e+=9)s=c[e],l=c[e+1],h=c[e+2],u.set(s,l,h),s=c[e+3],l=c[e+4],h=c[e+5],p.set(s,l,h),s=c[e+6],l=c[e+7],h=c[e+8],f.set(s,l,h),m.subVectors(f,p),g.subVectors(u,p),m.cross(g),d[e]=m.x,d[e+1]=m.y,d[e+2]=m.z,d[e+3]=m.x,d[e+4]=m.y,d[e+5]=m.z,d[e+6]=m.x,d[e+7]=m.y,d[e+8]=m.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,n=this.attributes.normal.array,r=0,o=n.length;o>r;r+=3)e=n[r],t=n[r+1],i=n[r+2],e=1/Math.sqrt(e*e+t*t+i*i),n[r]*=e,n[r+1]*=e,n[r+2]*=e},computeTangents:function(){function e(e){V.x=n[3*e],V.y=n[3*e+1],V.z=n[3*e+2],F.copy(V),k=s[e],N.copy(k),N.sub(V.multiplyScalar(V.dot(k))).normalize(),z.crossVectors(F,k),O=z.dot(l[e]),L=0>O?-1:1,a[4*e]=N.x,a[4*e+1]=N.y,a[4*e+2]=N.z,a[4*e+3]=L}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
else{var t=this.attributes.index.array,i=this.attributes.position.array,n=this.attributes.normal.array,r=this.attributes.uv.array,o=i.length/3;void 0===this.attributes.tangent&&(this.attributes.tangent={itemSize:4,array:new Float32Array(4*o)});for(var a=this.attributes.tangent.array,s=[],l=[],h=0;o>h;h++)s[h]=new THREE.Vector3,l[h]=new THREE.Vector3;var c,d,u,p,f,m,g,v,E,y,x,T,b,_,R,w,S,H,M,C,D,A,o=new THREE.Vector3,h=new THREE.Vector3,I=this.offsets;for(H=0,M=I.length;M>H;++H){S=I[H].start,C=I[H].count;var P=I[H].index;for(w=S,S+=C;S>w;w+=3)C=P+t[w],D=P+t[w+1],A=P+t[w+2],c=i[3*C],d=i[3*C+1],u=i[3*C+2],p=i[3*D],f=i[3*D+1],m=i[3*D+2],g=i[3*A],v=i[3*A+1],E=i[3*A+2],y=r[2*C],x=r[2*C+1],T=r[2*D],b=r[2*D+1],_=r[2*A],R=r[2*A+1],p-=c,c=g-c,f-=d,d=v-d,m-=u,u=E-u,T-=y,y=_-y,b-=x,x=R-x,R=1/(T*x-y*b),o.set((x*p-b*c)*R,(x*f-b*d)*R,(x*m-b*u)*R),h.set((T*c-y*p)*R,(T*d-y*f)*R,(T*u-y*m)*R),s[C].add(o),s[D].add(o),s[A].add(o),l[C].add(h),l[D].add(h),l[A].add(h)}var L,k,O,N=new THREE.Vector3,z=new THREE.Vector3,V=new THREE.Vector3,F=new THREE.Vector3;for(H=0,M=I.length;M>H;++H)for(S=I[H].start,C=I[H].count,P=I[H].index,w=S,S+=C;S>w;w+=3)C=P+t[w],D=P+t[w+1],A=P+t[w+2],e(C),e(D),e(A);this.tangentsNeedUpdate=this.hasTangents=!0}},clone:function(){var e,t=new THREE.BufferGeometry,i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(e in this.attributes){for(var n=this.attributes[e],r=n.array,o={itemSize:n.itemSize,numItems:n.numItems,array:null},n=0,a=i.length;a>n;n++){var s=i[n];if(r instanceof s){o.array=new s(r);break}}t.attributes[e]=o}for(n=0,a=this.offsets.length;a>n;n++)i=this.offsets[n],t.offsets.push({start:i.start,index:i.index,count:i.count});return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(e){return void 0===e&&(e=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e.projectionMatrixInverse.copy(this.projectionMatrixInverse),e},THREE.OrthographicCamera=function(e,t,i,n,r,o){THREE.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},THREE.PerspectiveCamera=function(e,t,i,n){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,n,r,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,i=-t,n=e*i,e=Math.abs(e*t-n),i=Math.abs(t-i);this.projectionMatrix.makeFrustum(n+this.x*e/this.fullWidth,n+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*i/this.fullHeight,t-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.HemisphereLight=function(e,t,i){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==i?i:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,i){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,i,n,r){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==r?r:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(1>e.length?".":e.join("/"))+"/"},initMaterials:function(e,t){for(var i=[],n=0;n<e.length;++n)i[n]=THREE.Loader.prototype.createMaterial(e[n],t);return i},needsTangents:function(e){for(var t=0,i=e.length;i>t;t++)if(e[t]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function i(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function n(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function r(e,r,o,s,l,h,c){var d=/\.dds$/i.test(o),u=t+"/"+o;if(d){var p=THREE.ImageUtils.loadCompressedTexture(u);e[r]=p}else p=document.createElement("canvas"),e[r]=new THREE.Texture(p);if(e[r].sourceFile=o,s&&(e[r].repeat.set(s[0],s[1]),1!==s[0]&&(e[r].wrapS=THREE.RepeatWrapping),1!==s[1]&&(e[r].wrapT=THREE.RepeatWrapping)),l&&e[r].offset.set(l[0],l[1]),h&&(o={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==o[h[0]]&&(e[r].wrapS=o[h[0]]),void 0!==o[h[1]]&&(e[r].wrapT=o[h[1]])),c&&(e[r].anisotropy=c),!d){var f=e[r],e=new Image;e.onload=function(){if(i(this.width)&&i(this.height))f.image=this;else{var e=n(this.width),t=n(this.height);f.image.width=e,f.image.height=t,f.image.getContext("2d").drawImage(this,0,0,e,t)}f.needsUpdate=!0},e.crossOrigin=a.crossOrigin,e.src=u}}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a=this,s="MeshLambertMaterial",l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var h=e.shading.toLowerCase();"phong"===h?s="MeshPhongMaterial":"basic"===h&&(s="MeshBasicMaterial")}return void 0!==e.blending&&void 0!==THREE[e.blending]&&(l.blending=THREE[e.blending]),(void 0!==e.transparent||1>e.opacity)&&(l.transparent=e.transparent),void 0!==e.depthTest&&(l.depthTest=e.depthTest),void 0!==e.depthWrite&&(l.depthWrite=e.depthWrite),void 0!==e.visible&&(l.visible=e.visible),void 0!==e.flipSided&&(l.side=THREE.BackSide),void 0!==e.doubleSided&&(l.side=THREE.DoubleSide),void 0!==e.wireframe&&(l.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?l.vertexColors=THREE.FaceColors:e.vertexColors&&(l.vertexColors=THREE.VertexColors)),e.colorDiffuse?l.color=o(e.colorDiffuse):e.DbgColor&&(l.color=e.DbgColor),e.colorSpecular&&(l.specular=o(e.colorSpecular)),e.colorAmbient&&(l.ambient=o(e.colorAmbient)),e.transparency&&(l.opacity=e.transparency),e.specularCoef&&(l.shininess=e.specularCoef),e.mapDiffuse&&t&&r(l,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&r(l,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&r(l,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&r(l,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&r(l,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(l.bumpScale=e.mapBumpScale),e.mapNormal?(s=THREE.ShaderLib.normalmap,h=THREE.UniformsUtils.clone(s.uniforms),h.tNormal.value=l.normalMap,e.mapNormalFactor&&h.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),l.map&&(h.tDiffuse.value=l.map,h.enableDiffuse.value=!0),l.specularMap&&(h.tSpecular.value=l.specularMap,h.enableSpecular.value=!0),l.lightMap&&(h.tAO.value=l.lightMap,h.enableAO.value=!0),h.uDiffuseColor.value.setHex(l.color),h.uSpecularColor.value.setHex(l.specular),h.uAmbientColor.value.setHex(l.ambient),h.uShininess.value=l.shininess,void 0!==l.opacity&&(h.uOpacity.value=l.opacity),s=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h,lights:!0,fog:!0}),l.transparent&&(s.transparent=!0)):s=new THREE[s](l),void 0!==e.DbgName&&(s.name=e.DbgName),s}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,i,n){var r=this,o=new XMLHttpRequest;void 0!==t&&o.addEventListener("load",function(i){t(i.target.responseText),r.manager.itemEnd(e)},!1),void 0!==i&&o.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&o.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.open("GET",e,!0),o.send(null),r.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,i,n){var r=this,o=document.createElement("img");return void 0!==t&&o.addEventListener("load",function(){r.manager.itemEnd(e),t(this)},!1),void 0!==i&&o.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&o.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.src=e,r.manager.itemStart(e),o},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,n,r){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText),s=e.parse(s,n);i(s.geometry,s.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?r&&(0===a&&(a=o.getResponseHeader("Content-Length")),r({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){var i,n,r,o,a,s,l,h,c,d,u,p,f,m,g=new THREE.Geometry,v=void 0!==e.scale?1/e.scale:1,E=e.faces;c=e.vertices;var y=e.normals,x=e.colors,T=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&T++;for(i=0;T>i;i++)g.faceVertexUvs[i]=[]}for(o=0,a=c.length;a>o;)s=new THREE.Vector3,s.x=c[o++]*v,s.y=c[o++]*v,s.z=c[o++]*v,g.vertices.push(s);for(o=0,a=E.length;a>o;)if(c=E[o++],d=1&c,r=2&c,i=8&c,l=16&c,u=32&c,s=64&c,c&=128,d){if(d=new THREE.Face3,d.a=E[o],d.b=E[o+1],d.c=E[o+3],p=new THREE.Face3,p.a=E[o+1],p.b=E[o+2],p.c=E[o+3],o+=4,r&&(r=E[o++],d.materialIndex=r,p.materialIndex=r),r=g.faces.length,i)for(i=0;T>i;i++)for(f=e.uvs[i],g.faceVertexUvs[i][r]=[],g.faceVertexUvs[i][r+1]=[],n=0;4>n;n++)h=E[o++],m=f[2*h],h=f[2*h+1],m=new THREE.Vector2(m,h),2!==n&&g.faceVertexUvs[i][r].push(m),0!==n&&g.faceVertexUvs[i][r+1].push(m);if(l&&(l=3*E[o++],d.normal.set(y[l++],y[l++],y[l]),p.normal.copy(d.normal)),u)for(i=0;4>i;i++)l=3*E[o++],u=new THREE.Vector3(y[l++],y[l++],y[l]),2!==i&&d.vertexNormals.push(u),0!==i&&p.vertexNormals.push(u);if(s&&(s=E[o++],s=x[s],d.color.setHex(s),p.color.setHex(s)),c)for(i=0;4>i;i++)s=E[o++],s=x[s],2!==i&&d.vertexColors.push(new THREE.Color(s)),0!==i&&p.vertexColors.push(new THREE.Color(s));g.faces.push(d),g.faces.push(p)}else{if(d=new THREE.Face3,d.a=E[o++],d.b=E[o++],d.c=E[o++],r&&(r=E[o++],d.materialIndex=r),r=g.faces.length,i)for(i=0;T>i;i++)for(f=e.uvs[i],g.faceVertexUvs[i][r]=[],n=0;3>n;n++)h=E[o++],m=f[2*h],h=f[2*h+1],m=new THREE.Vector2(m,h),g.faceVertexUvs[i][r].push(m);if(l&&(l=3*E[o++],d.normal.set(y[l++],y[l++],y[l])),u)for(i=0;3>i;i++)l=3*E[o++],u=new THREE.Vector3(y[l++],y[l++],y[l]),d.vertexNormals.push(u);if(s&&(s=E[o++],d.color.setHex(x[s])),c)for(i=0;3>i;i++)s=E[o++],d.vertexColors.push(new THREE.Color(x[s]));g.faces.push(d)}if(e.skinWeights)for(o=0,a=e.skinWeights.length;a>o;o+=2)E=e.skinWeights[o],y=e.skinWeights[o+1],g.skinWeights.push(new THREE.Vector4(E,y,0,0));if(e.skinIndices)for(o=0,a=e.skinIndices.length;a>o;o+=2)E=e.skinIndices[o],y=e.skinIndices[o+1],g.skinIndices.push(new THREE.Vector4(E,y,0,0));if(g.bones=e.bones,g.animation=e.animation,g.animations=e.animations,void 0!==e.morphTargets)for(o=0,a=e.morphTargets.length;a>o;o++)for(g.morphTargets[o]={},g.morphTargets[o].name=e.morphTargets[o].name,g.morphTargets[o].vertices=[],x=g.morphTargets[o].vertices,T=e.morphTargets[o].vertices,E=0,y=T.length;y>E;E+=3)c=new THREE.Vector3,c.x=T[E]*v,c.y=T[E+1]*v,c.z=T[E+2]*v,x.push(c);if(void 0!==e.morphColors)for(o=0,a=e.morphColors.length;a>o;o++)for(g.morphColors[o]={},g.morphColors[o].name=e.morphColors[o].name,g.morphColors[o].colors=[],y=g.morphColors[o].colors,x=e.morphColors[o].colors,v=0,E=x.length;E>v;v+=3)T=new THREE.Color(16755200),T.setRGB(x[v],x[v+1],x[v+2]),y.push(T);return g.computeCentroids(),g.computeFaceNormals(),g.computeBoundingSphere(),void 0===e.materials?{geometry:g}:(v=this.initMaterials(e.materials,t),this.needsTangents(v)&&g.computeTangents(),{geometry:g,materials:v})},THREE.LoadingManager=function(e,t,i){var n=this,r=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(){o++},this.itemEnd=function(e){r++,void 0!==n.onProgress&&n.onProgress(e,r,o),r===o&&void 0!==n.onLoad&&n.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t,i=new THREE.BufferGeometry,n=e.attributes,r=e.offsets,e=e.boundingSphere;for(t in n){var o=n[t];i.attributes[t]={itemSize:o.itemSize,array:new self[o.type](o.array)}}return void 0!==r&&(i.offsets=JSON.parse(JSON.stringify(r))),void 0!==e&&(i.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==e.center?e.center:[0,0,0]),e.radius)),i}},THREE.GeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(){}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var i=0,n=e.materials.length;n>i;i++)t.materials.push(this.parse(e.materials[i]));return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader(i.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),i=this.parseMaterials(e.materials);return this.parseObject(e.object,t,i)},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new THREE.JSONLoader,n=new THREE.BufferGeometryLoader,r=0,o=e.length;o>r;r++){var a,s=e[r];switch(s.type){case"PlaneGeometry":a=new THREE.PlaneGeometry(s.width,s.height,s.widthSegments,s.heightSegments);break;case"CircleGeometry":a=new THREE.CircleGeometry(s.radius,s.segments);break;case"CubeGeometry":a=new THREE.CubeGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CylinderGeometry":a=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=n.parse(s.data);break;case"Geometry":a=i.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var i=new THREE.MaterialLoader,n=0,r=e.length;r>n;n++){var o=e[n],a=i.parse(o);a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),t[o.uuid]=a}return t},parseObject:function(){var e=new THREE.Matrix4;return function(t,i,n){var r;switch(t.type){case"Scene":r=new THREE.Scene;break;case"PerspectiveCamera":r=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":r=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":r=new THREE.AmbientLight(t.color);break;case"DirectionalLight":r=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":r=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":r=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":r=i[t.geometry];var o=n[t.material];void 0===r&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===o&&console.error("THREE.ObjectLoader: Undefined material "+t.material),r=new THREE.Mesh(r,o);break;case"Sprite":o=n[t.material],void 0===o&&console.error("THREE.ObjectLoader: Undefined material "+t.material),r=new THREE.Sprite(o);break;default:r=new THREE.Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var a in t.children)r.add(this.parseObject(t.children[a],i,n));return r}}()},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader(i.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(n){i.parse(JSON.parse(n),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,i){function n(e,t){return"relativeToHTML"==t?e:R+"/"+e}function r(){o(T.scene,S.objects)}function o(e,t){var i,r,a,l,h,c;for(c in t){var f=T.objects[c],m=t[c];if(void 0===f){if(m.type&&m.type in _.hierarchyHandlers){if(void 0===m.loading){i={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var v,E={};for(v in m)v in i||(E[v]=m[v]);u=T.materials[m.material],m.loading=!0,i=_.hierarchyHandlers[m.type].loaderObject,i.options?i.load(n(m.url,S.urlBaseType),s(c,e,u,m)):i.load(n(m.url,S.urlBaseType),s(c,e,u,m),E)}}else if(void 0!==m.geometry){if(d=T.geometries[m.geometry]){if(f=!1,u=T.materials[m.material],f=u instanceof THREE.ShaderMaterial,r=m.position,a=m.rotation,l=m.scale,i=m.matrix,h=m.quaternion,m.material||(u=new THREE.MeshFaceMaterial(T.face_materials[m.geometry])),u instanceof THREE.MeshFaceMaterial&&0===u.materials.length&&(u=new THREE.MeshFaceMaterial(T.face_materials[m.geometry])),u instanceof THREE.MeshFaceMaterial)for(E=0;E<u.materials.length;E++)f=f||u.materials[E]instanceof THREE.ShaderMaterial;f&&d.computeTangents(),m.skin?f=new THREE.SkinnedMesh(d,u):m.morph?(f=new THREE.MorphAnimMesh(d,u),void 0!==m.duration&&(f.duration=m.duration),void 0!==m.time&&(f.time=m.time),void 0!==m.mirroredLoop&&(f.mirroredLoop=m.mirroredLoop),u.morphNormals&&d.computeMorphNormals()):f=new THREE.Mesh(d,u),f.name=c,i?(f.matrixAutoUpdate=!1,f.matrix.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])):(f.position.fromArray(r),h?f.quaternion.fromArray(h):f.rotation.fromArray(a),f.scale.fromArray(l)),f.visible=m.visible,f.castShadow=m.castShadow,f.receiveShadow=m.receiveShadow,e.add(f),T.objects[c]=f}}else if("AmbientLight"===m.type||"PointLight"===m.type||"DirectionalLight"===m.type||"SpotLight"===m.type||"HemisphereLight"===m.type||"AreaLight"===m.type){switch(E=m.color,i=m.intensity,r=m.distance,a=m.position,l=m.rotation,m.type){case"AmbientLight":g=new THREE.AmbientLight(E);break;case"PointLight":g=new THREE.PointLight(E,i,r),g.position.fromArray(a);break;case"DirectionalLight":g=new THREE.DirectionalLight(E,i),g.position.fromArray(m.direction);break;case"SpotLight":g=new THREE.SpotLight(E,i,r,1),g.angle=m.angle,g.position.fromArray(a),g.target.set(a[0],a[1]-r,a[2]),g.target.applyEuler(new THREE.Euler(l[0],l[1],l[2],"XYZ"));break;case"HemisphereLight":g=new THREE.DirectionalLight(E,i,r),g.target.set(a[0],a[1]-r,a[2]),g.target.applyEuler(new THREE.Euler(l[0],l[1],l[2],"XYZ"));break;case"AreaLight":g=new THREE.AreaLight(E,i),g.position.fromArray(a),g.width=m.size,g.height=m.size_y}e.add(g),g.name=c,T.lights[c]=g,T.objects[c]=g}else"PerspectiveCamera"===m.type||"OrthographicCamera"===m.type?(r=m.position,a=m.rotation,h=m.quaternion,"PerspectiveCamera"===m.type?p=new THREE.PerspectiveCamera(m.fov,m.aspect,m.near,m.far):"OrthographicCamera"===m.type&&(p=new THREE.OrthographicCamera(m.left,m.right,m.top,m.bottom,m.near,m.far)),p.name=c,p.position.fromArray(r),void 0!==h?p.quaternion.fromArray(h):void 0!==a&&p.rotation.fromArray(a),e.add(p),T.cameras[c]=p,T.objects[c]=p):(r=m.position,a=m.rotation,l=m.scale,h=m.quaternion,f=new THREE.Object3D,f.name=c,f.position.fromArray(r),h?f.quaternion.fromArray(h):f.rotation.fromArray(a),f.scale.fromArray(l),f.visible=void 0!==m.visible?m.visible:!1,e.add(f),T.objects[c]=f,T.empties[c]=f);if(f){if(void 0!==m.userData)for(var y in m.userData)f.userData[y]=m.userData[y];if(void 0!==m.groups)for(E=0;E<m.groups.length;E++)i=m.groups[E],void 0===T.groups[i]&&(T.groups[i]=[]),T.groups[i].push(c)}}void 0!==f&&void 0!==m.children&&o(f,m.children)}}function a(e){return function(t,i){t.name=e,T.geometries[e]=t,T.face_materials[e]=i,r(),v-=1,_.onLoadComplete(),h()}}function s(e,t,i,n){return function(o){var o=o.content?o.content:o.dae?o.scene:o,a=n.rotation,s=n.quaternion,l=n.scale;o.position.fromArray(n.position),s?o.quaternion.fromArray(s):o.rotation.fromArray(a),o.scale.fromArray(l),i&&o.traverse(function(e){e.material=i});var c=void 0!==n.visible?n.visible:!0;o.traverse(function(e){e.visible=c}),t.add(o),o.name=e,T.objects[e]=o,r(),v-=1,_.onLoadComplete(),h()}}function l(e){return function(t,i){t.name=e,T.geometries[e]=t,T.face_materials[e]=i}}function h(){if(_.callbackProgress({totalModels:y,totalTextures:x,loadedModels:y-v,loadedTextures:x-E},T),_.onLoadProgress(),0===v&&0===E){for(var e=0;e<w.length;e++){var i=w[e],n=T.objects[i.targetName];n?i.object.target=n:(i.object.target=new THREE.Object3D,T.scene.add(i.object.target)),i.object.target.userData.targetInverse=i.object}t(T)}}function c(e,t){if(t(e),void 0!==e.children)for(var i in e.children)c(e.children[i],t)}var d,u,p,f,m,g,v,E,y,x,T,b,_=this,R=THREE.Loader.prototype.extractUrlBase(i),w=[],S=e;for(b in this.geometryHandlers)e=this.geometryHandlers[b].loaderClass,this.geometryHandlers[b].loaderObject=new e;for(b in this.hierarchyHandlers)e=this.hierarchyHandlers[b].loaderClass,this.hierarchyHandlers[b].loaderObject=new e;E=v=0,T={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},S.transform&&(b=S.transform.position,e=S.transform.rotation,i=S.transform.scale,b&&T.scene.position.fromArray(b),e&&T.scene.rotation.fromArray(e),i&&T.scene.scale.fromArray(i),b||e||i)&&(T.scene.updateMatrix(),T.scene.updateMatrixWorld()),b=function(e){return function(){E-=e,h(),_.onLoadComplete()}};for(var H in S.fogs)e=S.fogs[H],"linear"===e.type?f=new THREE.Fog(0,e.near,e.far):"exp2"===e.type&&(f=new THREE.FogExp2(0,e.density)),e=e.color,f.color.setRGB(e[0],e[1],e[2]),T.fogs[H]=f;for(var M in S.geometries)f=S.geometries[M],f.type in this.geometryHandlers&&(v+=1,_.onLoadStart());for(var C in S.objects)c(S.objects[C],function(e){e.type&&e.type in _.hierarchyHandlers&&(v+=1,_.onLoadStart())});y=v;for(M in S.geometries)if(f=S.geometries[M],"cube"===f.type)d=new THREE.CubeGeometry(f.width,f.height,f.depth,f.widthSegments,f.heightSegments,f.depthSegments),d.name=M,T.geometries[M]=d;else if("plane"===f.type)d=new THREE.PlaneGeometry(f.width,f.height,f.widthSegments,f.heightSegments),d.name=M,T.geometries[M]=d;else if("sphere"===f.type)d=new THREE.SphereGeometry(f.radius,f.widthSegments,f.heightSegments),d.name=M,T.geometries[M]=d;else if("cylinder"===f.type)d=new THREE.CylinderGeometry(f.topRad,f.botRad,f.height,f.radSegs,f.heightSegs),d.name=M,T.geometries[M]=d;else if("torus"===f.type)d=new THREE.TorusGeometry(f.radius,f.tube,f.segmentsR,f.segmentsT),d.name=M,T.geometries[M]=d;else if("icosahedron"===f.type)d=new THREE.IcosahedronGeometry(f.radius,f.subdivisions),d.name=M,T.geometries[M]=d;else if(f.type in this.geometryHandlers){C={};for(m in f)"type"!==m&&"url"!==m&&(C[m]=f[m]);this.geometryHandlers[f.type].loaderObject.load(n(f.url,S.urlBaseType),a(M),C)}else"embedded"===f.type&&(C=S.embeds[f.id],C.metadata=S.metadata,C&&(C=this.geometryHandlers.ascii.loaderObject.parse(C,""),l(M)(C.geometry,C.materials)));for(var D in S.textures)if(M=S.textures[D],M.url instanceof Array)for(E+=M.url.length,m=0;m<M.url.length;m++)_.onLoadStart();else E+=1,_.onLoadStart();x=E;for(D in S.textures){if(M=S.textures[D],void 0!==M.mapping&&void 0!==THREE[M.mapping]&&(M.mapping=new THREE[M.mapping]),M.url instanceof Array){for(C=M.url.length,f=[],m=0;C>m;m++)f[m]=n(M.url[m],S.urlBaseType);m=(m=/\.dds$/i.test(f[0]))?THREE.ImageUtils.loadCompressedTextureCube(f,M.mapping,b(C)):THREE.ImageUtils.loadTextureCube(f,M.mapping,b(C))}else m=/\.dds$/i.test(M.url),C=n(M.url,S.urlBaseType),f=b(1),m=m?THREE.ImageUtils.loadCompressedTexture(C,M.mapping,f):THREE.ImageUtils.loadTexture(C,M.mapping,f),void 0!==THREE[M.minFilter]&&(m.minFilter=THREE[M.minFilter]),void 0!==THREE[M.magFilter]&&(m.magFilter=THREE[M.magFilter]),M.anisotropy&&(m.anisotropy=M.anisotropy),M.repeat&&(m.repeat.set(M.repeat[0],M.repeat[1]),1!==M.repeat[0]&&(m.wrapS=THREE.RepeatWrapping),1!==M.repeat[1]&&(m.wrapT=THREE.RepeatWrapping)),M.offset&&m.offset.set(M.offset[0],M.offset[1]),M.wrap&&(C={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==C[M.wrap[0]]&&(m.wrapS=C[M.wrap[0]]),void 0!==C[M.wrap[1]]&&(m.wrapT=C[M.wrap[1]]));
T.textures[D]=m}var A,I;for(A in S.materials){D=S.materials[A];for(I in D.parameters)"envMap"===I||"map"===I||"lightMap"===I||"bumpMap"===I?D.parameters[I]=T.textures[D.parameters[I]]:"shading"===I?D.parameters[I]="flat"===D.parameters[I]?THREE.FlatShading:THREE.SmoothShading:"side"===I?D.parameters[I]="double"==D.parameters[I]?THREE.DoubleSide:"back"==D.parameters[I]?THREE.BackSide:THREE.FrontSide:"blending"===I?D.parameters[I]=D.parameters[I]in THREE?THREE[D.parameters[I]]:THREE.NormalBlending:"combine"===I?D.parameters[I]=D.parameters[I]in THREE?THREE[D.parameters[I]]:THREE.MultiplyOperation:"vertexColors"===I?"face"==D.parameters[I]?D.parameters[I]=THREE.FaceColors:D.parameters[I]&&(D.parameters[I]=THREE.VertexColors):"wrapRGB"===I&&(b=D.parameters[I],D.parameters[I]=new THREE.Vector3(b[0],b[1],b[2]));void 0!==D.parameters.opacity&&1>D.parameters.opacity&&(D.parameters.transparent=!0),D.parameters.normalMap?(b=THREE.ShaderLib.normalmap,M=THREE.UniformsUtils.clone(b.uniforms),m=D.parameters.color,C=D.parameters.specular,f=D.parameters.ambient,H=D.parameters.shininess,M.tNormal.value=T.textures[D.parameters.normalMap],D.parameters.normalScale&&M.uNormalScale.value.set(D.parameters.normalScale[0],D.parameters.normalScale[1]),D.parameters.map&&(M.tDiffuse.value=D.parameters.map,M.enableDiffuse.value=!0),D.parameters.envMap&&(M.tCube.value=D.parameters.envMap,M.enableReflection.value=!0,M.uReflectivity.value=D.parameters.reflectivity),D.parameters.lightMap&&(M.tAO.value=D.parameters.lightMap,M.enableAO.value=!0),D.parameters.specularMap&&(M.tSpecular.value=T.textures[D.parameters.specularMap],M.enableSpecular.value=!0),D.parameters.displacementMap&&(M.tDisplacement.value=T.textures[D.parameters.displacementMap],M.enableDisplacement.value=!0,M.uDisplacementBias.value=D.parameters.displacementBias,M.uDisplacementScale.value=D.parameters.displacementScale),M.uDiffuseColor.value.setHex(m),M.uSpecularColor.value.setHex(C),M.uAmbientColor.value.setHex(f),M.uShininess.value=H,D.parameters.opacity&&(M.uOpacity.value=D.parameters.opacity),u=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:M,lights:!0,fog:!0})):u=new THREE[D.type](D.parameters),u.name=A,T.materials[A]=u}for(A in S.materials)if(D=S.materials[A],D.parameters.materials){for(I=[],m=0;m<D.parameters.materials.length;m++)I.push(T.materials[D.parameters.materials[m]]);T.materials[A].materials=I}r(),T.cameras&&S.defaults.camera&&(T.currentCamera=T.cameras[S.defaults.camera]),T.fogs&&S.defaults.fog&&(T.scene.fog=T.fogs[S.defaults.fog]),_.callbackSync(T),h()}},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t){var i=new THREE.ImageLoader(this.manager);i.setCrossOrigin(this.crossOrigin),i.load(e,function(e){e=new THREE.Texture(e),e.needsUpdate=!0,void 0!==t&&t(e)})},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.needsUpdate=this.visible=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0===i)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if(t in this){var n=this[t];n instanceof THREE.Color?n.set(i):n instanceof THREE.Vector3&&i instanceof THREE.Vector3?n.copy(i):this[t]="overdraw"==t?Number(i):i}}},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){for(var e=new THREE.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},THREE.ParticleSystemMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleSystemMaterial.prototype.clone=function(){var e=new THREE.ParticleSystemMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial,THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.sizeAttenuation=this.depthTest=!0,this.rotation=0,this.fog=!1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1),this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial,THREE.Texture=function(e,t,i,n,r,o,a,s,l){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,i,n,r,o,a,s,l,h,c){THREE.Texture.call(this,null,o,a,s,l,h,n,r,c),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,i,n,r,o,a,s,l,h,c){THREE.Texture.call(this,null,o,a,s,l,h,n,r,c),this.image={data:e,width:t,height:i}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.ParticleSystemMaterial({color:16777215*Math.random()}),this.frustumCulled=this.sortParticles=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,i){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,n=this.children.length;for(i=0;n>i;i++)this.children[i].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,i){THREE.Mesh.call(this,e,t),this.useVertexTexture=void 0!==i?i:!0,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var n,r,o;if(this.geometry&&void 0!==this.geometry.bones){for(e=0;e<this.geometry.bones.length;e++)i=this.geometry.bones[e],n=i.pos,r=i.rotq,o=i.scl,t=this.addBone(),t.name=i.name,t.position.set(n[0],n[1],n[2]),t.quaternion.set(r[0],r[1],r[2],r[3]),void 0!==o?t.scale.set(o[0],o[1],o[2]):t.scale.set(1,1,1);for(e=0;e<this.bones.length;e++)i=this.geometry.bones[e],t=this.bones[e],-1===i.parent?this.add(t):this.bones[i.parent].add(t);e=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=e>256?64:e>64?32:e>16?16:8,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*e),this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new THREE.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var t=0,i=this.children.length;i>t;t++){var n=this.children[t];n instanceof THREE.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}if(void 0==this.boneInverses)for(this.boneInverses=[],t=0,i=this.bones.length;i>t;t++)n=new THREE.Matrix4,n.getInverse(this.bones[t].skinMatrix),this.boneInverses.push(n);for(t=0,i=this.bones.length;i>t;t++)e.multiplyMatrices(this.bones[t].skinMatrix,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();1/0!==i?t.multiplyScalar(i):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,n=/([a-z]+)(\d+)/,r=0,o=e.morphTargets.length;o>r;r++){var a=e.morphTargets[r].name.match(n);if(a&&1<a.length){a=a[1],i[a]||(i[a]={start:1/0,end:-1/0});var s=i[a];r<s.start&&(s.start=r),r>s.end&&(s.end=r),t||(t=a)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time%=this.duration,0>this.time&&(this.time+=this.duration)),e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;i>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){if(1<this.objects.length){e.getPositionFromMatrix(i.matrixWorld),t.getPositionFromMatrix(this.matrixWorld),i=e.distanceTo(t),this.objects[0].object.visible=!0;for(var n=1,r=this.objects.length;r>n&&i>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;r>n;n++)this.objects[n].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(){},THREE.Sprite=function(e){THREE.Object3D.call(this),this.material=void 0!==e?e:new THREE.SpriteMaterial},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Particle=THREE.Sprite,THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);if(-1!==t&&this.__lights.splice(t,1),e.shadowCascadeArray)for(t=0;t<e.shadowCascadeArray.length;t++)this.__removeObject(e.shadowCascadeArray[t])}else e instanceof THREE.Camera||(this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),-1!==t&&this.__objectsAdded.splice(t,1));for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},THREE.Scene.prototype.clone=function(e){return void 0===e&&(e=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},THREE.Fog=function(e,t,i){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(e,t,i){for(var n=0,r=E.length;r>n;n++){var o=E[n];if(Et.copy(o.color),o instanceof THREE.DirectionalLight){var a=Ht.getPositionFromMatrix(o.matrixWorld).normalize(),s=t.dot(a);0>=s||(s*=o.intensity,i.add(Et.multiplyScalar(s)))}else o instanceof THREE.PointLight&&(a=Ht.getPositionFromMatrix(o.matrixWorld),s=t.dot(Ht.subVectors(a,e).normalize()),0>=s||(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1),0!=s&&(s*=o.intensity,i.add(Et.multiplyScalar(s)))))}}function i(e,t,i,n){c(t),d(i),u(n),p(e.getStyle()),A.stroke(),_t.expandByScalar(2*t)}function n(e){f(e.getStyle()),A.fill()}function r(e,t,i,r,o,a,s,l,h,c,d,u,p){if(!(p instanceof THREE.DataTexture||void 0===p.image||0===p.image.width)){if(!0===p.needsUpdate){var m=p.wrapS===THREE.RepeatWrapping,g=p.wrapT===THREE.RepeatWrapping;yt[p.id]=A.createPattern(p.image,!0===m&&!0===g?"repeat":!0===m&&!1===g?"repeat-x":!1===m&&!0===g?"repeat-y":"no-repeat"),p.needsUpdate=!1}void 0===yt[p.id]?f("rgba(0,0,0,1)"):f(yt[p.id]);var m=p.offset.x/p.repeat.x,g=p.offset.y/p.repeat.y,v=p.image.width*p.repeat.x,E=p.image.height*p.repeat.y,s=(s+m)*v,l=(1-l+g)*E,i=i-e,r=r-t,o=o-e,a=a-t,h=(h+m)*v-s,c=(1-c+g)*E-l,d=(d+m)*v-s,u=(1-u+g)*E-l,m=h*u-d*c;0===m?(void 0===xt[p.id]&&(t=document.createElement("canvas"),t.width=p.image.width,t.height=p.image.height,t=t.getContext("2d"),t.drawImage(p.image,0,0),xt[p.id]=t.getImageData(0,0,p.image.width,p.image.height).data),t=xt[p.id],s=4*(Math.floor(s)+Math.floor(l)*p.image.width),dt.setRGB(t[s]/255,t[s+1]/255,t[s+2]/255),n(dt)):(m=1/m,p=(u*i-c*o)*m,c=(u*r-c*a)*m,i=(h*o-d*i)*m,r=(h*a-d*r)*m,e=e-p*s-i*l,s=t-c*s-r*l,A.save(),A.transform(p,c,i,r,e,s),A.fill(),A.restore())}}function o(e,t,i,n,r,o,a,s,l,h,c,d,u){var p,f;p=u.width-1,f=u.height-1,a*=p,s*=f,i-=e,n-=t,r-=e,o-=t,l=l*p-a,h=h*f-s,c=c*p-a,d=d*f-s,f=1/(l*d-c*h),p=(d*i-h*r)*f,h=(d*n-h*o)*f,i=(l*r-c*i)*f,n=(l*o-c*n)*f,e=e-p*a-i*s,t=t-h*a-n*s,A.save(),A.transform(p,h,i,n,e,t),A.clip(),A.drawImage(u,0,0),A.restore()}function a(e,t,i,n){return lt[0]=255*e.r|0,lt[1]=255*e.g|0,lt[2]=255*e.b|0,lt[4]=255*t.r|0,lt[5]=255*t.g|0,lt[6]=255*t.b|0,lt[8]=255*i.r|0,lt[9]=255*i.g|0,lt[10]=255*i.b|0,lt[12]=255*n.r|0,lt[13]=255*n.g|0,lt[14]=255*n.b|0,at.putImageData(st,0,0),ct.drawImage(ot,0,0),ht}function s(e,t,i){var n=t.x-e.x,r=t.y-e.y,o=n*n+r*r;0!==o&&(i/=Math.sqrt(o),n*=i,r*=i,t.x+=n,t.y+=r,e.x-=n,e.y-=r)}function l(e){L!==e&&(L=A.globalAlpha=e)}function h(e){k!==e&&(e===THREE.NormalBlending?A.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?A.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(A.globalCompositeOperation="darker"),k=e)}function c(e){z!==e&&(z=A.lineWidth=e)}function d(e){V!==e&&(V=A.lineCap=e)}function u(e){F!==e&&(F=A.lineJoin=e)}function p(e){O!==e&&(O=A.strokeStyle=e)}function f(e){N!==e&&(N=A.fillStyle=e)}function m(e,t){(U!==e||B!==t)&&(A.setLineDash([e,t]),U=e,B=t)}console.log("THREE.CanvasRenderer",THREE.REVISION);var g,v,E,y,x,T,b,_=THREE.Math.smoothstep,e=e||{},R=this,w=new THREE.Projector,S=void 0!==e.canvas?e.canvas:document.createElement("canvas"),H=S.width,M=S.height,C=Math.floor(H/2),D=Math.floor(M/2),A=S.getContext("2d"),I=new THREE.Color(0),P=0,L=1,k=0,O=null,N=null,z=null,V=null,F=null,U=null,B=0;new THREE.RenderableVertex,new THREE.RenderableVertex;var G,W,j,$,X,Y,K,q,Z,J,Q,et,tt,it,nt,rt,ot,at,st,lt,ht,ct,dt=new THREE.Color,ut=new THREE.Color,pt=new THREE.Color,ft=new THREE.Color,mt=new THREE.Color,gt=new THREE.Color,vt=new THREE.Color,Et=new THREE.Color,yt={},xt={},Tt=new THREE.Box2,bt=new THREE.Box2,_t=new THREE.Box2,Rt=new THREE.Color,wt=new THREE.Color,St=new THREE.Color,Ht=new THREE.Vector3,Mt=16;ot=document.createElement("canvas"),ot.width=ot.height=2,at=ot.getContext("2d"),at.fillStyle="rgba(0,0,0,1)",at.fillRect(0,0,2,2),st=at.getImageData(0,0,2,2),lt=st.data,ht=document.createElement("canvas"),ht.width=ht.height=Mt,ct=ht.getContext("2d"),ct.translate(-Mt/2,-Mt/2),ct.scale(Mt,Mt),Mt--,void 0===A.setLineDash&&(A.setLineDash=void 0!==A.mozDash?function(e){A.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=S,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,i){H=e*this.devicePixelRatio,M=t*this.devicePixelRatio,C=Math.floor(H/2),D=Math.floor(M/2),S.width=H,S.height=M,1!==this.devicePixelRatio&&!1!==i&&(S.style.width=e+"px",S.style.height=t+"px"),Tt.set(new THREE.Vector2(-C,-D),new THREE.Vector2(C,D)),bt.set(new THREE.Vector2(-C,-D),new THREE.Vector2(C,D)),L=1,k=0,F=V=z=N=O=null},this.setClearColor=function(e,t){I.set(e),P=void 0!==t?t:1,bt.set(new THREE.Vector2(-C,-D),new THREE.Vector2(C,D))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){A.setTransform(1,0,0,-1,C,D),!1===bt.empty()&&(bt.intersect(Tt),bt.expandByScalar(2),1>P&&A.clearRect(0|bt.min.x,0|bt.min.y,bt.max.x-bt.min.x|0,bt.max.y-bt.min.y|0),P>0&&(h(THREE.NormalBlending),l(1),f("rgba("+Math.floor(255*I.r)+","+Math.floor(255*I.g)+","+Math.floor(255*I.b)+","+P+")"),A.fillRect(0|bt.min.x,0|bt.min.y,bt.max.x-bt.min.x|0,bt.max.y-bt.min.y|0)),bt.makeEmpty())
},this.render=function(e,S){if(!1==S instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),A.setTransform(1,0,0,-1,C,D),R.info.render.vertices=0,R.info.render.faces=0,g=w.projectScene(e,S,this.sortObjects,this.sortElements),v=g.elements,E=g.lights,y=S,Rt.setRGB(0,0,0),wt.setRGB(0,0,0),St.setRGB(0,0,0);for(var H=0,M=E.length;M>H;H++){var I=E[H],P=I.color;I instanceof THREE.AmbientLight?Rt.add(P):I instanceof THREE.DirectionalLight?wt.add(P):I instanceof THREE.PointLight&&St.add(P)}for(H=0,M=v.length;M>H;H++){var L=v[H],k=L.material;if(void 0!==k&&!1!==k.visible){if(_t.makeEmpty(),L instanceof THREE.RenderableSprite){x=L,x.x*=C,x.y*=D;var I=x,P=L,O=k;l(O.opacity),h(O.blending),L=P.scale.x*C,k=P.scale.y*D,_t.min.set(I.x-.5*L,I.y-.5*k),_t.max.set(I.x+.5*L,I.y+.5*k),!1===Tt.isIntersectionBox(_t)?_t.makeEmpty():O instanceof THREE.SpriteMaterial||O instanceof THREE.ParticleSystemMaterial?(null!==O.map?(P=O.map.image,A.save(),A.translate(I.x,I.y),A.rotate(-O.rotation),A.scale(L,-k),A.drawImage(P,0,0,P.width,P.height,-.5,-.5,1,1)):(f(O.color.getStyle()),A.save(),A.translate(I.x,I.y),A.rotate(-P.rotation),A.scale(L,k),A.fillRect(-.5,-.5,1,1)),A.restore()):O instanceof THREE.SpriteCanvasMaterial&&(p(O.color.getStyle()),f(O.color.getStyle()),A.save(),A.translate(I.x,I.y),A.rotate(-P.rotation),A.scale(L,k),O.program(A),A.restore())}else if(L instanceof THREE.RenderableLine){if(x=L.v1,T=L.v2,x.positionScreen.x*=C,x.positionScreen.y*=D,T.positionScreen.x*=C,T.positionScreen.y*=D,_t.setFromPoints([x.positionScreen,T.positionScreen]),!0===Tt.isIntersectionBox(_t))if(I=x,P=T,O=L,L=k,l(L.opacity),h(L.blending),A.beginPath(),A.moveTo(I.positionScreen.x,I.positionScreen.y),A.lineTo(P.positionScreen.x,P.positionScreen.y),L instanceof THREE.LineBasicMaterial){if(c(L.linewidth),d(L.linecap),u(L.linejoin),L.vertexColors!==THREE.VertexColors)p(L.color.getStyle());else if(k=O.vertexColors[0].getStyle(),O=O.vertexColors[1].getStyle(),k===O)p(k);else{try{var N=A.createLinearGradient(I.positionScreen.x,I.positionScreen.y,P.positionScreen.x,P.positionScreen.y);N.addColorStop(0,k),N.addColorStop(1,O)}catch(z){N=k}p(N)}A.stroke(),_t.expandByScalar(2*L.linewidth)}else L instanceof THREE.LineDashedMaterial&&(c(L.linewidth),d(L.linecap),u(L.linejoin),p(L.color.getStyle()),m(L.dashSize,L.gapSize),A.stroke(),_t.expandByScalar(2*L.linewidth),m(null,null))}else if(L instanceof THREE.RenderableFace3){if(x=L.v1,T=L.v2,b=L.v3,-1>x.positionScreen.z||1<x.positionScreen.z)continue;if(-1>T.positionScreen.z||1<T.positionScreen.z)continue;if(-1>b.positionScreen.z||1<b.positionScreen.z)continue;if(x.positionScreen.x*=C,x.positionScreen.y*=D,T.positionScreen.x*=C,T.positionScreen.y*=D,b.positionScreen.x*=C,b.positionScreen.y*=D,0<k.overdraw&&(s(x.positionScreen,T.positionScreen,k.overdraw),s(T.positionScreen,b.positionScreen,k.overdraw),s(b.positionScreen,x.positionScreen,k.overdraw)),_t.setFromPoints([x.positionScreen,T.positionScreen,b.positionScreen]),!0===Tt.isIntersectionBox(_t)){I=x,P=T,O=b,R.info.render.vertices+=3,R.info.render.faces++,l(k.opacity),h(k.blending),G=I.positionScreen.x,W=I.positionScreen.y,j=P.positionScreen.x,$=P.positionScreen.y,X=O.positionScreen.x,Y=O.positionScreen.y;var V=G,F=W,U=j,B=$,ot=X,at=Y;A.beginPath(),A.moveTo(V,F),A.lineTo(U,B),A.lineTo(ot,at),A.closePath(),(k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial)&&null===k.map?(gt.copy(k.color),vt.copy(k.emissive),k.vertexColors===THREE.FaceColors&&gt.multiply(L.color),!1===k.wireframe&&k.shading===THREE.SmoothShading&&3===L.vertexNormalsLength?(ut.copy(Rt),pt.copy(Rt),ft.copy(Rt),t(L.v1.positionWorld,L.vertexNormalsModel[0],ut),t(L.v2.positionWorld,L.vertexNormalsModel[1],pt),t(L.v3.positionWorld,L.vertexNormalsModel[2],ft),ut.multiply(gt).add(vt),pt.multiply(gt).add(vt),ft.multiply(gt).add(vt),mt.addColors(pt,ft).multiplyScalar(.5),Z=a(ut,pt,ft,mt),o(G,W,j,$,X,Y,0,0,1,0,0,1,Z)):(dt.copy(Rt),t(L.centroidModel,L.normalModel,dt),dt.multiply(gt).add(vt),!0===k.wireframe?i(dt,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):n(dt))):k instanceof THREE.MeshBasicMaterial||k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial?null!==k.map?k.map.mapping instanceof THREE.UVMapping&&(J=L.uvs[0],r(G,W,j,$,X,Y,J[0].x,J[0].y,J[1].x,J[1].y,J[2].x,J[2].y,k.map)):null!==k.envMap?k.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(Ht.copy(L.vertexNormalsModelView[0]),Q=.5*Ht.x+.5,et=.5*Ht.y+.5,Ht.copy(L.vertexNormalsModelView[1]),tt=.5*Ht.x+.5,it=.5*Ht.y+.5,Ht.copy(L.vertexNormalsModelView[2]),nt=.5*Ht.x+.5,rt=.5*Ht.y+.5,r(G,W,j,$,X,Y,Q,et,tt,it,nt,rt,k.envMap)):(dt.copy(k.color),k.vertexColors===THREE.FaceColors&&dt.multiply(L.color),!0===k.wireframe?i(dt,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):n(dt)):k instanceof THREE.MeshDepthMaterial?(K=y.near,q=y.far,ut.r=ut.g=ut.b=1-_(I.positionScreen.z*I.positionScreen.w,K,q),pt.r=pt.g=pt.b=1-_(P.positionScreen.z*P.positionScreen.w,K,q),ft.r=ft.g=ft.b=1-_(O.positionScreen.z*O.positionScreen.w,K,q),mt.addColors(pt,ft).multiplyScalar(.5),Z=a(ut,pt,ft,mt),o(G,W,j,$,X,Y,0,0,1,0,0,1,Z)):k instanceof THREE.MeshNormalMaterial&&(I=void 0,k.shading===THREE.FlatShading?(I=L.normalModelView,dt.setRGB(I.x,I.y,I.z).multiplyScalar(.5).addScalar(.5),!0===k.wireframe?i(dt,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):n(dt)):k.shading===THREE.SmoothShading&&(I=L.vertexNormalsModelView[0],ut.setRGB(I.x,I.y,I.z).multiplyScalar(.5).addScalar(.5),I=L.vertexNormalsModelView[1],pt.setRGB(I.x,I.y,I.z).multiplyScalar(.5).addScalar(.5),I=L.vertexNormalsModelView[2],ft.setRGB(I.x,I.y,I.z).multiplyScalar(.5).addScalar(.5),mt.addColors(pt,ft).multiplyScalar(.5),Z=a(ut,pt,ft,mt),o(G,W,j,$,X,Y,0,0,1,0,0,1,Z)))}}bt.union(_t)}}A.setTransform(1,0,0,1,0,0)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else if ( combine == 2 ) {\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 worldPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nworldNormal = normalize( worldNormal );\nvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, worldNormal );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nuniform int boneTextureWidth;\nuniform int boneTextureHeight;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, float( boneTextureWidth ) );\nfloat y = floor( j / float( boneTextureWidth ) );\nfloat dx = 1.0 / float( boneTextureWidth );\nfloat dy = 1.0 / float( boneTextureHeight );\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.0 * xPixelOffset;\nfloat dy0 = -1.0 * yPixelOffset;\nfloat dx1 = 1.0 * xPixelOffset;\nfloat dy1 = 1.0 * yPixelOffset;\nmat3 shadowKernel;\nmat3 depthKernel;\ndepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\ndepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\ndepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\ndepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\ndepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\ndepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\ndepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\ndepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\ndepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nvec3 shadowZ = vec3( shadowCoord.z );\nshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\nshadowKernel[0] *= vec3(0.25);\nshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\nshadowKernel[1] *= vec3(0.25);\nshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\nshadowKernel[2] *= vec3(0.25);\nvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\nshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\nshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\nvec4 shadowValues;\nshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\nshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\nshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\nshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\nshadow = dot( shadowValues, vec4( 1.0 ) );\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,i,n,r={};
for(t=0;t<e.length;t++)for(i in n=this.clone(e[t]))r[i]=n[i];return r},clone:function(e){var t,i,n,r={};for(t in e)for(i in r[t]={},e[t])n=e[t][i],r[t][i]=n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture?n.clone():n instanceof Array?n.slice():n;return r}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\nif ( mod( vLineDistance, totalSize ) > dashSize ) {\ndiscard;\n}\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalize( normalMatrix * skinnedNormal.xyz );\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n#else\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\n#endif\nvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = worldPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\nvoid main() {\ngl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n}"},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t){var i=e.vertices.length,n=t.material;if(n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var r in n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=U.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function i(e,t){var i=t.geometry,a=e.faces3,s=3*a.length,l=1*a.length,h=3*a.length,a=n(t,e),c=o(a),d=r(a),u=a.vertexColors?a.vertexColors:!1;if(e.__vertexArray=new Float32Array(3*s),d&&(e.__normalArray=new Float32Array(3*s)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*s)),u&&(e.__colorArray=new Float32Array(3*s)),c&&(0<i.faceVertexUvs.length&&(e.__uvArray=new Float32Array(2*s)),1<i.faceVertexUvs.length&&(e.__uv2Array=new Float32Array(2*s))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*s),e.__skinWeightArray=new Float32Array(4*s)),e.__faceArray=new Uint16Array(3*l),e.__lineArray=new Uint16Array(2*h),e.numMorphTargets)for(e.__morphTargetsArrays=[],i=0,c=e.numMorphTargets;c>i;i++)e.__morphTargetsArrays.push(new Float32Array(3*s));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],i=0,c=e.numMorphNormals;c>i;i++)e.__morphNormalsArrays.push(new Float32Array(3*s));if(e.__webglFaceCount=3*l,e.__webglLineCount=2*h,a.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in a.attributes){var f,l=a.attributes[p],h={};for(f in l)h[f]=l[f];(!h.__webglInitialized||h.createUniqueBuffers)&&(h.__webglInitialized=!0,i=1,"v2"===h.type?i=2:"v3"===h.type?i=3:"v4"===h.type?i=4:"c"===h.type&&(i=3),h.size=i,h.array=new Float32Array(s*i),h.buffer=U.createBuffer(),h.buffer.belongsToAttribute=p,l.needsUpdate=!0,h.__original=l),e.__webglCustomAttributesList.push(h)}}e.__inittedArrays=!0}function n(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function r(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&void 0!==e.shading&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function o(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function a(e){xt[e]||(U.enableVertexAttribArray(e),xt[e]=!0)}function s(){for(var e in xt)xt[e]&&(U.disableVertexAttribArray(e),xt[e]=!1)}function l(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function h(e,t){return t[0]-e[0]}function c(e,t,i){if(e.length)for(var n=0,r=e.length;r>n;n++)Q=K=null,Z=J=nt=it=ht=lt=rt=-1,St=!0,e[n].render(t,i,Et,yt),Q=K=null,Z=J=nt=it=ht=lt=rt=-1,St=!0}function d(e,t,i,n,r,o,a,s){var l,h,c,d;t?(h=e.length-1,d=t=-1):(h=0,t=e.length,d=1);for(var u=h;u!==t;u+=d)if(l=e[u],l.render){if(h=l.object,c=l.buffer,s)l=s;else{if(l=l[i],!l)continue;a&&$.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),$.setDepthTest(l.depthTest),$.setDepthWrite(l.depthWrite),w(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}$.setMaterialFaces(l),c instanceof THREE.BufferGeometry?$.renderBufferDirect(n,r,o,l,c,h):$.renderBuffer(n,r,o,l,c,h)}}function u(e,t,i,n,r,o,a){for(var s,l,h=0,c=e.length;c>h;h++)if(s=e[h],l=s.object,l.visible){if(a)s=a;else{if(s=s[t],!s)continue;o&&$.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),$.setDepthTest(s.depthTest),$.setDepthWrite(s.depthWrite),w(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}$.renderImmediateObject(i,n,r,s,l)}}function p(e,n){var r,o,a,s;if(void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Bt)),o=e.geometry,void 0!==o))if(o instanceof THREE.BufferGeometry){var l,h;for(l in o.attributes)h="index"===l?U.ELEMENT_ARRAY_BUFFER:U.ARRAY_BUFFER,s=o.attributes[l],void 0===s.numItems&&(s.numItems=s.array.length),s.buffer=U.createBuffer(),U.bindBuffer(h,s.buffer),U.bufferData(h,s.array,U.STATIC_DRAW)}else if(e instanceof THREE.Mesh){if(a=e.material,void 0===o.geometryGroups){l=o;var c,d,u;h={};var p=l.morphTargets.length,m=l.morphNormals.length,g=a instanceof THREE.MeshFaceMaterial;for(l.geometryGroups={},a=0,c=l.faces.length;c>a;a++)d=l.faces[a],d=g?d.materialIndex:0,void 0===h[d]&&(h[d]={hash:d,counter:0}),u=h[d].hash+"_"+h[d].counter,void 0===l.geometryGroups[u]&&(l.geometryGroups[u]={faces3:[],materialIndex:d,vertices:0,numMorphTargets:p,numMorphNormals:m}),65535<l.geometryGroups[u].vertices+3&&(h[d].counter+=1,u=h[d].hash+"_"+h[d].counter,void 0===l.geometryGroups[u]&&(l.geometryGroups[u]={faces3:[],materialIndex:d,vertices:0,numMorphTargets:p,numMorphNormals:m})),l.geometryGroups[u].faces3.push(a),l.geometryGroups[u].vertices+=3;l.geometryGroupsList=[];for(s in l.geometryGroups)l.geometryGroups[s].id=et++,l.geometryGroupsList.push(l.geometryGroups[s])}for(r in o.geometryGroups)if(s=o.geometryGroups[r],!s.__webglVertexBuffer){if(l=s,l.__webglVertexBuffer=U.createBuffer(),l.__webglNormalBuffer=U.createBuffer(),l.__webglTangentBuffer=U.createBuffer(),l.__webglColorBuffer=U.createBuffer(),l.__webglUVBuffer=U.createBuffer(),l.__webglUV2Buffer=U.createBuffer(),l.__webglSkinIndicesBuffer=U.createBuffer(),l.__webglSkinWeightsBuffer=U.createBuffer(),l.__webglFaceBuffer=U.createBuffer(),l.__webglLineBuffer=U.createBuffer(),p=h=void 0,l.numMorphTargets)for(l.__webglMorphTargetsBuffers=[],h=0,p=l.numMorphTargets;p>h;h++)l.__webglMorphTargetsBuffers.push(U.createBuffer());if(l.numMorphNormals)for(l.__webglMorphNormalsBuffers=[],h=0,p=l.numMorphNormals;p>h;h++)l.__webglMorphNormalsBuffers.push(U.createBuffer());$.info.memory.geometries++,i(s,e),o.verticesNeedUpdate=!0,o.morphTargetsNeedUpdate=!0,o.elementsNeedUpdate=!0,o.uvsNeedUpdate=!0,o.normalsNeedUpdate=!0,o.tangentsNeedUpdate=!0,o.colorsNeedUpdate=!0}}else e instanceof THREE.Line?o.__webglVertexBuffer||(s=o,s.__webglVertexBuffer=U.createBuffer(),s.__webglColorBuffer=U.createBuffer(),s.__webglLineDistanceBuffer=U.createBuffer(),$.info.memory.geometries++,s=o,l=s.vertices.length,s.__vertexArray=new Float32Array(3*l),s.__colorArray=new Float32Array(3*l),s.__lineDistanceArray=new Float32Array(1*l),s.__webglLineCount=l,t(s,e),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0,o.lineDistancesNeedUpdate=!0):e instanceof THREE.ParticleSystem&&!o.__webglVertexBuffer&&(s=o,s.__webglVertexBuffer=U.createBuffer(),s.__webglColorBuffer=U.createBuffer(),$.info.memory.geometries++,s=o,l=s.vertices.length,s.__vertexArray=new Float32Array(3*l),s.__colorArray=new Float32Array(3*l),s.__sortArray=[],s.__webglParticleCount=l,t(s,e),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0);
if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){if(o=e.geometry,o instanceof THREE.BufferGeometry)f(n.__webglObjects,o,e);else if(o instanceof THREE.Geometry)for(r in o.geometryGroups)s=o.geometryGroups[r],f(n.__webglObjects,s,e)}else e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(o=e.geometry,f(n.__webglObjects,o,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?n.__webglObjectsImmediate.push({id:null,object:e,opaque:null,transparent:null,z:0}):e instanceof THREE.Sprite?n.__webglSprites.push(e):e instanceof THREE.LensFlare&&n.__webglFlares.push(e);e.__webglActive=!0}}function f(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,z:0})}function m(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function g(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function v(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Line?E(t.__webglObjects,e):e instanceof THREE.Sprite?y(t.__webglSprites,e):e instanceof THREE.LensFlare?y(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&E(t.__webglObjectsImmediate,e),delete e.__webglActive}function E(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function y(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function x(e,t,i,n,r){tt=0,n.needsUpdate&&(n.program&&Xt(n),$.initMaterial(n,t,i,r),n.needsUpdate=!1),n.morphTargets&&!r.__webglMorphTargetInfluences&&(r.__webglMorphTargetInfluences=new Float32Array($.maxMorphTargets));var o=!1,a=n.program,s=a.uniforms,l=n.uniforms;if(a!==K&&(U.useProgram(a),K=a,o=!0),n.id!==Z&&(Z=n.id,o=!0),(o||e!==Q)&&(U.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix.elements),e!==Q&&(Q=e)),n.skinning)if(kt&&r.useVertexTexture){if(null!==s.boneTexture){var h=T();U.uniform1i(s.boneTexture,h),$.setTexture(r.boneTexture,h)}null!==s.boneTextureWidth&&U.uniform1i(s.boneTextureWidth,r.boneTextureWidth),null!==s.boneTextureHeight&&U.uniform1i(s.boneTextureHeight,r.boneTextureHeight)}else null!==s.boneGlobalMatrices&&U.uniformMatrix4fv(s.boneGlobalMatrices,!1,r.boneMatrices);if(o){if(i&&n.fog&&(l.fogColor.value=i.color,i instanceof THREE.Fog?(l.fogNear.value=i.near,l.fogFar.value=i.far):i instanceof THREE.FogExp2&&(l.fogDensity.value=i.density)),n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n.lights){if(St){for(var c,d,u,p,f=h=0,m=0,g=Ht,v=g.directional.colors,E=g.directional.positions,y=g.point.colors,x=g.point.positions,R=g.point.distances,w=g.spot.colors,S=g.spot.positions,H=g.spot.distances,C=g.spot.directions,D=g.spot.anglesCos,P=g.spot.exponents,L=g.hemi.skyColors,k=g.hemi.groundColors,O=g.hemi.positions,N=0,z=0,V=0,F=0,B=0,G=0,W=0,j=0,X=c=0,i=p=X=0,o=t.length;o>i;i++)c=t[i],c.onlyShadow||(d=c.color,u=c.intensity,p=c.distance,c instanceof THREE.AmbientLight?c.visible&&($.gammaInput?(h+=d.r*d.r,f+=d.g*d.g,m+=d.b*d.b):(h+=d.r,f+=d.g,m+=d.b)):c instanceof THREE.DirectionalLight?(B+=1,c.visible&&(wt.getPositionFromMatrix(c.matrixWorld),Rt.getPositionFromMatrix(c.target.matrixWorld),wt.sub(Rt),wt.normalize(),0===wt.x&&0===wt.y&&0===wt.z||(c=3*N,E[c]=wt.x,E[c+1]=wt.y,E[c+2]=wt.z,$.gammaInput?b(v,c,d,u*u):_(v,c,d,u),N+=1))):c instanceof THREE.PointLight?(G+=1,c.visible&&(X=3*z,$.gammaInput?b(y,X,d,u*u):_(y,X,d,u),Rt.getPositionFromMatrix(c.matrixWorld),x[X]=Rt.x,x[X+1]=Rt.y,x[X+2]=Rt.z,R[z]=p,z+=1)):c instanceof THREE.SpotLight?(W+=1,c.visible&&(X=3*V,$.gammaInput?b(w,X,d,u*u):_(w,X,d,u),Rt.getPositionFromMatrix(c.matrixWorld),S[X]=Rt.x,S[X+1]=Rt.y,S[X+2]=Rt.z,H[V]=p,wt.copy(Rt),Rt.getPositionFromMatrix(c.target.matrixWorld),wt.sub(Rt),wt.normalize(),C[X]=wt.x,C[X+1]=wt.y,C[X+2]=wt.z,D[V]=Math.cos(c.angle),P[V]=c.exponent,V+=1)):c instanceof THREE.HemisphereLight&&(j+=1,c.visible&&(wt.getPositionFromMatrix(c.matrixWorld),wt.normalize(),0===wt.x&&0===wt.y&&0===wt.z||(p=3*F,O[p]=wt.x,O[p+1]=wt.y,O[p+2]=wt.z,d=c.color,c=c.groundColor,$.gammaInput?(u*=u,b(L,p,d,u),b(k,p,c,u)):(_(L,p,d,u),_(k,p,c,u)),F+=1))));for(i=3*N,o=Math.max(v.length,3*B);o>i;i++)v[i]=0;for(i=3*z,o=Math.max(y.length,3*G);o>i;i++)y[i]=0;for(i=3*V,o=Math.max(w.length,3*W);o>i;i++)w[i]=0;for(i=3*F,o=Math.max(L.length,3*j);o>i;i++)L[i]=0;for(i=3*F,o=Math.max(k.length,3*j);o>i;i++)k[i]=0;g.directional.length=N,g.point.length=z,g.spot.length=V,g.hemi.length=F,g.ambient[0]=h,g.ambient[1]=f,g.ambient[2]=m,St=!1}i=Ht,l.ambientLightColor.value=i.ambient,l.directionalLightColor.value=i.directional.colors,l.directionalLightDirection.value=i.directional.positions,l.pointLightColor.value=i.point.colors,l.pointLightPosition.value=i.point.positions,l.pointLightDistance.value=i.point.distances,l.spotLightColor.value=i.spot.colors,l.spotLightPosition.value=i.spot.positions,l.spotLightDistance.value=i.spot.distances,l.spotLightDirection.value=i.spot.directions,l.spotLightAngleCos.value=i.spot.anglesCos,l.spotLightExponent.value=i.spot.exponents,l.hemisphereLightSkyColor.value=i.hemi.skyColors,l.hemisphereLightGroundColor.value=i.hemi.groundColors,l.hemisphereLightDirection.value=i.hemi.positions}if(n instanceof THREE.MeshBasicMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.MeshPhongMaterial){l.opacity.value=n.opacity,$.gammaInput?l.diffuse.value.copyGammaToLinear(n.color):l.diffuse.value=n.color,l.map.value=n.map,l.lightMap.value=n.lightMap,l.specularMap.value=n.specularMap,n.bumpMap&&(l.bumpMap.value=n.bumpMap,l.bumpScale.value=n.bumpScale),n.normalMap&&(l.normalMap.value=n.normalMap,l.normalScale.value.copy(n.normalScale));var Y;n.map?Y=n.map:n.specularMap?Y=n.specularMap:n.normalMap?Y=n.normalMap:n.bumpMap&&(Y=n.bumpMap),void 0!==Y&&(i=Y.offset,Y=Y.repeat,l.offsetRepeat.value.set(i.x,i.y,Y.x,Y.y)),l.envMap.value=n.envMap,l.flipEnvMap.value=n.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,l.reflectivity.value=n.reflectivity,l.refractionRatio.value=n.refractionRatio,l.combine.value=n.combine,l.useRefract.value=n.envMap&&n.envMap.mapping instanceof THREE.CubeRefractionMapping}if(n instanceof THREE.LineBasicMaterial?(l.diffuse.value=n.color,l.opacity.value=n.opacity):n instanceof THREE.LineDashedMaterial?(l.diffuse.value=n.color,l.opacity.value=n.opacity,l.dashSize.value=n.dashSize,l.totalSize.value=n.dashSize+n.gapSize,l.scale.value=n.scale):n instanceof THREE.ParticleSystemMaterial?(l.psColor.value=n.color,l.opacity.value=n.opacity,l.size.value=n.size,l.scale.value=I.height/2,l.map.value=n.map):n instanceof THREE.MeshPhongMaterial?(l.shininess.value=n.shininess,$.gammaInput?(l.ambient.value.copyGammaToLinear(n.ambient),l.emissive.value.copyGammaToLinear(n.emissive),l.specular.value.copyGammaToLinear(n.specular)):(l.ambient.value=n.ambient,l.emissive.value=n.emissive,l.specular.value=n.specular),n.wrapAround&&l.wrapRGB.value.copy(n.wrapRGB)):n instanceof THREE.MeshLambertMaterial?($.gammaInput?(l.ambient.value.copyGammaToLinear(n.ambient),l.emissive.value.copyGammaToLinear(n.emissive)):(l.ambient.value=n.ambient,l.emissive.value=n.emissive),n.wrapAround&&l.wrapRGB.value.copy(n.wrapRGB)):n instanceof THREE.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=n.opacity):n instanceof THREE.MeshNormalMaterial&&(l.opacity.value=n.opacity),r.receiveShadow&&!n._shadowPass&&l.shadowMatrix)for(i=Y=0,o=t.length;o>i;i++)h=t[i],h.castShadow&&(h instanceof THREE.SpotLight||h instanceof THREE.DirectionalLight&&!h.shadowCascade)&&(l.shadowMap.value[Y]=h.shadowMap,l.shadowMapSize.value[Y]=h.shadowMapSize,l.shadowMatrix.value[Y]=h.shadowMatrix,l.shadowDarkness.value[Y]=h.shadowDarkness,l.shadowBias.value[Y]=h.shadowBias,Y++);for(t=n.uniformsList,l=0,Y=t.length;Y>l;l++)if(o=a.uniforms[t[l][1]])if(i=t[l][0],f=i.type,h=i.value,"i"===f)U.uniform1i(o,h);else if("f"===f)U.uniform1f(o,h);else if("v2"===f)U.uniform2f(o,h.x,h.y);else if("v3"===f)U.uniform3f(o,h.x,h.y,h.z);else if("v4"===f)U.uniform4f(o,h.x,h.y,h.z,h.w);else if("c"===f)U.uniform3f(o,h.r,h.g,h.b);else if("iv1"===f)U.uniform1iv(o,h);else if("iv"===f)U.uniform3iv(o,h);else if("fv1"===f)U.uniform1fv(o,h);else if("fv"===f)U.uniform3fv(o,h);else if("v2v"===f){for(void 0===i._array&&(i._array=new Float32Array(2*h.length)),f=0,m=h.length;m>f;f++)g=2*f,i._array[g]=h[f].x,i._array[g+1]=h[f].y;U.uniform2fv(o,i._array)}else if("v3v"===f){for(void 0===i._array&&(i._array=new Float32Array(3*h.length)),f=0,m=h.length;m>f;f++)g=3*f,i._array[g]=h[f].x,i._array[g+1]=h[f].y,i._array[g+2]=h[f].z;U.uniform3fv(o,i._array)}else if("v4v"===f){for(void 0===i._array&&(i._array=new Float32Array(4*h.length)),f=0,m=h.length;m>f;f++)g=4*f,i._array[g]=h[f].x,i._array[g+1]=h[f].y,i._array[g+2]=h[f].z,i._array[g+3]=h[f].w;U.uniform4fv(o,i._array)}else if("m4"===f)void 0===i._array&&(i._array=new Float32Array(16)),h.flattenToArray(i._array),U.uniformMatrix4fv(o,!1,i._array);else if("m4v"===f){for(void 0===i._array&&(i._array=new Float32Array(16*h.length)),f=0,m=h.length;m>f;f++)h[f].flattenToArrayOffset(i._array,16*f);U.uniformMatrix4fv(o,!1,i._array)}else if("t"===f){if(g=h,h=T(),U.uniform1i(o,h),g)if(g.image instanceof Array&&6===g.image.length){if(i=g,o=h,6===i.image.length)if(i.needsUpdate){for(i.image.__webglTextureCube||(i.addEventListener("dispose",Gt),i.image.__webglTextureCube=U.createTexture(),$.info.memory.textures++),U.activeTexture(U.TEXTURE0+o),U.bindTexture(U.TEXTURE_CUBE_MAP,i.image.__webglTextureCube),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,i.flipY),o=i instanceof THREE.CompressedTexture,h=[],f=0;6>f;f++)$.autoScaleCubemaps&&!o?(m=h,g=f,v=i.image[f],y=It,v.width<=y&&v.height<=y||(x=Math.max(v.width,v.height),E=Math.floor(v.width*y/x),y=Math.floor(v.height*y/x),x=document.createElement("canvas"),x.width=E,x.height=y,x.getContext("2d").drawImage(v,0,0,v.width,v.height,0,0,E,y),v=x),m[g]=v):h[f]=i.image[f];for(f=h[0],m=0===(f.width&f.width-1)&&0===(f.height&f.height-1),g=A(i.format),v=A(i.type),M(U.TEXTURE_CUBE_MAP,i,m),f=0;6>f;f++)if(o)for(y=h[f].mipmaps,x=0,R=y.length;R>x;x++)E=y[x],i.format!==THREE.RGBAFormat?U.compressedTexImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+f,x,g,E.width,E.height,0,E.data):U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+f,x,g,E.width,E.height,0,g,v,E.data);else U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,g,g,v,h[f]);i.generateMipmaps&&m&&U.generateMipmap(U.TEXTURE_CUBE_MAP),i.needsUpdate=!1,i.onUpdate&&i.onUpdate()}else U.activeTexture(U.TEXTURE0+o),U.bindTexture(U.TEXTURE_CUBE_MAP,i.image.__webglTextureCube)}else g instanceof THREE.WebGLRenderTargetCube?(i=g,U.activeTexture(U.TEXTURE0+h),U.bindTexture(U.TEXTURE_CUBE_MAP,i.__webglTexture)):$.setTexture(g,h)}else if("tv"===f){for(void 0===i._array&&(i._array=[]),f=0,m=i.value.length;m>f;f++)i._array[f]=T();for(U.uniform1iv(o,i._array),f=0,m=i.value.length;m>f;f++)g=i.value[f],h=i._array[f],g&&$.setTexture(g,h)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+f);(n instanceof THREE.ShaderMaterial||n instanceof THREE.MeshPhongMaterial||n.envMap)&&null!==s.cameraPosition&&(Rt.getPositionFromMatrix(e.matrixWorld),U.uniform3f(s.cameraPosition,Rt.x,Rt.y,Rt.z)),(n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.ShaderMaterial||n.skinning)&&null!==s.viewMatrix&&U.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements)}return U.uniformMatrix4fv(s.modelViewMatrix,!1,r._modelViewMatrix.elements),s.normalMatrix&&U.uniformMatrix3fv(s.normalMatrix,!1,r._normalMatrix.elements),null!==s.modelMatrix&&U.uniformMatrix4fv(s.modelMatrix,!1,r.matrixWorld.elements),a}function T(){var e=tt;return e>=Dt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Dt),tt+=1,e}function b(e,t,i,n){e[t]=i.r*i.r*n,e[t+1]=i.g*i.g*n,e[t+2]=i.b*i.b*n}function _(e,t,i,n){e[t]=i.r*n,e[t+1]=i.g*n,e[t+2]=i.b*n}function R(e){e!==pt&&(U.lineWidth(e),pt=e)}function w(e,t,i){ct!==e&&(e?U.enable(U.POLYGON_OFFSET_FILL):U.disable(U.POLYGON_OFFSET_FILL),ct=e),!e||dt===t&&ut===i||(U.polygonOffset(t,i),dt=t,ut=i)}function S(e){for(var e=e.split("\n"),t=0,i=e.length;i>t;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function H(e,t){var i;return"fragment"===e?i=U.createShader(U.FRAGMENT_SHADER):"vertex"===e&&(i=U.createShader(U.VERTEX_SHADER)),U.shaderSource(i,t),U.compileShader(i),U.getShaderParameter(i,U.COMPILE_STATUS)?i:(console.error(U.getShaderInfoLog(i)),console.error(S(t)),null)}function M(e,t,i){i?(U.texParameteri(e,U.TEXTURE_WRAP_S,A(t.wrapS)),U.texParameteri(e,U.TEXTURE_WRAP_T,A(t.wrapT)),U.texParameteri(e,U.TEXTURE_MAG_FILTER,A(t.magFilter)),U.texParameteri(e,U.TEXTURE_MIN_FILTER,A(t.minFilter))):(U.texParameteri(e,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(e,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(e,U.TEXTURE_MAG_FILTER,D(t.magFilter)),U.texParameteri(e,U.TEXTURE_MIN_FILTER,D(t.minFilter))),W&&t.type!==THREE.FloatType&&(1<t.anisotropy||t.__oldAnisotropy)&&(U.texParameterf(e,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Pt)),t.__oldAnisotropy=t.anisotropy)}function C(e,t){U.bindRenderbuffer(U.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,t.width,t.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_STENCIL,t.width,t.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,e)):U.renderbufferStorage(U.RENDERBUFFER,U.RGBA4,t.width,t.height)}function D(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?U.NEAREST:U.LINEAR}function A(e){if(e===THREE.RepeatWrapping)return U.REPEAT;if(e===THREE.ClampToEdgeWrapping)return U.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return U.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return U.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return U.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return U.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return U.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return U.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return U.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return U.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return U.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return U.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return U.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return U.BYTE;if(e===THREE.ShortType)return U.SHORT;if(e===THREE.UnsignedShortType)return U.UNSIGNED_SHORT;if(e===THREE.IntType)return U.INT;if(e===THREE.UnsignedIntType)return U.UNSIGNED_INT;if(e===THREE.FloatType)return U.FLOAT;if(e===THREE.AlphaFormat)return U.ALPHA;if(e===THREE.RGBFormat)return U.RGB;if(e===THREE.RGBAFormat)return U.RGBA;if(e===THREE.LuminanceFormat)return U.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return U.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return U.FUNC_ADD;if(e===THREE.SubtractEquation)return U.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return U.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return U.ZERO;if(e===THREE.OneFactor)return U.ONE;if(e===THREE.SrcColorFactor)return U.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return U.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return U.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return U.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return U.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return U.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return U.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return U.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return U.SRC_ALPHA_SATURATE;if(void 0!==j){if(e===THREE.RGB_S3TC_DXT1_Format)return j.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return j.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return j.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return j.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);var e=e||{},I=void 0!==e.canvas?e.canvas:document.createElement("canvas"),P=void 0!==e.precision?e.precision:"highp",L=void 0!==e.alpha?e.alpha:!1,k=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,O=void 0!==e.antialias?e.antialias:!1,N=void 0!==e.stencil?e.stencil:!0,z=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,V=new THREE.Color(0),F=0;this.domElement=I,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var U,B,G,W,j,$=this,X=[],Y=0,K=null,q=null,Z=-1,J=null,Q=null,et=0,tt=0,it=-1,nt=-1,rt=-1,ot=-1,at=-1,st=-1,lt=-1,ht=-1,ct=null,dt=null,ut=null,pt=null,ft=0,mt=0,gt=I.width,vt=I.height,Et=0,yt=0,xt={},Tt=new THREE.Frustum,bt=new THREE.Matrix4,_t=new THREE.Matrix4,Rt=new THREE.Vector3,wt=new THREE.Vector3,St=!0,Ht={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var Mt={alpha:L,premultipliedAlpha:k,antialias:O,stencil:N,preserveDrawingBuffer:z};if(U=I.getContext("webgl",Mt)||I.getContext("experimental-webgl",Mt),null===U)throw"Error creating WebGL context."}catch(Ct){console.error(Ct)}B=U.getExtension("OES_texture_float"),U.getExtension("OES_texture_float_linear"),G=U.getExtension("OES_standard_derivatives"),W=U.getExtension("EXT_texture_filter_anisotropic")||U.getExtension("MOZ_EXT_texture_filter_anisotropic")||U.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),j=U.getExtension("WEBGL_compressed_texture_s3tc")||U.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||U.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),B||console.log("THREE.WebGLRenderer: Float textures not supported."),G||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),W||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),j||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===U.getShaderPrecisionFormat&&(U.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),U.clearColor(0,0,0,1),U.clearDepth(1),U.clearStencil(0),U.enable(U.DEPTH_TEST),U.depthFunc(U.LEQUAL),U.frontFace(U.CCW),U.cullFace(U.BACK),U.enable(U.CULL_FACE),U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA),U.viewport(ft,mt,gt,vt),U.clearColor(V.r,V.g,V.b,F),this.context=U;var Dt=U.getParameter(U.MAX_TEXTURE_IMAGE_UNITS),At=U.getParameter(U.MAX_VERTEX_TEXTURE_IMAGE_UNITS);U.getParameter(U.MAX_TEXTURE_SIZE);var It=U.getParameter(U.MAX_CUBE_MAP_TEXTURE_SIZE),Pt=W?U.getParameter(W.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Lt=At>0,kt=Lt&&B;j&&U.getParameter(U.COMPRESSED_TEXTURE_FORMATS);var Ot=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.HIGH_FLOAT),Nt=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.MEDIUM_FLOAT);U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.LOW_FLOAT);var zt=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.HIGH_FLOAT),Vt=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.MEDIUM_FLOAT);U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.LOW_FLOAT),U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.HIGH_INT),U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.MEDIUM_INT),U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.LOW_INT),U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.HIGH_INT),U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.MEDIUM_INT),U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.LOW_INT);var Ft=0<Ot.precision&&0<zt.precision,Ut=0<Nt.precision&&0<Vt.precision;"highp"===P&&!Ft&&(Ut?(P="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(P="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"===P&&!Ut&&(P="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return U},this.supportsVertexTextures=function(){return Lt},this.supportsFloatTextures=function(){return B},this.supportsStandardDerivatives=function(){return G},this.supportsCompressedTextureS3TC=function(){return j},this.getMaxAnisotropy=function(){return Pt},this.getPrecision=function(){return P},this.setSize=function(e,t,i){I.width=e*this.devicePixelRatio,I.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==i&&(I.style.width=e+"px",I.style.height=t+"px"),this.setViewport(0,0,I.width,I.height)},this.setViewport=function(e,t,i,n){ft=void 0!==e?e:0,mt=void 0!==t?t:0,gt=void 0!==i?i:I.width,vt=void 0!==n?n:I.height,U.viewport(ft,mt,gt,vt)},this.setScissor=function(e,t,i,n){U.scissor(e,t,i,n)},this.enableScissorTest=function(e){e?U.enable(U.SCISSOR_TEST):U.disable(U.SCISSOR_TEST)},this.setClearColor=function(e,t){V.set(e),F=void 0!==t?t:1,U.clearColor(V.r,V.g,V.b,F)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return V},this.getClearAlpha=function(){return F},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=U.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=U.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=U.STENCIL_BUFFER_BIT),U.clear(n)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){K=null,Z=J=ht=lt=rt=-1,St=!0,nt=it=-1,this.shadowMapPlugin.update(e,t)};var Bt=function(e){if(e=e.target,e.removeEventListener("dispose",Bt),e.__webglInit=void 0,e instanceof THREE.BufferGeometry){var t,i=e.attributes;for(t in i)void 0!==i[t].buffer&&U.deleteBuffer(i[t].buffer);$.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(i in e.geometryGroups){if(t=e.geometryGroups[i],void 0!==t.numMorphTargets)for(var n=0,r=t.numMorphTargets;r>n;n++)U.deleteBuffer(t.__webglMorphTargetsBuffers[n]);if(void 0!==t.numMorphNormals)for(n=0,r=t.numMorphNormals;r>n;n++)U.deleteBuffer(t.__webglMorphNormalsBuffers[n]);$t(t)}else $t(e)},Gt=function(e){e=e.target,e.removeEventListener("dispose",Gt),e.image&&e.image.__webglTextureCube?U.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,U.deleteTexture(e.__webglTexture)),$.info.memory.textures--},Wt=function(e){if(e=e.target,e.removeEventListener("dispose",Wt),e&&e.__webglTexture)if(U.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)U.deleteFramebuffer(e.__webglFramebuffer[t]),U.deleteRenderbuffer(e.__webglRenderbuffer[t]);else U.deleteFramebuffer(e.__webglFramebuffer),U.deleteRenderbuffer(e.__webglRenderbuffer);$.info.memory.textures--},jt=function(e){e=e.target,e.removeEventListener("dispose",jt),Xt(e)},$t=function(e){if(void 0!==e.__webglVertexBuffer&&U.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&U.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&U.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&U.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&U.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&U.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&U.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&U.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&U.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&U.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&U.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)U.deleteBuffer(e.__webglCustomAttributesList[t].buffer);$.info.memory.geometries--},Xt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,n,r=!1,e=0;for(i=X.length;i>e;e++)if(n=X[e],n.program===t){n.usedTimes--,0===n.usedTimes&&(r=!0);break}if(!0===r){for(r=[],e=0,i=X.length;i>e;e++)n=X[e],n.program!==t&&r.push(n);X=r,U.deleteProgram(t),$.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=U.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=U.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=U.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=U.createBuffer()),e.hasPositions&&(U.bindBuffer(U.ARRAY_BUFFER,e.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,e.positionArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(t.attributes.position),U.vertexAttribPointer(t.attributes.position,3,U.FLOAT,!1,0,0)),e.hasNormals){if(U.bindBuffer(U.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===THREE.FlatShading){var n,r,o,a,s,l,h,c,d,u,p,f=3*e.count;for(p=0;f>p;p+=9)u=e.normalArray,n=u[p],r=u[p+1],o=u[p+2],a=u[p+3],l=u[p+4],c=u[p+5],s=u[p+6],h=u[p+7],d=u[p+8],n=(n+a+s)/3,r=(r+l+h)/3,o=(o+c+d)/3,u[p]=n,u[p+1]=r,u[p+2]=o,u[p+3]=n,u[p+4]=r,u[p+5]=o,u[p+6]=n,u[p+7]=r,u[p+8]=o}U.bufferData(U.ARRAY_BUFFER,e.normalArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(t.attributes.normal),U.vertexAttribPointer(t.attributes.normal,3,U.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(U.bindBuffer(U.ARRAY_BUFFER,e.__webglUvBuffer),U.bufferData(U.ARRAY_BUFFER,e.uvArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(t.attributes.uv),U.vertexAttribPointer(t.attributes.uv,2,U.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==THREE.NoColors&&(U.bindBuffer(U.ARRAY_BUFFER,e.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,e.colorArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(t.attributes.color),U.vertexAttribPointer(t.attributes.color,3,U.FLOAT,!1,0,0)),U.drawArrays(U.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,o){if(!1!==n.visible){var l,h,c,d;if(l=x(e,t,i,n,o),t=l.attributes,e=r.attributes,i=!1,l=16777215*r.id+2*l.id+(n.wireframe?1:0),l!==J&&(J=l,i=!0),i&&s(),o instanceof THREE.Mesh)if(o=e.index){r=r.offsets,1<r.length&&(i=!0);for(var u=0,p=r.length;p>u;u++){var f=r[u].index;if(i){for(h in t)c=t[h],l=e[h],c>=0&&(l?(d=l.itemSize,U.bindBuffer(U.ARRAY_BUFFER,l.buffer),a(c),U.vertexAttribPointer(c,d,U.FLOAT,!1,0,4*f*d)):n.defaultAttributeValues&&(2===n.defaultAttributeValues[h].length?U.vertexAttrib2fv(c,n.defaultAttributeValues[h]):3===n.defaultAttributeValues[h].length&&U.vertexAttrib3fv(c,n.defaultAttributeValues[h])));U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,o.buffer)}U.drawElements(U.TRIANGLES,r[u].count,U.UNSIGNED_SHORT,2*r[u].start),$.info.render.calls++,$.info.render.vertices+=r[u].count,$.info.render.faces+=r[u].count/3}}else{if(i)for(h in t)"index"!==h&&(c=t[h],l=e[h],c>=0&&(l?(d=l.itemSize,U.bindBuffer(U.ARRAY_BUFFER,l.buffer),a(c),U.vertexAttribPointer(c,d,U.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[h]&&(2===n.defaultAttributeValues[h].length?U.vertexAttrib2fv(c,n.defaultAttributeValues[h]):3===n.defaultAttributeValues[h].length&&U.vertexAttrib3fv(c,n.defaultAttributeValues[h]))));n=r.attributes.position,U.drawArrays(U.TRIANGLES,0,n.numItems/3),$.info.render.calls++,$.info.render.vertices+=n.numItems/3,$.info.render.faces+=n.numItems/3/3}else if(o instanceof THREE.ParticleSystem){if(i){for(h in t)c=t[h],l=e[h],c>=0&&(l?(d=l.itemSize,U.bindBuffer(U.ARRAY_BUFFER,l.buffer),a(c),U.vertexAttribPointer(c,d,U.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[h]&&(2===n.defaultAttributeValues[h].length?U.vertexAttrib2fv(c,n.defaultAttributeValues[h]):3===n.defaultAttributeValues[h].length&&U.vertexAttrib3fv(c,n.defaultAttributeValues[h])));n=e.position,U.drawArrays(U.POINTS,0,n.numItems/3),$.info.render.calls++,$.info.render.points+=n.numItems/3}}else if(o instanceof THREE.Line&&i){for(h in t)c=t[h],l=e[h],c>=0&&(l?(d=l.itemSize,U.bindBuffer(U.ARRAY_BUFFER,l.buffer),a(c),U.vertexAttribPointer(c,d,U.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[h]&&(2===n.defaultAttributeValues[h].length?U.vertexAttrib2fv(c,n.defaultAttributeValues[h]):3===n.defaultAttributeValues[h].length&&U.vertexAttrib3fv(c,n.defaultAttributeValues[h])));h=o.type===THREE.LineStrip?U.LINE_STRIP:U.LINES,R(n.linewidth),n=e.position,U.drawArrays(h,0,n.numItems/3),$.info.render.calls++,$.info.render.points+=n.numItems}}},this.renderBuffer=function(e,t,i,n,r,o){if(!1!==n.visible){var l,c,i=x(e,t,i,n,o),e=i.attributes,t=!1,i=16777215*r.id+2*i.id+(n.wireframe?1:0);if(i!==J&&(J=i,t=!0),t&&s(),!n.morphTargets&&0<=e.position)t&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglVertexBuffer),a(e.position),U.vertexAttribPointer(e.position,3,U.FLOAT,!1,0,0));else if(o.morphTargetBase){if(i=n.program.attributes,-1!==o.morphTargetBase&&0<=i.position?(U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[o.morphTargetBase]),a(i.position),U.vertexAttribPointer(i.position,3,U.FLOAT,!1,0,0)):0<=i.position&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglVertexBuffer),a(i.position),U.vertexAttribPointer(i.position,3,U.FLOAT,!1,0,0)),o.morphTargetForcedOrder.length){var d=0;for(c=o.morphTargetForcedOrder,l=o.morphTargetInfluences;d<n.numSupportedMorphTargets&&d<c.length;)0<=i["morphTarget"+d]&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[c[d]]),a(i["morphTarget"+d]),U.vertexAttribPointer(i["morphTarget"+d],3,U.FLOAT,!1,0,0)),0<=i["morphNormal"+d]&&n.morphNormals&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphNormalsBuffers[c[d]]),a(i["morphNormal"+d]),U.vertexAttribPointer(i["morphNormal"+d],3,U.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[d]=l[c[d]],d++}else{c=[],l=o.morphTargetInfluences;var u,p=l.length;for(u=0;p>u;u++)d=l[u],d>0&&c.push([d,u]);for(c.length>n.numSupportedMorphTargets?(c.sort(h),c.length=n.numSupportedMorphTargets):c.length>n.numSupportedMorphNormals?c.sort(h):0===c.length&&c.push([0,0]),d=0;d<n.numSupportedMorphTargets;)c[d]?(u=c[d][1],0<=i["morphTarget"+d]&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[u]),a(i["morphTarget"+d]),U.vertexAttribPointer(i["morphTarget"+d],3,U.FLOAT,!1,0,0)),0<=i["morphNormal"+d]&&n.morphNormals&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglMorphNormalsBuffers[u]),a(i["morphNormal"+d]),U.vertexAttribPointer(i["morphNormal"+d],3,U.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[d]=l[u]):o.__webglMorphTargetInfluences[d]=0,d++}null!==n.program.uniforms.morphTargetInfluences&&U.uniform1fv(n.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}if(t){if(r.__webglCustomAttributesList)for(l=0,c=r.__webglCustomAttributesList.length;c>l;l++)i=r.__webglCustomAttributesList[l],0<=e[i.buffer.belongsToAttribute]&&(U.bindBuffer(U.ARRAY_BUFFER,i.buffer),a(e[i.buffer.belongsToAttribute]),U.vertexAttribPointer(e[i.buffer.belongsToAttribute],i.size,U.FLOAT,!1,0,0));0<=e.color&&(0<o.geometry.colors.length||0<o.geometry.faces.length?(U.bindBuffer(U.ARRAY_BUFFER,r.__webglColorBuffer),a(e.color),U.vertexAttribPointer(e.color,3,U.FLOAT,!1,0,0)):n.defaultAttributeValues&&U.vertexAttrib3fv(e.color,n.defaultAttributeValues.color)),0<=e.normal&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglNormalBuffer),a(e.normal),U.vertexAttribPointer(e.normal,3,U.FLOAT,!1,0,0)),0<=e.tangent&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglTangentBuffer),a(e.tangent),U.vertexAttribPointer(e.tangent,4,U.FLOAT,!1,0,0)),0<=e.uv&&(o.geometry.faceVertexUvs[0]?(U.bindBuffer(U.ARRAY_BUFFER,r.__webglUVBuffer),a(e.uv),U.vertexAttribPointer(e.uv,2,U.FLOAT,!1,0,0)):n.defaultAttributeValues&&U.vertexAttrib2fv(e.uv,n.defaultAttributeValues.uv)),0<=e.uv2&&(o.geometry.faceVertexUvs[1]?(U.bindBuffer(U.ARRAY_BUFFER,r.__webglUV2Buffer),a(e.uv2),U.vertexAttribPointer(e.uv2,2,U.FLOAT,!1,0,0)):n.defaultAttributeValues&&U.vertexAttrib2fv(e.uv2,n.defaultAttributeValues.uv2)),n.skinning&&0<=e.skinIndex&&0<=e.skinWeight&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglSkinIndicesBuffer),a(e.skinIndex),U.vertexAttribPointer(e.skinIndex,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,r.__webglSkinWeightsBuffer),a(e.skinWeight),U.vertexAttribPointer(e.skinWeight,4,U.FLOAT,!1,0,0)),0<=e.lineDistance&&(U.bindBuffer(U.ARRAY_BUFFER,r.__webglLineDistanceBuffer),a(e.lineDistance),U.vertexAttribPointer(e.lineDistance,1,U.FLOAT,!1,0,0))}o instanceof THREE.Mesh?(n.wireframe?(R(n.wireframeLinewidth),t&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer),U.drawElements(U.LINES,r.__webglLineCount,U.UNSIGNED_SHORT,0)):(t&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),U.drawElements(U.TRIANGLES,r.__webglFaceCount,U.UNSIGNED_SHORT,0)),$.info.render.calls++,$.info.render.vertices+=r.__webglFaceCount,$.info.render.faces+=r.__webglFaceCount/3):o instanceof THREE.Line?(o=o.type===THREE.LineStrip?U.LINE_STRIP:U.LINES,R(n.linewidth),U.drawArrays(o,0,r.__webglLineCount),$.info.render.calls++):o instanceof THREE.ParticleSystem&&(U.drawArrays(U.POINTS,0,r.__webglParticleCount),$.info.render.calls++,$.info.render.points+=r.__webglParticleCount)
}},this.render=function(e,t,i,n){if(!1==t instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var r,o,a,s,h=e.__lights,p=e.fog;for(Z=-1,St=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),bt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Tt.setFromMatrix(bt),this.autoUpdateObjects&&this.initWebGLObjects(e),c(this.renderPluginsPre,e,t),$.info.render.calls=0,$.info.render.vertices=0,$.info.render.faces=0,$.info.render.points=0,this.setRenderTarget(i),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),s=e.__webglObjects,n=0,r=s.length;r>n;n++)if(o=s[n],a=o.object,o.id=n,o.render=!1,a.visible&&(!(a instanceof THREE.Mesh||a instanceof THREE.ParticleSystem)||!a.frustumCulled||Tt.intersectsObject(a))){var f=a;f._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,f.matrixWorld),f._normalMatrix.getNormalMatrix(f._modelViewMatrix);var f=o,m=f.buffer,g=void 0,v=g=void 0,v=f.object.material;v instanceof THREE.MeshFaceMaterial?(g=m.materialIndex,g=v.materials[g],g.transparent?(f.transparent=g,f.opaque=null):(f.opaque=g,f.transparent=null)):(g=v)&&(g.transparent?(f.transparent=g,f.opaque=null):(f.opaque=g,f.transparent=null)),o.render=!0,!0===this.sortObjects&&(null!==a.renderDepth?o.z=a.renderDepth:(Rt.getPositionFromMatrix(a.matrixWorld),Rt.applyProjection(bt),o.z=Rt.z))}for(this.sortObjects&&s.sort(l),s=e.__webglObjectsImmediate,n=0,r=s.length;r>n;n++)o=s[n],a=o.object,a.visible&&(a._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,a.matrixWorld),a._normalMatrix.getNormalMatrix(a._modelViewMatrix),a=o.object.material,a.transparent?(o.transparent=a,o.opaque=null):(o.opaque=a,o.transparent=null));e.overrideMaterial?(n=e.overrideMaterial,this.setBlending(n.blending,n.blendEquation,n.blendSrc,n.blendDst),this.setDepthTest(n.depthTest),this.setDepthWrite(n.depthWrite),w(n.polygonOffset,n.polygonOffsetFactor,n.polygonOffsetUnits),d(e.__webglObjects,!1,"",t,h,p,!0,n),u(e.__webglObjectsImmediate,"",t,h,p,!1,n)):(n=null,this.setBlending(THREE.NoBlending),d(e.__webglObjects,!0,"opaque",t,h,p,!1,n),u(e.__webglObjectsImmediate,"opaque",t,h,p,!1,n),d(e.__webglObjects,!1,"transparent",t,h,p,!0,n),u(e.__webglObjectsImmediate,"transparent",t,h,p,!0,n)),c(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&(i instanceof THREE.WebGLRenderTargetCube?(U.bindTexture(U.TEXTURE_CUBE_MAP,i.__webglTexture),U.generateMipmap(U.TEXTURE_CUBE_MAP),U.bindTexture(U.TEXTURE_CUBE_MAP,null)):(U.bindTexture(U.TEXTURE_2D,i.__webglTexture),U.generateMipmap(U.TEXTURE_2D),U.bindTexture(U.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,i,n,r){var o=x(e,t,i,n,r);J=-1,$.setMaterialFaces(n),r.immediateRenderCallback?r.immediateRenderCallback(o,U,Tt):r.render(function(e){$.renderBufferImmediate(e,o,n)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)p(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)v(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,a=e.__webglObjects.length;a>t;t++){var s=e.__webglObjects[t].object;void 0===s.__webglInit&&(void 0!==s.__webglActive&&v(s,e),p(s,e));var l=s,c=l.geometry,d=void 0,u=void 0,f=void 0;if(c instanceof THREE.BufferGeometry){var E=U.DYNAMIC_DRAW,y=!c.dynamic,x=c.attributes,T=void 0,b=void 0;for(T in x)b=x[T],b.needsUpdate&&("index"===T?(U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,b.buffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,b.array,E)):(U.bindBuffer(U.ARRAY_BUFFER,b.buffer),U.bufferData(U.ARRAY_BUFFER,b.array,E)),b.needsUpdate=!1),y&&!b.dynamic&&(b.array=null)}else if(l instanceof THREE.Mesh){for(var _=0,R=c.geometryGroupsList.length;R>_;_++)if(d=c.geometryGroupsList[_],f=n(l,d),c.buffersNeedUpdate&&i(d,l),u=f.attributes&&m(f),c.verticesNeedUpdate||c.morphTargetsNeedUpdate||c.elementsNeedUpdate||c.uvsNeedUpdate||c.normalsNeedUpdate||c.colorsNeedUpdate||c.tangentsNeedUpdate||u){var w=d,S=l,H=U.DYNAMIC_DRAW,M=!c.dynamic,C=f;if(w.__inittedArrays){var D=r(C),A=C.vertexColors?C.vertexColors:!1,I=o(C),P=D===THREE.SmoothShading,L=void 0,k=void 0,O=void 0,N=void 0,z=void 0,V=void 0,F=void 0,B=void 0,G=void 0,W=void 0,j=void 0,$=void 0,X=void 0,Y=void 0,K=void 0,q=void 0,Z=void 0,J=void 0,Q=void 0,et=void 0,tt=void 0,it=void 0,nt=void 0,rt=void 0,ot=void 0,at=void 0,st=void 0,lt=void 0,ht=void 0,ct=void 0,dt=void 0,ut=void 0,pt=void 0,ft=void 0,mt=void 0,gt=void 0,vt=void 0,Et=void 0,yt=void 0,xt=void 0,Tt=0,wt=0,St=0,Ht=0,Mt=0,Ct=0,Dt=0,At=0,It=0,Pt=0,Lt=0,kt=0,Ot=void 0,Nt=w.__vertexArray,zt=w.__uvArray,Vt=w.__uv2Array,Ft=w.__normalArray,Ut=w.__tangentArray,Bt=w.__colorArray,Gt=w.__skinIndexArray,Wt=w.__skinWeightArray,jt=w.__morphTargetsArrays,$t=w.__morphNormalsArrays,Xt=w.__webglCustomAttributesList,Yt=void 0,Kt=w.__faceArray,qt=w.__lineArray,Zt=S.geometry,Jt=Zt.elementsNeedUpdate,Qt=Zt.uvsNeedUpdate,ei=Zt.normalsNeedUpdate,ti=Zt.tangentsNeedUpdate,ii=Zt.colorsNeedUpdate,ni=Zt.morphTargetsNeedUpdate,ri=Zt.vertices,oi=w.faces3,ai=Zt.faces,si=Zt.faceVertexUvs[0],li=Zt.faceVertexUvs[1],hi=Zt.skinIndices,ci=Zt.skinWeights,di=Zt.morphTargets,ui=Zt.morphNormals;if(Zt.verticesNeedUpdate){for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],$=ri[N.a],X=ri[N.b],Y=ri[N.c],Nt[wt]=$.x,Nt[wt+1]=$.y,Nt[wt+2]=$.z,Nt[wt+3]=X.x,Nt[wt+4]=X.y,Nt[wt+5]=X.z,Nt[wt+6]=Y.x,Nt[wt+7]=Y.y,Nt[wt+8]=Y.z,wt+=9;U.bindBuffer(U.ARRAY_BUFFER,w.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,Nt,H)}if(ni)for(mt=0,gt=di.length;gt>mt;mt++){for(L=Lt=0,k=oi.length;k>L;L++)yt=oi[L],N=ai[yt],$=di[mt].vertices[N.a],X=di[mt].vertices[N.b],Y=di[mt].vertices[N.c],vt=jt[mt],vt[Lt]=$.x,vt[Lt+1]=$.y,vt[Lt+2]=$.z,vt[Lt+3]=X.x,vt[Lt+4]=X.y,vt[Lt+5]=X.z,vt[Lt+6]=Y.x,vt[Lt+7]=Y.y,vt[Lt+8]=Y.z,C.morphNormals&&(P?(xt=ui[mt].vertexNormals[yt],J=xt.a,Q=xt.b,et=xt.c):et=Q=J=ui[mt].faceNormals[yt],Et=$t[mt],Et[Lt]=J.x,Et[Lt+1]=J.y,Et[Lt+2]=J.z,Et[Lt+3]=Q.x,Et[Lt+4]=Q.y,Et[Lt+5]=Q.z,Et[Lt+6]=et.x,Et[Lt+7]=et.y,Et[Lt+8]=et.z),Lt+=9;U.bindBuffer(U.ARRAY_BUFFER,w.__webglMorphTargetsBuffers[mt]),U.bufferData(U.ARRAY_BUFFER,jt[mt],H),C.morphNormals&&(U.bindBuffer(U.ARRAY_BUFFER,w.__webglMorphNormalsBuffers[mt]),U.bufferData(U.ARRAY_BUFFER,$t[mt],H))}if(ci.length){for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],rt=ci[N.a],ot=ci[N.b],at=ci[N.c],Wt[Pt]=rt.x,Wt[Pt+1]=rt.y,Wt[Pt+2]=rt.z,Wt[Pt+3]=rt.w,Wt[Pt+4]=ot.x,Wt[Pt+5]=ot.y,Wt[Pt+6]=ot.z,Wt[Pt+7]=ot.w,Wt[Pt+8]=at.x,Wt[Pt+9]=at.y,Wt[Pt+10]=at.z,Wt[Pt+11]=at.w,st=hi[N.a],lt=hi[N.b],ht=hi[N.c],Gt[Pt]=st.x,Gt[Pt+1]=st.y,Gt[Pt+2]=st.z,Gt[Pt+3]=st.w,Gt[Pt+4]=lt.x,Gt[Pt+5]=lt.y,Gt[Pt+6]=lt.z,Gt[Pt+7]=lt.w,Gt[Pt+8]=ht.x,Gt[Pt+9]=ht.y,Gt[Pt+10]=ht.z,Gt[Pt+11]=ht.w,Pt+=12;Pt>0&&(U.bindBuffer(U.ARRAY_BUFFER,w.__webglSkinIndicesBuffer),U.bufferData(U.ARRAY_BUFFER,Gt,H),U.bindBuffer(U.ARRAY_BUFFER,w.__webglSkinWeightsBuffer),U.bufferData(U.ARRAY_BUFFER,Wt,H))}if(ii&&A){for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],F=N.vertexColors,B=N.color,3===F.length&&A===THREE.VertexColors?(tt=F[0],it=F[1],nt=F[2]):nt=it=tt=B,Bt[It]=tt.r,Bt[It+1]=tt.g,Bt[It+2]=tt.b,Bt[It+3]=it.r,Bt[It+4]=it.g,Bt[It+5]=it.b,Bt[It+6]=nt.r,Bt[It+7]=nt.g,Bt[It+8]=nt.b,It+=9;It>0&&(U.bindBuffer(U.ARRAY_BUFFER,w.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,Bt,H))}if(ti&&Zt.hasTangents){for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],G=N.vertexTangents,K=G[0],q=G[1],Z=G[2],Ut[Dt]=K.x,Ut[Dt+1]=K.y,Ut[Dt+2]=K.z,Ut[Dt+3]=K.w,Ut[Dt+4]=q.x,Ut[Dt+5]=q.y,Ut[Dt+6]=q.z,Ut[Dt+7]=q.w,Ut[Dt+8]=Z.x,Ut[Dt+9]=Z.y,Ut[Dt+10]=Z.z,Ut[Dt+11]=Z.w,Dt+=12;U.bindBuffer(U.ARRAY_BUFFER,w.__webglTangentBuffer),U.bufferData(U.ARRAY_BUFFER,Ut,H)}if(ei&&D){for(L=0,k=oi.length;k>L;L++)if(N=ai[oi[L]],z=N.vertexNormals,V=N.normal,3===z.length&&P)for(ct=0;3>ct;ct++)ut=z[ct],Ft[Ct]=ut.x,Ft[Ct+1]=ut.y,Ft[Ct+2]=ut.z,Ct+=3;else for(ct=0;3>ct;ct++)Ft[Ct]=V.x,Ft[Ct+1]=V.y,Ft[Ct+2]=V.z,Ct+=3;U.bindBuffer(U.ARRAY_BUFFER,w.__webglNormalBuffer),U.bufferData(U.ARRAY_BUFFER,Ft,H)}if(Qt&&si&&I){for(L=0,k=oi.length;k>L;L++)if(O=oi[L],W=si[O],void 0!==W)for(ct=0;3>ct;ct++)pt=W[ct],zt[St]=pt.x,zt[St+1]=pt.y,St+=2;St>0&&(U.bindBuffer(U.ARRAY_BUFFER,w.__webglUVBuffer),U.bufferData(U.ARRAY_BUFFER,zt,H))}if(Qt&&li&&I){for(L=0,k=oi.length;k>L;L++)if(O=oi[L],j=li[O],void 0!==j)for(ct=0;3>ct;ct++)ft=j[ct],Vt[Ht]=ft.x,Vt[Ht+1]=ft.y,Ht+=2;Ht>0&&(U.bindBuffer(U.ARRAY_BUFFER,w.__webglUV2Buffer),U.bufferData(U.ARRAY_BUFFER,Vt,H))}if(Jt){for(L=0,k=oi.length;k>L;L++)Kt[Mt]=Tt,Kt[Mt+1]=Tt+1,Kt[Mt+2]=Tt+2,Mt+=3,qt[At]=Tt,qt[At+1]=Tt+1,qt[At+2]=Tt,qt[At+3]=Tt+2,qt[At+4]=Tt+1,qt[At+5]=Tt+2,At+=6,Tt+=3;U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,Kt,H),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,w.__webglLineBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,qt,H)}if(Xt)for(ct=0,dt=Xt.length;dt>ct;ct++)if(Yt=Xt[ct],Yt.__original.needsUpdate){if(kt=0,1===Yt.size){if(void 0===Yt.boundTo||"vertices"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],Yt.array[kt]=Yt.value[N.a],Yt.array[kt+1]=Yt.value[N.b],Yt.array[kt+2]=Yt.value[N.c],kt+=3;else if("faces"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)Ot=Yt.value[oi[L]],Yt.array[kt]=Ot,Yt.array[kt+1]=Ot,Yt.array[kt+2]=Ot,kt+=3}else if(2===Yt.size){if(void 0===Yt.boundTo||"vertices"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],$=Yt.value[N.a],X=Yt.value[N.b],Y=Yt.value[N.c],Yt.array[kt]=$.x,Yt.array[kt+1]=$.y,Yt.array[kt+2]=X.x,Yt.array[kt+3]=X.y,Yt.array[kt+4]=Y.x,Yt.array[kt+5]=Y.y,kt+=6;else if("faces"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)Y=X=$=Ot=Yt.value[oi[L]],Yt.array[kt]=$.x,Yt.array[kt+1]=$.y,Yt.array[kt+2]=X.x,Yt.array[kt+3]=X.y,Yt.array[kt+4]=Y.x,Yt.array[kt+5]=Y.y,kt+=6}else if(3===Yt.size){var pi;if(pi="c"===Yt.type?["r","g","b"]:["x","y","z"],void 0===Yt.boundTo||"vertices"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],$=Yt.value[N.a],X=Yt.value[N.b],Y=Yt.value[N.c],Yt.array[kt]=$[pi[0]],Yt.array[kt+1]=$[pi[1]],Yt.array[kt+2]=$[pi[2]],Yt.array[kt+3]=X[pi[0]],Yt.array[kt+4]=X[pi[1]],Yt.array[kt+5]=X[pi[2]],Yt.array[kt+6]=Y[pi[0]],Yt.array[kt+7]=Y[pi[1]],Yt.array[kt+8]=Y[pi[2]],kt+=9;else if("faces"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)Y=X=$=Ot=Yt.value[oi[L]],Yt.array[kt]=$[pi[0]],Yt.array[kt+1]=$[pi[1]],Yt.array[kt+2]=$[pi[2]],Yt.array[kt+3]=X[pi[0]],Yt.array[kt+4]=X[pi[1]],Yt.array[kt+5]=X[pi[2]],Yt.array[kt+6]=Y[pi[0]],Yt.array[kt+7]=Y[pi[1]],Yt.array[kt+8]=Y[pi[2]],kt+=9;else if("faceVertices"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)Ot=Yt.value[oi[L]],$=Ot[0],X=Ot[1],Y=Ot[2],Yt.array[kt]=$[pi[0]],Yt.array[kt+1]=$[pi[1]],Yt.array[kt+2]=$[pi[2]],Yt.array[kt+3]=X[pi[0]],Yt.array[kt+4]=X[pi[1]],Yt.array[kt+5]=X[pi[2]],Yt.array[kt+6]=Y[pi[0]],Yt.array[kt+7]=Y[pi[1]],Yt.array[kt+8]=Y[pi[2]],kt+=9}else if(4===Yt.size)if(void 0===Yt.boundTo||"vertices"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)N=ai[oi[L]],$=Yt.value[N.a],X=Yt.value[N.b],Y=Yt.value[N.c],Yt.array[kt]=$.x,Yt.array[kt+1]=$.y,Yt.array[kt+2]=$.z,Yt.array[kt+3]=$.w,Yt.array[kt+4]=X.x,Yt.array[kt+5]=X.y,Yt.array[kt+6]=X.z,Yt.array[kt+7]=X.w,Yt.array[kt+8]=Y.x,Yt.array[kt+9]=Y.y,Yt.array[kt+10]=Y.z,Yt.array[kt+11]=Y.w,kt+=12;else if("faces"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)Y=X=$=Ot=Yt.value[oi[L]],Yt.array[kt]=$.x,Yt.array[kt+1]=$.y,Yt.array[kt+2]=$.z,Yt.array[kt+3]=$.w,Yt.array[kt+4]=X.x,Yt.array[kt+5]=X.y,Yt.array[kt+6]=X.z,Yt.array[kt+7]=X.w,Yt.array[kt+8]=Y.x,Yt.array[kt+9]=Y.y,Yt.array[kt+10]=Y.z,Yt.array[kt+11]=Y.w,kt+=12;else if("faceVertices"===Yt.boundTo)for(L=0,k=oi.length;k>L;L++)Ot=Yt.value[oi[L]],$=Ot[0],X=Ot[1],Y=Ot[2],Yt.array[kt]=$.x,Yt.array[kt+1]=$.y,Yt.array[kt+2]=$.z,Yt.array[kt+3]=$.w,Yt.array[kt+4]=X.x,Yt.array[kt+5]=X.y,Yt.array[kt+6]=X.z,Yt.array[kt+7]=X.w,Yt.array[kt+8]=Y.x,Yt.array[kt+9]=Y.y,Yt.array[kt+10]=Y.z,Yt.array[kt+11]=Y.w,kt+=12;U.bindBuffer(U.ARRAY_BUFFER,Yt.buffer),U.bufferData(U.ARRAY_BUFFER,Yt.array,H)}M&&(delete w.__inittedArrays,delete w.__colorArray,delete w.__normalArray,delete w.__tangentArray,delete w.__uvArray,delete w.__uv2Array,delete w.__faceArray,delete w.__vertexArray,delete w.__lineArray,delete w.__skinIndexArray,delete w.__skinWeightArray)}}c.verticesNeedUpdate=!1,c.morphTargetsNeedUpdate=!1,c.elementsNeedUpdate=!1,c.uvsNeedUpdate=!1,c.normalsNeedUpdate=!1,c.colorsNeedUpdate=!1,c.tangentsNeedUpdate=!1,c.buffersNeedUpdate=!1,f.attributes&&g(f)}else if(l instanceof THREE.Line){if(f=n(l,c),u=f.attributes&&m(f),c.verticesNeedUpdate||c.colorsNeedUpdate||c.lineDistancesNeedUpdate||u){var fi=c,mi=U.DYNAMIC_DRAW,gi=void 0,vi=void 0,Ei=void 0,yi=void 0,xi=void 0,Ti=void 0,bi=fi.vertices,_i=fi.colors,Ri=fi.lineDistances,wi=bi.length,Si=_i.length,Hi=Ri.length,Mi=fi.__vertexArray,Ci=fi.__colorArray,Di=fi.__lineDistanceArray,Ai=fi.colorsNeedUpdate,Ii=fi.lineDistancesNeedUpdate,Pi=fi.__webglCustomAttributesList,Li=void 0,ki=void 0,Oi=void 0,Ni=void 0,zi=void 0,Vi=void 0;if(fi.verticesNeedUpdate){for(gi=0;wi>gi;gi++)yi=bi[gi],xi=3*gi,Mi[xi]=yi.x,Mi[xi+1]=yi.y,Mi[xi+2]=yi.z;U.bindBuffer(U.ARRAY_BUFFER,fi.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,Mi,mi)}if(Ai){for(vi=0;Si>vi;vi++)Ti=_i[vi],xi=3*vi,Ci[xi]=Ti.r,Ci[xi+1]=Ti.g,Ci[xi+2]=Ti.b;U.bindBuffer(U.ARRAY_BUFFER,fi.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,Ci,mi)}if(Ii){for(Ei=0;Hi>Ei;Ei++)Di[Ei]=Ri[Ei];U.bindBuffer(U.ARRAY_BUFFER,fi.__webglLineDistanceBuffer),U.bufferData(U.ARRAY_BUFFER,Di,mi)}if(Pi)for(Li=0,ki=Pi.length;ki>Li;Li++)if(Vi=Pi[Li],Vi.needsUpdate&&(void 0===Vi.boundTo||"vertices"===Vi.boundTo)){if(xi=0,Ni=Vi.value.length,1===Vi.size)for(Oi=0;Ni>Oi;Oi++)Vi.array[Oi]=Vi.value[Oi];else if(2===Vi.size)for(Oi=0;Ni>Oi;Oi++)zi=Vi.value[Oi],Vi.array[xi]=zi.x,Vi.array[xi+1]=zi.y,xi+=2;else if(3===Vi.size)if("c"===Vi.type)for(Oi=0;Ni>Oi;Oi++)zi=Vi.value[Oi],Vi.array[xi]=zi.r,Vi.array[xi+1]=zi.g,Vi.array[xi+2]=zi.b,xi+=3;else for(Oi=0;Ni>Oi;Oi++)zi=Vi.value[Oi],Vi.array[xi]=zi.x,Vi.array[xi+1]=zi.y,Vi.array[xi+2]=zi.z,xi+=3;else if(4===Vi.size)for(Oi=0;Ni>Oi;Oi++)zi=Vi.value[Oi],Vi.array[xi]=zi.x,Vi.array[xi+1]=zi.y,Vi.array[xi+2]=zi.z,Vi.array[xi+3]=zi.w,xi+=4;U.bindBuffer(U.ARRAY_BUFFER,Vi.buffer),U.bufferData(U.ARRAY_BUFFER,Vi.array,mi)}}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,c.lineDistancesNeedUpdate=!1,f.attributes&&g(f)}else if(l instanceof THREE.ParticleSystem){if(f=n(l,c),u=f.attributes&&m(f),c.verticesNeedUpdate||c.colorsNeedUpdate||l.sortParticles||u){var Fi=c,Ui=U.DYNAMIC_DRAW,Bi=l,Gi=void 0,Wi=void 0,ji=void 0,$i=void 0,Xi=void 0,Yi=void 0,Ki=Fi.vertices,qi=Ki.length,Zi=Fi.colors,Ji=Zi.length,Qi=Fi.__vertexArray,en=Fi.__colorArray,tn=Fi.__sortArray,nn=Fi.verticesNeedUpdate,rn=Fi.colorsNeedUpdate,on=Fi.__webglCustomAttributesList,an=void 0,sn=void 0,ln=void 0,hn=void 0,cn=void 0,dn=void 0;if(Bi.sortParticles){for(_t.copy(bt),_t.multiply(Bi.matrixWorld),Gi=0;qi>Gi;Gi++)ji=Ki[Gi],Rt.copy(ji),Rt.applyProjection(_t),tn[Gi]=[Rt.z,Gi];for(tn.sort(h),Gi=0;qi>Gi;Gi++)ji=Ki[tn[Gi][1]],$i=3*Gi,Qi[$i]=ji.x,Qi[$i+1]=ji.y,Qi[$i+2]=ji.z;for(Wi=0;Ji>Wi;Wi++)$i=3*Wi,Yi=Zi[tn[Wi][1]],en[$i]=Yi.r,en[$i+1]=Yi.g,en[$i+2]=Yi.b;if(on)for(an=0,sn=on.length;sn>an;an++)if(dn=on[an],void 0===dn.boundTo||"vertices"===dn.boundTo)if($i=0,hn=dn.value.length,1===dn.size)for(ln=0;hn>ln;ln++)Xi=tn[ln][1],dn.array[ln]=dn.value[Xi];else if(2===dn.size)for(ln=0;hn>ln;ln++)Xi=tn[ln][1],cn=dn.value[Xi],dn.array[$i]=cn.x,dn.array[$i+1]=cn.y,$i+=2;else if(3===dn.size)if("c"===dn.type)for(ln=0;hn>ln;ln++)Xi=tn[ln][1],cn=dn.value[Xi],dn.array[$i]=cn.r,dn.array[$i+1]=cn.g,dn.array[$i+2]=cn.b,$i+=3;else for(ln=0;hn>ln;ln++)Xi=tn[ln][1],cn=dn.value[Xi],dn.array[$i]=cn.x,dn.array[$i+1]=cn.y,dn.array[$i+2]=cn.z,$i+=3;else if(4===dn.size)for(ln=0;hn>ln;ln++)Xi=tn[ln][1],cn=dn.value[Xi],dn.array[$i]=cn.x,dn.array[$i+1]=cn.y,dn.array[$i+2]=cn.z,dn.array[$i+3]=cn.w,$i+=4}else{if(nn)for(Gi=0;qi>Gi;Gi++)ji=Ki[Gi],$i=3*Gi,Qi[$i]=ji.x,Qi[$i+1]=ji.y,Qi[$i+2]=ji.z;if(rn)for(Wi=0;Ji>Wi;Wi++)Yi=Zi[Wi],$i=3*Wi,en[$i]=Yi.r,en[$i+1]=Yi.g,en[$i+2]=Yi.b;if(on)for(an=0,sn=on.length;sn>an;an++)if(dn=on[an],dn.needsUpdate&&(void 0===dn.boundTo||"vertices"===dn.boundTo))if(hn=dn.value.length,$i=0,1===dn.size)for(ln=0;hn>ln;ln++)dn.array[ln]=dn.value[ln];else if(2===dn.size)for(ln=0;hn>ln;ln++)cn=dn.value[ln],dn.array[$i]=cn.x,dn.array[$i+1]=cn.y,$i+=2;else if(3===dn.size)if("c"===dn.type)for(ln=0;hn>ln;ln++)cn=dn.value[ln],dn.array[$i]=cn.r,dn.array[$i+1]=cn.g,dn.array[$i+2]=cn.b,$i+=3;else for(ln=0;hn>ln;ln++)cn=dn.value[ln],dn.array[$i]=cn.x,dn.array[$i+1]=cn.y,dn.array[$i+2]=cn.z,$i+=3;else if(4===dn.size)for(ln=0;hn>ln;ln++)cn=dn.value[ln],dn.array[$i]=cn.x,dn.array[$i+1]=cn.y,dn.array[$i+2]=cn.z,dn.array[$i+3]=cn.w,$i+=4}if((nn||Bi.sortParticles)&&(U.bindBuffer(U.ARRAY_BUFFER,Fi.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,Qi,Ui)),(rn||Bi.sortParticles)&&(U.bindBuffer(U.ARRAY_BUFFER,Fi.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,en,Ui)),on)for(an=0,sn=on.length;sn>an;an++)dn=on[an],(dn.needsUpdate||Bi.sortParticles)&&(U.bindBuffer(U.ARRAY_BUFFER,dn.buffer),U.bufferData(U.ARRAY_BUFFER,dn.array,Ui))}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,f.attributes&&g(f)}}},this.initMaterial=function(e,t,i,n){var r,o,a,s;e.addEventListener("dispose",jt);var l,h,c,d,u;if(e instanceof THREE.MeshDepthMaterial?u="depth":e instanceof THREE.MeshNormalMaterial?u="normal":e instanceof THREE.MeshBasicMaterial?u="basic":e instanceof THREE.MeshLambertMaterial?u="lambert":e instanceof THREE.MeshPhongMaterial?u="phong":e instanceof THREE.LineBasicMaterial?u="basic":e instanceof THREE.LineDashedMaterial?u="dashed":e instanceof THREE.ParticleSystemMaterial&&(u="particle_basic"),u){var p=THREE.ShaderLib[u];e.uniforms=THREE.UniformsUtils.clone(p.uniforms),e.vertexShader=p.vertexShader,e.fragmentShader=p.fragmentShader}var f=r=0,m=0,g=p=0;for(o=t.length;o>g;g++)a=t[g],a.onlyShadow||(a instanceof THREE.DirectionalLight&&r++,a instanceof THREE.PointLight&&f++,a instanceof THREE.SpotLight&&m++,a instanceof THREE.HemisphereLight&&p++);for(o=f,a=m,s=p,m=p=0,f=t.length;f>m;m++)g=t[m],g.castShadow&&(g instanceof THREE.SpotLight&&p++,g instanceof THREE.DirectionalLight&&!g.shadowCascade&&p++);d=p,kt&&n&&n.useVertexTexture?c=1024:(t=U.getParameter(U.MAX_VERTEX_UNIFORM_VECTORS),t=Math.floor((t-20)/4),void 0!==n&&n instanceof THREE.SkinnedMesh&&(t=Math.min(n.bones.length,t),t<n.bones.length&&console.warn("WebGLRenderer: too many bones - "+n.bones.length+", this GPU supports just "+t+" (try OpenGL instead of ANGLE)")),c=t);e:{var v,E,y,m=e.fragmentShader,f=e.vertexShader,p=e.uniforms,t=e.attributes,g=e.defines,i={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:c,useVertexTexture:kt&&n&&n.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:r,maxPointLights:o,maxSpotLights:a,maxHemiLights:s,maxShadows:d,shadowMapEnabled:this.shadowMapEnabled&&n.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},n=e.index0AttributeName;r=[],u?r.push(u):(r.push(m),r.push(f));for(E in g)r.push(E),r.push(g[E]);for(v in i)r.push(v),r.push(i[v]);for(u=r.join(),v=0,E=X.length;E>v;v++)if(r=X[v],r.code===u){r.usedTimes++,h=r.program;break e}v="SHADOWMAP_TYPE_BASIC",i.shadowMapType===THREE.PCFShadowMap?v="SHADOWMAP_TYPE_PCF":i.shadowMapType===THREE.PCFSoftShadowMap&&(v="SHADOWMAP_TYPE_PCF_SOFT"),E=[];for(y in g)r=g[y],!1!==r&&(r="#define "+y+" "+r,E.push(r));r=E.join("\n"),y=U.createProgram(),E=["precision "+P+" float;","precision "+P+" int;",r,Lt?"#define VERTEX_TEXTURES":"",$.gammaInput?"#define GAMMA_INPUT":"",$.gammaOutput?"#define GAMMA_OUTPUT":"",$.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+v:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),v=["precision "+P+" float;","precision "+P+" int;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",r,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",$.gammaInput?"#define GAMMA_INPUT":"",$.gammaOutput?"#define GAMMA_OUTPUT":"",$.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+v:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),E=H("vertex",E+f),v=H("fragment",v+m),U.attachShader(y,E),U.attachShader(y,v),n&&U.bindAttribLocation(y,0,n),U.linkProgram(y),U.getProgramParameter(y,U.LINK_STATUS)||(console.error("Could not initialise shader\nVALIDATE_STATUS: "+U.getProgramParameter(y,U.VALIDATE_STATUS)+", gl error ["+U.getError()+"]"),console.error("Program Info Log: "+U.getProgramInfoLog(y))),U.deleteShader(v),U.deleteShader(E),y.uniforms={},y.attributes={};var x;v="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),i.useVertexTexture?(v.push("boneTexture"),v.push("boneTextureWidth"),v.push("boneTextureHeight")):v.push("boneGlobalMatrices");for(x in p)v.push(x);for(x=v,v=0,E=x.length;E>v;v++)p=x[v],y.uniforms[p]=U.getUniformLocation(y,p);for(v="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" "),x=0;x<i.maxMorphTargets;x++)v.push("morphTarget"+x);for(x=0;x<i.maxMorphNormals;x++)v.push("morphNormal"+x);for(h in t)v.push(h);for(h=v,x=0,t=h.length;t>x;x++)v=h[x],y.attributes[v]=U.getAttribLocation(y,v);y.id=Y++,X.push({program:y,code:u,usedTimes:1}),$.info.memory.programs=X.length,h=y}if(e.program=h,x=e.program.attributes,e.morphTargets)for(e.numSupportedMorphTargets=0,t="morphTarget",h=0;h<this.maxMorphTargets;h++)y=t+h,0<=x[y]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(e.numSupportedMorphNormals=0,t="morphNormal",h=0;h<this.maxMorphNormals;h++)y=t+h,0<=x[y]&&e.numSupportedMorphNormals++;e.uniformsList=[];for(l in e.uniforms)e.uniformsList.push([e.uniforms[l],l])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?U.disable(U.CULL_FACE):(t===THREE.FrontFaceDirectionCW?U.frontFace(U.CW):U.frontFace(U.CCW),e===THREE.CullFaceBack?U.cullFace(U.BACK):e===THREE.CullFaceFront?U.cullFace(U.FRONT):U.cullFace(U.FRONT_AND_BACK),U.enable(U.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,e=e.side===THREE.BackSide;it!==t&&(t?U.disable(U.CULL_FACE):U.enable(U.CULL_FACE),it=t),nt!==e&&(e?U.frontFace(U.CW):U.frontFace(U.CCW),nt=e)},this.setDepthTest=function(e){lt!==e&&(e?U.enable(U.DEPTH_TEST):U.disable(U.DEPTH_TEST),lt=e)},this.setDepthWrite=function(e){ht!==e&&(U.depthMask(e),ht=e)},this.setBlending=function(e,t,i,n){e!==rt&&(e===THREE.NoBlending?U.disable(U.BLEND):e===THREE.AdditiveBlending?(U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE)):e===THREE.SubtractiveBlending?(U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.SRC_COLOR)):e===THREE.CustomBlending?U.enable(U.BLEND):(U.enable(U.BLEND),U.blendEquationSeparate(U.FUNC_ADD,U.FUNC_ADD),U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA)),rt=e),e===THREE.CustomBlending?(t!==ot&&(U.blendEquation(A(t)),ot=t),(i!==at||n!==st)&&(U.blendFunc(A(i),A(n)),at=i,st=n)):st=at=ot=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Gt),e.__webglTexture=U.createTexture(),$.info.memory.textures++),U.activeTexture(U.TEXTURE0+t),U.bindTexture(U.TEXTURE_2D,e.__webglTexture),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,e.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,n=0===(i.width&i.width-1)&&0===(i.height&i.height-1),r=A(e.format),o=A(e.type);M(U.TEXTURE_2D,e,n);var a=e.mipmaps;if(e instanceof THREE.DataTexture)if(0<a.length&&n){for(var s=0,l=a.length;l>s;s++)i=a[s],U.texImage2D(U.TEXTURE_2D,s,r,i.width,i.height,0,r,o,i.data);e.generateMipmaps=!1}else U.texImage2D(U.TEXTURE_2D,0,r,i.width,i.height,0,r,o,i.data);else if(e instanceof THREE.CompressedTexture)for(s=0,l=a.length;l>s;s++)i=a[s],e.format!==THREE.RGBAFormat?U.compressedTexImage2D(U.TEXTURE_2D,s,r,i.width,i.height,0,i.data):U.texImage2D(U.TEXTURE_2D,s,r,i.width,i.height,0,r,o,i.data);else if(0<a.length&&n){for(s=0,l=a.length;l>s;s++)i=a[s],U.texImage2D(U.TEXTURE_2D,s,r,r,o,i);e.generateMipmaps=!1}else U.texImage2D(U.TEXTURE_2D,0,r,r,o,e.image);e.generateMipmaps&&n&&U.generateMipmap(U.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else U.activeTexture(U.TEXTURE0+t),U.bindTexture(U.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Wt),e.__webglTexture=U.createTexture(),$.info.memory.textures++;var i=0===(e.width&e.width-1)&&0===(e.height&e.height-1),n=A(e.format),r=A(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],U.bindTexture(U.TEXTURE_CUBE_MAP,e.__webglTexture),M(U.TEXTURE_CUBE_MAP,e,i);for(var o=0;6>o;o++){e.__webglFramebuffer[o]=U.createFramebuffer(),e.__webglRenderbuffer[o]=U.createRenderbuffer(),U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n,e.width,e.height,0,n,r,null);var a=e,s=U.TEXTURE_CUBE_MAP_POSITIVE_X+o;U.bindFramebuffer(U.FRAMEBUFFER,e.__webglFramebuffer[o]),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,s,a.__webglTexture,0),C(e.__webglRenderbuffer[o],e)}i&&U.generateMipmap(U.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=U.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:U.createRenderbuffer(),U.bindTexture(U.TEXTURE_2D,e.__webglTexture),M(U.TEXTURE_2D,e,i),U.texImage2D(U.TEXTURE_2D,0,n,e.width,e.height,0,n,r,null),n=U.TEXTURE_2D,U.bindFramebuffer(U.FRAMEBUFFER,e.__webglFramebuffer),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,n,e.__webglTexture,0),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,e.__webglRenderbuffer):C(e.__webglRenderbuffer,e),i&&U.generateMipmap(U.TEXTURE_2D);t?U.bindTexture(U.TEXTURE_CUBE_MAP,null):U.bindTexture(U.TEXTURE_2D,null),U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,e=e.height,r=n=0):(t=null,i=gt,e=vt,n=ft,r=mt),t!==q&&(U.bindFramebuffer(U.FRAMEBUFFER,t),U.viewport(n,r,i,e),q=t),Et=i,yt=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.rotation=this.z=this.y=this.x=0,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(e,t,i){var n,r,o=e.vertices.length,a=t instanceof THREE.Mesh?t.geometry:t,s=e.vertices,l=a.vertices,h=e.faces,c=a.faces,e=e.faceVertexUvs[0],a=a.faceVertexUvs[0];
void 0===i&&(i=0),t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=(new THREE.Matrix3).getNormalMatrix(n));for(var t=0,d=l.length;d>t;t++){var u=l[t].clone();n&&u.applyMatrix4(n),s.push(u)}for(t=0,d=c.length;d>t;t++){var p,f,u=c[t],m=u.vertexNormals,g=u.vertexColors;for(p=new THREE.Face3(u.a+o,u.b+o,u.c+o),p.normal.copy(u.normal),r&&p.normal.applyMatrix3(r).normalize(),s=0,l=m.length;l>s;s++)f=m[s].clone(),r&&f.applyMatrix3(r).normalize(),p.vertexNormals.push(f);for(p.color.copy(u.color),s=0,l=g.length;l>s;s++)f=g[s],p.vertexColors.push(f.clone());p.materialIndex=u.materialIndex+i,p.centroid.copy(u.centroid),n&&p.centroid.applyMatrix4(n),h.push(p)}for(t=0,d=a.length;d>t;t++){for(i=a[t],n=[],s=0,l=i.length;l>s;s++)n.push(new THREE.Vector2(i[s].x,i[s].y));e.push(n)}},randomPointInTriangle:function(){var e=new THREE.Vector3;return function(t,i,n){var r=new THREE.Vector3,o=THREE.Math.random16(),a=THREE.Math.random16();o+a>1&&(o=1-o,a=1-a);var s=1-o-a;return r.copy(t),r.multiplyScalar(o),e.copy(i),e.multiplyScalar(a),r.add(e),e.copy(n),e.multiplyScalar(s),r.add(e),r}}(),randomPointInFace:function(e,t){return THREE.GeometryUtils.randomPointInTriangle(t.vertices[e.a],t.vertices[e.b],t.vertices[e.c])},randomPointsInGeometry:function(e,t){function i(e){function t(i,n){if(i>n)return i;var r=i+Math.floor((n-i)/2);return u[r]>e?t(i,r-1):u[r]<e?t(r+1,n):r}return t(0,u.length-1)}var n,r,o,a,s,l=e.faces,h=e.vertices,c=l.length,d=0,u=[];for(r=0;c>r;r++)n=l[r],o=h[n.a],a=h[n.b],s=h[n.c],n._area=THREE.GeometryUtils.triangleArea(o,a,s),d+=n._area,u[r]=d;for(n=[],r=0;t>r;r++)h=THREE.Math.random16()*d,h=i(h),n[r]=THREE.GeometryUtils.randomPointInFace(l[h],e,!0);return n},triangleArea:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n,r){return e.subVectors(n,i),t.subVectors(r,i),e.cross(t),.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new THREE.Vector3;return i.addVectors(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},triangulateQuads:function(e){var t,i,n,r,o=[],a=[];for(t=0,i=e.faceVertexUvs.length;i>t;t++)a[t]=[];for(t=0,i=e.faces.length;i>t;t++)for(o.push(e.faces[t]),n=0,r=e.faceVertexUvs.length;r>n;n++)a[n].push(e.faceVertexUvs[n][t]);e.faces=o,e.faceVertexUvs=a,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()}},THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i){var n=new THREE.ImageLoader;n.crossOrigin=this.crossOrigin;var r=new THREE.Texture(void 0,t),t=n.load(e,function(){r.needsUpdate=!0,i&&i(r)});return r.image=t,r.sourceFile=e,r},loadCompressedTexture:function(e,t,i,n){var r=new THREE.CompressedTexture;r.mapping=t;var o=new XMLHttpRequest;return o.onload=function(){var e=THREE.ImageUtils.parseDDS(o.response,!0);r.format=e.format,r.mipmaps=e.mipmaps,r.image.width=e.width,r.image.height=e.height,r.generateMipmaps=!1,r.needsUpdate=!0,i&&i(r)},o.onerror=n,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),r},loadTextureCube:function(e,t,i,n){var r=[];r.loadCount=0;var o=new THREE.Texture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1;for(var t=0,a=e.length;a>t;++t){var s=new Image;r[t]=s,s.onload=function(){r.loadCount+=1,6===r.loadCount&&(o.needsUpdate=!0,i&&i(o))},s.onerror=n,s.crossOrigin=this.crossOrigin,s.src=e[t]}return o},loadCompressedTextureCube:function(e,t,i,n){var r=[];r.loadCount=0;var o=new THREE.CompressedTexture;if(o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1,t=function(e,t){return function(){var n=THREE.ImageUtils.parseDDS(e.response,!0);t.format=n.format,t.mipmaps=n.mipmaps,t.width=n.width,t.height=n.height,r.loadCount+=1,6===r.loadCount&&(o.format=n.format,o.needsUpdate=!0,i&&i(o))}},e instanceof Array)for(var a=0,s=e.length;s>a;++a){var l={};r[a]=l;var h=new XMLHttpRequest;h.onload=t(h,l),h.onerror=n,l=e[a],h.open("GET",l,!0),h.responseType="arraybuffer",h.send(null)}else h=new XMLHttpRequest,h.onload=function(){var e=THREE.ImageUtils.parseDDS(h.response,!0);if(e.isCubemap){for(var t=e.mipmaps.length/e.mipmapCount,n=0;t>n;n++){r[n]={mipmaps:[]};for(var a=0;a<e.mipmapCount;a++)r[n].mipmaps.push(e.mipmaps[n*e.mipmapCount+a]),r[n].format=e.format,r[n].width=e.width,r[n].height=e.height}o.format=e.format,o.needsUpdate=!0,i&&i(o)}},h.onerror=n,h.open("GET",e,!0),h.responseType="arraybuffer",h.send(null);return o},loadDDSTexture:function(e,t,i,n){var r=[];r.loadCount=0;var o=new THREE.CompressedTexture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;var a=new XMLHttpRequest;return a.onload=function(){var e=THREE.ImageUtils.parseDDS(a.response,!0);if(e.isCubemap)for(var t=e.mipmaps.length/e.mipmapCount,n=0;t>n;n++){r[n]={mipmaps:[]};for(var s=0;s<e.mipmapCount;s++)r[n].mipmaps.push(e.mipmaps[n*e.mipmapCount+s]),r[n].format=e.format,r[n].width=e.width,r[n].height=e.height}else o.image.width=e.width,o.image.height=e.height,o.mipmaps=e.mipmaps;o.format=e.format,o.needsUpdate=!0,i&&i(o)},a.onerror=n,a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null),o},parseDDS:function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},r=i("DXT1"),o=i("DXT3"),a=i("DXT5"),s=new Int32Array(e,0,31);if(542327876!==s[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),n;if(4&!s[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),n;var l=s[21],h=!1;switch(l){case r:r=8,n.format=THREE.RGB_S3TC_DXT1_Format;break;case o:r=16,n.format=THREE.RGBA_S3TC_DXT3_Format;break;case a:r=16,n.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==s[22]&&16711680&s[23]&&65280&s[24]&&255&s[25]&&4278190080&s[26]))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(255&l,l>>8&255,l>>16&255,l>>24&255)),n;h=!0,r=64,n.format=THREE.RGBAFormat}n.mipmapCount=1,131072&s[2]&&!1!==t&&(n.mipmapCount=Math.max(1,s[7])),n.isCubemap=512&s[28]?!0:!1,n.width=s[4],n.height=s[3];for(var s=s[1]+4,o=n.width,a=n.height,l=n.isCubemap?6:1,c=0;l>c;c++){for(var d=0;d<n.mipmapCount;d++){if(h){var u;u=o;for(var p=a,f=4*u*p,m=new Uint8Array(e,s,f),f=new Uint8Array(f),g=0,v=0,E=0;p>E;E++)for(var y=0;u>y;y++){var x=m[v];v++;var T=m[v];v++;var b=m[v];v++;var _=m[v];v++,f[g]=b,g++,f[g]=T,g++,f[g]=x,g++,f[g]=_,g++}u=f,p=u.length}else p=Math.max(4,o)/4*Math.max(4,a)/4*r,u=new Uint8Array(e,s,p);n.mipmaps.push({data:u,width:o,height:a}),s+=p,o=Math.max(.5*o,1),a=Math.max(.5*a,1)}o=n.width,a=n.height}return n},getNormalMap:function(e,t){var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=1|t,n=e.width,r=e.height,o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");a.drawImage(e,0,0);for(var s=a.getImageData(0,0,n,r).data,l=a.createImageData(n,r),h=l.data,c=0;n>c;c++)for(var d=0;r>d;d++){var u=0>d-1?0:d-1,p=d+1>r-1?r-1:d+1,f=0>c-1?0:c-1,m=c+1>n-1?n-1:c+1,g=[],v=[0,0,s[4*(d*n+c)]/255*t];for(g.push([-1,0,s[4*(d*n+f)]/255*t]),g.push([-1,-1,s[4*(u*n+f)]/255*t]),g.push([0,-1,s[4*(u*n+c)]/255*t]),g.push([1,-1,s[4*(u*n+m)]/255*t]),g.push([1,0,s[4*(d*n+m)]/255*t]),g.push([1,1,s[4*(p*n+m)]/255*t]),g.push([0,1,s[4*(p*n+c)]/255*t]),g.push([-1,1,s[4*(p*n+f)]/255*t]),u=[],f=g.length,p=0;f>p;p++){var m=g[p],E=g[(p+1)%f],m=[m[0]-v[0],m[1]-v[1],m[2]-v[2]],E=[E[0]-v[0],E[1]-v[1],E[2]-v[2]];u.push(i([m[1]*E[2]-m[2]*E[1],m[2]*E[0]-m[0]*E[2],m[0]*E[1]-m[1]*E[0]]))}for(g=[0,0,0],p=0;p<u.length;p++)g[0]+=u[p][0],g[1]+=u[p][1],g[2]+=u[p][2];g[0]/=u.length,g[1]/=u.length,g[2]/=u.length,v=4*(d*n+c),h[v]=255*((g[0]+1)/2)|0,h[v+1]=255*((g[1]+1)/2)|0,h[v+2]=255*g[2]|0,h[v+3]=255}return a.putImageData(l,0,0),o},generateDataTexture:function(e,t,i){for(var n=e*t,r=new Uint8Array(3*n),o=Math.floor(255*i.r),a=Math.floor(255*i.g),i=Math.floor(255*i.b),s=0;n>s;s++)r[3*s]=o,r[3*s+1]=a,r[3*s+2]=i;return e=new THREE.DataTexture(r,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Object3D,n=0,r=t.length;r>n;n++)i.add(new THREE.Mesh(e,t[n]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var n=new THREE.Matrix4;n.getInverse(i.matrixWorld),e.applyMatrix(n),t.remove(e),i.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),i=this.size/t.resolution,n=0,r=String(e).split(""),o=r.length,a=[],e=0;o>e;e++){var s=new THREE.Path,s=this.extractGlyphPoints(r[e],t,i,n,s),n=n+s.offset;a.push(s.path)}return{paths:a,offset:n/2}},extractGlyphPoints:function(e,t,i,n,r){var o,a,s,l,h,c,d,u,p,f,m,g=[],v=t.glyphs[e]||t.glyphs["?"];if(v){if(v.o)for(t=v._cachedOutline||(v._cachedOutline=v.o.split(" ")),l=t.length,e=0;l>e;)switch(s=t[e++]){case"m":s=t[e++]*i+n,h=t[e++]*i,r.moveTo(s,h);break;case"l":s=t[e++]*i+n,h=t[e++]*i,r.lineTo(s,h);break;case"q":if(s=t[e++]*i+n,h=t[e++]*i,u=t[e++]*i+n,p=t[e++]*i,r.quadraticCurveTo(u,p,s,h),o=g[g.length-1])for(c=o.x,d=o.y,o=1,a=this.divisions;a>=o;o++){var E=o/a;THREE.Shape.Utils.b2(E,c,u,s),THREE.Shape.Utils.b2(E,d,p,h)}break;case"b":if(s=t[e++]*i+n,h=t[e++]*i,u=t[e++]*i+n,p=t[e++]*-i,f=t[e++]*i+n,m=t[e++]*-i,r.bezierCurveTo(s,h,u,p,f,m),o=g[g.length-1])for(c=o.x,d=o.y,o=1,a=this.divisions;a>=o;o++)E=o/a,THREE.Shape.Utils.b3(E,c,u,f,s),THREE.Shape.Utils.b3(E,d,p,m,h)}return{offset:v.ha*i,path:r}}}},THREE.FontUtils.generateShapes=function(e,t){var t=t||{},i=void 0!==t.curveSegments?t.curveSegments:4,n=void 0!==t.font?t.font:"helvetiker",r=void 0!==t.weight?t.weight:"normal",o=void 0!==t.style?t.style:"normal";for(THREE.FontUtils.size=void 0!==t.size?t.size:100,THREE.FontUtils.divisions=i,THREE.FontUtils.face=n,THREE.FontUtils.weight=r,THREE.FontUtils.style=o,i=THREE.FontUtils.drawText(e).paths,n=[],r=0,o=i.length;o>r;r++)Array.prototype.push.apply(n,i[r].toShapes());return n},function(e){var t=function(e){for(var t=e.length,i=0,n=t-1,r=0;t>r;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i};return e.Triangulate=function(e,i){var n=e.length;if(3>n)return null;var r,o,a,s=[],l=[],h=[];if(0<t(e))for(o=0;n>o;o++)l[o]=o;else for(o=0;n>o;o++)l[o]=n-1-o;var c=2*n;for(o=n-1;n>2;){if(0>=c--){console.log("Warning, unable to triangulate polygon!");break}r=o,r>=n&&(r=0),o=r+1,o>=n&&(o=0),a=o+1,a>=n&&(a=0);var d;e:{var u=d=void 0,p=void 0,f=void 0,m=void 0,g=void 0,v=void 0,E=void 0,y=void 0,u=e[l[r]].x,p=e[l[r]].y,f=e[l[o]].x,m=e[l[o]].y,g=e[l[a]].x,v=e[l[a]].y;if(1e-10>(f-u)*(v-p)-(m-p)*(g-u))d=!1;else{var x=void 0,T=void 0,b=void 0,_=void 0,R=void 0,w=void 0,S=void 0,H=void 0,M=void 0,C=void 0,M=H=S=y=E=void 0,x=g-f,T=v-m,b=u-g,_=p-v,R=f-u,w=m-p;for(d=0;n>d;d++)if(d!==r&&d!==o&&d!==a&&(E=e[l[d]].x,y=e[l[d]].y,S=E-u,H=y-p,M=E-f,C=y-m,E-=g,y-=v,M=x*C-T*M,S=R*H-w*S,H=b*y-_*E,M>=-1e-10&&H>=-1e-10&&S>=-1e-10)){d=!1;break e}d=!0}}if(d){for(s.push([e[l[r]],e[l[o]],e[l[a]]]),h.push([l[r],l[o],l[a]]),r=o,a=o+1;n>a;r++,a++)l[r]=l[a];n--,c=2*n}}return i?h:s},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),o+=t.distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t?t:e*n[o-1];for(var a,s=0,l=o-1;l>=s;)if(r=Math.floor(s+(l-s)/2),a=n[r]-i,0>a)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}return r=l,n[r]==i?r/(o-1):(s=n[r],n=(r+(i-s)/(n[r+1]-s))/(o-1))},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return 0>t&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,n,r){var e=.5*(i-e),n=.5*(n-t),o=r*r;return(2*t-2*i+e+n)*r*o+(-3*t+3*i-2*e-n)*o+e*r+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),e=0;e<i.length;){if(i[e]>=t)return t=i[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,n=this.curves.length;for(e=0;n>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,i,n,r,o,a=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=r=Number.POSITIVE_INFINITY;var s,l,h,c,d=a[0]instanceof THREE.Vector3;for(c=d?new THREE.Vector3:new THREE.Vector2,l=0,h=a.length;h>l;l++)s=a[l],s.x>e?e=s.x:s.x<n&&(n=s.x),s.y>t?t=s.y:s.y<r&&(r=s.y),d&&(s.z>i?i=s.z:s.z<o&&(o=s.z)),c.add(s);return a={minX:n,minY:r,maxX:e,maxY:t,centroid:c.divideScalar(h)},d&&(a.maxZ=i,a.minZ=o),a},THREE.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,i=0;i<e.length;i++)t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,e[i].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i,n,r=this.getPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,n,r=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i,n,r,o,a,s,l=this.getBoundingBox();for(i=0,n=e.length;n>i;i++)r=e[i],o=r.x,a=r.y,s=o/l.maxX,s=t.getUtoTmapping(s,o),o=t.getPoint(s),a=t.getNormalVector(s).multiplyScalar(a),r.x=o.x+a.x,r.y=o.y+a.y;return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:e})},THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=new THREE.LineCurve(new THREE.Vector2(n[n.length-2],n[n.length-1]),new THREE.Vector2(e,t));this.curves.push(n),this.actions.push({action:THREE.PathActions.LINE_TO,args:i})},THREE.Path.prototype.quadraticCurveTo=function(e,t,i,n){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,o=new THREE.QuadraticBezierCurve(new THREE.Vector2(o[o.length-2],o[o.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(i,n));this.curves.push(o),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:r})},THREE.Path.prototype.bezierCurveTo=function(e,t,i,n,r,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,s=new THREE.CubicBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(i,n),new THREE.Vector2(r,o));this.curves.push(s),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=[new THREE.Vector2(i[i.length-2],i[i.length-1])];Array.prototype.push.apply(i,e),i=new THREE.SplineCurve(i),this.curves.push(i),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,i,n,r,o){var a=this.actions[this.actions.length-1].args;this.absarc(e+a[a.length-2],t+a[a.length-1],i,n,r,o)},THREE.Path.prototype.absarc=function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},THREE.Path.prototype.ellipse=function(e,t,i,n,r,o,a){var s=this.actions[this.actions.length-1].args;this.absellipse(e+s[s.length-2],t+s[s.length-1],i,n,r,o,a)},THREE.Path.prototype.absellipse=function(e,t,i,n,r,o,a){var s=Array.prototype.slice.call(arguments),l=new THREE.EllipseCurve(e,t,i,n,r,o,a);this.curves.push(l),l=l.getPoint(1),s.push(l.x),s.push(l.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var i,n,r,o,a,s,l,h,c,d,u,p,f,e=e||12,m=[];for(i=0,n=this.actions.length;n>i;i++)switch(r=this.actions[i],o=r.action,r=r.args,o){case THREE.PathActions.MOVE_TO:m.push(new THREE.Vector2(r[0],r[1]));break;case THREE.PathActions.LINE_TO:m.push(new THREE.Vector2(r[0],r[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(a=r[2],s=r[3],c=r[0],d=r[1],0<m.length?(o=m[m.length-1],u=o.x,p=o.y):(o=this.actions[i-1].args,u=o[o.length-2],p=o[o.length-1]),r=1;e>=r;r++)f=r/e,o=THREE.Shape.Utils.b2(f,u,c,a),f=THREE.Shape.Utils.b2(f,p,d,s),m.push(new THREE.Vector2(o,f));break;case THREE.PathActions.BEZIER_CURVE_TO:for(a=r[4],s=r[5],c=r[0],d=r[1],l=r[2],h=r[3],0<m.length?(o=m[m.length-1],u=o.x,p=o.y):(o=this.actions[i-1].args,u=o[o.length-2],p=o[o.length-1]),r=1;e>=r;r++)f=r/e,o=THREE.Shape.Utils.b3(f,u,c,l,a),f=THREE.Shape.Utils.b3(f,p,d,h,s),m.push(new THREE.Vector2(o,f));break;case THREE.PathActions.CSPLINE_THRU:for(o=this.actions[i-1].args,f=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=e*r[0].length,f=f.concat(r[0]),f=new THREE.SplineCurve(f),r=1;o>=r;r++)m.push(f.getPointAt(r/o));break;case THREE.PathActions.ARC:for(a=r[0],s=r[1],d=r[2],l=r[3],o=r[4],c=!!r[5],u=o-l,p=2*e,r=1;p>=r;r++)f=r/p,c||(f=1-f),f=l+f*u,o=a+d*Math.cos(f),f=s+d*Math.sin(f),m.push(new THREE.Vector2(o,f));break;case THREE.PathActions.ELLIPSE:for(a=r[0],s=r[1],d=r[2],h=r[3],l=r[4],o=r[5],c=!!r[6],u=o-l,p=2*e,r=1;p>=r;r++)f=r/p,c||(f=1-f),f=l+f*u,o=a+d*Math.cos(f),f=s+h*Math.sin(f),m.push(new THREE.Vector2(o,f))}return i=m[m.length-1],1e-10>Math.abs(i.x-m[0].x)&&1e-10>Math.abs(i.y-m[0].y)&&m.splice(m.length-1,1),t&&m.push(m[0]),m},THREE.Path.prototype.toShapes=function(e){var t,i,n,r,o=[],a=new THREE.Path;for(t=0,i=this.actions.length;i>t;t++)n=this.actions[t],r=n.args,n=n.action,n==THREE.PathActions.MOVE_TO&&0!=a.actions.length&&(o.push(a),a=new THREE.Path),a[n].apply(a,r);if(0!=a.actions.length&&o.push(a),0==o.length)return[];var s;if(r=[],1==o.length)return n=o[0],s=new THREE.Shape,s.actions=n.actions,s.curves=n.curves,r.push(s),r;if(t=!THREE.Shape.Utils.isClockWise(o[0].getPoints()),e?!t:t)for(s=new THREE.Shape,t=0,i=o.length;i>t;t++)n=o[t],a=THREE.Shape.Utils.isClockWise(n.getPoints()),(a=e?!a:a)?(s.actions=n.actions,s.curves=n.curves,r.push(s),s=new THREE.Shape):s.holes.push(n);else{for(s=void 0,t=0,i=o.length;i>t;t++)n=o[t],a=THREE.Shape.Utils.isClockWise(n.getPoints()),(a=e?!a:a)?(s&&r.push(s),s=new THREE.Shape,s.actions=n.actions,s.curves=n.curves):s.holes.push(n);r.push(s)}return r},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var i,n,r,o,a,s,l,h,c,d,u=e.concat(),p=u.concat(),f=[];for(a=0;a<t.length;a++){for(s=t[a],Array.prototype.push.apply(p,s),n=Number.POSITIVE_INFINITY,i=0;i<s.length;i++)for(c=s[i],d=[],h=0;h<u.length;h++)l=u[h],l=c.distanceToSquared(l),d.push(l),n>l&&(n=l,r=i,o=h);i=o-1>=0?o-1:u.length-1,n=r-1>=0?r-1:s.length-1;var m=[s[r],u[o],u[i]];h=THREE.FontUtils.Triangulate.area(m);var g=[s[r],s[n],u[o]];c=THREE.FontUtils.Triangulate.area(g),d=o,l=r,o+=1,r+=-1,0>o&&(o+=u.length),o%=u.length,0>r&&(r+=s.length),r%=s.length,i=o-1>=0?o-1:u.length-1,n=r-1>=0?r-1:s.length-1,m=[s[r],u[o],u[i]],m=THREE.FontUtils.Triangulate.area(m),g=[s[r],s[n],u[o]],g=THREE.FontUtils.Triangulate.area(g),h+c>m+g&&(o=d,r=l,0>o&&(o+=u.length),o%=u.length,0>r&&(r+=s.length),r%=s.length,i=o-1>=0?o-1:u.length-1,n=r-1>=0?r-1:s.length-1),h=u.slice(0,o),c=u.slice(o),d=s.slice(r),l=s.slice(0,r),n=[s[r],s[n],u[o]],f.push([s[r],u[o],u[i]]),f.push(n),u=h.concat(d).concat(l).concat(c)}return{shape:u,isolatedPts:f,allpoints:p}},triangulateShape:function(e,t){var i,n,r,o,a=THREE.Shape.Utils.removeHoles(e,t),s=a.allpoints,l=a.isolatedPts,a=THREE.FontUtils.Triangulate(a.shape,!1),h={};for(i=0,n=s.length;n>i;i++)o=s[i].x+":"+s[i].y,void 0!==h[o]&&console.log("Duplicate point",o),h[o]=i;for(i=0,n=a.length;n>i;i++)for(r=a[i],s=0;3>s;s++)o=r[s].x+":"+r[s].y,o=h[o],void 0!==o&&(r[s]=o);for(i=0,n=l.length;n>i;i++)for(r=l[i],s=0;3>s;s++)o=r[s].x+":"+r[s].y,o=h[o],void 0!==o&&(r[s]=o);return a.concat(l)},isClockWise:function(e){return 0>THREE.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,n){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,n)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,n,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,n)+this.b3p3(e,r)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t,i=new THREE.Vector2,n=[],r=this.points;return t=(r.length-1)*e,e=Math.floor(t),t-=e,n[0]=0==e?e:e-1,n[1]=e,n[2]=e>r.length-2?r.length-1:e+1,n[3]=e>r.length-3?r.length-1:e+2,i.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,t),i.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,t),i},THREE.EllipseCurve=function(e,t,i,n,r,o,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t;return t=this.aEndAngle-this.aStartAngle,0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t),t=this.aY+this.yRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.ArcCurve=function(e,t,i,n,r,o){THREE.EllipseCurve.call(this,e,t,i,i,n,r,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,i,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},function(e){var t,i;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,i,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i=new THREE.Vector3,n=[],r=this.points,e=(r.length-1)*e;t=Math.floor(e),e-=t,n[0]=0==t?t:t-1,n[1]=t,n[2]=t>r.length-2?r.length-1:t+1,n[3]=t>r.length-3?r.length-1:t+2,t=r[n[0]];var o=r[n[1]],a=r[n[2]],n=r[n[3]];return i.x=THREE.Curve.Utils.interpolate(t.x,o.x,a.x,n.x,e),i.y=THREE.Curve.Utils.interpolate(t.y,o.y,a.y,n.y,e),i.z=THREE.Curve.Utils.interpolate(t.z,o.z,a.z,n.z,e),i}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i=new THREE.Vector3,n=[],r=this.points;return t=(r.length-0)*e,e=Math.floor(t),t-=e,e+=e>0?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length,n[0]=(e-1)%r.length,n[1]=e%r.length,n[2]=(e+1)%r.length,n[3]=(e+2)%r.length,i.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,t),i.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,t),i.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,t),i}),THREE.AnimationHandler=function(){var e=[],t={},i={update:function(t){for(var i=0;i<e.length;i++)e[i].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},add:function(e){if(void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,!0!==e.initialized){for(var i=0;i<e.hierarchy.length;i++){for(var n=0;n<e.hierarchy[i].keys.length;n++)if(0>e.hierarchy[i].keys[n].time&&(e.hierarchy[i].keys[n].time=0),void 0!==e.hierarchy[i].keys[n].rot&&!(e.hierarchy[i].keys[n].rot instanceof THREE.Quaternion)){var r=e.hierarchy[i].keys[n].rot;e.hierarchy[i].keys[n].rot=new THREE.Quaternion(r[0],r[1],r[2],r[3])}if(e.hierarchy[i].keys.length&&void 0!==e.hierarchy[i].keys[0].morphTargets){for(r={},n=0;n<e.hierarchy[i].keys.length;n++)for(var o=0;o<e.hierarchy[i].keys[n].morphTargets.length;o++){var a=e.hierarchy[i].keys[n].morphTargets[o];r[a]=-1}for(e.hierarchy[i].usedMorphTargets=r,n=0;n<e.hierarchy[i].keys.length;n++){var s={};for(a in r){for(o=0;o<e.hierarchy[i].keys[n].morphTargets.length;o++)if(e.hierarchy[i].keys[n].morphTargets[o]===a){s[a]=e.hierarchy[i].keys[n].morphTargetsInfluences[o];break}o===e.hierarchy[i].keys[n].morphTargets.length&&(s[a]=0)}e.hierarchy[i].keys[n].morphTargetsInfluences=s}}for(n=1;n<e.hierarchy[i].keys.length;n++)e.hierarchy[i].keys[n].time===e.hierarchy[i].keys[n-1].time&&(e.hierarchy[i].keys.splice(n,1),n--);for(n=0;n<e.hierarchy[i].keys.length;n++)e.hierarchy[i].keys[n].index=n}for(n=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[],i=0;i<e.hierarchy.length;i++)e.JIT.hierarchy.push(Array(n));e.initialized=!0}},get:function(e){return"string"==typeof e?t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var i=0;i<e.bones.length;i++)t.push(e.bones[i]);else n(e,t);return t}},n=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)n(e.children[i],t)};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),THREE.Animation=function(e,t,i){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==i?i:THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3
},THREE.Animation.prototype.play=function(e,t){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var i,n,r=this.hierarchy.length;for(i=0;r>i;i++){n=this.hierarchy[i],n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey={pos:0,rot:0,scl:0},n.animationCache.nextKey={pos:0,rot:0,scl:0},n.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix);var o=n.animationCache.prevKey;n=n.animationCache.nextKey,o.pos=this.data.hierarchy[i].keys[0],o.rot=this.data.hierarchy[i].keys[0],o.scl=this.data.hierarchy[i].keys[0],n.pos=this.getNextKeyWith("pos",i,1),n.rot=this.getNextKeyWith("rot",i,1),n.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(e){if(!1!==this.isPlaying){var t,i,n,r,o,a,s,l,h,c=["pos","rot","scl"];h=this.currentTime+=e*this.timeScale,l=this.currentTime%=this.data.length,parseInt(Math.min(l*this.data.fps,this.data.length*this.data.fps),10);for(var d=0,u=this.hierarchy.length;u>d;d++){e=this.hierarchy[d],s=e.animationCache;for(var p=0;3>p;p++){if(t=c[p],o=s.prevKey[t],a=s.nextKey[t],a.time<=h){if(h>l){if(!this.loop)return this.stop(),void 0;for(o=this.data.hierarchy[d].keys[0],a=this.getNextKeyWith(t,d,1);a.time<l;)o=a,a=this.getNextKeyWith(t,d,a.index+1)}else do o=a,a=this.getNextKeyWith(t,d,a.index+1);while(a.time<l);s.prevKey[t]=o,s.nextKey[t]=a}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,i=(l-o.time)/(a.time-o.time),n=o[t],r=a[t],(0>i||i>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+d),i=0>i?0:1),"pos"===t?(t=e.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(t.x=n[0]+(r[0]-n[0])*i,t.y=n[1]+(r[1]-n[1])*i,t.z=n[2]+(r[2]-n[2])*i):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",d,o.index-1).pos,this.points[1]=n,this.points[2]=r,this.points[3]=this.getNextKeyWith("pos",d,a.index+1).pos,i=.33*i+.33,n=this.interpolateCatmullRom(this.points,i),t.x=n[0],t.y=n[1],t.z=n[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(i=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(i[0],i[1],i[2]),this.target.sub(t),this.target.y=0,this.target.normalize(),i=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,i,0)))):"rot"===t?THREE.Quaternion.slerp(n,r,e.quaternion,i):"scl"===t&&(t=e.scale,t.x=n[0]+(r[0]-n[0])*i,t.y=n[1]+(r[1]-n[1])*i,t.z=n[2]+(r[2]-n[2])*i)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var i,n,r,o,a,s,l=[],h=[];return i=(e.length-1)*t,n=Math.floor(i),i-=n,l[0]=0===n?n:n-1,l[1]=n,l[2]=n>e.length-2?n:n+1,l[3]=n>e.length-3?n:n+2,n=e[l[0]],o=e[l[1]],a=e[l[2]],s=e[l[3]],l=i*i,r=i*l,h[0]=this.interpolate(n[0],o[0],a[0],s[0],i,l,r),h[1]=this.interpolate(n[1],o[1],a[1],s[1],i,l,r),h[2]=this.interpolate(n[2],o[2],a[2],s[2],i,l,r),h},THREE.Animation.prototype.interpolate=function(e,t,i,n,r,o,a){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*a+(-3*(t-i)-2*e-n)*o+e*r+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,i){for(var n=this.data.hierarchy[t].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i<n.length-1?i:n.length-1:i%n.length;i<n.length;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,i){for(var n=this.data.hierarchy[t].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[n.length-1]},THREE.KeyFrameAnimation=function(e,t,i){for(this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0!==i?i:!0,e=0,t=this.hierarchy.length;t>e;e++){var i=this.data.hierarchy[e].sids,n=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&i){for(var r=0;r<i.length;r++){var o=i[r],a=this.getNextKeyWith(o,e,0);a&&a.apply(o)}n.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,n,r,o=this.hierarchy.length;for(i=0;o>i;i++)n=this.hierarchy[i],r=this.data.hierarchy[i],void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix),n=this.data.hierarchy[i].keys,n.length&&(r.animationCache.prevKey=n[0],r.animationCache.nextKey=n[1],this.startTime=Math.min(n[0].time,this.startTime),this.endTime=Math.max(n[n.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var n=i.animationCache.originalMatrix;t instanceof THREE.Bone?(n.copy(t.skinMatrix),t.skinMatrix=n):(n.copy(t.matrix),t.matrix=n),delete i.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,n,r,o,a,s,l=this.data.JIT.hierarchy;if(a=this.currentTime+=e*this.timeScale,o=this.currentTime%=this.data.length,o<this.startTimeMs&&(o=this.currentTime=this.startTimeMs+o),r=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10),(s=a>o)&&!this.loop){for(var e=0,h=this.hierarchy.length;h>e;e++){var c=this.data.hierarchy[e].keys,l=this.data.hierarchy[e].sids;if(n=c.length-1,r=this.hierarchy[e],c.length){for(c=0;c<l.length;c++)o=l[c],(a=this.getPrevKeyWith(o,e,n))&&a.apply(o);this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(o<this.startTime)){for(e=0,h=this.hierarchy.length;h>e;e++){n=this.hierarchy[e],t=this.data.hierarchy[e];var c=t.keys,d=t.animationCache;if(this.JITCompile&&void 0!==l[e][r])n instanceof THREE.Bone?(n.skinMatrix=l[e][r],n.matrixWorldNeedsUpdate=!1):(n.matrix=l[e][r],n.matrixWorldNeedsUpdate=!0);else if(c.length){if(this.JITCompile&&d&&(n instanceof THREE.Bone?n.skinMatrix=d.originalMatrix:n.matrix=d.originalMatrix),t=d.prevKey,i=d.nextKey,t&&i){if(i.time<=a){if(s&&this.loop)for(t=c[0],i=c[1];i.time<o;)t=i,i=c[t.index+1];else if(!s)for(var u=c.length-1;i.time<o&&i.index!==u;)t=i,i=c[t.index+1];d.prevKey=t,d.nextKey=i}i.time>=o?t.interpolate(i,o):t.interpolate(i,i.time)}this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===l[0][r])for(this.hierarchy[0].updateMatrixWorld(!0),e=0;e<this.hierarchy.length;e++)l[e][r]=this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i%=t.length;i<t.length;i++)if(t[i].hasTarget(e))return t[i];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i=i>=0?i:i+t.length;i>=0;i--)if(t[i].hasTarget(e))return t[i];return t[t.length-1]},THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);var n=new THREE.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new THREE.Vector3(1,0,0)),this.add(n);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(-1,0,0)),this.add(r);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new THREE.Vector3(0,1,0)),this.add(o);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new THREE.Vector3(0,-1,0)),this.add(a);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new THREE.Vector3(0,0,1)),this.add(s);var l=new THREE.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,-1)),this.add(l),this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,h=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,n,i),i.activeCubeFace=1,e.render(t,r,i),i.activeCubeFace=2,e.render(t,o,i),i.activeCubeFace=3,e.render(t,a,i),i.activeCubeFace=4,e.render(t,s,i),i.generateMipmaps=h,i.activeCubeFace=5,e.render(t,l,i)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,i,n,r,o,a){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(i,e/t,n,r),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var i=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CircleGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.radius=e=e||50,this.segments=t=void 0!==t?Math.max(3,t):8,this.thetaStart=i=void 0!==i?i:0,this.thetaLength=n=void 0!==n?n:2*Math.PI;var r,o=[];r=new THREE.Vector3;var a=new THREE.Vector2(.5,.5);for(this.vertices.push(r),o.push(a),r=0;t>=r;r++){var s=new THREE.Vector3,l=i+r/t*n;s.x=e*Math.cos(l),s.y=e*Math.sin(l),this.vertices.push(s),o.push(new THREE.Vector2((s.x/e+1)/2,(s.y/e+1)/2))}for(i=new THREE.Vector3(0,0,1),r=1;t>=r;r++)this.faces.push(new THREE.Face3(r,r+1,0,[i.clone(),i.clone(),i.clone()])),this.faceVertexUvs[0].push([o[r].clone(),o[r+1].clone(),a.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,i,n,r,o){function a(e,t,i,n,r,o,a,l){var h,c=s.widthSegments,d=s.heightSegments,u=r/2,p=o/2,f=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",d=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",c=s.depthSegments);var m=c+1,g=d+1,v=r/c,E=o/d,y=new THREE.Vector3;for(y[h]=a>0?1:-1,r=0;g>r;r++)for(o=0;m>o;o++){var x=new THREE.Vector3;x[e]=(o*v-u)*i,x[t]=(r*E-p)*n,x[h]=a,s.vertices.push(x)}for(r=0;d>r;r++)for(o=0;c>o;o++)p=o+m*r,e=o+m*(r+1),t=o+1+m*(r+1),i=o+1+m*r,n=new THREE.Vector2(o/c,1-r/d),a=new THREE.Vector2(o/c,1-(r+1)/d),h=new THREE.Vector2((o+1)/c,1-(r+1)/d),u=new THREE.Vector2((o+1)/c,1-r/d),p=new THREE.Face3(p+f,e+f,i+f),p.normal.copy(y),p.vertexNormals.push(y.clone(),y.clone(),y.clone()),p.materialIndex=l,s.faces.push(p),s.faceVertexUvs[0].push([n,a,u]),p=new THREE.Face3(e+f,t+f,i+f),p.normal.copy(y),p.vertexNormals.push(y.clone(),y.clone(),y.clone()),p.materialIndex=l,s.faces.push(p),s.faceVertexUvs[0].push([a.clone(),h,u.clone()])}THREE.Geometry.call(this);var s=this;this.width=e,this.height=t,this.depth=i,this.widthSegments=n||1,this.heightSegments=r||1,this.depthSegments=o||1,e=this.width/2,t=this.height/2,i=this.depth/2,a("z","y",-1,-1,this.depth,this.height,e,0),a("z","y",1,-1,this.depth,this.height,-e,1),a("x","z",1,1,this.width,this.depth,t,2),a("x","z",1,-1,this.width,this.depth,-t,3),a("x","y",1,-1,this.width,this.height,i,4),a("x","y",-1,-1,this.width,this.height,-i,5),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(e,t,i,n,r,o){THREE.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=i=void 0!==i?i:100,this.radialSegments=n=n||8,this.heightSegments=r=r||1,this.openEnded=o=void 0!==o?o:!1;var a,s,l=i/2,h=[],c=[];for(s=0;r>=s;s++){var d=[],u=[],p=s/r,f=p*(t-e)+e;for(a=0;n>=a;a++){var m=a/n,g=new THREE.Vector3;g.x=f*Math.sin(2*m*Math.PI),g.y=-p*i+l,g.z=f*Math.cos(2*m*Math.PI),this.vertices.push(g),d.push(this.vertices.length-1),u.push(new THREE.Vector2(m,1-p))}h.push(d),c.push(u)}for(i=(t-e)/i,a=0;n>a;a++)for(0!==e?(d=this.vertices[h[0][a]].clone(),u=this.vertices[h[0][a+1]].clone()):(d=this.vertices[h[1][a]].clone(),u=this.vertices[h[1][a+1]].clone()),d.setY(Math.sqrt(d.x*d.x+d.z*d.z)*i).normalize(),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*i).normalize(),s=0;r>s;s++){var p=h[s][a],f=h[s+1][a],m=h[s+1][a+1],g=h[s][a+1],v=d.clone(),E=d.clone(),y=u.clone(),x=u.clone(),T=c[s][a].clone(),b=c[s+1][a].clone(),_=c[s+1][a+1].clone(),R=c[s][a+1].clone();this.faces.push(new THREE.Face3(p,f,g,[v,E,x])),this.faceVertexUvs[0].push([T,b,R]),this.faces.push(new THREE.Face3(f,m,g,[E.clone(),y,x.clone()])),this.faceVertexUvs[0].push([b.clone(),_,R.clone()])}if(!1===o&&e>0)for(this.vertices.push(new THREE.Vector3(0,l,0)),a=0;n>a;a++)p=h[0][a],f=h[0][a+1],m=this.vertices.length-1,v=new THREE.Vector3(0,1,0),E=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),T=c[0][a].clone(),b=c[0][a+1].clone(),_=new THREE.Vector2(b.x,0),this.faces.push(new THREE.Face3(p,f,m,[v,E,y])),this.faceVertexUvs[0].push([T,b,_]);if(!1===o&&t>0)for(this.vertices.push(new THREE.Vector3(0,-l,0)),a=0;n>a;a++)p=h[s][a+1],f=h[s][a],m=this.vertices.length-1,v=new THREE.Vector3(0,-1,0),E=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),T=c[s][a+1].clone(),b=c[s][a].clone(),_=new THREE.Vector2(b.x,1),this.faces.push(new THREE.Face3(p,f,m,[v,E,y])),this.faceVertexUvs[0].push([T,b,_]);this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){"undefined"!=typeof e&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;i>n;n++)this.addShape(e[n],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function n(e,t,i){var n=THREE.ExtrudeGeometry.__v1,r=THREE.ExtrudeGeometry.__v2,o=THREE.ExtrudeGeometry.__v3,a=THREE.ExtrudeGeometry.__v4,s=THREE.ExtrudeGeometry.__v5,l=THREE.ExtrudeGeometry.__v6;return n.set(e.x-t.x,e.y-t.y),r.set(e.x-i.x,e.y-i.y),n=n.normalize(),r=r.normalize(),o.set(-n.y,n.x),a.set(r.y,-r.x),s.copy(e).add(o),l.copy(e).add(a),s.equals(l)?a.clone():(s.copy(t).add(o),l.copy(i).add(a),o=n.dot(a),a=l.sub(s).dot(a),0===o&&(console.log("Either infinite or no solutions!"),0===a?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),a/=o,0>a?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(i.y-e.y,i.x-e.x),t>e&&(e+=2*Math.PI),i=(t+e)/2,e=-Math.cos(i),i=-Math.sin(i),new THREE.Vector2(e,i)):n.multiplyScalar(a).add(s).sub(e).clone())}function r(i,n){var r,o;for(z=i.length;0<=--z;){r=z,o=z-1,0>o&&(o=i.length-1);for(var a=0,s=E+2*m,a=0;s>a;a++){var l=k*a,h=k*(a+1),c=n+r+l,l=n+o+l,d=n+o+h,h=n+r+h,u=i,p=a,f=s,g=r,v=o,c=c+M,l=l+M,d=d+M,h=h+M;H.faces.push(new THREE.Face3(c,l,h,null,null,b)),H.faces.push(new THREE.Face3(l,d,h,null,null,b)),c=_.generateSideWallUV(H,e,u,t,c,l,d,h,p,f,g,v),H.faceVertexUvs[0].push([c[0],c[1],c[3]]),H.faceVertexUvs[0].push([c[1],c[2],c[3]])}}}function o(e,t,i){H.vertices.push(new THREE.Vector3(e,t,i))}function a(i,n,r,o){i+=M,n+=M,r+=M,H.faces.push(new THREE.Face3(i,n,r,null,null,T)),i=o?_.generateBottomUV(H,e,t,i,n,r):_.generateTopUV(H,e,t,i,n,r),H.faceVertexUvs[0].push(i)}var s,l,h,c,d,u=void 0!==t.amount?t.amount:100,p=void 0!==t.bevelThickness?t.bevelThickness:6,f=void 0!==t.bevelSize?t.bevelSize:p-2,m=void 0!==t.bevelSegments?t.bevelSegments:3,g=void 0!==t.bevelEnabled?t.bevelEnabled:!0,v=void 0!==t.curveSegments?t.curveSegments:12,E=void 0!==t.steps?t.steps:1,y=t.extrudePath,x=!1,T=t.material,b=t.extrudeMaterial,_=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;y&&(s=y.getSpacedPoints(E),x=!0,g=!1,l=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(y,E,!1),h=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3),g||(f=p=m=0);var R,w,S,H=this,M=this.vertices.length,v=e.extractPoints(v),C=v.shape,v=v.holes;if(y=!THREE.Shape.Utils.isClockWise(C)){for(C=C.reverse(),w=0,S=v.length;S>w;w++)R=v[w],THREE.Shape.Utils.isClockWise(R)&&(v[w]=R.reverse());y=!1}var D=THREE.Shape.Utils.triangulateShape(C,v),y=C;for(w=0,S=v.length;S>w;w++)R=v[w],C=C.concat(R);var A,I,P,L,k=C.length,O=D.length,N=[],z=0,V=y.length;for(A=V-1,I=z+1;V>z;z++,A++,I++)A===V&&(A=0),I===V&&(I=0),N[z]=n(y[z],y[A],y[I]);var F,U=[],B=N.concat();for(w=0,S=v.length;S>w;w++){for(R=v[w],F=[],z=0,V=R.length,A=V-1,I=z+1;V>z;z++,A++,I++)A===V&&(A=0),I===V&&(I=0),F[z]=n(R[z],R[A],R[I]);U.push(F),B=B.concat(F)}for(A=0;m>A;A++){for(R=A/m,P=p*(1-R),I=f*Math.sin(R*Math.PI/2),z=0,V=y.length;V>z;z++)L=i(y[z],N[z],I),o(L.x,L.y,-P);for(w=0,S=v.length;S>w;w++)for(R=v[w],F=U[w],z=0,V=R.length;V>z;z++)L=i(R[z],F[z],I),o(L.x,L.y,-P)}for(I=f,z=0;k>z;z++)L=g?i(C[z],B[z],I):C[z],x?(c.copy(l.normals[0]).multiplyScalar(L.x),h.copy(l.binormals[0]).multiplyScalar(L.y),d.copy(s[0]).add(c).add(h),o(d.x,d.y,d.z)):o(L.x,L.y,0);for(R=1;E>=R;R++)for(z=0;k>z;z++)L=g?i(C[z],B[z],I):C[z],x?(c.copy(l.normals[R]).multiplyScalar(L.x),h.copy(l.binormals[R]).multiplyScalar(L.y),d.copy(s[R]).add(c).add(h),o(d.x,d.y,d.z)):o(L.x,L.y,u/E*R);for(A=m-1;A>=0;A--){for(R=A/m,P=p*(1-R),I=f*Math.sin(R*Math.PI/2),z=0,V=y.length;V>z;z++)L=i(y[z],N[z],I),o(L.x,L.y,u+P);for(w=0,S=v.length;S>w;w++)for(R=v[w],F=U[w],z=0,V=R.length;V>z;z++)L=i(R[z],F[z],I),x?o(L.x,L.y+s[E-1].y,s[E-1].x+P):o(L.x,L.y,u+P)}if(g){for(p=0*k,z=0;O>z;z++)u=D[z],a(u[2]+p,u[1]+p,u[0]+p,!0);for(p=k*(E+2*m),z=0;O>z;z++)u=D[z],a(u[0]+p,u[1]+p,u[2]+p,!1)}else{for(z=0;O>z;z++)u=D[z],a(u[2],u[1],u[0],!0);for(z=0;O>z;z++)u=D[z],a(u[0]+k*E,u[1]+k*E,u[2]+k*E,!1)}for(u=0,r(y,u),u+=y.length,w=0,S=v.length;S>w;w++)R=v[w],r(R,u),u+=R.length},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,n,r,o){return t=e.vertices[r].x,r=e.vertices[r].y,i=e.vertices[o].x,o=e.vertices[o].y,[new THREE.Vector2(e.vertices[n].x,e.vertices[n].y),new THREE.Vector2(t,r),new THREE.Vector2(i,o)]},generateBottomUV:function(e,t,i,n,r,o){return this.generateTopUV(e,t,i,n,r,o)},generateSideWallUV:function(e,t,i,n,r,o,a,s){var t=e.vertices[r].x,i=e.vertices[r].y,r=e.vertices[r].z,n=e.vertices[o].x,l=e.vertices[o].y,o=e.vertices[o].z,h=e.vertices[a].x,c=e.vertices[a].y,a=e.vertices[a].z,d=e.vertices[s].x,u=e.vertices[s].y,e=e.vertices[s].z;return.01>Math.abs(i-l)?[new THREE.Vector2(t,1-r),new THREE.Vector2(n,1-o),new THREE.Vector2(h,1-a),new THREE.Vector2(d,1-e)]:[new THREE.Vector2(i,1-r),new THREE.Vector2(l,1-o),new THREE.Vector2(c,1-a),new THREE.Vector2(u,1-e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),!1==e instanceof Array&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,n=e.length;n>i;i++)this.addShape(e[i],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,n,r,o=t.material,a=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,s=this.vertices.length;i=e.extractPoints(void 0!==t.curveSegments?t.curveSegments:12);var l=i.shape,h=i.holes;if(!THREE.Shape.Utils.isClockWise(l))for(l=l.reverse(),i=0,n=h.length;n>i;i++)r=h[i],THREE.Shape.Utils.isClockWise(r)&&(h[i]=r.reverse());var c=THREE.Shape.Utils.triangulateShape(l,h);for(i=0,n=h.length;n>i;i++)r=h[i],l=l.concat(r);for(h=l.length,n=c.length,i=0;h>i;i++)r=l[i],this.vertices.push(new THREE.Vector3(r.x,r.y,0));for(i=0;n>i;i++)h=c[i],l=h[0]+s,r=h[1]+s,h=h[2]+s,this.faces.push(new THREE.Face3(l,r,h,null,null,o)),this.faceVertexUvs[0].push(a.generateBottomUV(this,e,t,l,r,h))},THREE.LatheGeometry=function(e,t,i,n){THREE.Geometry.call(this);for(var t=t||12,i=i||0,n=n||2*Math.PI,r=1/(e.length-1),o=1/t,a=0,s=t;s>=a;a++)for(var l=i+a*o*n,h=Math.cos(l),c=Math.sin(l),l=0,d=e.length;d>l;l++){var u=e[l],p=new THREE.Vector3;p.x=h*u.x-c*u.y,p.y=c*u.x+h*u.y,p.z=u.z,this.vertices.push(p)}for(i=e.length,a=0,s=t;s>a;a++)for(l=0,d=e.length-1;d>l;l++){var t=c=l+i*a,n=c+i,h=c+1+i,c=c+1,u=a*o,p=l*r,f=u+o,m=p+r;this.faces.push(new THREE.Face3(t,n,c)),this.faceVertexUvs[0].push([new THREE.Vector2(u,p),new THREE.Vector2(f,p),new THREE.Vector2(u,m)]),this.faces.push(new THREE.Face3(n,h,c)),this.faceVertexUvs[0].push([new THREE.Vector2(f,p),new THREE.Vector2(f,m),new THREE.Vector2(u,m)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=i||1,this.heightSegments=n||1;for(var r=e/2,o=t/2,i=this.widthSegments,n=this.heightSegments,a=i+1,s=n+1,l=this.width/i,h=this.height/n,c=new THREE.Vector3(0,0,1),e=0;s>e;e++)for(t=0;a>t;t++)this.vertices.push(new THREE.Vector3(t*l-r,-(e*h-o),0));for(e=0;n>e;e++)for(t=0;i>t;t++){var d=t+a*e,r=t+a*(e+1),o=t+1+a*(e+1),s=t+1+a*e,l=new THREE.Vector2(t/i,1-e/n),h=new THREE.Vector2(t/i,1-(e+1)/n),u=new THREE.Vector2((t+1)/i,1-(e+1)/n),p=new THREE.Vector2((t+1)/i,1-e/n),d=new THREE.Face3(d,r,s);d.normal.copy(c),d.vertexNormals.push(c.clone(),c.clone(),c.clone()),this.faces.push(d),this.faceVertexUvs[0].push([l,h,p]),d=new THREE.Face3(r,o,s),d.normal.copy(c),d.vertexNormals.push(c.clone(),c.clone(),c.clone()),this.faces.push(d),this.faceVertexUvs[0].push([h.clone(),u,p.clone()])}this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,i,n,r,o){THREE.Geometry.call(this);for(var a,e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8,n=void 0!==n?Math.max(3,n):8,s=[],l=e,h=(t-e)/n,e=0;n>=e;e++){for(a=0;i>=a;a++){var c=new THREE.Vector3,d=r+a/i*o;c.x=l*Math.cos(d),c.y=l*Math.sin(d),this.vertices.push(c),s.push(new THREE.Vector2((c.x/t+1)/2,(c.y/t+1)/2))}l+=h}for(t=new THREE.Vector3(0,0,1),e=0;n>e;e++)for(r=e*i,a=0;i>=a;a++)d=a+r,o=d+e,h=d+i+e,c=d+i+1+e,this.faces.push(new THREE.Face3(o,h,c,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([s[o].clone(),s[h].clone(),s[c].clone()]),o=d+e,h=d+i+1+e,c=d+1+e,this.faces.push(new THREE.Face3(o,h,c,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([s[o].clone(),s[h].clone(),s[c].clone()]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,l)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,i,n,r,o,a){THREE.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=i=Math.max(2,Math.floor(i)||6),this.phiStart=n=void 0!==n?n:0,this.phiLength=r=void 0!==r?r:2*Math.PI,this.thetaStart=o=void 0!==o?o:0,this.thetaLength=a=void 0!==a?a:Math.PI;var s,l,h=[],c=[];for(l=0;i>=l;l++){var d=[],u=[];for(s=0;t>=s;s++){var p=s/t,f=l/i,m=new THREE.Vector3;m.x=-e*Math.cos(n+p*r)*Math.sin(o+f*a),m.y=e*Math.cos(o+f*a),m.z=e*Math.sin(n+p*r)*Math.sin(o+f*a),this.vertices.push(m),d.push(this.vertices.length-1),u.push(new THREE.Vector2(p,1-f))}h.push(d),c.push(u)}for(l=0;l<this.heightSegments;l++)for(s=0;s<this.widthSegments;s++){var t=h[l][s+1],i=h[l][s],n=h[l+1][s],r=h[l+1][s+1],o=this.vertices[t].clone().normalize(),a=this.vertices[i].clone().normalize(),d=this.vertices[n].clone().normalize(),u=this.vertices[r].clone().normalize(),p=c[l][s+1].clone(),f=c[l][s].clone(),m=c[l+1][s].clone(),g=c[l+1][s+1].clone();Math.abs(this.vertices[t].y)===this.radius?(p.x=(p.x+f.x)/2,this.faces.push(new THREE.Face3(t,n,r,[o,d,u])),this.faceVertexUvs[0].push([p,m,g])):Math.abs(this.vertices[n].y)===this.radius?(m.x=(m.x+g.x)/2,this.faces.push(new THREE.Face3(t,i,n,[o,a,d])),this.faceVertexUvs[0].push([p,f,m])):(this.faces.push(new THREE.Face3(t,i,r,[o,a,u])),this.faceVertexUvs[0].push([p,f,g]),this.faces.push(new THREE.Face3(i,n,r,[a.clone(),d,u.clone()])),this.faceVertexUvs[0].push([f.clone(),m,g.clone()]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){var t=t||{},i=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,i,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,i,n,r){for(THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=i||8,this.tubularSegments=n||6,this.arc=r||2*Math.PI,r=new THREE.Vector3,e=[],t=[],i=0;i<=this.radialSegments;i++)for(n=0;n<=this.tubularSegments;n++){var o=n/this.tubularSegments*this.arc,a=2*i/this.radialSegments*Math.PI;r.x=this.radius*Math.cos(o),r.y=this.radius*Math.sin(o);var s=new THREE.Vector3;s.x=(this.radius+this.tube*Math.cos(a))*Math.cos(o),s.y=(this.radius+this.tube*Math.cos(a))*Math.sin(o),s.z=this.tube*Math.sin(a),this.vertices.push(s),e.push(new THREE.Vector2(n/this.tubularSegments,i/this.radialSegments)),t.push(s.clone().sub(r).normalize())}for(i=1;i<=this.radialSegments;i++)for(n=1;n<=this.tubularSegments;n++){var r=(this.tubularSegments+1)*i+n-1,o=(this.tubularSegments+1)*(i-1)+n-1,a=(this.tubularSegments+1)*(i-1)+n,s=(this.tubularSegments+1)*i+n,l=new THREE.Face3(r,o,s,[t[r],t[o],t[s]]);l.normal.add(t[r]),l.normal.add(t[o]),l.normal.add(t[s]),l.normal.normalize(),this.faces.push(l),this.faceVertexUvs[0].push([e[r].clone(),e[o].clone(),e[s].clone()]),l=new THREE.Face3(o,a,s,[t[o],t[a],t[s]]),l.normal.add(t[o]),l.normal.add(t[a]),l.normal.add(t[s]),l.normal.normalize(),this.faces.push(l),this.faceVertexUvs[0].push([e[o].clone(),e[a].clone(),e[s].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,i,n,r,o,a){function s(e,t,i,n,r){var o=Math.cos(e),a=Math.sin(e),e=t/i*e,t=Math.cos(e),o=.5*n*(2+t)*o,a=.5*n*(2+t)*a,n=.5*r*n*Math.sin(e);return new THREE.Vector3(o,a,n)}for(THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=i||64,this.tubularSegments=n||8,this.p=r||2,this.q=o||3,this.heightScale=a||1,this.grid=Array(this.radialSegments),i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,e=0;e<this.radialSegments;++e)for(this.grid[e]=Array(this.tubularSegments),t=2*(e/this.radialSegments)*this.p*Math.PI,o=s(t,this.q,this.p,this.radius,this.heightScale),t=s(t+.01,this.q,this.p,this.radius,this.heightScale),i.subVectors(t,o),n.addVectors(t,o),r.crossVectors(i,n),n.crossVectors(r,i),r.normalize(),n.normalize(),t=0;t<this.tubularSegments;++t){var l=2*(t/this.tubularSegments)*Math.PI,a=-this.tube*Math.cos(l),l=this.tube*Math.sin(l),h=new THREE.Vector3;h.x=o.x+a*n.x+l*r.x,h.y=o.y+a*n.y+l*r.y,h.z=o.z+a*n.z+l*r.z,this.grid[e][t]=this.vertices.push(h)-1}for(e=0;e<this.radialSegments;++e)for(t=0;t<this.tubularSegments;++t){var r=(e+1)%this.radialSegments,o=(t+1)%this.tubularSegments,i=this.grid[e][t],n=this.grid[r][t],r=this.grid[r][o],o=this.grid[e][o],a=new THREE.Vector2(e/this.radialSegments,t/this.tubularSegments),l=new THREE.Vector2((e+1)/this.radialSegments,t/this.tubularSegments),h=new THREE.Vector2((e+1)/this.radialSegments,(t+1)/this.tubularSegments),c=new THREE.Vector2(e/this.radialSegments,(t+1)/this.tubularSegments);this.faces.push(new THREE.Face3(i,n,o)),this.faceVertexUvs[0].push([a,l,c]),this.faces.push(new THREE.Face3(n,r,o)),this.faceVertexUvs[0].push([l.clone(),h,c.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,i,n,r){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.radialSegments=n||8,this.closed=r||!1,this.grid=[];var o,a,s,l,h,c,d,n=this.segments+1,r=new THREE.Vector3,t=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed);for(c=t.normals,d=t.binormals,this.tangents=t.tangents,this.normals=c,this.binormals=d,t=0;n>t;t++)for(this.grid[t]=[],i=t/(n-1),h=e.getPointAt(i),o=c[t],a=d[t],i=0;i<this.radialSegments;i++)s=2*(i/this.radialSegments)*Math.PI,l=-this.radius*Math.cos(s),s=this.radius*Math.sin(s),r.copy(h),r.x+=l*o.x+s*a.x,r.y+=l*o.y+s*a.y,r.z+=l*o.z+s*a.z,this.grid[t][i]=this.vertices.push(new THREE.Vector3(r.x,r.y,r.z))-1;for(t=0;t<this.segments;t++)for(i=0;i<this.radialSegments;i++)r=this.closed?(t+1)%this.segments:t+1,c=(i+1)%this.radialSegments,e=this.grid[t][i],n=this.grid[r][i],r=this.grid[r][c],c=this.grid[t][c],d=new THREE.Vector2(t/this.segments,i/this.radialSegments),o=new THREE.Vector2((t+1)/this.segments,i/this.radialSegments),a=new THREE.Vector2((t+1)/this.segments,(i+1)/this.radialSegments),l=new THREE.Vector2(t/this.segments,(i+1)/this.radialSegments),this.faces.push(new THREE.Face3(e,n,c)),this.faceVertexUvs[0].push([d,o,l]),this.faces.push(new THREE.Face3(n,r,c)),this.faceVertexUvs[0].push([o.clone(),a,l.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,i){new THREE.Vector3;
var n=new THREE.Vector3;new THREE.Vector3;var r,o,a,s=[],l=[],h=[],c=new THREE.Vector3,d=new THREE.Matrix4,t=t+1;for(this.tangents=s,this.normals=l,this.binormals=h,r=0;t>r;r++)o=r/(t-1),s[r]=e.getTangentAt(o),s[r].normalize();for(l[0]=new THREE.Vector3,h[0]=new THREE.Vector3,e=Number.MAX_VALUE,r=Math.abs(s[0].x),o=Math.abs(s[0].y),a=Math.abs(s[0].z),e>=r&&(e=r,n.set(1,0,0)),e>=o&&(e=o,n.set(0,1,0)),e>=a&&n.set(0,0,1),c.crossVectors(s[0],n).normalize(),l[0].crossVectors(s[0],c),h[0].crossVectors(s[0],l[0]),r=1;t>r;r++)l[r]=l[r-1].clone(),h[r]=h[r-1].clone(),c.crossVectors(s[r-1],s[r]),1e-4<c.length()&&(c.normalize(),n=Math.acos(THREE.Math.clamp(s[r-1].dot(s[r]),-1,1)),l[r].applyMatrix4(d.makeRotationAxis(c,n))),h[r].crossVectors(s[r],l[r]);if(i)for(n=Math.acos(THREE.Math.clamp(l[0].dot(l[t-1]),-1,1)),n/=t-1,0<s[0].dot(c.crossVectors(l[0],l[t-1]))&&(n=-n),r=1;t>r;r++)l[r].applyMatrix4(d.makeRotationAxis(s[r],n*r)),h[r].crossVectors(s[r],l[r])},THREE.PolyhedronGeometry=function(e,t,i,n){function r(e){var t=e.normalize().clone();t.index=s.vertices.push(t)-1;var i=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new THREE.Vector2(i,1-e),t}function o(e,t,i){var n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);n.centroid.add(e).add(t).add(i).divideScalar(3),s.faces.push(n),n=Math.atan2(n.centroid.z,-n.centroid.x),s.faceVertexUvs[0].push([a(e.uv,e,n),a(t.uv,t,n),a(i.uv,i,n)])}function a(e,t,i){return 0>i&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this);for(var i=i||1,n=n||0,s=this,l=0,h=e.length;h>l;l++)r(new THREE.Vector3(e[l][0],e[l][1],e[l][2]));for(var c=this.vertices,e=[],l=0,h=t.length;h>l;l++){var d=c[t[l][0]],u=c[t[l][1]],p=c[t[l][2]];e[l]=new THREE.Face3(d.index,u.index,p.index,[d.clone(),u.clone(),p.clone()])}for(l=0,h=e.length;h>l;l++){u=e[l],c=n,t=Math.pow(2,c),Math.pow(4,c);for(var c=r(s.vertices[u.a]),d=r(s.vertices[u.b]),f=r(s.vertices[u.c]),u=[],p=0;t>=p;p++){u[p]=[];for(var m=r(c.clone().lerp(f,p/t)),g=r(d.clone().lerp(f,p/t)),v=t-p,E=0;v>=E;E++)u[p][E]=0==E&&p==t?m:r(m.clone().lerp(g,E/v))}for(p=0;t>p;p++)for(E=0;2*(t-p)-1>E;E++)c=Math.floor(E/2),0==E%2?o(u[p][c+1],u[p+1][c],u[p][c]):o(u[p][c+1],u[p+1][c+1],u[p+1][c])}for(l=0,h=this.faceVertexUvs[0].length;h>l;l++)n=this.faceVertexUvs[0][l],e=n[0].x,t=n[1].x,c=n[2].x,d=Math.max(e,Math.max(t,c)),u=Math.min(e,Math.min(t,c)),d>.9&&.1>u&&(.2>e&&(n[0].x+=1),.2>t&&(n[1].x+=1),.2>c&&(n[2].x+=1));for(l=0,h=this.vertices.length;h>l;l++)this.vertices[l].multiplyScalar(i);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var i=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,i){THREE.Geometry.call(this);var n,r,o,a,s=this.vertices,l=this.faces,h=this.faceVertexUvs[0],c=t+1;for(n=0;i>=n;n++)for(a=n/i,r=0;t>=r;r++)o=r/t,o=e(o,a),s.push(o);var d,u,p,f;for(n=0;i>n;n++)for(r=0;t>r;r++)e=n*c+r,s=n*c+r+1,a=(n+1)*c+r+1,o=(n+1)*c+r,d=new THREE.Vector2(r/t,n/i),u=new THREE.Vector2((r+1)/t,n/i),p=new THREE.Vector2((r+1)/t,(n+1)/i),f=new THREE.Vector2(r/t,(n+1)/i),l.push(new THREE.Face3(e,s,o)),h.push([d,u,f]),l.push(new THREE.Face3(s,a,o)),h.push([u.clone(),p,f.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){var e=e||1,t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e,0,0),new THREE.Vector3,new THREE.Vector3(0,e,0),new THREE.Vector3,new THREE.Vector3(0,0,e)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775)),e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),THREE.Line.call(this,t,e,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,i,n){THREE.Object3D.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),this.position=t,t=new THREE.Geometry,t.vertices.push(new THREE.Vector3(0,0,0)),t.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(t,new THREE.LineBasicMaterial({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),t=new THREE.CylinderGeometry(0,.05,.25,5,1),t.applyMatrix((new THREE.Matrix4).makeTranslation(0,.875,0)),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;return function(i){.99999<i.y?this.quaternion.set(0,0,0,1):-.99999>i.y?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.BoxHelper=function(e){var t=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=t;var i=new THREE.Geometry;i.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),THREE.Line.call(this,i,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,t=t.boundingBox.max,n=this.vertices;n[0].set(t.x,t.y,t.z),n[1].set(i.x,t.y,t.z),n[2].set(i.x,i.y,t.z),n[3].set(t.x,i.y,t.z),n[4].set(t.x,t.y,i.z),n[5].set(i.x,t.y,i.z),n[6].set(i.x,i.y,i.z),n[7].set(t.x,i.y,i.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.BoundingBoxHelper=function(e,t){var i=t||8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.CubeGeometry(1,1,1),new THREE.MeshBasicMaterial({color:i,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){n.vertices.push(new THREE.Vector3),n.colors.push(new THREE.Color(t)),void 0===o[e]&&(o[e]=[]),o[e].push(n.vertices.length-1)}var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),o={};t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),THREE.Line.call(this,n,r,THREE.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Camera,i=new THREE.Projector;return function(){function n(n,o,a,s){if(e.set(o,a,s),i.unprojectVector(e,t),n=r.pointMap[n],void 0!==n)for(o=0,a=n.length;a>o;o++)r.geometry.vertices[n[o]].copy(e)}var r=this;t.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=t||1,i=new THREE.PlaneGeometry(t,t),n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Mesh(i,n),this.add(this.lightPlane),i=new THREE.Geometry,i.vertices.push(new THREE.Vector3),i.vertices.push(new THREE.Vector3),n=new THREE.LineBasicMaterial({fog:!1}),n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(i,n),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(){e.getPositionFromMatrix(this.light.matrixWorld),t.getPositionFromMatrix(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(i),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.FaceNormalsHelper=function(e,t,i,n){this.object=e,this.size=t||1;for(var e=i||16776960,n=n||1,t=new THREE.Geometry,i=0,r=this.object.geometry.faces.length;r>i;i++)t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3);THREE.Line.call(this,t,new THREE.LineBasicMaterial({color:e,linewidth:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var t=this.geometry.vertices,i=this.object.geometry.faces,n=this.object.matrixWorld,r=0,o=i.length;o>r;r++){var a=i[r];e.copy(a.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var s=2*r;t[s].copy(a.centroid).applyMatrix4(n),t[s+1].addVectors(t[s],e)}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.GridHelper=function(e,t){var i=new THREE.Geometry,n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var r=-e;e>=r;r+=t){i.vertices.push(new THREE.Vector3(-e,0,r),new THREE.Vector3(e,0,r),new THREE.Vector3(r,0,-e),new THREE.Vector3(r,0,e));var o=0===r?this.color1:this.color2;i.colors.push(o,o,o,o)}THREE.Line.call(this,i,n,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var i=new THREE.SphereGeometry(t,4,2);i.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var n=0;8>n;n++)i.faces[n].color=this.colors[4>n?0:1];n=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0}),this.lightSphere=new THREE.Mesh(i,n),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.getPositionFromMatrix(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new THREE.SphereGeometry(t,4,2),n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,i,n),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,e=new THREE.CylinderGeometry(0,1,1,8,1,!0),e.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var t=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(e,t),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var i=this.light.distance?this.light.distance:1e4,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),e.getPositionFromMatrix(this.light.matrixWorld),t.getPositionFromMatrix(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,i,n){this.object=e,this.size=t||1;for(var t=i||16711680,n=n||1,i=new THREE.Geometry,e=e.geometry.faces,r=0,o=e.length;o>r;r++)for(var a=0,s=e[r].vertexNormals.length;s>a;a++)i.vertices.push(new THREE.Vector3),i.vertices.push(new THREE.Vector3);THREE.Line.call(this,i,new THREE.LineBasicMaterial({color:t,linewidth:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,r=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,l=r.length;l>s;s++)for(var h=r[s],c=0,d=h.vertexNormals.length;d>c;c++){var u=h.vertexNormals[c];i[a].copy(n[h[t[c]]]).applyMatrix4(o),e.copy(u).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),e.add(i[a]),a+=1,i[a].copy(e),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(e,t,i,n){this.object=e,this.size=t||1;for(var t=i||255,n=n||1,i=new THREE.Geometry,e=e.geometry.faces,r=0,o=e.length;o>r;r++)for(var a=0,s=e[r].vertexTangents.length;s>a;a++)i.vertices.push(new THREE.Vector3),i.vertices.push(new THREE.Vector3);THREE.Line.call(this,i,new THREE.LineBasicMaterial({color:t,linewidth:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,r=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,l=r.length;l>s;s++)for(var h=r[s],c=0,d=h.vertexTangents.length;d>c;c++){var u=h.vertexTangents[c];i[a].copy(n[h[t[c]]]).applyMatrix4(o),e.copy(u).transformDirection(o).multiplyScalar(this.size),e.add(i[a]),a+=1,i[a].copy(e),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(e){for(var t=[0,0],i={},n=function(e,t){return e-t},r=["a","b","c","d"],o=new THREE.Geometry,a=e.geometry.vertices,s=e.geometry.faces,l=0,h=s.length;h>l;l++)for(var c=s[l],d=0;3>d;d++){t[0]=c[r[d]],t[1]=c[r[(d+1)%3]],t.sort(n);var u=t.toString();void 0===i[u]&&(o.vertices.push(a[t[0]]),o.vertices.push(a[t[1]]),i[u]=!0)}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:16777215}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,i,n,r){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,n,r)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,i,n,r,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new THREE.Color(16777215)),void 0===n&&(n=THREE.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:r,blending:n})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=.25*t.x*Math.PI,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length;this.createAnimation("__default",0,i-1,i/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){t={startFrame:t,endFrame:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,n={},r=this.geometry,o=0,a=r.morphTargets.length;a>o;o++){var s=r.morphTargets[o].name.match(i);if(s&&1<s.length){var l=s[1];n[l]||(n[l]={start:1/0,end:-1/0}),s=n[l],o<s.start&&(s.start=o),o>s.end&&(s.end=o),t||(t=l)}}for(l in n)s=n[l],this.createAnimation(l,s.start,s.end,e);this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;i>t;t++){var n=this.animationsList[t];if(n.active){var r=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||0>n.time)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),0>n.time&&(n.time=0,n.directionBackwards=!1)):(n.time%=n.duration,0>n.time&&(n.time+=n.duration));var o=n.startFrame+THREE.Math.clamp(Math.floor(n.time/r),0,n.length-1),a=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o),r=n.time%r/r,n.directionBackwards&&(r=1-r),this.morphTargetInfluences[n.currentFrame]=r*a,this.morphTargetInfluences[n.lastFrame]=(1-r)*a}}},THREE.LensFlarePlugin=function(){function e(e,i){var n=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),a="precision "+i+" float;\n";return t.shaderSource(r,a+e.fragmentShader),t.shaderSource(o,a+e.vertexShader),t.compileShader(r),t.compileShader(o),t.attachShader(n,r),t.attachShader(n,o),t.linkProgram(n),n}var t,i,n,r,o,a,s,l,h,c,d,u,p;this.init=function(f){t=f.context,i=f,n=f.getPrecision(),r=new Float32Array(16),o=new Uint16Array(6),f=0,r[f++]=-1,r[f++]=-1,r[f++]=0,r[f++]=0,r[f++]=1,r[f++]=-1,r[f++]=1,r[f++]=0,r[f++]=1,r[f++]=1,r[f++]=1,r[f++]=1,r[f++]=-1,r[f++]=1,r[f++]=0,r[f++]=1,f=0,o[f++]=0,o[f++]=1,o[f++]=2,o[f++]=0,o[f++]=2,o[f++]=3,a=t.createBuffer(),s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW),l=t.createTexture(),h=t.createTexture(),t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),0>=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(c=!1,d=e(THREE.ShaderFlares.lensFlare,n)):(c=!0,d=e(THREE.ShaderFlares.lensFlareVertexTexture,n)),u={},p={},u.vertex=t.getAttribLocation(d,"position"),u.uv=t.getAttribLocation(d,"uv"),p.renderType=t.getUniformLocation(d,"renderType"),p.map=t.getUniformLocation(d,"map"),p.occlusionMap=t.getUniformLocation(d,"occlusionMap"),p.opacity=t.getUniformLocation(d,"opacity"),p.color=t.getUniformLocation(d,"color"),p.scale=t.getUniformLocation(d,"scale"),p.rotation=t.getUniformLocation(d,"rotation"),p.screenPosition=t.getUniformLocation(d,"screenPosition")},this.render=function(e,n,r,o){var e=e.__webglFlares,f=e.length;if(f){var m=new THREE.Vector3,g=o/r,v=.5*r,E=.5*o,y=16/o,x=new THREE.Vector2(y*g,y),T=new THREE.Vector3(1,1,0),b=new THREE.Vector2(1,1),_=p,y=u;t.useProgram(d),t.enableVertexAttribArray(u.vertex),t.enableVertexAttribArray(u.uv),t.uniform1i(_.occlusionMap,0),t.uniform1i(_.map,1),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(y.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(y.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.disable(t.CULL_FACE),t.depthMask(!1);var R,w,S,H,M;for(R=0;f>R;R++)if(y=16/o,x.set(y*g,y),H=e[R],m.set(H.matrixWorld.elements[12],H.matrixWorld.elements[13],H.matrixWorld.elements[14]),m.applyMatrix4(n.matrixWorldInverse),m.applyProjection(n.projectionMatrix),T.copy(m),b.x=T.x*v+v,b.y=T.y*E+E,c||0<b.x&&b.x<r&&0<b.y&&b.y<o)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,b.x-8,b.y-8,16,16,0),t.uniform1i(_.renderType,0),t.uniform2f(_.scale,x.x,x.y),t.uniform3f(_.screenPosition,T.x,T.y,T.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,b.x-8,b.y-8,16,16,0),t.uniform1i(_.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,l),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),H.positionScreen.copy(T),H.customUpdateCallback?H.customUpdateCallback(H):H.updateLensFlares(),t.uniform1i(_.renderType,2),t.enable(t.BLEND),w=0,S=H.lensFlares.length;S>w;w++)M=H.lensFlares[w],.001<M.opacity&&.001<M.scale&&(T.x=M.x,T.y=M.y,T.z=M.z,y=M.size*M.scale/o,x.x=y*g,x.y=y,t.uniform3f(_.screenPosition,T.x,T.y,T.z),t.uniform2f(_.scale,x.x,x.y),t.uniform1f(_.rotation,M.rotation),t.uniform1f(_.opacity,M.opacity),t.uniform3f(_.color,M.color.r,M.color.g,M.color.b),i.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst),i.setTexture(M.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,i,n,r,o,a=new THREE.Frustum,s=new THREE.Matrix4,l=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3;this.init=function(a){e=a.context,t=a;var a=THREE.ShaderLib.depthRGBA,s=THREE.UniformsUtils.clone(a.uniforms);i=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s}),n=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,morphTargets:!0}),r=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,skinning:!0}),o=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,morphTargets:!0,skinning:!0}),i._shadowPass=!0,n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0},this.render=function(e,i){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,i)},this.update=function(d,u){var p,f,m,g,v,E,y,x,T,b=[];for(g=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===THREE.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),p=0,f=d.__lights.length;f>p;p++)if(m=d.__lights[p],m.castShadow)if(m instanceof THREE.DirectionalLight&&m.shadowCascade)for(v=0;v<m.shadowCascadeCount;v++){var _;if(m.shadowCascadeArray[v])_=m.shadowCascadeArray[v];else{T=m,y=v,_=new THREE.DirectionalLight,_.isVirtual=!0,_.onlyShadow=!0,_.castShadow=!0,_.shadowCameraNear=T.shadowCameraNear,_.shadowCameraFar=T.shadowCameraFar,_.shadowCameraLeft=T.shadowCameraLeft,_.shadowCameraRight=T.shadowCameraRight,_.shadowCameraBottom=T.shadowCameraBottom,_.shadowCameraTop=T.shadowCameraTop,_.shadowCameraVisible=T.shadowCameraVisible,_.shadowDarkness=T.shadowDarkness,_.shadowBias=T.shadowCascadeBias[y],_.shadowMapWidth=T.shadowCascadeWidth[y],_.shadowMapHeight=T.shadowCascadeHeight[y],_.pointsWorld=[],_.pointsFrustum=[],x=_.pointsWorld,E=_.pointsFrustum;for(var R=0;8>R;R++)x[R]=new THREE.Vector3,E[R]=new THREE.Vector3;x=T.shadowCascadeNearZ[y],T=T.shadowCascadeFarZ[y],E[0].set(-1,-1,x),E[1].set(1,-1,x),E[2].set(-1,1,x),E[3].set(1,1,x),E[4].set(-1,-1,T),E[5].set(1,-1,T),E[6].set(-1,1,T),E[7].set(1,1,T),_.originalCamera=u,E=new THREE.Gyroscope,E.position=m.shadowCascadeOffset,E.add(_),E.add(_.target),u.add(E),m.shadowCascadeArray[v]=_,console.log("Created virtualLight",_)}y=m,x=v,T=y.shadowCascadeArray[x],T.position.copy(y.position),T.target.position.copy(y.target.position),T.lookAt(T.target),T.shadowCameraVisible=y.shadowCameraVisible,T.shadowDarkness=y.shadowDarkness,T.shadowBias=y.shadowCascadeBias[x],E=y.shadowCascadeNearZ[x],y=y.shadowCascadeFarZ[x],T=T.pointsFrustum,T[0].z=E,T[1].z=E,T[2].z=E,T[3].z=E,T[4].z=y,T[5].z=y,T[6].z=y,T[7].z=y,b[g]=_,g++}else b[g]=m,g++;for(p=0,f=b.length;f>p;p++){if(m=b[p],m.shadowMap||(v=THREE.LinearFilter,t.shadowMapType===THREE.PCFSoftShadowMap&&(v=THREE.NearestFilter),m.shadowMap=new THREE.WebGLRenderTarget(m.shadowMapWidth,m.shadowMapHeight,{minFilter:v,magFilter:v,format:THREE.RGBAFormat}),m.shadowMapSize=new THREE.Vector2(m.shadowMapWidth,m.shadowMapHeight),m.shadowMatrix=new THREE.Matrix4),!m.shadowCamera){if(m instanceof THREE.SpotLight)m.shadowCamera=new THREE.PerspectiveCamera(m.shadowCameraFov,m.shadowMapWidth/m.shadowMapHeight,m.shadowCameraNear,m.shadowCameraFar);else{if(!(m instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}m.shadowCamera=new THREE.OrthographicCamera(m.shadowCameraLeft,m.shadowCameraRight,m.shadowCameraTop,m.shadowCameraBottom,m.shadowCameraNear,m.shadowCameraFar)}d.add(m.shadowCamera),!0===d.autoUpdate&&d.updateMatrixWorld()}if(m.shadowCameraVisible&&!m.cameraHelper&&(m.cameraHelper=new THREE.CameraHelper(m.shadowCamera),m.shadowCamera.add(m.cameraHelper)),m.isVirtual&&_.originalCamera==u){for(v=u,g=m.shadowCamera,E=m.pointsFrustum,T=m.pointsWorld,l.set(1/0,1/0,1/0),h.set(-1/0,-1/0,-1/0),y=0;8>y;y++)x=T[y],x.copy(E[y]),THREE.ShadowMapPlugin.__projector.unprojectVector(x,v),x.applyMatrix4(g.matrixWorldInverse),x.x<l.x&&(l.x=x.x),x.x>h.x&&(h.x=x.x),x.y<l.y&&(l.y=x.y),x.y>h.y&&(h.y=x.y),x.z<l.z&&(l.z=x.z),x.z>h.z&&(h.z=x.z);g.left=l.x,g.right=h.x,g.top=h.y,g.bottom=l.y,g.updateProjectionMatrix()}for(g=m.shadowMap,E=m.shadowMatrix,v=m.shadowCamera,v.position.getPositionFromMatrix(m.matrixWorld),c.getPositionFromMatrix(m.target.matrixWorld),v.lookAt(c),v.updateMatrixWorld(),v.matrixWorldInverse.getInverse(v.matrixWorld),m.cameraHelper&&(m.cameraHelper.visible=m.shadowCameraVisible),m.shadowCameraVisible&&m.cameraHelper.update(),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(v.projectionMatrix),E.multiply(v.matrixWorldInverse),s.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse),a.setFromMatrix(s),t.setRenderTarget(g),t.clear(),T=d.__webglObjects,m=0,g=T.length;g>m;m++)y=T[m],E=y.object,y.render=!1,!E.visible||!E.castShadow||(E instanceof THREE.Mesh||E instanceof THREE.ParticleSystem)&&E.frustumCulled&&!a.intersectsObject(E)||(E._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,E.matrixWorld),y.render=!0);for(m=0,g=T.length;g>m;m++)y=T[m],y.render&&(E=y.object,y=y.buffer,R=E.material instanceof THREE.MeshFaceMaterial?E.material.materials[0]:E.material,x=0<E.geometry.morphTargets.length&&R.morphTargets,R=E instanceof THREE.SkinnedMesh&&R.skinning,x=E.customDepthMaterial?E.customDepthMaterial:R?x?o:r:x?n:i,y instanceof THREE.BufferGeometry?t.renderBufferDirect(v,d.__lights,null,x,y,E):t.renderBuffer(v,d.__lights,null,x,y,E));for(T=d.__webglObjectsImmediate,m=0,g=T.length;g>m;m++)y=T[m],E=y.object,E.visible&&E.castShadow&&(E._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,E.matrixWorld),t.renderImmediateObject(v,d.__lights,null,i,E))}p=t.getClearColor(),f=t.getClearAlpha(),e.clearColor(p.r,p.g,p.b,f),e.enable(e.BLEND),t.shadowMapCullFace===THREE.CullFaceFront&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var t,i,n,r,o,a,s,l,h,c,d,u,p,f,m,g,v,E,y,x,T,b,_,R,w,S;this.init=function(e){y=e.context,x=e,b=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),_=new Uint16Array([0,1,2,0,2,3]),R=y.createBuffer(),w=y.createBuffer(),y.bindBuffer(y.ARRAY_BUFFER,R),y.bufferData(y.ARRAY_BUFFER,b,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,w),y.bufferData(y.ELEMENT_ARRAY_BUFFER,_,y.STATIC_DRAW);
var e=y.createProgram(),H=y.createShader(y.VERTEX_SHADER),M=y.createShader(y.FRAGMENT_SHADER);y.shaderSource(H,["precision "+x.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nuniform vec2 halfViewport;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n")),y.shaderSource(M,["precision "+x.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n")),y.compileShader(H),y.compileShader(M),y.attachShader(e,H),y.attachShader(e,M),y.linkProgram(e),S=e,v=y.getAttribLocation(S,"position"),E=y.getAttribLocation(S,"uv"),t=y.getUniformLocation(S,"uvOffset"),i=y.getUniformLocation(S,"uvScale"),n=y.getUniformLocation(S,"rotation"),r=y.getUniformLocation(S,"scale"),o=y.getUniformLocation(S,"halfViewport"),a=y.getUniformLocation(S,"color"),s=y.getUniformLocation(S,"map"),l=y.getUniformLocation(S,"opacity"),h=y.getUniformLocation(S,"modelViewMatrix"),c=y.getUniformLocation(S,"projectionMatrix"),d=y.getUniformLocation(S,"fogType"),u=y.getUniformLocation(S,"fogDensity"),p=y.getUniformLocation(S,"fogNear"),f=y.getUniformLocation(S,"fogFar"),m=y.getUniformLocation(S,"fogColor"),g=y.getUniformLocation(S,"alphaTest"),e=document.createElement("canvas"),e.width=8,e.height=8,H=e.getContext("2d"),H.fillStyle="#ffffff",H.fillRect(0,0,e.width,e.height),T=new THREE.Texture(e),T.needsUpdate=!0},this.render=function(b,_,H,M){var C=b.__webglSprites,D=C.length;if(D){H*=.5,M*=.5,y.useProgram(S),y.enableVertexAttribArray(v),y.enableVertexAttribArray(E),y.disable(y.CULL_FACE),y.enable(y.BLEND),y.bindBuffer(y.ARRAY_BUFFER,R),y.vertexAttribPointer(v,2,y.FLOAT,!1,16,0),y.vertexAttribPointer(E,2,y.FLOAT,!1,16,8),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,w),y.uniformMatrix4fv(c,!1,_.projectionMatrix.elements),y.activeTexture(y.TEXTURE0),y.uniform1i(s,0);var A=0,I=0,P=b.fog;P?(y.uniform3f(m,P.color.r,P.color.g,P.color.b),P instanceof THREE.Fog?(y.uniform1f(p,P.near),y.uniform1f(f,P.far),y.uniform1i(d,1),I=A=1):P instanceof THREE.FogExp2&&(y.uniform1f(u,P.density),y.uniform1i(d,2),I=A=2)):(y.uniform1i(d,0),I=A=0);for(var L,k=[],P=0;D>P;P++)L=C[P],!1!==L.visible&&(L._modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,L.matrixWorld),L.z=-L._modelViewMatrix.elements[14]);for(C.sort(e),P=0;D>P;P++)L=C[P],!1!==L.visible&&(_=L.material,y.uniform1f(g,_.alphaTest),y.uniformMatrix4fv(h,!1,L._modelViewMatrix.elements),k[0]=L.scale.x,k[1]=L.scale.y,L=b.fog&&_.fog?I:0,A!==L&&(y.uniform1i(d,L),A=L),y.uniform2f(i,_.uvScale.x,_.uvScale.y),y.uniform2f(t,_.uvOffset.x,_.uvOffset.y),y.uniform1f(l,_.opacity),y.uniform3f(a,_.color.r,_.color.g,_.color.b),y.uniform1f(n,_.rotation),y.uniform2fv(r,k),y.uniform2f(o,H,M),x.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),x.setDepthTest(_.depthTest),x.setDepthWrite(_.depthWrite),_.map&&_.map.image&&_.map.image.width?x.setTexture(_.map,0):x.setTexture(T,0),y.drawElements(y.TRIANGLES,6,y.UNSIGNED_SHORT,0));y.enable(y.CULL_FACE)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,i,n,r,o,a=new THREE.Frustum,s=new THREE.Matrix4;this.init=function(a){e=a.context,t=a;var a=THREE.ShaderLib.depthRGBA,s=THREE.UniformsUtils.clone(a.uniforms);i=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s}),n=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,morphTargets:!0}),r=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,skinning:!0}),o=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,morphTargets:!0,skinning:!0}),i._shadowPass=!0,n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,h){var c,d,u,p,f,m;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),!0===l.autoUpdate&&l.updateMatrixWorld(),h.matrixWorldInverse.getInverse(h.matrixWorld),s.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),a.setFromMatrix(s),t.setRenderTarget(this.renderTarget),t.clear(),m=l.__webglObjects,c=0,d=m.length;d>c;c++)u=m[c],f=u.object,u.render=!1,!f.visible||(f instanceof THREE.Mesh||f instanceof THREE.ParticleSystem)&&f.frustumCulled&&!a.intersectsObject(f)||(f._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,f.matrixWorld),u.render=!0);var g;for(c=0,d=m.length;d>c;c++)u=m[c],!u.render||(f=u.object,u=u.buffer,f instanceof THREE.ParticleSystem&&!f.customDepthMaterial)||((g=f.material instanceof THREE.MeshFaceMaterial?f.material.materials[0]:f.material)&&t.setMaterialFaces(f.material),p=0<f.geometry.morphTargets.length&&g.morphTargets,g=f instanceof THREE.SkinnedMesh&&g.skinning,p=f.customDepthMaterial?f.customDepthMaterial:g?p?o:r:p?n:i,u instanceof THREE.BufferGeometry?t.renderBufferDirect(h,l.__lights,null,p,u,f):t.renderBuffer(h,l.__lights,null,p,u,f));for(m=l.__webglObjectsImmediate,c=0,d=m.length;d>c;c++)u=m[c],f=u.object,f.visible&&(f._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,f.matrixWorld),t.renderImmediateObject(h,l.__lights,null,i,f));c=t.getClearColor(),d=t.getClearAlpha(),e.clearColor(c.r,c.g,c.b,d),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},function(e){function t(e,t,i){var n,r,o,a;return n=(e[i.signx].x+t.x-i.ray.origin.x)*i.ray_invx,r=(e[1-i.signx].x+t.x-i.ray.origin.x)*i.ray_invx,o=(e[i.signy].y+t.y-i.ray.origin.y)*i.ray_invy,a=(e[1-i.signy].y+t.y-i.ray.origin.y)*i.ray_invy,n>a||o>r?!1:(o>n&&(n=o),r>a&&(r=a),o=(e[i.signz].z+t.z-i.ray.origin.z)*i.ray_invz,e=(e[1-i.signz].z+t.z-i.ray.origin.z)*i.ray_invz,n>e||o>r?!1:(o>n&&(n=o),r>e&&(r=e),n<i.far&&r>i.near))}e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),this.near=n||0,this.far=r||1/0,this.ray_invx=0==this.ray.direction.x?1/0:1/this.ray.direction.x,this.ray_invy=0==this.ray.direction.y?1/0:1/this.ray.direction.y,this.ray_invz=0==this.ray.direction.z?1/0:1/this.ray.direction.z,this.signx=0>this.ray_invx?1:0,this.signy=0>this.ray_invy?1:0,this.signz=0>this.ray_invz?1:0};var i=new e.Sphere,n=new e.Ray;new e.Plane,new e.Vector3;var r=new e.Vector3,o=new e.Matrix4,a=function(e,t){return e.distance-t.distance},s=new e.Vector3,l=new e.Vector3,h=new e.Vector3,c=function(a,d,u){if(a instanceof e.Sprite){r.getPositionFromMatrix(a.matrixWorld);var p=d.ray.distanceToPoint(r);if(p>a.scale.x)return u;u.push({distance:p,point:a.position,face:null,object:a})}else if(a instanceof e.LOD)r.getPositionFromMatrix(a.matrixWorld),p=d.ray.origin.distanceTo(r),c(a.getObjectForDistance(p),d,u);else if(a instanceof e.Mesh){if(0==a.visible||void 0!==a.geometry.min&&!t([a.geometry.min,a.geometry.max],a.position,d)||void 0!==a.geometry.boundingBox&&a.geometry.boundingBox&&void 0!==a.geometry.boundingBox.min&&!t([a.geometry.boundingBox.min,a.geometry.boundingBox.max],a.position,d))return u;var f=a.geometry;if(o.getInverse(a.matrixWorld),n.copy(d.ray).applyMatrix4(o),f instanceof e.BufferGeometry){var m=a.material;if(void 0===m||!1===f.dynamic)return u;var g,v,E=d.precision;if(void 0!==f.attributes.index)for(var y=f.offsets,x=f.attributes.index.array,T=f.attributes.position.array,b=f.offsets.length,_=f.attributes.index.array.length/3,_=0;b>_;++_)for(var p=y[_].start,R=y[_].index,f=p,w=p+y[_].count;w>f;f+=3)p=R+x[f],g=R+x[f+1],v=R+x[f+2],s.set(T[3*p],T[3*p+1],T[3*p+2]),l.set(T[3*g],T[3*g+1],T[3*g+2]),h.set(T[3*v],T[3*v+1],T[3*v+2]),g=m.side===e.BackSide?n.intersectTriangle(h,l,s,!0):n.intersectTriangle(s,l,h,m.side!==e.DoubleSide),null!==g&&(g.applyMatrix4(a.matrixWorld),p=d.ray.origin.distanceTo(g),E>p||p<d.near||p>d.far||u.push({distance:p,point:g,face:null,faceIndex:null,object:a}));else for(T=f.attributes.position.array,_=f.attributes.position.array.length,f=0;_>f;f+=3)p=f,g=f+1,v=f+2,s.set(T[3*p],T[3*p+1],T[3*p+2]),l.set(T[3*g],T[3*g+1],T[3*g+2]),h.set(T[3*v],T[3*v+1],T[3*v+2]),g=m.side===e.BackSide?n.intersectTriangle(h,l,s,!0):n.intersectTriangle(s,l,h,m.side!==e.DoubleSide),null!==g&&(g.applyMatrix4(a.matrixWorld),p=d.ray.origin.distanceTo(g),E>p||p<d.near||p>d.far||u.push({distance:p,point:g,face:null,faceIndex:null,object:a}))}else if(f instanceof e.Geometry)for(x=a.material instanceof e.MeshFaceMaterial,T=!0===x?a.material.materials:null,E=d.precision,y=f.vertices,b=0,_=f.faces.length;_>b;b++)R=f.faces[b],(void 0===R.bound_min||t([R.bound_min,R.bound_max],a.position,d))&&(m=!0===x?T[R.materialIndex]:a.material,void 0!==m&&(p=y[R.a],g=y[R.b],v=y[R.c],g=m.side===e.BackSide?n.intersectTriangle(v,g,p,!0):n.intersectTriangle(p,g,v,m.side!==e.DoubleSide),null!==g&&(g.applyMatrix4(a.matrixWorld),p=d.ray.origin.distanceTo(g),E>p||p<d.near||p>d.far||u.push({distance:p,point:g,face:R,faceIndex:b,object:a}))))}else if(a instanceof e.Line){if(E=d.linePrecision,m=E*E,f=a.geometry,null===f.boundingSphere&&f.computeBoundingSphere(),i.copy(f.boundingSphere),i.applyMatrix4(a.matrixWorld),!1===d.ray.isIntersectionSphere(i))return u;if(o.getInverse(a.matrixWorld),n.copy(d.ray).applyMatrix4(o),f instanceof e.Geometry)for(y=f.vertices,E=y.length,g=new e.Vector3,v=new e.Vector3,_=a.type===e.LineStrip?1:2,f=0;E-1>f;f+=_)n.distanceSqToSegment(y[f],y[f+1],v,g)>m||(p=n.origin.distanceTo(v),p<d.near||p>d.far||u.push({distance:p,point:g.clone().applyMatrix4(a.matrixWorld),face:null,faceIndex:null,object:a}))}},d=function(e,t,i){for(var e=e.getDescendants(),n=0,r=e.length;r>n;n++)c(e[n],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return!0===t&&d(e,this,i),c(e,this,i),i.sort(a),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],n=0,r=e.length;r>n;n++)c(e[n],this,i),!0===t&&d(e[n],this,i);return i.sort(a),i}}(THREE),THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,i,n){var r=this,o=document.createElement("img");return void 0!==t&&o.addEventListener("load",function(){r.manager.itemEnd(e),t(this)},!1),void 0!==i&&o.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&o.addEventListener("error",function(e){n(e)},!1),o.src=e,r.manager.itemStart(e),o},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else if ( combine == 2 ) {\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) || defined (BASIC)\n#ifdef USE_SKINNING\nvec4 worldPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nworldNormal = normalize( worldNormal );\nvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, worldNormal );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\nvLightBack = vec3( 0.2, 0.2, 0.2 );\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nuniform int boneTextureWidth;\nuniform int boneTextureHeight;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, float( boneTextureWidth ) );\nfloat y = floor( j / float( boneTextureWidth ) );\nfloat dx = 1.0 / float( boneTextureWidth );\nfloat dy = 1.0 / float( boneTextureHeight );\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.0 * xPixelOffset;\nfloat dy0 = -1.0 * yPixelOffset;\nfloat dx1 = 1.0 * xPixelOffset;\nfloat dy1 = 1.0 * yPixelOffset;\nmat3 shadowKernel;\nmat3 depthKernel;\ndepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\ndepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\ndepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\ndepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\ndepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\ndepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\ndepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\ndepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\ndepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nvec3 shadowZ = vec3( shadowCoord.z );\nshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\nshadowKernel[0] *= vec3(0.25);\nshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\nshadowKernel[1] *= vec3(0.25);\nshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\nshadowKernel[2] *= vec3(0.25);\nvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\nshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\nshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\nvec4 shadowValues;\nshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\nshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\nshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\nshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\nshadow = dot( shadowValues, vec4( 1.0 ) );\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif",clipping_pars_fragment:"uniform int clipStatus;\nuniform int clipXDirection;\nuniform float clipXPosition;\nuniform int clipYDirection;\nuniform float clipYPosition;\nuniform int clipZDirection;\nuniform float clipZPosition;",clipping_assign_world_pos:"customWorldPosition = worldPosition;",clipping_declare_world_pos:"varying vec4 customWorldPosition;",clipping_check_or_discard:"if(clipStatus==1){\nif(clipXDirection==0 && customWorldPosition[0] > clipXPosition) discard;\nelse if(clipXDirection==1 && customWorldPosition[0] < clipXPosition) discard;\nif(clipYDirection==0 && customWorldPosition[1] > clipYPosition) discard;\nelse if(clipYDirection==1 && customWorldPosition[1] < clipYPosition) discard;\nif(clipZDirection==0 && customWorldPosition[2] > clipZPosition) discard;\nelse if(clipZDirection==1 && customWorldPosition[2] < clipZPosition) discard;\n}",clipping_fragcolor:"#ifdef DOUBLE_SIDED\n#ifdef gl_FrontFacing\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif"},THREE.UniformsUtils={merge:function(e){var t,i,n,r={};
for(t=0;t<e.length;t++)for(i in n=this.clone(e[t]))r[i]=n[i];return r},clone:function(e){var t,i,n,r={};for(t in e)for(i in r[t]={},e[t])n=e[t][i],r[t][i]=n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture?n.clone():n instanceof Array?n.slice():n;return r}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}},clipview:{clipStatus:{type:"i",value:0},clipXDirection:{type:"i",value:0},clipXPosition:{type:"f",value:0},clipYDirection:{type:"i",value:0},clipYPosition:{type:"f",value:0},clipZDirection:{type:"i",value:0},clipZPosition:{type:"f",value:0}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap,THREE.UniformsLib.clipview]),vertexShader:["#define BASIC",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.clipping_declare_world_pos,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.clipping_assign_world_pos,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.clipping_declare_world_pos,THREE.ShaderChunk.clipping_pars_fragment,"uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {",THREE.ShaderChunk.clipping_check_or_discard,"gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,THREE.UniformsLib.clipview,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;",THREE.ShaderChunk.clipping_declare_world_pos,"#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.clipping_assign_world_pos,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.clipping_declare_world_pos,THREE.ShaderChunk.clipping_pars_fragment,"uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {",THREE.ShaderChunk.clipping_check_or_discard,"gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.clipping_fragcolor,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\nif ( mod( vLineDistance, totalSize ) > dashSize ) {\ndiscard;\n}\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalize( normalMatrix * skinnedNormal.xyz );\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n#else\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\n#endif\nvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = worldPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\nvoid main() {\ngl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n}"},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0},LZMA.OutWindow.prototype.create=function(e){this._buffer&&this._windowSize===e||(this._buffer=[]),this._windowSize=e,this._streamPos=this._pos=0},LZMA.OutWindow.prototype.flush=function(){var e=this._pos-this._streamPos;if(0!==e){for(;e--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},LZMA.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},LZMA.OutWindow.prototype.setStream=function(e){this.releaseStream(),this._stream=e},LZMA.OutWindow.prototype.init=function(e){e||(this._pos=this._streamPos=0)},LZMA.OutWindow.prototype.copyBlock=function(e,t){var i=this._pos-e-1;for(0>i&&(i+=this._windowSize);t--;)i>=this._windowSize&&(i=0),this._buffer[this._pos++]=this._buffer[i++],this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.putByte=function(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.getByte=function(e){return e=this._pos-e-1,0>e&&(e+=this._windowSize),this._buffer[e]},LZMA.RangeDecoder=function(){},LZMA.RangeDecoder.prototype.setStream=function(e){this._stream=e},LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null},LZMA.RangeDecoder.prototype.init=function(){var e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()},LZMA.RangeDecoder.prototype.decodeDirectBits=function(e){for(var t,i=0;e--;)this._range>>>=1,t=this._code-this._range>>>31,this._code-=this._range&t-1,i=i<<1|1-t,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return i},LZMA.RangeDecoder.prototype.decodeBit=function(e,t){var i=e[t],n=(this._range>>>11)*i;return(2147483648^this._code)<(2147483648^n)?(this._range=n,e[t]+=2048-i>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=n,this._code-=n,e[t]-=i>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},LZMA.initBitModels=function(e,t){for(;t--;)e[t]=1024},LZMA.BitTreeDecoder=function(e){this._models=[],this._numBitLevels=e},LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.decode=function(e){for(var t=1,i=this._numBitLevels;i--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.reverseDecode=function(e){for(var t,i=1,n=0,r=0;r<this._numBitLevels;++r)t=e.decodeBit(this._models,i),i=i<<1|t,n|=t<<r;return n},LZMA.reverseDecode2=function(e,t,i,n){for(var r,o=1,a=0,s=0;n>s;++s)r=i.decodeBit(e,t+o),o=o<<1|r,a|=r<<s;return a},LZMA.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new LZMA.BitTreeDecoder(8),this._numPosStates=0},LZMA.LenDecoder.prototype.create=function(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)},LZMA.LenDecoder.prototype.init=function(){var e=this._numPosStates;for(LZMA.initBitModels(this._choice,2);e--;)this._lowCoder[e].init(),this._midCoder[e].init();this._highCoder.init()},LZMA.LenDecoder.prototype.decode=function(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)},LZMA.Decoder2=function(){this._decoders=[]},LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)},LZMA.Decoder2.prototype.decodeNormal=function(e){var t=1;do t=t<<1|e.decodeBit(this._decoders,t);while(256>t);return 255&t},LZMA.Decoder2.prototype.decodeWithMatchByte=function(e,t){var i,n,r=1;do if(i=t>>7&1,t<<=1,n=e.decodeBit(this._decoders,(1+i<<8)+r),r=r<<1|n,i!==n){for(;256>r;)r=r<<1|e.decodeBit(this._decoders,r);break}while(256>r);return 255&r},LZMA.LiteralDecoder=function(){},LZMA.LiteralDecoder.prototype.create=function(e,t){var i;if(!this._coders||this._numPrevBits!==t||this._numPosBits!==e)for(this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[],i=1<<this._numPrevBits+this._numPosBits;i--;)this._coders[i]=new LZMA.Decoder2},LZMA.LiteralDecoder.prototype.init=function(){for(var e=1<<this._numPrevBits+this._numPosBits;e--;)this._coders[e].init()},LZMA.LiteralDecoder.prototype.getDecoder=function(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]},LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow,this._rangeDecoder=new LZMA.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new LZMA.BitTreeDecoder(4),this._lenDecoder=new LZMA.LenDecoder,this._repLenDecoder=new LZMA.LenDecoder,this._literalDecoder=new LZMA.LiteralDecoder,this._dictionarySizeCheck=this._dictionarySize=-1,this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)},LZMA.Decoder.prototype.setDictionarySize=function(e){return 0>e?!1:(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)
},LZMA.Decoder.prototype.setLcLpPb=function(e,t,i){var n=1<<i;return e>8||t>4||i>4?!1:(this._literalDecoder.create(t,e),this._lenDecoder.create(n),this._repLenDecoder.create(n),this._posStateMask=n-1,!0)},LZMA.Decoder.prototype.init=function(){var e=4;for(this._outWindow.init(!1),LZMA.initBitModels(this._isMatchDecoders,192),LZMA.initBitModels(this._isRep0LongDecoders,192),LZMA.initBitModels(this._isRepDecoders,12),LZMA.initBitModels(this._isRepG0Decoders,12),LZMA.initBitModels(this._isRepG1Decoders,12),LZMA.initBitModels(this._isRepG2Decoders,12),LZMA.initBitModels(this._posDecoders,114),this._literalDecoder.init();e--;)this._posSlotDecoder[e].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},LZMA.Decoder.prototype.decode=function(e,t,i){var n=0,r=0,o=0,a=0,s=0,l=0,h=0;for(this._rangeDecoder.setStream(e),this._outWindow.setStream(t),this.init();0>i||i>l;)if(e=l&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(n<<4)+e))h=this._literalDecoder.getDecoder(l++,h),h=n>=7?h.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(r)):h.decodeNormal(this._rangeDecoder),this._outWindow.putByte(h),n=4>n?0:n-(10>n?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,n))h=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,n)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(n<<4)+e)&&(n=7>n?9:11,h=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,n)?t=o:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,n)?t=a:(t=s,s=a),a=o),o=r,r=t),0===h&&(h=2+this._repLenDecoder.decode(this._rangeDecoder,e),n=7>n?8:11);else if(s=a,a=o,o=r,h=2+this._lenDecoder.decode(this._rangeDecoder,e),n=7>n?7:10,e=this._posSlotDecoder[5>=h?h-2:3].decode(this._rangeDecoder),e>=4){if(t=(e>>1)-1,r=(2|1&e)<<t,14>e)r+=LZMA.reverseDecode2(this._posDecoders,r-e-1,this._rangeDecoder,t);else if(r+=this._rangeDecoder.decodeDirectBits(t-4)<<4,r+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>r){if(-1===r)break;return!1}}else r=e;if(r>=l||r>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(r,h),l+=h,h=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},LZMA.Decoder.prototype.setDecoderProperties=function(e){var t,i;return 5>e.size?!1:(t=e.readByte(),i=t%9,t=~~(t/9),this.setLcLpPb(i,t%5,~~(t/5))?(t=e.readByte(),t|=e.readByte()<<8,t|=e.readByte()<<16,t+=16777216*e.readByte(),this.setDictionarySize(t)):!1)},LZMA.decompress=function(e,t,i,n){var r=new LZMA.Decoder;if(!r.setDecoderProperties(e))throw"Incorrect stream properties";if(!r.decode(t,i,n))throw"Error in data stream";return!0};var CTM=CTM||{};CTM.CompressionMethod={RAW:5718354,MG1:3229517,MG2:3295053},CTM.Flags={NORMALS:1},CTM.File=function(e){this.load(e)},CTM.File.prototype.load=function(e){this.header=new CTM.FileHeader(e),this.body=new CTM.FileBody(this.header),this.getReader().read(e,this.body)},CTM.File.prototype.getReader=function(){var e;switch(this.header.compressionMethod){case CTM.CompressionMethod.RAW:e=new CTM.ReaderRAW;break;case CTM.CompressionMethod.MG1:e=new CTM.ReaderMG1;break;case CTM.CompressionMethod.MG2:e=new CTM.ReaderMG2}return e},CTM.FileHeader=function(e){e.readInt32(),this.fileFormat=e.readInt32(),this.compressionMethod=e.readInt32(),this.vertexCount=e.readInt32(),this.triangleCount=e.readInt32(),this.uvMapCount=e.readInt32(),this.attrMapCount=e.readInt32(),this.flags=e.readInt32(),this.comment=e.readString()},CTM.FileHeader.prototype.hasNormals=function(){return this.flags&CTM.Flags.NORMALS},CTM.FileBody=function(e){var t=3*e.triangleCount,i=3*e.vertexCount,n=e.hasNormals()?3*e.vertexCount:0,r=2*e.vertexCount,o=4*e.vertexCount,a=0,s=new ArrayBuffer(4*(t+i+n+r*e.uvMapCount+o*e.attrMapCount));if(this.indices=new Uint32Array(s,0,t),this.vertices=new Float32Array(s,4*t,i),e.hasNormals()&&(this.normals=new Float32Array(s,4*(t+i),n)),e.uvMapCount)for(this.uvMaps=[],a=0;a<e.uvMapCount;++a)this.uvMaps[a]={uv:new Float32Array(s,4*(t+i+n+a*r),r)};if(e.attrMapCount)for(this.attrMaps=[],a=0;a<e.attrMapCount;++a)this.attrMaps[a]={attr:new Float32Array(s,4*(t+i+n+r*e.uvMapCount+a*o),o)}},CTM.FileMG2Header=function(e){e.readInt32(),this.vertexPrecision=e.readFloat32(),this.normalPrecision=e.readFloat32(),this.lowerBoundx=e.readFloat32(),this.lowerBoundy=e.readFloat32(),this.lowerBoundz=e.readFloat32(),this.higherBoundx=e.readFloat32(),this.higherBoundy=e.readFloat32(),this.higherBoundz=e.readFloat32(),this.divx=e.readInt32(),this.divy=e.readInt32(),this.divz=e.readInt32(),this.sizex=(this.higherBoundx-this.lowerBoundx)/this.divx,this.sizey=(this.higherBoundy-this.lowerBoundy)/this.divy,this.sizez=(this.higherBoundz-this.lowerBoundz)/this.divz},CTM.ReaderRAW=function(){},CTM.ReaderRAW.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},CTM.ReaderRAW.prototype.readIndices=function(e,t){e.readInt32(),e.readArrayInt32(t)},CTM.ReaderRAW.prototype.readVertices=function(e,t){e.readInt32(),e.readArrayFloat32(t)},CTM.ReaderRAW.prototype.readNormals=function(e,t){e.readInt32(),e.readArrayFloat32(t)},CTM.ReaderRAW.prototype.readUVMaps=function(e,t){for(var i=0;i<t.length;++i)e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString(),e.readArrayFloat32(t[i].uv)},CTM.ReaderRAW.prototype.readAttrMaps=function(e,t){for(var i=0;i<t.length;++i)e.readInt32(),t[i].name=e.readString(),e.readArrayFloat32(t[i].attr)},CTM.ReaderMG1=function(){},CTM.ReaderMG1.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},CTM.ReaderMG1.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length),CTM.restoreIndices(t,t.length)},CTM.ReaderMG1.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,1);LZMA.decompress(e,e,i,i.data.length)},CTM.ReaderMG1.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length)},CTM.ReaderMG1.prototype.readUVMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString(),e.readInt32();var n=new CTM.InterleavedStream(t[i].uv,2);LZMA.decompress(e,e,n,n.data.length)}},CTM.ReaderMG1.prototype.readAttrMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString(),e.readInt32();var n=new CTM.InterleavedStream(t[i].attr,4);LZMA.decompress(e,e,n,n.data.length)}},CTM.ReaderMG2=function(){},CTM.ReaderMG2.prototype.read=function(e,t){this.MG2Header=new CTM.FileMG2Header(e),this.readVertices(e,t.vertices),this.readIndices(e,t.indices),t.normals&&this.readNormals(e,t),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},CTM.ReaderMG2.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length),i=this.readGridIndices(e,t),CTM.restoreVertices(t,this.MG2Header,i,this.MG2Header.vertexPrecision)},CTM.ReaderMG2.prototype.readGridIndices=function(e,t){e.readInt32(),e.readInt32();var i=new Uint32Array(t.length/3),n=new CTM.InterleavedStream(i,1);return LZMA.decompress(e,e,n,n.data.length),CTM.restoreGridIndices(i,i.length),i},CTM.ReaderMG2.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t,3);LZMA.decompress(e,e,i,i.data.length),CTM.restoreIndices(t,t.length)},CTM.ReaderMG2.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();var i=new CTM.InterleavedStream(t.normals,3);LZMA.decompress(e,e,i,i.data.length),i=CTM.calcSmoothNormals(t.indices,t.vertices),CTM.restoreNormals(t.normals,i,this.MG2Header.normalPrecision)},CTM.ReaderMG2.prototype.readUVMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString();var n=e.readFloat32();e.readInt32();var r=new CTM.InterleavedStream(t[i].uv,2);LZMA.decompress(e,e,r,r.data.length),CTM.restoreMap(t[i].uv,2,n)}},CTM.ReaderMG2.prototype.readAttrMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString();var n=e.readFloat32();e.readInt32();var r=new CTM.InterleavedStream(t[i].attr,4);LZMA.decompress(e,e,r,r.data.length),CTM.restoreMap(t[i].attr,4,n)}},CTM.restoreIndices=function(e,t){var i=3;for(t>0&&(e[2]+=e[0],e[1]+=e[0]);t>i;i+=3)e[i]+=e[i-3],e[i+1]=e[i]===e[i-3]?e[i+1]+e[i-2]:e[i+1]+e[i],e[i+2]+=e[i]},CTM.restoreGridIndices=function(e,t){for(var i=1;t>i;++i)e[i]+=e[i-1]},CTM.restoreVertices=function(e,t,i,n){for(var r,o,a,s,l,h=new Uint32Array(e.buffer,e.byteOffset,e.length),c=t.divx,d=c*t.divy,u=2147483647,p=0,f=0,m=0,g=i.length;g>f;m+=3)a=r=i[f++],l=~~(a/d),a-=~~(l*d),s=~~(a/c),a-=~~(s*c),o=h[m],r===u&&(o+=p),e[m]=t.lowerBoundx+a*t.sizex+n*o,e[m+1]=t.lowerBoundy+s*t.sizey+n*h[m+1],e[m+2]=t.lowerBoundz+l*t.sizez+n*h[m+2],u=r,p=o},CTM.restoreNormals=function(e,t,i){for(var n,r,o,a,s,l,h=new Uint32Array(e.buffer,e.byteOffset,e.length),c=0,d=e.length;d>c;c+=3)n=h[c]*i,r=h[c+1],0===r?(e[c]=t[c]*n,e[c+1]=t[c+1]*n,e[c+2]=t[c+2]*n):(o=4>=r?1.5707963267948966*(h[c+2]-2):1.5707963267948966*(4*h[c+2]/r-2),r*=1.5707963267948966*i,a=n*Math.sin(r),s=a*Math.cos(o),o=a*Math.sin(o),n*=Math.cos(r),a=t[c+1],r=t[c]-t[c+2],l=Math.sqrt(2*a*a+r*r),l>1e-20&&(r/=l,a/=l),e[c]=t[c]*n+(t[c+1]*a-t[c+2]*r)*o-a*s,e[c+1]=t[c+1]*n-(t[c+2]+t[c])*a*o+r*s,e[c+2]=t[c+2]*n+(t[c]*r+t[c+1]*a)*o+a*s)},CTM.restoreMap=function(e,t,i){for(var n,r,o,a=new Uint32Array(e.buffer,e.byteOffset,e.length),s=0,l=e.length;t>s;++s)for(n=0,o=s;l>o;o+=t)r=a[o],n+=1&r?-(r+1>>1):r>>1,e[o]=n*i},CTM.calcSmoothNormals=function(e,t){var i,n,r,o,a,s,l,h,c,d,u,p,f=new Float32Array(t.length);for(u=0,p=e.length;p>u;)i=3*e[u++],n=3*e[u++],r=3*e[u++],s=t[n]-t[i],h=t[r]-t[i],l=t[n+1]-t[i+1],c=t[r+1]-t[i+1],a=t[n+2]-t[i+2],d=t[r+2]-t[i+2],o=l*d-a*c,a=a*h-s*d,s=s*c-l*h,l=Math.sqrt(o*o+a*a+s*s),l>1e-10&&(o/=l,a/=l,s/=l),f[i]+=o,f[i+1]+=a,f[i+2]+=s,f[n]+=o,f[n+1]+=a,f[n+2]+=s,f[r]+=o,f[r+1]+=a,f[r+2]+=s;for(u=0,p=f.length;p>u;u+=3)l=Math.sqrt(f[u]*f[u]+f[u+1]*f[u+1]+f[u+2]*f[u+2]),l>1e-10&&(f[u]/=l,f[u+1]/=l,f[u+2]/=l);return f},CTM.isLittleEndian=function(){var e=new ArrayBuffer(2),t=new Uint8Array(e),e=new Uint16Array(e);return t[0]=1,1===e[0]}(),CTM.InterleavedStream=function(e,t){this.data=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.offset=CTM.isLittleEndian?3:0,this.count=4*t,this.len=this.data.length},CTM.InterleavedStream.prototype.writeByte=function(e){this.data[this.offset]=e,this.offset+=this.count,this.offset>=this.len&&(this.offset-=this.len-4,this.offset>=this.count&&(this.offset-=this.count+(CTM.isLittleEndian?1:-1)))},CTM.Stream=function(e){this.data=e,this.offset=0},CTM.Stream.prototype.TWO_POW_MINUS23=Math.pow(2,-23),CTM.Stream.prototype.TWO_POW_MINUS126=Math.pow(2,-126),CTM.Stream.prototype.readByte=function(){return 255&this.data[this.offset++]},CTM.Stream.prototype.readInt32=function(){var e=this.readByte(),e=e|this.readByte()<<8,e=e|this.readByte()<<16;return e|this.readByte()<<24},CTM.Stream.prototype.readFloat32=function(){var e=this.readByte(),e=e+(this.readByte()<<8),t=this.readByte(),i=this.readByte(),e=e+((127&t)<<16),t=(127&i)<<1|(128&t)>>>7,i=128&i?-1:1;return 255===t?0!==e?0/0:1/0*i:t>0?i*(1+e*this.TWO_POW_MINUS23)*Math.pow(2,t-127):0!==e?i*e*this.TWO_POW_MINUS126:0*i},CTM.Stream.prototype.readString=function(){var e=this.readInt32();return this.offset+=e,this.data.subarray(this.offset-e,e)},CTM.Stream.prototype.readArrayInt32=function(e){for(var t=0,i=e.length;i>t;)e[t++]=this.readInt32();return e},CTM.Stream.prototype.readArrayFloat32=function(e){for(var t=0,i=e.length;i>t;)e[t++]=this.readFloat32();return e},THREE.CTMLoader=function(e){THREE.Loader.call(this,e)},THREE.CTMLoader.prototype=Object.create(THREE.Loader.prototype),THREE.CTMLoader.prototype.loadParts=function(e,t,i){var n=this,r=new XMLHttpRequest,o=i.basePath?i.basePath:this.extractUrlBase(e);r.onreadystatechange=function(){if(4===r.readyState&&(200===r.status||0===r.status)){for(var e=JSON.parse(r.responseText),a=[],s=[],l=0,h=0;h<e.materials.length;h++)a[h]=THREE.Loader.prototype.createMaterial(e.materials[h],o);n.load(o+e.data,function(i){l+=1,s.push(i),l===e.offsets.length&&t(s,a)},{useWorker:i.useWorker,useBuffers:i.useBuffers,offsets:e.offsets})}},r.open("GET",e,!0),r.setRequestHeader("Content-Type","text/plain"),r.send(null)},THREE.CTMLoader.prototype.load=function(e,t,i){var n=this,r=void 0!==i.offsets?i.offsets:[0],o=void 0!==i.useBuffers?i.useBuffers:!0,a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status||0===a.status){var s=new Uint8Array(a.response),l=Date.now();if(i.useWorker){var h=new Worker("js/loaders/ctm/CTMWorker.js");h.onmessage=function(e){for(var e=e.data,i=0;i<e.length;i++){var r=e[i],a=Date.now();o?n.createModelBuffers(r,t):n.createModelClassic(r,t),r=Date.now(),console.log("model load time [worker]: "+(r-a)+" ms, total: "+(r-l))}},h.postMessage({data:s,offsets:r})}else for(h=0;h<r.length;h++){var c=new CTM.Stream(s);c.offset=r[h],c=new CTM.File(c),o?n.createModelBuffers(c,t):n.createModelClassic(c,t)}}else console.error("Couldn't load ["+e+"] ["+a.status+"]");else 3!==a.readyState&&2===a.readyState&&a.getResponseHeader("Content-Length")},a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null)},THREE.CTMLoader.prototype.createModelBuffers=function(e,t){var i=function(){this.materials=[],THREE.BufferGeometry.call(this),Date.now();var t,i,n=e.body.indices,r=e.body.vertices,o=e.body.normals;void 0!==e.body.uvMaps&&0<e.body.uvMaps.length&&(t=e.body.uvMaps[0].uv),void 0!==e.body.attrMaps&&0<e.body.attrMaps.length&&"Color"===e.body.attrMaps[0].name&&(i=e.body.attrMaps[0].attr);for(var a=function(e,t){return void 0===t[e]&&(t[e]=c,h[c]=e,c+=1),t[e]},s=new Uint32Array(n.length),l={},h={},c=0,d=0,u=Math.ceil(n.length/3e3),p=new Uint32Array(u),f=0;f<n.length;f+=3){var m=n[f],g=n[f+1],v=n[f+2];a(m,l),a(g,l),a(v,l),65535<Math.abs(l[m]-l[g])||65535<Math.abs(l[g]-l[v])||65535<Math.abs(l[v]-l[m])?(d>=u&&(console.warn("reached sprawled faces limit: "+d),u*=2,m=new Uint32Array(u),m.set(p),p=m),p[d]=f,d+=1):(s[f]=l[m],s[f+1]=l[g],s[f+2]=l[v])}for(u={},m=0;d>m;m++)for(f=p[m],l=0;3>l;l++)s[f+l]=a(n[f+l],u);var E,y,x,f=new Float32Array(3*c);for(o&&(E=new Float32Array(3*c)),t&&(y=new Float32Array(2*c)),i&&(x=new Float32Array(4*c)),n=0;c>n;n++)a=h[n],d=n,p=3*a,l=3*a+1,u=3*a+2,m=3*d,g=3*d+1,v=3*d+2,f[m]=r[p],f[g]=r[l],f[v]=r[u],o&&(E[m]=o[p],E[g]=o[l],E[v]=o[u]),t&&(y[2*d]=t[2*a],y[2*d+1]=t[2*a+1]),i&&(x[4*d]=i[4*a],x[4*d+1]=i[4*a+1],x[4*d+2]=i[4*a+2],x[4*d+3]=i[4*a+3]);for(n=s,r=f,o&&(o=E),t&&(t=y),i&&(i=x),this.offsets=[],s=n,E=0,x=r.length,a=0,y=x,f=0;f<s.length;){for(l=0;3>l;++l)d=s[f++],x>d&&(x=d),d>a&&(a=d);if(a-x>65535){if(f-=3,y>0)for(x=E;f>x;++x)s[x]-=y;this.offsets.push({start:E,count:f-E,index:y}),E=f,x=r.length,a=0}y=x}if(y>0)for(x=E;f>x;++x)s[x]-=y;this.offsets.push({start:E,count:f-E,index:y}),s=new Uint16Array(n),E=this.attributes,E.index={itemSize:1,array:s,numItems:s.length},E.position={itemSize:3,array:r,numItems:r.length},void 0!==o&&(E.normal={itemSize:3,array:o,numItems:o.length}),void 0!==t&&(E.uv={itemSize:2,array:t,numItems:t.length}),void 0!==i&&(E.color={itemSize:4,array:i,numItems:i.length})};i.prototype=Object.create(THREE.BufferGeometry.prototype),i=new i,void 0===i.attributes.normal&&i.computeVertexNormals(),t(i)},THREE.CTMLoader.prototype.createModelClassic=function(e,t){var i=function(){this.materials=[],THREE.Geometry.call(this);var t,i,n,r,o=[],a=[],s=[],l=e.body.vertices,h=l.length;for(r=0;h>r;r+=3)t=l[r],i=l[r+1],n=l[r+2],this.vertices.push(new THREE.Vector3(t,i,n));if(void 0!==e.body.normals)for(l=e.body.normals,h=l.length,r=0;h>r;r+=3)t=l[r],i=l[r+1],n=l[r+2],o.push(t,i,n);if(void 0!==e.body.uvMaps&&0<e.body.uvMaps.length)for(l=e.body.uvMaps[0].uv,r=l.length,n=0;r>n;n+=2)t=l[n],i=l[n+1],a.push(t,i);if(void 0!==e.body.attrMaps&&0<e.body.attrMaps.length&&"Color"===e.body.attrMaps[0].name)for(l=e.body.attrMaps[0].attr,h=l.length,r=0;h>r;r+=4){t=l[r],i=l[r+1],n=l[r+2];var c=new THREE.Color;c.setRGB(t,i,n),s.push(c)}l=0<o.length?!0:!1,t=0<a.length?!0:!1,i=0<s.length?!0:!1,n=e.body.indices;var d,u,p,f,m,g,v,h=n.length;for(r=0;h>r;r+=3){if(d=n[r],u=n[r+1],c=n[r+2],l){p=d,g=u,v=c;var E=o[3*u],y=o[3*u+1],x=o[3*u+2];m=o[3*c];var T=o[3*c+1],b=o[3*c+2];f=new THREE.Vector3(o[3*d],o[3*d+1],o[3*d+2]),E=new THREE.Vector3(E,y,x),m=new THREE.Vector3(m,T,b),p=new THREE.Face3(p,g,v,[f,E,m],null,0)}else p=new THREE.Face3(d,u,c,null,null,0);this.faces.push(p),i&&(p.vertexColors[0]=s[d],p.vertexColors[1]=s[u],p.vertexColors[2]=s[c]),t&&(p=a[2*d],d=a[2*d+1],f=a[2*u],m=a[2*u+1],g=a[2*c],v=a[2*c+1],c=this.faceVertexUvs[0],u=f,f=m,m=[],m.push(new THREE.Vector2(p,d)),m.push(new THREE.Vector2(u,f)),m.push(new THREE.Vector2(g,v)),c.push(m))}this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox()};i.prototype=Object.create(THREE.Geometry.prototype),t(new i)},THREE.STLLoader=function(){},THREE.STLLoader.prototype={constructor:THREE.STLLoader},THREE.STLLoader.prototype.load=function(e,t){var i=this,n=new XMLHttpRequest;n.addEventListener("load",function(n){200===n.target.status||0===n.target.status?(n=i.parse(n.target.response||n.target.responseText),i.dispatchEvent({type:"load",content:n}),t&&t(n)):i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]",response:n.target.responseText})},!1),n.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),n.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.overrideMimeType("text/plain; charset=x-user-defined"),n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null)},THREE.STLLoader.prototype.parse=function(e){var t,i=this.ensureBinary(e);return t=new DataView(i),84+50*t.getUint32(80,!0)===t.byteLength?this.parseBinary(i):this.parseASCII(this.ensureString(e))},THREE.STLLoader.prototype.parseBinary=function(e){var t,i,n,r,o,a,s;for(n=new DataView(e),i=n.getUint32(80,!0),t=new THREE.Geometry,e=0;i>e;e++){for(a=84+50*e,o=new THREE.Vector3(n.getFloat32(a,!0),n.getFloat32(a+4,!0),n.getFloat32(a+8,!0)),r=1;3>=r;r++)s=a+12*r,t.vertices.push(new THREE.Vector3(n.getFloat32(s,!0),n.getFloat32(s+4,!0),n.getFloat32(s+8,!0)));r=t.vertices.length,t.faces.push(new THREE.Face3(r-3,r-2,r-1,o))}return t.computeCentroids(),t.computeBoundingSphere(),t},THREE.STLLoader.prototype.parseASCII=function(e){var t,i,n,r,o,a;for(t=new THREE.Geometry,r=/facet([\s\S]*?)endfacet/g;null!=(i=r.exec(e));){for(a=i[0],o=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!=(i=o.exec(a));)n=new THREE.Vector3(parseFloat(i[1]),parseFloat(i[3]),parseFloat(i[5]));for(o=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!=(i=o.exec(a));)t.vertices.push(new THREE.Vector3(parseFloat(i[1]),parseFloat(i[3]),parseFloat(i[5])));i=t.vertices.length,t.faces.push(new THREE.Face3(i-3,i-2,i-1,n))}return t.computeCentroids(),t.computeBoundingBox(),t.computeBoundingSphere(),t},THREE.STLLoader.prototype.ensureString=function(e){if("string"!=typeof e){for(var t=new Uint8Array(e),i="",n=0;n<e.byteLength;n++)i+=String.fromCharCode(t[n]);return i}return e},THREE.STLLoader.prototype.ensureBinary=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e},THREE.EventDispatcher.prototype.apply(THREE.STLLoader.prototype),"undefined"==typeof DataView&&(DataView=function(e,t,i){this.buffer=e,this.byteOffset=t||0,this.byteLength=i||e.byteLength||e.length,this._isString="string"==typeof e},DataView.prototype={_getCharCodes:function(e,t,i){for(var t=t||0,i=i||e.length,i=t+i,n=[];i>t;t++)n.push(255&e.charCodeAt(t));return n},_getBytes:function(e,t,i){if(void 0===i&&(i=this._littleEndian),t=void 0===t?this.byteOffset:this.byteOffset+t,void 0===e&&(e=this.byteLength-t),"number"!=typeof t)throw new TypeError("DataView byteOffset is not a number");if(0>e||t+e>this.byteLength)throw Error("DataView length or (byteOffset+length) value is out of bounds");return t=this.isString?this._getCharCodes(this.buffer,t,t+e):this.buffer.slice(t,t+e),!i&&e>1&&(t instanceof Array||(t=Array.prototype.slice.call(t)),t.reverse()),t},getFloat64:function(e,t){var i=this._getBytes(8,e,t),n=1-2*(i[7]>>7),r=((i[7]<<1&255)<<3|i[6]>>4)-1023,i=(15&i[6])*Math.pow(2,48)+i[5]*Math.pow(2,40)+i[4]*Math.pow(2,32)+i[3]*Math.pow(2,24)+i[2]*Math.pow(2,16)+i[1]*Math.pow(2,8)+i[0];return 1024===r?0!==i?0/0:1/0*n:-1023===r?n*i*Math.pow(2,-1074):n*(1+i*Math.pow(2,-52))*Math.pow(2,r)},getFloat32:function(e,t){var i=this._getBytes(4,e,t),n=1-2*(i[3]>>7),r=(i[3]<<1&255|i[2]>>7)-127,i=(127&i[2])<<16|i[1]<<8|i[0];return 128===r?0!==i?0/0:1/0*n:-127===r?n*i*Math.pow(2,-149):n*(1+i*Math.pow(2,-23))*Math.pow(2,r)},getInt32:function(e,t){var i=this._getBytes(4,e,t);return i[3]<<24|i[2]<<16|i[1]<<8|i[0]},getUint32:function(e,t){return this.getInt32(e,t)>>>0},getInt16:function(e,t){return this.getUint16(e,t)<<16>>16},getUint16:function(e,t){var i=this._getBytes(2,e,t);return i[1]<<8|i[0]},getInt8:function(e){return this.getUint8(e)<<24>>24},getUint8:function(e){return this._getBytes(1,e)[0]}}),THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader(i.manager);n.setCrossOrigin("anonymous"),n.load(e,function(e){t(i.parse(e))})},parse:function(e){function t(e,t,i){return new THREE.Vector3(e,t,i)}function i(e,t){return new THREE.Vector2(e,t)}function n(e,t,i,n){return new THREE.Face3(e,t,i,n)}function r(e,t,i,r){void 0===r?s.faces.push(n(parseInt(e)-(d+1),parseInt(t)-(d+1),parseInt(i)-(d+1))):s.faces.push(n(parseInt(e)-(d+1),parseInt(t)-(d+1),parseInt(i)-(d+1),[u[parseInt(r[0])-1].clone(),u[parseInt(r[1])-1].clone(),u[parseInt(r[2])-1].clone()]))}function o(e,t,i){s.faceVertexUvs[0].push([p[parseInt(e)-1].clone(),p[parseInt(t)-1].clone(),p[parseInt(i)-1].clone()])}function a(e,t,i){void 0===e[3]?(r(e[0],e[1],e[2],i),void 0!==t&&0<t.length&&o(t[0],t[1],t[2])):(void 0!==i&&0<i.length?(r(e[0],e[1],e[3],[i[0],i[1],i[3]]),r(e[1],e[2],e[3],[i[1],i[2],i[3]])):(r(e[0],e[1],e[3]),r(e[1],e[2],e[3])),void 0!==t&&0<t.length&&(o(t[0],t[1],t[3]),o(t[1],t[2],t[3])))}var s,l,h,c=new THREE.Object3D,d=0;!1===/^o /gm.test(e)&&(s=new THREE.Geometry,l=new THREE.MeshLambertMaterial,h=new THREE.Mesh(s,l),c.add(h));for(var u=[],p=[],f=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,m=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,g=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,v=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,E=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,y=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,x=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,T=e.split("\n"),e=0;e<T.length;e++){var b=T[e],b=b.trim();0===b.length||"#"===b.charAt(0)||(null!==(h=f.exec(b))?s.vertices.push(t(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]))):null!==(h=m.exec(b))?u.push(t(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]))):null!==(h=g.exec(b))?p.push(i(parseFloat(h[1]),parseFloat(h[2]))):null!==(h=v.exec(b))?a([h[1],h[2],h[3],h[4]]):null!==(h=E.exec(b))?a([h[2],h[5],h[8],h[11]],[h[3],h[6],h[9],h[12]]):null!==(h=y.exec(b))?a([h[2],h[6],h[10],h[14]],[h[3],h[7],h[11],h[15]],[h[4],h[8],h[12],h[16]]):null!==(h=x.exec(b))?a([h[2],h[5],h[8],h[11]],[],[h[3],h[6],h[9],h[12]]):/^o /.test(b)?(void 0!==s&&(d+=s.vertices.length),s=new THREE.Geometry,l=new THREE.MeshLambertMaterial,h=new THREE.Mesh(s,l),h.name=b.substring(2).trim(),c.add(h)):/^g /.test(b)||(/^usemtl /.test(b)?l.name=b.substring(7).trim():/^mtllib /.test(b)||/^s /.test(b)))}for(e=0,l=c.children.length;l>e;e++)s=c.children[e].geometry,s.computeCentroids(),s.computeFaceNormals(),s.computeBoundingSphere(),s.computeBoundingBox();return c}},THREE.MTLLoader=function(e,t,i){this.baseUrl=e,this.options=t,this.crossOrigin=void 0===i?"anonymous":i,this.imageURLLookup=null},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader;n.setCrossOrigin("anonymous"),n.load(e,function(e){t(i.parse(e))})},parse:function(e){for(var t=e.split("\n"),i={},n=/\s+/,e={},r=0;r<t.length;r++){var o=t[r],o=o.trim();if(0!==o.length&&"#"!==o.charAt(0)){var a=o.indexOf(" "),s=a>=0?o.substring(0,a):o,s=s.toLowerCase(),o=a>=0?o.substring(a+1):"",o=o.trim();"newmtl"===s?(i={name:o},e[o]=i):i&&("ka"===s||"kd"===s||"ks"===s?(o=o.split(n,3),i[s]=[parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])]):i[s]=o)}}return t=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.options),t.imageURLLookup=this.imageURLLookup,t.setMaterials(e),t}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping,this.imageURLLookup=null},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t,i={};for(t in e){var n=e[t],r={};i[t]=r;for(var o in n){var a=!0,s=n[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(a=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s)}a&&(r[l]=s)}}return i},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e,t=0;for(e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t,i=this.materialsInfo[e],n={name:e,side:this.side};for(t in i){var r=i[t];switch(t.toLowerCase()){case"kd":n.diffuse=(new THREE.Color).fromArray(r);break;case"ka":n.ambient=(new THREE.Color).fromArray(r);break;case"ks":n.specular=(new THREE.Color).fromArray(r);break;case"map_kd":var o=this.baseUrl+r;this.imageURLLookup&&(o=this.imageURLLookup(r)),""!=o&&(n.map=this.loadTexture(o),n.map.wrapS=this.wrap,n.map.wrapT=this.wrap);break;case"ns":n.shininess=r;break;case"d":1>r&&(n.transparent=!0,n.opacity=r)}}return n.diffuse&&(n.ambient||(n.ambient=n.diffuse),n.color=n.diffuse),this.materials[e]=new THREE.MeshLambertMaterial(n),this.materials[e]},loadTexture:function(e,t,i,n){if(/\.dds$/i.test(e))var r=THREE.ImageUtils.loadCompressedTexture(e,t,i,n);else n=new Image,r=new THREE.Texture(n,t),t=new THREE.ImageLoader,t.crossOrigin="anonymous",t.load(e,function(e){r.image=THREE.MTLLoader.ensurePowerOfTwo_(e),r.needsUpdate=!0,i&&i(r)});return r}},THREE.MTLLoader.ensurePowerOfTwo_=function(e){if(!THREE.MTLLoader.isPowerOfTwo_(e.width)||!THREE.MTLLoader.isPowerOfTwo_(e.height)){var t=document.createElement("canvas");return t.width=THREE.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=THREE.MTLLoader.nextHighestPowerOfTwo_(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},THREE.MTLLoader.isPowerOfTwo_=function(e){return 0===(e&e-1)},THREE.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype),THREE.OBJMTLLoader=function(){},THREE.OBJMTLLoader.prototype={constructor:THREE.OBJMTLLoader,load:function(e,t,i){var n=this,r=new THREE.MTLLoader(e.substr(0,e.lastIndexOf("/")+1));this.imageURLlookup&&(r.imageURLLookup=this.imageURLlookup),r.load(t,function(t){t.preload();var r=new THREE.XHRLoader(n.manager);r.setCrossOrigin(this.crossOrigin),r.setCrossOrigin("anonymous"),r.load(e,function(e){e=n.parse(e),e.traverse(function(e){if(e instanceof THREE.Mesh&&e.material.name){var i=t.create(e.material.name);i&&(e.material=i)}}),i(e)})})},parse:function(e,t){function i(e,t,i){return new THREE.Vector3(e,t,i)}function n(e,t){return new THREE.Vector2(e,t)}function r(e,t,i,n){return new THREE.Face3(e,t,i,n)}function o(e,t){0<m.length&&(u.vertices=m,u.mergeVertices(),u.computeCentroids(),u.computeFaceNormals(),u.computeBoundingBox(),u.computeBoundingSphere(),d.add(f),u=new THREE.Geometry,f=new THREE.Mesh(u,p)),void 0!==e&&(f.name=e),void 0!==t&&(p=new THREE.MeshLambertMaterial,p.name=t,f.material=p)}function a(e,t,i,n){void 0===n?u.faces.push(r(parseInt(e)-(h+1),parseInt(t)-(h+1),parseInt(i)-(h+1))):u.faces.push(r(parseInt(e)-(h+1),parseInt(t)-(h+1),parseInt(i)-(h+1),[g[parseInt(n[0])-1].clone(),g[parseInt(n[1])-1].clone(),g[parseInt(n[2])-1].clone()]))}function s(e,t,i){u.faceVertexUvs[0].push([v[parseInt(e)-1].clone(),v[parseInt(t)-1].clone(),v[parseInt(i)-1].clone()])}function l(e,t,i){void 0===e[3]?(a(e[0],e[1],e[2],i),void 0!==t&&0<t.length&&s(t[0],t[1],t[2])):(void 0!==i&&0<i.length?(a(e[0],e[1],e[3],[i[0],i[1],i[3]]),a(e[1],e[2],e[3],[i[1],i[2],i[3]])):(a(e[0],e[1],e[3]),a(e[1],e[2],e[3])),void 0!==t&&0<t.length&&(s(t[0],t[1],t[3]),s(t[1],t[2],t[3])))}for(var h=0,c=new THREE.Object3D,d=c,u=new THREE.Geometry,p=new THREE.MeshLambertMaterial,f=new THREE.Mesh(u,p),m=[],g=[],v=[],E=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,y=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,x=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,T=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,b=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,_=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,R=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,w=e.split("\n"),S=0;S<w.length;S++){var H,M=w[S],M=M.trim();0===M.length||"#"===M.charAt(0)||(null!==(H=E.exec(M))?m.push(i(parseFloat(H[1]),parseFloat(H[2]),parseFloat(H[3]))):null!==(H=y.exec(M))?g.push(i(parseFloat(H[1]),parseFloat(H[2]),parseFloat(H[3]))):null!==(H=x.exec(M))?v.push(n(parseFloat(H[1]),parseFloat(H[2]))):null!==(H=T.exec(M))?l([H[1],H[2],H[3],H[4]]):null!==(H=b.exec(M))?l([H[2],H[5],H[8],H[11]],[H[3],H[6],H[9],H[12]]):null!==(H=_.exec(M))?l([H[2],H[6],H[10],H[14]],[H[3],H[7],H[11],H[15]],[H[4],H[8],H[12],H[16]]):null!==(H=R.exec(M))?l([H[2],H[5],H[8],H[11]],[],[H[3],H[6],H[9],H[12]]):/^o /.test(M)?(o(),h+=m.length,m=[],d=new THREE.Object3D,d.name=M.substring(2).trim(),c.add(d)):/^g /.test(M)?o(M.substring(2).trim(),void 0):/^usemtl /.test(M)?o(void 0,M.substring(7).trim()):/^mtllib /.test(M)?t&&(M=M.substring(7),M=M.trim(),t(M)):/^s /.test(M)||console.log("THREE.OBJMTLLoader: Unhandled line "+M))}return o(void 0,void 0),c}},THREE.EventDispatcher.prototype.apply(THREE.OBJMTLLoader.prototype),THREE.TrackballControls=function(e,t){function i(e){!1!==a.enabled&&(window.removeEventListener("keydown",i),c=h,h===s.NONE&&(e.keyCode!==a.keys[s.ROTATE]||a.noRotate?e.keyCode!==a.keys[s.ZOOM]||a.noZoom?e.keyCode===a.keys[s.PAN]&&!a.noPan&&(h=s.PAN):h=s.ZOOM:h=s.ROTATE))}function n(e){!1!==a.enabled&&(e.preventDefault(),e.stopPropagation(),h!==s.ROTATE||a.noRotate?h!==s.ZOOM||a.noZoom?h===s.PAN&&!a.noPan&&(y=a.getMouseOnScreen(e.clientX,e.clientY)):m=a.getMouseOnScreen(e.clientX,e.clientY):p=a.getMouseProjectionOnBall(e.clientX,e.clientY))}function r(e){!1!==a.enabled&&(e.preventDefault(),e.stopPropagation(),h=s.NONE,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r),a.dispatchEvent(b))}function o(e){if(!1!==a.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),f.y+=.01*t,a.dispatchEvent(T),a.dispatchEvent(b)}}var a=this,s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;
var l=new THREE.Vector3,h=s.NONE,c=s.NONE,d=new THREE.Vector3,u=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector2,m=new THREE.Vector2,g=0,v=0,E=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var x={type:"change"},T={type:"start"},b={type:"end"};this.handleResize=function(){this.domElement===document?(this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight):this.screen=this.domElement.getBoundingClientRect()},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-a.screen.left)/a.screen.width,(t-a.screen.top)/a.screen.height)},this.getMouseProjectionOnBall=function(e,t){var i=new THREE.Vector3((e-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(.5*a.screen.height+a.screen.top-t)/(.5*a.screen.height),0),n=i.length();return a.noRoll?i.z=n<Math.SQRT1_2?Math.sqrt(1-n*n):.5/n:n>1?i.normalize():i.z=Math.sqrt(1-n*n),d.copy(a.object.position).sub(a.target),n=a.object.up.clone().setLength(i.y),n.add(a.object.up.clone().cross(d).setLength(i.x)),n.add(d.setLength(i.z)),n},this.rotateCamera=function(){var e=Math.acos(u.dot(p)/u.length()/p.length());if(e){var t=(new THREE.Vector3).crossVectors(u,p).normalize(),i=new THREE.Quaternion,e=e*a.rotateSpeed;i.setFromAxisAngle(t,-e),d.applyQuaternion(i),a.object.up.applyQuaternion(i),p.applyQuaternion(i),a.staticMoving?u.copy(p):(i.setFromAxisAngle(t,e*(a.dynamicDampingFactor-1)),u.applyQuaternion(i))}},this.zoomCamera=function(){if(h===s.TOUCH_ZOOM){var e=g/v;g=v,d.multiplyScalar(e)}else e=1+(m.y-f.y)*a.zoomSpeed,1!==e&&e>0&&(d.multiplyScalar(e),a.staticMoving?f.copy(m):f.y+=(m.y-f.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=y.clone().sub(E);if(e.lengthSq()){e.multiplyScalar(d.length()*a.panSpeed);var t=d.clone().cross(a.object.up).setLength(e.x);t.add(a.object.up.clone().setLength(e.y)),a.object.position.add(t),a.target.add(t),a.staticMoving?E=y:E.add(e.subVectors(y,E).multiplyScalar(a.dynamicDampingFactor))}},this.checkDistances=function(){a.noZoom&&a.noPan||(d.lengthSq()>a.maxDistance*a.maxDistance&&a.object.position.addVectors(a.target,d.setLength(a.maxDistance)),d.lengthSq()<a.minDistance*a.minDistance&&a.object.position.addVectors(a.target,d.setLength(a.minDistance)))},this.update=function(){d.subVectors(a.object.position,a.target),a.noRotate||a.rotateCamera(),a.noZoom||a.zoomCamera(),a.noPan||a.panCamera(),a.object.position.addVectors(a.target,d),a.checkDistances(),a.object.lookAt(a.target),0<l.distanceToSquared(a.object.position)&&(a.dispatchEvent(x),l.copy(a.object.position))},this.reset=function(){c=h=s.NONE,a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.up.copy(a.up0),d.subVectors(a.object.position,a.target),a.object.lookAt(a.target),a.dispatchEvent(x),l.copy(a.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){!1!==a.enabled&&(e.preventDefault(),e.stopPropagation(),h===s.NONE&&(h=e.button),h!==s.ROTATE||a.noRotate?h!==s.ZOOM||a.noZoom?h===s.PAN&&!a.noPan&&(E=a.getMouseOnScreen(e.clientX,e.clientY),y.copy(E)):(f=a.getMouseOnScreen(e.clientX,e.clientY),m.copy(f)):(u=a.getMouseProjectionOnBall(e.clientX,e.clientY),p.copy(u)),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",r,!1),a.dispatchEvent(T))},!1),this.domElement.addEventListener("mousewheel",o,!1),this.domElement.addEventListener("DOMMouseScroll",o,!1),this.domElement.addEventListener("touchstart",function(e){if(!1!==a.enabled){switch(e.touches.length){case 1:h=s.TOUCH_ROTATE,u=p=a.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:h=s.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY;v=g=Math.sqrt(t*t+e*e);break;case 3:h=s.TOUCH_PAN,E=y=a.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:h=s.NONE}a.dispatchEvent(T)}},!1),this.domElement.addEventListener("touchend",function(e){if(!1!==a.enabled){switch(e.touches.length){case 1:u=p=a.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:g=v=0;break;case 3:E=y=a.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}h=s.NONE,a.dispatchEvent(b)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!1!==a.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:p=a.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY;v=Math.sqrt(t*t+e*e);break;case 3:y=a.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:h=s.NONE}},!1),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",function(){!1!==a.enabled&&(h=c,window.addEventListener("keydown",i,!1))},!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var TPX=TPX||{};TPX.File=function(){},TPX.File.prototype.load=function(e){this.header=new TPX.FileHeader(e)},TPX.FileHeader=function(e){if(this.ver=e.readInt32(),1e4<=this.ver)this.ver=0;else if(400>this.ver)this.ver=0;else{if(400<=this.ver?(_readMassProperties(e,this),this.unitToMM=_intToFloatCoord(e.readInt32())):(this.unitToMM=1,this.min=new THREE.Vector3,this.max=new THREE.Vector3,this.min.x=_intToFloatCoord(e.readInt32()),this.min.y=_intToFloatCoord(e.readInt32()),this.min.z=_intToFloatCoord(e.readInt32()),this.max.x=_intToFloatCoord(e.readInt32()),this.max.y=_intToFloatCoord(e.readInt32()),this.max.z=_intToFloatCoord(e.readInt32())),200<=this.ver){this.colorTable=[],this.styleTable=[],this.materialTable=[];for(var t=e.readInt32(),i=0;t>i;++i)r=_intToFloatCoord(e.readInt32()),g=_intToFloatCoord(e.readInt32()),b=_intToFloatCoord(e.readInt32()),a=_intToFloatCoord(e.readInt32()),this.colorTable.push([r,g,b,a]);for(t=e.readInt32(),i=0;t>i;++i)colInd=e.readInt32(),trans=e.readInt32(),bMat=e.readInt32(),this.styleTable.push([colInd,trans,bMat]);for(t=e.readInt32(),i=0;t>i;++i)specular=e.readInt32(),emissive=e.readInt32(),diffuse=e.readInt32(),ambient=e.readInt32(),shininess=_intToFloatCoord(e.readInt32()),specularAlpha=_intToFloatCoord(e.readInt32()),emissiveAlpha=_intToFloatCoord(e.readInt32()),diffuseAlpha=_intToFloatCoord(e.readInt32()),ambientAlpha=_intToFloatCoord(e.readInt32()),this.materialTable.push([specular,emissive,diffuse,ambient,shininess,specularAlpha,emissiveAlpha,diffuseAlpha,ambientAlpha])}400>this.ver&&(this.numModels=e.readInt32())}},TPX.FileBody=function(i,r,o){if(i>=200){i>=400&&(_readMassProperties(o,r),r.styleIndex=decompStream.readInt32());for(var s=o.readInt32(),l=0;s>l;++l)x=o.readInt32(),y=o.readInt32(),z=o.readInt32(),r.vertices.push(new THREE.Vector3(_intToFloatCoord(x),_intToFloatCoord(y),_intToFloatCoord(z)));normals=[];for(var h=o.readInt32(),l=0;h>l;++l)x=o.readInt32(),y=o.readInt32(),z=o.readInt32(),normals.push([_intToFloatCoord(x),_intToFloatCoord(y),_intToFloatCoord(z)]);for(triangles=[],h=o.readInt32(),l=0;h>l;++l)t=o.readInt32(),triangles.push(t);for(faces=[],r.edges=[],h=o.readInt32(),l=0;h>l;++l){var c=2,d=[],u=1;if(i>=300)for(c=o.readInt32(),u=o.readInt32(),tric=0;u>tric;++tric)d.push(o.readInt32());else d.push(o.readInt32());for(this.styleIndex=o.readInt32(),void 0!=r.styleIndex&&-1!=r.styleIndex||1==this.styleIndex||(r.styleIndex=this.styleIndex),startingIndex=o.readInt32(),faces.push([c,u,d,startingIndex]),numEdges=o.readInt32(),d=0,u=!1,j=0;numEdges>j;++j){for(numEdgeVertices=o.readInt32(),edgeIndices=[],c=0;numEdgeVertices>c;++c)e=o.readInt32(),e>=3*s?(d++,u=!0):-1==e?u=!0:edgeIndices.push(e);u||r.edges.push(edgeIndices)}}for(tpDebug.print("  build faces"),l=0;h>l;++l)if(f=faces[l],c=f[0],d=f[2],startingIndex=f[3],8==c)for(o=d[0],s=u=i=0;o>s;++s){var p=0;for(n=[],v=[],c=0;c<d[s+1];++c)p=startingIndex+2*u,n.push(triangles[p+2*c]/3),v.push(triangles[p+2*c+1]/3),++i;for(var m,c=!0,g=0;g<n.length-2;++g)c?(u=g,p=g+1,m=g+2,c=!1):(u=g,p=g+2,m=g+1,c=!0),scopeFace=new THREE.Face3(v[u],v[p],v[m]),n1=n[u],n2=n[p],n3=n[m],scopeFace.vertexNormals=[new THREE.Vector3(normals[n1][0],normals[n1][1],normals[n1][2]),new THREE.Vector3(normals[n2][0],normals[n2][1],normals[n2][2]),new THREE.Vector3(normals[n3][0],normals[n3][1],normals[n3][2])],r.faces.push(scopeFace);u=i}else if(10==c){for(j=0;j<d[0];++j)n1=triangles[startingIndex+6*j]/3,v1=triangles[startingIndex+6*j+1]/3,n2=triangles[startingIndex+6*j+2]/3,v2=triangles[startingIndex+6*j+3]/3,n3=triangles[startingIndex+6*j+4]/3,v3=triangles[startingIndex+6*j+5]/3,scopeFace=new THREE.Face3(v1,v2,v3),scopeFace.vertexNormals=[new THREE.Vector3(normals[n1][0],normals[n1][1],normals[n1][2]),new THREE.Vector3(normals[n2][0],normals[n2][1],normals[n2][2]),new THREE.Vector3(normals[n3][0],normals[n3][1],normals[n3][2])],r.faces.push(scopeFace);for(o=d[1],s=u=i=0;o>s;++s){for(n=[],v=[],c=0;c<d[s+2];++c)p=startingIndex+6*d[0]+2*u,n.push(triangles[p+2*c]/3),v.push(triangles[p+2*c+1]/3),++i;for(c=!0,g=0;g<n.length-2;++g)c?(u=g,p=g+1,m=g+2,c=!1):(u=g,p=g+2,m=g+1,c=!0),scopeFace=new THREE.Face3(v[u],v[p],v[m]),n1=n[u],n2=n[p],n3=n[m],scopeFace.vertexNormals=[new THREE.Vector3(normals[n1][0],normals[n1][1],normals[n1][2]),new THREE.Vector3(normals[n2][0],normals[n2][1],normals[n2][2]),new THREE.Vector3(normals[n3][0],normals[n3][1],normals[n3][2])],r.faces.push(scopeFace);u=i}}else if(32==c)for(j=0;j<d[0];++j)n1=triangles[startingIndex+4*j]/3,v1=triangles[startingIndex+4*j+1]/3,v2=triangles[startingIndex+4*j+2]/3,v3=triangles[startingIndex+4*j+3]/3,scopeFace=new THREE.Face3(v1,v2,v3),scopeFace.vertexNormals=[new THREE.Vector3(normals[n1][0],normals[n1][1],normals[n1][2]),new THREE.Vector3(normals[n1][0],normals[n1][1],normals[n1][2]),new THREE.Vector3(normals[n1][0],normals[n1][1],normals[n1][2])],r.faces.push(scopeFace);else for(j=0;j<d[0];++j)n1=triangles[startingIndex+6*j]/3,v1=triangles[startingIndex+6*j+1]/3,n2=triangles[startingIndex+6*j+2]/3,v2=triangles[startingIndex+6*j+3]/3,n3=triangles[startingIndex+6*j+4]/3,v3=triangles[startingIndex+6*j+5]/3,scopeFace=new THREE.Face3(v1,v2,v3),scopeFace.vertexNormals=[new THREE.Vector3(normals[n1][0],normals[n1][1],normals[n1][2]),new THREE.Vector3(normals[n2][0],normals[n2][1],normals[n2][2]),new THREE.Vector3(normals[n3][0],normals[n3][1],normals[n3][2])],r.faces.push(scopeFace)}else{this.modelID=o.readInt32(),101>i&&(this.modelID=0),this.numVts=o.readInt32(),this.numFcs=o.readInt32(),this.numEds=o.readInt32(),this.numNurbsCvs=o.readInt32(),this.diffuse=[],this.ambient=[],this.emission=[],r.modelID=this.modelID;for(var l=0;4>l;++l)this.diffuse.push(_intToFloatMaterial(o.readInt32()));for(_checkDiffuseColor(this.diffuse),l=0;4>l;++l)this.ambient.push(_intToFloatMaterial(o.readInt32()));for(l=0;4>l;++l)this.emission.push(_intToFloatMaterial(o.readInt32()));for(this.shininess=_intToFloatMaterial(o.readInt32()),this.normals=new Float32Array(3*this.numVts),h=new THREE.Vector3,l=0;l<this.numVts;++l)x=o.readInt32(),y=o.readInt32(),z=o.readInt32(),r.vertices.push(new THREE.Vector3(_intToFloatCoord(x),_intToFloatCoord(y),_intToFloatCoord(z))),a=o.readInt16(),b=o.readInt16(),_getNormalVal(a,b,h),this.normals[3*l]=h.x,this.normals[3*l+1]=h.y,this.normals[3*l+2]=h.z;for(l=0;l<this.numFcs;++l)v1=o.readInt32(),v2=o.readInt32(),v3=o.readInt32(),fc=new THREE.Face3(v1,v2,v3),r.faces.push(fc),fc.vertexNormals=[new THREE.Vector3(this.normals[3*v1],this.normals[3*v1+1],this.normals[3*v1+2]),new THREE.Vector3(this.normals[3*v2],this.normals[3*v2+1],this.normals[3*v2+2]),new THREE.Vector3(this.normals[3*v3],this.normals[3*v3+1],this.normals[3*v3+2])]}for(d=new THREE.Vector3,o=new THREE.Vector3,h=r.faces.length,tpDebug.printInt("    calc face normal start:",h),l=0;h>l;l+=1)v1=r.vertices[r.faces[l].a],v2=r.vertices[r.faces[l].b],v3=r.vertices[r.faces[l].c],d.set(v2.x-v1.x,v2.y-v1.y,v2.z-v1.z),o.set(v3.x-v1.x,v3.y-v1.y,v3.z-v1.z),r.faces[l].normal=new THREE.Vector3,r.faces[l].normal.crossVectors(d,o).normalize(),i=v1.x<v2.x?v1.x:v2.x,i=i<v3.x?i:v3.x,s=v1.y<v2.y?v1.y:v2.y,s=s<v3.y?s:v3.y,c=v1.z<v2.z?v1.z:v2.z,c=c<v3.z?c:v3.z,u=v1.x>v2.x?v1.x:v2.x,u=u>v3.x?u:v3.x,p=v1.y>v2.y?v1.y:v2.y,p=p>v3.y?p:v3.y,m=v1.z>v2.z?v1.z:v2.z,m=m>v3.z?m:v3.z,r.faces[l].bound_min={x:i,y:s,z:c},r.faces[l].bound_max={x:u,y:p,z:m};tpDebug.print("    calc face normal end")},THREE.TPXLoader=function(e){THREE.Loader.call(this,e)};var decompStream={total:1,data:[],offset:0,writeByte:function(e){decompStream.data[decompStream.offset++]=e},readByte:function(){return 255&decompStream.data[decompStream.offset++]},readInt16:function(){var e=decompStream.readByte(),e=e|decompStream.readByte()<<8;return e>=32768&&(e|=-65536),e},readInt32:function(){var e=decompStream.readByte(),e=e|decompStream.readByte()<<8,e=e|decompStream.readByte()<<16;return e|decompStream.readByte()<<24}},readTPXPartNew=function(e,t,i,n){if(0!=decompStream.readInt32()){var r=[],o=new TPVIEWER.dispModel(t);o.children=[],t.children.push(o),l=decompStream.readInt32();for(var a=0;l>a;a++)t=decompStream.readByte(),r.push(t);for(o.name=String.fromCharCode.apply(String,r),_readMassProperties(decompStream,o),n.scale(o.min),n.scale(o.max),c=decompStream.readInt32(),o.isContainer=1==c?!0:!1,o.styleIndex=decompStream.readInt32(),o.numBreps=decompStream.readInt32(),tpDebug.printInt("  Breps: ",o.numBreps),o.breps=[],ibrep=0;ibrep<o.numBreps;++ibrep)if(scope=new THREE.Geometry,scope.modelID=e.currentModelId,THREE.Geometry.call(scope),scope.edges=[],body=new TPX.FileBody(i.ver,scope,decompStream),scope.vertices&&0!=scope.vertices.length&&scope.faces&&0!=scope.faces.length){for(tpDebug.printInt("  Vertices: ",scope.vertices.length),TPVIEWER.dispModel.prototype.tvertices+=scope.vertices.length,tpDebug.printInt("  Faces: ",scope.faces.length),TPVIEWER.dispModel.prototype.tfaces+=scope.faces.length,tpDebug.printInt("  Edges: ",scope.edges.length),TPVIEWER.dispModel.prototype.tedges+=scope.edges.length,r=0,t=scope.vertices.length;t>r;r++)n.scale(scope.vertices[r]);for(r=0,t=scope.faces.length;t>r;r++)n.scale(scope.faces[r].bound_min),n.scale(scope.faces[r].bound_max);n.scale(scope.min),n.scale(scope.max),r=Math.sqrt(scope.min.x*scope.min.x+scope.min.y*scope.min.y+scope.min.z*scope.min.z),scope.boundingSphere={radius:r,center:new THREE.Vector3((scope.max.x+scope.min.x)/2,(scope.max.y+scope.min.y)/2,(scope.max.z+scope.min.z)/2)},diffuse=[.6,.6,.6,1],ambient=[0,0,0,0],emission=[0,0,0,0],shininess=.5,styleIndex=-1==scope.styleIndex||65535==scope.styleIndex?o.styleIndex&&-1!=o.styleIndex?o.styleIndex:0:scope.styleIndex,styleIndex>=i.styleTable.length&&(styleIndex=0),0>=i.styleTable.length||(1==i.styleTable[styleIndex][2]?(m=i.styleTable[styleIndex][0],m>=0&&m<i.materialTable.length&&(sp=i.materialTable[m][0]/3,em=i.materialTable[m][1]/3,di=i.materialTable[m][2]/3,am=i.materialTable[m][3]/3,shininess=i.materialTable[m][4],emission[0]=i.colorTable[em][0],emission[1]=i.colorTable[em][1],emission[2]=i.colorTable[em][2],emission[3]=i.materialTable[m][6],diffuse[0]=i.colorTable[di][0],diffuse[1]=i.colorTable[di][1],diffuse[2]=i.colorTable[di][2],diffuse[3]=i.materialTable[m][7],ambient[0]=i.colorTable[am][0],ambient[1]=i.colorTable[am][1],ambient[2]=i.colorTable[am][2],ambient[3]=i.materialTable[m][8])):(c=i.styleTable[styleIndex][0]/3,tr=i.styleTable[styleIndex][1]/255,c>=0&&c<i.colorTable.length&&(diffuse[0]=i.colorTable[c][0],diffuse[1]=i.colorTable[c][1],diffuse[2]=i.colorTable[c][2],diffuse[3]=tr))),e.diffuses.push(diffuse),e.emissions.push(emission),e.shinesses.push(shininess),e.ambients.push(ambient),scope.massComputed=!1,scope.parentPartNode=o,e.geometries.push(scope),o.breps.push(scope)}for(r=decompStream.readInt32(),tpDebug.printInt("reading children : ",r),t=0;r>t;++t)tpDebug.isDebug()&&(0>t||t>100)||(e.currentModelId++,tpDebug.timeStart("child "+t+" reading"),readTPXPartNew(e,o,i,n),tpDebug.timeEnd("child "+t+" reading"))}};THREE.TPXLoader.prototype=new THREE.Loader,THREE.TPXLoader.prototype.constructor=THREE.TPXLoader,THREE.TPXLoader.prototype.supr=THREE.Loader.prototype,THREE.TPXLoader.prototype.createTPXModel=function(e){var t,i,n,r,o,a,s,l=i=0;if(s=-1,e=new CTM.Stream(e),t=new LZMA.Decoder,!t.setDecoderProperties(e))return null;for(o=0;8>o;++o)u=e.readByte(),i|=u<<8*o;if(!t.decode(e,decompStream,i))return null;if(decompStream.offset=0,decompStream.total=i,i=new TPX.FileHeader(decompStream),0==i.ver)return null;if(e=new TPVIEWER.dispModel,e.geometries=[],e.unitToMM=i.unitToMM,e.ambients=[],e.diffuses=[],e.emissions=[],e.shinesses=[],o=tpModelMaxLength,t=i.max.z-i.min.z,l=i.max.x-i.min.x,l=Math.max(l,i.max.y-i.min.y),l=Math.max(l,t),l=o/l,e.scaleFactor=l,e.isContainer=!0,t=new TPVIEWER.scaler((i.min.x+i.max.x)/2,(i.min.y+i.max.y)/2,(i.min.z+i.max.z)/2,l),e.min=i.min.clone(),t.scale(e.min),e.max=i.max.clone(),t.scale(e.max),e.area=i.area,e.volume=i.volume,e.currentModelId=0,400<=i.ver){e.part=new TPVIEWER.dispModel(e),e.part.children=[],readTPXPartNew(e,e.part,i,t),tpDebug.printInt("Total vertices: ",TPVIEWER.dispModel.prototype.tvertices),tpDebug.printInt("Total faces: ",TPVIEWER.dispModel.prototype.tfaces),tpDebug.printInt("Total edges: ",TPVIEWER.dispModel.prototype.tedges);var h=function(e){if(0==e.children.length)return e.volume;var t,i;for(t=e.volume=0,i=e.children.length;i>t;++t)e.volume+=h(e.children[t]);return e.volume},c=function(e){if(0==e.children.length)return e.area;var t,i;for(t=e.area=0,i=e.children.length;i>t;++t)e.area+=c(e.children[t]);return e.area};return h(e.part.children[0]),c(e.part.children[0]),e}for(o=0;o<i.numModels;++o){if(200<=i.ver){for(r=[],l=decompStream.readInt32(),s=0;l>s;s++)r.push(decompStream.readByte());String.fromCharCode.apply(String,r),s=decompStream.readInt32(),l=decompStream.readInt32(),e.currentModelId++}else l=1;for(a=0;l>a;++a)if(r=new THREE.Geometry,r.modelID=this.currentModelId,THREE.Geometry.call(r),r.edges=[],n=new TPX.FileBody(i.ver,r,decompStream),r.vertices&&0!=r.vertices.length&&r.faces&&0!=r.faces.length){var d;r.boundingBox={x:[r.vertices[0].x,r.vertices[0].x],y:[r.vertices[0].y,r.vertices[0].y],z:[r.vertices[0].z,r.vertices[0].z]};for(var u=1,p=r.vertices.length;p>u;u++)d=r.vertices[u],d.x<r.boundingBox.x[0]?r.boundingBox.x[0]=d.x:d.x>r.boundingBox.x[1]&&(r.boundingBox.x[1]=d.x),d.y<r.boundingBox.y[0]?r.boundingBox.y[0]=d.y:d.y>r.boundingBox.y[1]&&(r.boundingBox.y[1]=d.y),d.z<r.boundingBox.z[0]?r.boundingBox.z[0]=d.z:d.z>r.boundingBox.z[1]&&(r.boundingBox.z[1]=d.z);for(u=0,p=r.vertices.length;p>u;u++)t.scale(r.vertices[u]);for(u=0,p=r.faces.length;p>u;u++)t.scale(r.faces[u].bound_min),t.scale(r.faces[u].bound_max);for(u=0;2>u;++u)t.scale(r.boundingBox.x[u]);u=Math.sqrt(r.boundingBox.x[0]*r.boundingBox.x[0]+r.boundingBox.y[0]*r.boundingBox.y[0]+r.boundingBox.z[0]*r.boundingBox.z[0]),r.min=new THREE.Vector3(r.boundingBox.x[0],r.boundingBox.y[0],r.boundingBox.z[0]),r.max=new THREE.Vector3(r.boundingBox.x[1],r.boundingBox.y[1],r.boundingBox.z[1]),r.boundingSphere={radius:u,center:new THREE.Vector3((r.max.x+r.min.x)/2,(r.max.y+r.min.y)/2,(r.max.z+r.min.z)/2)},r.area=0,r.volume=0,r.massComputed=!0;var m,g,v,E,y,x,T;for(f=0,fl=r.faces.length;fl>f;f++)face=r.faces[f],u=r.vertices[face.a],d=r.vertices[face.b],p=r.vertices[face.c],m=p.x-d.x,g=p.y-d.y,v=p.z-d.z,E=u.x-d.x,y=u.y-d.y,x=u.z-d.z,T=g*x-v*y,v=v*E-m*x,m=m*y-g*E,T=Math.sqrt(T*T+v*v+m*m),r.area+=T/2,T=p.x*d.y*u.z,m=d.x*p.y*u.z,g=p.x*u.y*d.z,E=u.x*p.y*d.z,y=d.x*u.y*p.z,u=u.x*d.y*p.z,r.volume+=1/6*(-T+m+g-E-y+u);r.volume=Math.abs(r.volume),200>i.ver?(e.diffuses.push(n.diffuse),e.emissions.push(n.emission),e.shinesses.push(n.shininess),e.ambients.push(n.ambient)):(u=[.6,.6,.6,1],d=[0,0,0,0],p=[0,0,0,0],T=.5,-1==s&&(s=n.styleIndex&&-1!=n.styleIndex?n.styleIndex:0),s>=i.styleTable.length&&(s=0),0>=i.styleTable.length||(1==i.styleTable[s][2]?(n=i.styleTable[s][0],n>=0&&n<i.materialTable.length&&(sp=i.materialTable[n][0]/3,em=i.materialTable[n][1]/3,di=i.materialTable[n][2]/3,am=i.materialTable[n][3]/3,T=i.materialTable[n][4],p[0]=i.colorTable[em][0],p[1]=i.colorTable[em][1],p[2]=i.colorTable[em][2],p[3]=i.materialTable[n][6],u[0]=i.colorTable[di][0],u[1]=i.colorTable[di][1],u[2]=i.colorTable[di][2],u[3]=i.materialTable[n][7],d[0]=i.colorTable[am][0],d[1]=i.colorTable[am][1],d[2]=i.colorTable[am][2],d[3]=i.materialTable[n][8])):(n=i.styleTable[s][0]/3,m=i.styleTable[s][1]/255,n>=0&&n<i.colorTable.length&&(u[0]=i.colorTable[n][0],u[1]=i.colorTable[n][1],u[2]=i.colorTable[n][2],u[3]=m))),e.diffuses.push(u),e.emissions.push(p),e.shinesses.push(T),e.ambients.push(d)),e.geometries.push(r)}}return e};var saveAs=saveAs||function(e){var t=e.document,i=e.URL||e.webkitURL||e,n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,o=e.webkitRequestFileSystem,a=e.requestFileSystem||o||e.mozRequestFileSystem,s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l=0,h=[],c=function(e,t,i){for(var t=[].concat(t),n=t.length;n--;){var r=e["on"+t[n]];if("function"==typeof r)try{r.call(e,i||e)}catch(o){s(o)}}},d=function(i,s){var d,u,p,f=this,m=i.type,g=!1,v=function(){var t=(e.URL||e.webkitURL||e).createObjectURL(i);return h.push(t),t},E=function(){c(f,["writestart","progress","write","writeend"])},y=function(){(g||!d)&&(d=v(i)),u.location.href=d,f.readyState=f.DONE,E()},x=function(e){return function(){return f.readyState!==f.DONE?e.apply(this,arguments):void 0}},T={create:!0,exclusive:!1};return f.readyState=f.INIT,s||(s="download"),r&&(d=v(i),n.href=d,n.download=s,p=t.createEvent("MouseEvents"),p.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(p))?(f.readyState=f.DONE,E(),void 0):(e.chrome&&m&&"application/octet-stream"!==m&&(p=i.slice||i.webkitSlice,i=p.call(i,0,i.size,"application/octet-stream"),g=!0),o&&"download"!==s&&(s+=".download"),u="application/octet-stream"===m||o?e:e.open(),a?(l+=i.size,a(e.TEMPORARY,l,x(function(e){e.root.getDirectory("saved",T,x(function(e){var t=function(){e.getFile(s,T,x(function(e){e.createWriter(x(function(t){t.onwriteend=function(t){u.location.href=e.toURL(),h.push(e),f.readyState=f.DONE,c(f,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&y()},["writestart","progress","write","abort"].forEach(function(e){t["on"+e]=f["on"+e]}),t.write(i),f.abort=function(){t.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),y)}),y)};e.getFile(s,{create:!1},x(function(e){e.remove(),t()}),x(function(e){e.code===e.NOT_FOUND_ERR?t():y()}))}),y)}),y)):y(),void 0)},u=d.prototype;return u.abort=function(){this.readyState=this.DONE,c(this,"abort")},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,e.addEventListener("unload",function(){for(var e=h.length;e--;){var t=h[e];"string"==typeof t?i.revokeObjectURL(t):t.remove()}h.length=0},!1),function(e,t){return new d(e,t)}}(self);file3dHelper={init_file3d:function(e,t,i,n,r,o,a){window.onload=function(){var s,l=(!!window.CanvasRenderingContext2D,function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}});l()?"faro"!=e?(s=new tp3DViewerUI({dataURL:t,webGLContainerID:"tpModelCanvasHolder",width:window.innerWidth,height:window.innerHeight,mtlURL:o,imageList:a}),s.start()):apprise("Enter the Radius of Scanning Range in Meter",{input:"120",validation:function(e){return isNaN(e)?!1:parseFloat(e)<0?!1:!0},validationfailerror:"Please enter a positive number",textOk:"Compute Point Cloud"},function(e){if(e){if(!isNaN(e)){var o={depthMapURL:i,depthMapParams:r,colorMapParams:n,radius:parseFloat(e)};s=new tp3DViewerUI({dataURL:t,webGLContainerID:"tpModelCanvasHolder",width:window.innerWidth,height:window.innerHeight}),s.start({pointCloudArgs:o})}}else $("#tpModelLoadingProgress").hide(),window.close(),parent.$.fn.colorbox.close()}):(document.getElementById("tpWebGLDisabled")&&(document.getElementById("tpWebGLDisabled").style.display="block"),document.getElementById("tpGUILayout")&&(document.getElementById("tpGUILayout").style.display="none"),document.getElementById("tpViewPoints")&&(document.getElementById("tpViewPoints").style.display="none"),document.getElementById("tpModelInfo")&&(document.getElementById("tpModelInfo").style.display="none"),document.getElementById("tpModelCanvasHolder")&&(document.getElementById("tpModelCanvasHolder").style.display="none"))}},regenPreview:function(e,t){var i="/ufiles/"+e+"/regen_old_preview";alert(t+"\nStarting regenerating preview."),$.ajax({type:"GET",url:i,dataType:"script",success:function(){alert("Regenerating preview started. Please refresh the TeamPlatform file view."),window.close()}})},saveInLocalStorage:function(e,t){try{return localStorage.setItem(e,t),!0}catch(i){localStorage.clear();try{return localStorage.setItem(e,t),!0}catch(i){return!1}}},getOutOfLocalStorage:function(e){try{var t=localStorage.getItem(e);return t}catch(i){return null}}},THREE.DepthMapLoader=function(e){THREE.Loader.call(this,e),this.load=function(e){var t,i,n,r;t=JSON&&JSON.parse(e.depthViewArgs.colorMapParams)||$.parseJSON(e.depthViewArgs.colorMapParams),i=JSON&&JSON.parse(e.depthViewArgs.depthMapParams)||$.parseJSON(e.depthViewArgs.depthMapParams),n=t.tp_filename?t.tp_filename.replace(/"/g,""):"(no name)",r={Left:parseFloat(i.Left),Right:parseFloat(i.Right),Bottom:parseFloat(i.Bottom),Top:parseFloat(i.Top),DistMin:parseFloat(i.DistMin),DistMax:parseFloat(i.DistMax),ScaleMin:parseFloat(i.ScaleMin),ScaleMax:parseFloat(i.ScaleMax),PositionX:parseFloat(t.PositionX),PositionY:parseFloat(t.PositionY),PositionZ:parseFloat(t.PositionZ),OrientationX:parseFloat(t.OrientationX),OrientationY:parseFloat(t.OrientationY),OrientationZ:parseFloat(t.OrientationZ),OrientationAngle:parseFloat(t.OrientationAngle)},THREE.DepthMapLoader.prototype.createDepthMapModel(n,e.colorMapURL,e.depthViewArgs.depthMapURL,r,e.depthViewArgs.radius,e.onLoadFinished,e.onLoadFailed)}},THREE.DepthMapLoader.prototype=new THREE.Loader,THREE.DepthMapLoader.prototype.constructor=THREE.DepthMapLoader,THREE.DepthMapLoader.prototype.supr=THREE.Loader.prototype,THREE.DepthMapLoader.prototype.createDepthMapModel=function(e,t,i,n,r,o,a){var s,l,h=1,c={};c.fileName=e;var d=function(){function e(e){if(!e||e.vertices.length<1)return a("Point Cloud generation failed : No points are found within the scanning radius."),void 0;var t,i=100;e.boundingBox={x:[e.vertices[0].x,e.vertices[0].x],y:[e.vertices[0].y,e.vertices[0].y],z:[e.vertices[0].z,e.vertices[0].z]};for(var n=1,r=e.vertices.length;r>n;n++)t=e.vertices[n],t.x<e.boundingBox.x[0]?e.boundingBox.x[0]=t.x:t.x>e.boundingBox.x[1]&&(e.boundingBox.x[1]=t.x),t.y<e.boundingBox.y[0]?e.boundingBox.y[0]=t.y:t.y>e.boundingBox.y[1]&&(e.boundingBox.y[1]=t.y),t.z<e.boundingBox.z[0]?e.boundingBox.z[0]=t.z:t.z>e.boundingBox.z[1]&&(e.boundingBox.z[1]=t.z);var d=(e.boundingBox.x[0]+e.boundingBox.x[1])/2,u=(e.boundingBox.y[0]+e.boundingBox.y[1])/2,p=(e.boundingBox.z[0]+e.boundingBox.z[1])/2,f=e.boundingBox.x[1]-e.boundingBox.x[0],m=e.boundingBox.y[1]-e.boundingBox.y[0],g=e.boundingBox.z[1]-e.boundingBox.z[0],v=f;v=Math.max(v,m),v=Math.max(v,g),v=i/v,h=v;for(var n=0,r=e.vertices.length;r>n;n++)t=e.vertices[n],t.x-=d,t.x*=v,t.y-=u,t.y*=v,t.z-=p,t.z*=v;for(var E=0;2>E;++E)e.boundingBox.x[E]-=d,e.boundingBox.x[E]*=v,e.boundingBox.y[E]-=u,e.boundingBox.y[E]*=v,e.boundingBox.z[E]-=p,e.boundingBox.z[E]*=v;var y=Math.sqrt(e.boundingBox.x[0]*e.boundingBox.x[0]+e.boundingBox.y[0]*e.boundingBox.y[0]+e.boundingBox.z[0]*e.boundingBox.z[0]);e.boundingSphere={radius:y},e.volume=0,e.area=0,s=new THREE.Vector3(e.boundingBox.x[0]*h,e.boundingBox.y[0]*h,e.boundingBox.z[0]*h),l=new THREE.Vector3(e.boundingBox.x[1]*h,e.boundingBox.y[1]*h,e.boundingBox.z[1]*h),c.modelType=TPVIEWER.MODEL_TYPE.POINTCLOUD,c.geometry=e,c.min=s,c.max=l,c.scaleFactor=h,o(c)}var d=this;d.modelID=0,THREE.Geometry.call(this);var u=new DethMapModel.Create(d,t,i,n,r,e);return u?void 0:(a("Point Cloud generation failed : invalid input data."),void 0)};d.prototype=new THREE.Geometry,d.prototype.constructor=d,new d};var DethMapModel=DethMapModel||{};DethMapModel.Create=function(e,t,i,n,r,o){function a(e,t,i,n,r,o,a){var s=Math.cos(a),l=Math.sin(a);M.push(n*n*(1-s)+s),M.push(r*n*(1-s)-o*l),M.push(o*n*(1-s)+r*l),M.push(e),M.push(n*r*(1-s)+o*l),M.push(r*r*(1-s)+s),M.push(o*r*(1-s)-n*l),M.push(t),M.push(n*o*(1-s)-r*l),M.push(r*o*(1-s)+n*l),M.push(o*o*(1-s)+s),M.push(i)}function s(e){var t,i,n,r,o,a,s,l,c,u,f,D;for(C||(C=1.5),x=0;S>x;++x)for(y=0;H>y;++y)h=d+x*b,v=p-y*_,t=4*(y*S+x),i=R.data[t],n=R.data[t+1],r=R.data[t+2],(0!=i||0!=n||0!=r)&&(o=r<<16|n<<8|i,a=(o-E)*(g-m)/(T-E)+m,a>C||(s=Math.cos(h)*Math.cos(v)*a,l=-Math.sin(h)*Math.cos(v)*a,c=Math.sin(v)*a,u=M[0]*s+M[1]*l+M[2]*c+M[3],f=M[4]*s+M[5]*l+M[6]*c+M[7],D=M[8]*s+M[9]*l+M[10]*c+M[11],i=w.data[t],n=w.data[t+1],r=w.data[t+2],vector=new THREE.Vector3(u,f,D),e.vertices.push(vector),color=new THREE.Color(16777215),color.setRGB(i/256,n/256,r/256),e.colors.push(color)))}var l,c,d,u,p,f,m,g,E,T,b,_,R,w,S,H,M=[],C=r;if(d=n.Left,u=n.Right,p=n.Top,f=n.Bottom,0==d&&0==p)return o(null),!1;var D=.1;"undefined"==typeof u?u=2*Math.PI:D>u&&(u+=2*Math.PI),m=n.DistMin,g=n.DistMax,E=n.ScaleMin,T=n.ScaleMax,a(n.PositionX,n.PositionY,n.PositionZ,n.OrientationX,n.OrientationY,n.OrientationZ,n.OrientationAngle);var A=document.getElementById("dmCanvas"),I=A.getContext("2d");return l=new Image,postImageLoad=function(){S=l.width,H=l.height,A.width=S,A.height=H,I.drawImage(l,0,0,S,H),R=I.getImageData(0,0,S,H),b=(u-d)/S,_=(p-f)/H;var i=document.getElementById("colorCanvas"),n=i.getContext("2d");c=new Image,postColorImageLoad=function(){i.width=S,i.height=c.height,n.drawImage(c,0,0,S,H),w=n.getImageData(0,0,S,H),s(e),o(e)},colorStoredData=file3dHelper.getOutOfLocalStorage(t),colorStoredData?(c.src=colorStoredData,c.onload=function(){postColorImageLoad()}):(c.src=t,c.onload=function(){postColorImageLoad(),file3dHelper.saveInLocalStorage(t,i.toDataURL())})},storedData=file3dHelper.getOutOfLocalStorage(i),storedData?(l.src=storedData,l.onload=function(){postImageLoad()}):(l.src=i,l.onload=function(){postImageLoad(),file3dHelper.saveInLocalStorage(i,A.toDataURL())}),!0};var GUI=function(parameters){var _this=this,MIN_WIDTH=240,MAX_WIDTH=500,controllers=[],listening=[],autoListen=!0,listenInterval,controllerHeight,curControllerContainerHeight=0,_this=this,open=!1,width=160,explicitOpenHeight=!1,openHeight,name,resizeTo=0,resizeTimeout;this.domElement=document.createElement("div"),this.domElement.setAttribute("class","guidat"),this.domElement.style.width=width+"px";var controllerContainer=document.createElement("div");controllerContainer.setAttribute("class","guidat-controllers"),controllerContainer.addEventListener("DOMMouseScroll",function(e){var t=this.scrollTop;e.wheelDelta?t+=e.wheelDelta:e.detail&&(t+=e.detail),e.preventDefault&&e.preventDefault(),e.returnValue=!1,controllerContainer.scrollTop=t},!1),controllerContainer.style.height="0px";var toggleButton=document.createElement("a");toggleButton.setAttribute("class","guidat-toggle"),toggleButton.setAttribute("href","#"),toggleButton.innerHTML="Show Controls";var toggleDragged=!1,dragDisplacementY=0,togglePressed=!1,my,pmy,mx,pmx,resize=function(e){pmy=my,pmx=mx,my=e.pageY,mx=e.pageX;var t=my-pmy;if(!open){if(!(t>0))return;open=!0,curControllerContainerHeight=openHeight=1,toggleButton.innerHTML=name||"Hide Controls"}var i=pmx-mx;if(t>0&&curControllerContainerHeight>controllerHeight){var n=GUI.map(curControllerContainerHeight,controllerHeight,controllerHeight+100,1,0);t*=n}toggleDragged=!0,dragDisplacementY+=t,dragDisplacementX+=i,openHeight+=t,width+=i,curControllerContainerHeight+=t,controllerContainer.style.height=openHeight+"px",width=GUI.constrain(width,MIN_WIDTH,MAX_WIDTH),_this.domElement.style.width=width+"px",checkForOverflow()};toggleButton.addEventListener("mousedown",function(e){return pmy=my=e.pageY,pmx=mx=e.pageX,togglePressed=!0,e.preventDefault(),dragDisplacementY=0,dragDisplacementX=0,!1},!1),toggleButton.addEventListener("click",function(e){return e.preventDefault(),!1},!1),document.addEventListener("mouseup",function(e){if(togglePressed&&!toggleDragged&&_this.toggle(),togglePressed&&toggleDragged)if(0==dragDisplacementX&&adaptToScrollbar(),openHeight>controllerHeight)clearTimeout(resizeTimeout),openHeight=resizeTo=controllerHeight,beginResize();else if(controllerContainer.children.length>=1){var t=controllerContainer.children[0].offsetHeight;clearTimeout(resizeTimeout);var i=Math.round(curControllerContainerHeight/t)*t-1;resizeTo=i,0>=resizeTo?(_this.hide(),openHeight=2*t):(openHeight=resizeTo,beginResize())}return document.removeEventListener("mousemove",resize,!1),e.preventDefault(),toggleDragged=!1,togglePressed=!1,!1
},!1),this.domElement.appendChild(controllerContainer),this.domElement.appendChild(toggleButton),parameters.domElement&&(GUI.autoPlace=!1,parameters.domElement.appendChild(this.domElement)),GUI.autoPlace&&(null==GUI.autoPlaceContainer&&(GUI.autoPlaceContainer=document.createElement("div"),GUI.autoPlaceContainer.setAttribute("id","guidat"),document.body.appendChild(GUI.autoPlaceContainer)),GUI.autoPlaceContainer.appendChild(this.domElement)),this.autoListenIntervalTime=1e3/60;var createListenInterval=function(){listenInterval=setInterval(function(){_this.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(e){autoListen=e,autoListen?listening.length>0&&createListenInterval():clearInterval(listenInterval)}),this.__defineGetter__("autoListen",function(){return autoListen}),this.listenTo=function(e){0==listening.length&&createListenInterval(),listening.push(e)},this.unlistenTo=function(e){for(var t=0;t<listening.length;t++)listening[t]==e&&listening.splice(t,1);listening.length<=0&&clearInterval(listenInterval)},this.listen=function(e){var t=e||listening;for(var i in t)t[i].updateDisplay()},this.listenAll=function(){this.listen(controllers)},this.autoListen=!0;var alreadyControlled=function(e,t){for(var i in controllers)if(controllers[i].object==e&&controllers[i].propertyName==t)return!0;return!1},construct=function(e,t){function i(){return e.apply(this,t)}return i.prototype=e.prototype,new i};this.add=function(){var e=arguments[0],t=arguments[1];alreadyControlled(e,t);var i=e[t];if(void 0==i)return GUI.error(e+' either has no property "'+t+'", or the property is inaccessible.'),void 0;var n=typeof i,r=handlerTypes[n];if(void 0==r)return GUI.error('Cannot create controller for data type "'+n+'"'),void 0;for(var o=[this],a=0;a<arguments.length;a++)o.push(arguments[a]);var s=construct(r,o);return s?(s.domElement.id=t,controllerContainer.appendChild(s.domElement),controllers.push(s),GUI.allControllers.push(s),"function"!=n&&GUI.saveIndex<GUI.savedValues.length&&(s.setValue(GUI.savedValues[GUI.saveIndex]),GUI.saveIndex++),checkForOverflow(),explicitOpenHeight||(openHeight=controllerHeight),s):(GUI.error('Error creating controller for "'+t+'".'),void 0)};var checkForOverflow=function(){controllerHeight=0;for(var e in controllers)controllerHeight+=controllers[e].domElement.offsetHeight+5;controllerContainer.style.overflowY=controllerHeight-1>openHeight?"hidden":"hidden"},handlerTypes={number:GUI.NumberController,string:GUI.StringController,"boolean":GUI.BooleanController,"function":GUI.FunctionController},alreadyControlled=function(e,t){for(var i in controllers)if(controllers[i].object==e&&controllers[i].propertyName==t)return!0;return!1},construct=function(e,t){function i(){return e.apply(this,t)}return i.prototype=e.prototype,new i};this.reset=function(){},this.toggle=function(){open?this.hide():this.show()},this.show=function(){toggleButton.innerHTML=name||"Hide Controls",resizeTo=openHeight,clearTimeout(resizeTimeout),beginResize(),open=!0},this.hide=function(){toggleButton.innerHTML=name||"Show Controls",resizeTo=0,clearTimeout(resizeTimeout),beginResize(),open=!1},this.name=function(e){name=e,toggleButton.innerHTML=e},this.appearanceVars=function(){return[open,width,openHeight,controllerContainer.scrollTop]};var beginResize=function(){curControllerContainerHeight+=.6*(resizeTo-curControllerContainerHeight),Math.abs(curControllerContainerHeight-resizeTo)<1?(curControllerContainerHeight=resizeTo,adaptToScrollbar()):resizeTimeout=setTimeout(beginResize,1e3/30),controllerContainer.style.height=Math.round(curControllerContainerHeight)+"px",checkForOverflow()},adaptToScrollbar=function(){_this.domElement.style.width=width+1+"px",setTimeout(function(){_this.domElement.style.width=width+"px"},1)};if(GUI.guiIndex<GUI.savedAppearanceVars.length){if(width=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]),_this.domElement.style.width=width+"px",openHeight=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]),explicitOpenHeight=!0,1==eval(GUI.savedAppearanceVars[GUI.guiIndex][0])){curControllerContainerHeight=openHeight;var t=GUI.savedAppearanceVars[GUI.guiIndex][3];setTimeout(function(){controllerContainer.scrollTop=t},0),GUI.scrollTop>-1&&(document.body.scrollTop=GUI.scrollTop),resizeTo=openHeight,this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.hidden=!1,GUI.autoPlace=!0,GUI.autoPlaceContainer=null,GUI.allControllers=[],GUI.allGuis=[],GUI.toggleHide=function(){GUI.hidden?GUI.show():GUI.hide()},GUI.show=function(){GUI.hidden=!1;for(var e in GUI.allGuis)GUI.allGuis[e].domElement.style.display="block"},GUI.hide=function(){GUI.hidden=!0;for(var e in GUI.allGuis)GUI.allGuis[e].domElement.style.display="none"},GUI.saveURL=function(){var e=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=e},GUI.scrollTop=-1,GUI.load=function(e){var t=e.split(","),i=parseInt(t[0]);GUI.scrollTop=parseInt(t[1]);for(var n=0;i>n;n++){var r=t.splice(2,4);GUI.savedAppearanceVars.push(r)}GUI.savedValues=t.splice(2,t.length)},GUI.savedValues=[],GUI.savedAppearanceVars=[],GUI.getSaveString=function(){var e,t=[];t.push(GUI.allGuis.length),t.push(document.body.scrollTop);for(e in GUI.allGuis)for(var i=GUI.allGuis[e].appearanceVars(),n=0;n<i.length;n++)t.push(i[n]);for(e in GUI.allControllers)if("function"!=GUI.allControllers[e].type){var r=GUI.allControllers[e].getValue();"number"==GUI.allControllers[e].type&&(r=GUI.roundToDecimal(r,4)),t.push(r)}return t.join(",")},GUI.getVarFromURL=function(e){for(var t,i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<i.length;n++)if(t=i[n].split("="),void 0!=t&&t[0]==e)return t[1];return null},GUI.replaceGetVar=function(e,t){for(var i,n=window.location.href,r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<r.length;o++)if(i=r[o].split("="),void 0!=i&&i[0]==e)return n.replace(i[1],t);return-1!=window.location.href.indexOf("?")?n+"&"+e+"="+t:n+"?"+e+"="+t},GUI.saveIndex=0,GUI.guiIndex=0,GUI.showSaveString=function(){alert(GUI.getSaveString())},GUI.makeUnselectable=function(e){e.onselectstart=function(){return!1},e.style.MozUserSelect="none",e.style.KhtmlUserSelect="none",e.unselectable="on"},GUI.makeSelectable=function(e){e.onselectstart=function(){},e.style.MozUserSelect="auto",e.style.KhtmlUserSelect="auto",e.unselectable="off"},GUI.map=function(e,t,i,n,r){return n+(r-n)*((e-t)/(i-t))},GUI.constrain=function(e,t,i){return t>e?e=t:e>i&&(e=i),e},GUI.error=function(e){"function"==typeof console.error&&console.error("[GUI ERROR] "+e)},GUI.roundToDecimal=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i},GUI.extendController=function(e){e.prototype=new GUI.Controller,e.prototype.constructor=e},null!=GUI.getVarFromURL("saveString")&&GUI.load(GUI.getVarFromURL("saveString")),GUI.Slider=function(e,t,i,n,r){var o,a,s=!1,l=this;this.domElement=document.createElement("div"),this.domElement.setAttribute("class","guidat-slider-bg"),this.fg=document.createElement("div"),this.fg.setAttribute("class","guidat-slider-fg"),this.domElement.appendChild(this.fg),this.sliderPointer=document.createElement("div"),this.sliderPointer.setAttribute("class","guidat-slider-pointer"),this.fg.appendChild(this.sliderPointer);var h=function(r){if(s){var o=d(l.domElement),a=GUI.map(r.pageX,o[0],o[0]+l.domElement.offsetWidth,t,i);a=Math.round(a/n)*n,e.setValue(a)}};this.domElement.addEventListener("mousedown",function(t){s=!0,o=a=t.pageX,l.domElement.className+=" active",l.fg.className+=" active",e.domElement.className+=" active",h(t),document.addEventListener("mouseup",c,!1)},!1);var c=function(){l.domElement.className=l.domElement.className.replace(" active",""),l.fg.className=l.fg.className.replace(" active",""),e.domElement.className=e.domElement.className.replace(" active",""),s=!1,null!=e.finishChangeFunction&&e.finishChangeFunction.call(this,e.getValue()),document.removeEventListener("mouseup",c,!1)},d=function(e){var t=0,i=0;if(e.offsetParent){do t+=e.offsetLeft,i+=e.offsetTop;while(e=e.offsetParent);return[t,i]}};this.__defineSetter__("value",function(e){var n=GUI.map(e,t,i,0,100);this.fg.style.width=n+"%"});var h=function(r){if(s){var o=d(l.domElement),a=GUI.map(r.pageX,o[0],o[0]+l.domElement.offsetWidth,t,i);a=Math.round(a/n)*n,e.setValue(a)}};this.domElement.addEventListener("mousedown",function(e){s=!0,o=a=e.pageX,l.domElement.setAttribute("class","guidat-slider-bg active"),l.fg.setAttribute("class","guidat-slider-fg active"),h(e),document.addEventListener("mouseup",c,!1)},!1);var c=function(){l.domElement.setAttribute("class","guidat-slider-bg"),l.fg.setAttribute("class","guidat-slider-fg"),s=!1,null!=e.finishChangeFunction&&e.finishChangeFunction.call(this,e.getValue()),document.removeEventListener("mouseup",c,!1)};document.addEventListener("mousemove",h,!1),this.value=r},GUI.Controller=function(){this.parent=arguments[0],this.object=arguments[1],this.propertyName=arguments[2],arguments.length>0&&(this.initialValue=this.propertyName[this.object]),this.domElement=document.createElement("div"),this.domElement.setAttribute("class","guidat-controller "+this.type),this.propertyNameElement=document.createElement("span"),this.propertyNameElement.setAttribute("class","guidat-propertyname"),this.name(this.propertyName),this.domElement.appendChild(this.propertyNameElement),GUI.makeUnselectable(this.domElement)},GUI.Controller.prototype.changeFunction=null,GUI.Controller.prototype.finishChangeFunction=null,GUI.Controller.prototype.name=function(e){return this.propertyNameElement.innerHTML=e,this},GUI.Controller.prototype.reset=function(){return this.setValue(this.initialValue),this},GUI.Controller.prototype.listen=function(){return this.parent.listenTo(this),this},GUI.Controller.prototype.unlisten=function(){return this.parent.unlistenTo(this),this},GUI.Controller.prototype.setValue=function(e){return this.object[this.propertyName]=e,null!=this.changeFunction&&this.changeFunction.call(this,e),this.updateDisplay(),this},GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]},GUI.Controller.prototype.updateDisplay=function(){},GUI.Controller.prototype.onChange=function(e){return this.changeFunction=e,this},GUI.Controller.prototype.onFinishChange=function(e){return this.finishChangeFunction=e,this},GUI.Controller.prototype.options=function(){var e=this,t=document.createElement("select");if(1==arguments.length){var i=arguments[0];for(var n in i){var r=document.createElement("option");r.innerHTML=n,r.setAttribute("value",i[n]),t.appendChild(r)}}else for(var n=0;n<arguments.length;n++){var r=document.createElement("option");r.innerHTML=arguments[n],r.setAttribute("value",arguments[n]),t.appendChild(r)}return t.addEventListener("change",function(){e.setValue(this.value),null!=e.finishChangeFunction&&e.finishChangeFunction.call(this,e.getValue())},!1),e.domElement.appendChild(t),this},GUI.BooleanController=function(){this.type="boolean",GUI.Controller.apply(this,arguments);var _this=this,input=document.createElement("input");input.setAttribute("type","checkbox"),this.domElement.addEventListener("click",function(e){input.checked=!input.checked,e.preventDefault(),_this.setValue(input.checked)},!1),input.addEventListener("mouseup",function(){input.checked=!input.checked},!1),this.domElement.style.cursor="pointer",this.propertyNameElement.style.cursor="pointer",this.domElement.appendChild(input),this.updateDisplay=function(){input.checked=_this.getValue()},this.setValue=function(val){if("boolean"!=typeof val)try{val=eval(val)}catch(e){}return GUI.Controller.prototype.setValue.call(this,val)}},GUI.extendController(GUI.BooleanController),GUI.FunctionController=function(){this.type="function";var e=this;GUI.Controller.apply(this,arguments),this.domElement.addEventListener("click",function(){e.fire()},!1),this.domElement.style.cursor="pointer",this.propertyNameElement.style.cursor="pointer";var t=null;this.onFire=function(e){return t=e,this},this.fire=function(){null!=t&&t.call(this),e.object[e.propertyName].call(e.object)}},GUI.extendController(GUI.FunctionController),GUI.NumberController=function(){this.type="number",GUI.Controller.apply(this,arguments);var e=this,t=!1,i=!1,n=0,r=0,o=arguments[3],a=arguments[4],s=arguments[5];s||(s=void 0!=o&&void 0!=a?.01*(a-o):1);var l=document.createElement("input");l.setAttribute("id",this.propertyName),l.setAttribute("type","text"),l.setAttribute("value",this.getValue()),s&&l.setAttribute("step",s),this.domElement.appendChild(l);var h;void 0!=o&&void 0!=a&&(h=new GUI.Slider(this,o,a,s,this.getValue()),this.domElement.appendChild(h.domElement)),l.addEventListener("blur",function(){var t=parseFloat(this.value);isNaN(t)||e.setValue(t)},!1),l.addEventListener("mousewheel",function(t){return t.preventDefault(),e.setValue(e.getValue()+Math.abs(t.wheelDeltaY)/t.wheelDeltaY*s),!1},!1),l.addEventListener("mousedown",function(e){r=n=e.pageY,i=!0,document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",c,!1)},!1),l.addEventListener("keydown",function(t){var i;switch(t.keyCode){case 13:i=parseFloat(this.value),e.setValue(i);break;case 38:i=e.getValue()+s,e.setValue(i);break;case 40:i=e.getValue()-s,e.setValue(i)}},!1);var c=function(){document.removeEventListener("mousemove",d,!1),GUI.makeSelectable(e.parent.domElement),GUI.makeSelectable(l),i&&!t&&(l.focus(),l.select()),h&&(h.domElement.className=h.domElement.className.replace(" active","")),t=!1,i=!1,null!=e.finishChangeFunction&&e.finishChangeFunction.call(this,e.getValue()),document.removeEventListener("mouseup",c,!1)},d=function(i){t=!0,i.preventDefault(),GUI.makeUnselectable(e.parent.domElement),GUI.makeUnselectable(l),h&&(h.domElement.className+=" active"),r=n,n=i.pageY;var o=r-n,a=e.getValue()+o*s;return e.setValue(a),!1};this.options=function(){return e.noSlider(),e.domElement.removeChild(l),GUI.Controller.prototype.options.apply(this,arguments)},this.noSlider=function(){return h&&e.domElement.removeChild(h.domElement),this},this.setValue=function(e){return e=parseFloat(e),void 0!=o&&o>=e?e=o:void 0!=a&&e>=a&&(e=a),GUI.Controller.prototype.setValue.call(this,e)},this.updateDisplay=function(){l.value=GUI.roundToDecimal(e.getValue(),4),h&&(h.value=e.getValue())}},GUI.extendController(GUI.NumberController),GUI.StringController=function(){this.type="string";var e=this;GUI.Controller.apply(this,arguments);var t=document.createElement("input"),i=this.getValue();t.setAttribute("value",i),t.setAttribute("spellcheck","false"),this.domElement.addEventListener("mouseup",function(){t.focus(),t.select()},!1),t.addEventListener("keyup",function(i){13==i.keyCode&&null!=e.finishChangeFunction&&e.finishChangeFunction.call(this,e.getValue()),e.setValue(t.value)},!1),t.addEventListener("blur",function(){null!=e.finishChangeFunction&&e.finishChangeFunction.call(this,e.getValue())},!1),this.updateDisplay=function(){t.value=e.getValue()},this.options=function(){return e.domElement.removeChild(t),GUI.Controller.prototype.options.apply(this,arguments)},this.domElement.appendChild(t)},GUI.extendController(GUI.StringController),tpSavedView=function(){this.cam,this.explode_ratio=0,this.name,this.annot_id},tp3DViewerUI=function(n){function o(){file_name_str=gt+"<span class='versioninfo'> (v"+q+")</span>",e=document.getElementById("tpTitle"),e&&(e.innerHTML=file_name_str)}function a(){$(".help-tooltip").hide(),$(".showtt[title]").tooltip({tipClass:"help-tooltip",position:"bottom center",effect:"toggle"}),$(".showttr[title]").tooltip({tipClass:"help-tooltip",position:"center right",effect:"toggle"}),$(".showtt, .showttr").mousedown(function(){$(".help-tooltip").hide()}),$(".showtt, .showttr").mouseover(function(){pause_tooltip&&$(".help-tooltip").hide()})}function s(){X.explodeObjects(0),$("#explodeslider").slider("value",0),$("#explodeamount").val("0%")}function l(e){K=-1,q=-1,mt="false";for(var t=e.split("?")[1].split("&"),i=0;i<t.length;i++){var n=t[i].split("=");"id"==n[0]?K=n[1]:"v"==n[0]?q=n[1]:"save_enabled"==n[0]?mt=n[1]:"file_name"==n[0]&&(gt=n[1])}}function h(){if(W(),ft||j(),M(),a(),$(document)[0].oncontextmenu=function(){return!1},$("#tpDRHeader").show(),$("#tpViewPoints").show(),$("#tpModelInfo").show(),$(document).keyup(function(e){27==e.keyCode&&(Gt(),ri(),g())}),ft?$("#changeradbtn").button({text:!0}).click(function(){document.location.reload(!0)}):$("#changeradbtn").hide(),ft?$("#freedistbtn").hide():$("#freedistbtn").button({icons:{primary:"icon-fdist",secondary:null},text:!1}).click(function(){w(!1)}),ft?$("#ndistbtn").hide():$("#ndistbtn").button({icons:{primary:"icon-ndist",secondary:null},text:!1}).click(function(){w(!0)}),ft?$("#anglebtn").hide():$("#anglebtn").button({icons:{primary:"icon-angle",secondary:null},text:!1}).click(function(){S()}),Wt()){$("#explodeslider").slider({range:"min",value:0,min:0,max:100,step:1,slide:function(e,t){$("#explodeamount").val(t.value+"%"),Vt=t.value/20,X.explodeObjects(Vt)}}),$("#tpTreeWrapper #tpTreeHandle").show(),$("#explodeamount").val($("#explodeslider").slider("value")+"%"),$("#tpTree").resizable({scroll:!0}),$("#tpTreeWrapper").draggable({cursor:"move",handle:"#tpTreeHandle",cancel:"#tpTree",containment:"document"});var e=($("#tpTree").height(),$("#tpTree .dynatree-lastsib").height()),t=40,i=e+t,n=window.innerHeight-t;$("#tpTree").height(i>n?n:i)}else $("#explode").hide();$("#pointsize").hide(),$("#modelunitbtn").text("Model: "+E(Rt)),$("#modelunitlist").menu({selected:function(e,t){ri(),m=t.item.text(),Rt=v(m),oi(),$("#modelunit .ui-button-text").text("Model: "+m),$("#modelunitlist").hide()}}),$("#modelunitlist").hide(),$("#modelunitbtn").button({icons:{primary:"ui-icon-triangle-1-s",secondary:null},text:!0}).click(function(){ri(),$("#modelunitlist").show()}),$("#modelunit").mouseleave(function(){$("#modelunitlist").hide()}),$("#measureunitbtn").text("Measure: "+E(wt)),$("#measureunitlist").menu({selected:function(e,t){ri(),m=t.item.text(),wt=v(m),oi(),$("#measureunit .ui-button-text").text("Measure: "+m),$("#measureunitlist").hide()}}),$("#measureunit").mouseleave(function(){$("#measureunitlist").hide()}),$("#measureunitlist").hide(),$("#measureunitbtn").button({icons:{primary:"ui-icon-triangle-1-s",secondary:null},text:!0}).click(function(){ri(),$("#measureunitlist").show()}),$("#sectionmenus").hide(),ft?$("#sectionview").hide():($("#sectionviewcheck").button({icons:{primary:"icon-section",secondary:null},text:!1}).change(function(){this.checked?f():g()}),$("#sectiondir").buttonset(),$("#sectiondir input[type=radio]").click(function(){var e,t,i=this.value;p(i),e=X.getCustomAxisNormalPlaneObjectInfo(zt[i]),t=100*e.position[i]/(tt[i]-et[i]),$("#sectionslider").slider("value",t),$("#sectionposition").val(t+"%")}),$("#sectionslider").slider({range:"min",value:50,min:0,max:100,step:1,slide:function(e,t){var i,n={};switch($("#sectionposition").val(t.value+"%"),gui_params.clip_direction){case TPVIEWER.SECTION_DIR.POS_X:case TPVIEWER.SECTION_DIR.NEG_X:i="x";break;case TPVIEWER.SECTION_DIR.POS_Y:case TPVIEWER.SECTION_DIR.NEG_Y:i="y";break;case TPVIEWER.SECTION_DIR.POS_Z:case TPVIEWER.SECTION_DIR.NEG_Z:i="z"}n[i]=(tt[i]-et[i])*t.value/100+et[i],X.updateCustomAxisNormalPlaneObject(zt[i],{position:n}),X.clipView(n)}}),$("#sectionoppcheck").button({icons:{primary:"icon-opp",secondary:null},text:!1}),$("#sectionoppcheck").change(function(){gui_params.clip_opposite=this.checked?!0:!1,p()})),ft?$("#transp").hide():$("#transpcheck").button({icons:{primary:"icon-transp",secondary:null},text:!1}).change(function(){gui_params.transparency=this.checked?Ft:0,this.checked?X.setObjectOpacity(it,Ft):X.resetObjectOpacity(it)}),$("#savescreenbtn").button({icons:{primary:"icon-camera",secondary:null},text:!1}).click(function(){G()}),ft?$("#downloadstlbtn").hide():$("#downloadstlbtn").button({icons:{primary:"icon-stl",secondary:null},text:!1}).click(function(){res=X.saveAsSTL(it,gt+".stl"),c(res)})}function c(e){var t="",i=!0;switch(e){case TPVIEWER.ERROR_CODE.NO_DATA:t="there are no mesh data in the model.";break;case TPVIEWER.ERROR_CODE.BROWSER_NOT_SUPPORTED:t="your browser does not support this feature yet.";break;case TPVIEWER.ERROR_CODE.SUCCESS:i=!1;break;default:t="an error occurred while saving."}i&&apprise("Download as STL failed because <br>"+t)}function d(e,t){var i,n=Ct.getNodeByKey(e);switch(t){case"show":X.showObject(e);break;case"hide":X.hideObject(e);break;case"showall":X.showAllObject();break;case"hideothers":X.hideOtherObjects(e);break;case"downloadstl":i=X.saveAsSTL(e,n.data.title+".stl"),c(i);break;case"setcamera":X.setRotationCenter(e);break;case"resetcamera":X.resetRotationCenter();break;case"trans":X.setObjectOpacity(e,.8);break;case"opaque":X.resetObjectOpacity(e)}}function u(){function e(t,i){var n,r,o;for(i.children=new Array,n=0,r=t.childrenIDs.length;r>n;n+=1){o=X.getObjectInfo(t.childrenIDs[n]);var a={title:o.name,isFolder:o.isContainer,key:o.objectID};i.children.push(a),o.isContainer&&e(o,i.children[i.children.length-1])}}qt("RIGHT_UP",function(e){e.objectPoint&&$("#tpMousePointer").showMenu("tpTreeMenuOnModel",e.screenPoint.x,e.screenPoint.y,function(t){d(e.objectID,t)})});var t=[];t.push({title:gt,isFolder:!0,key:it}),e(nt,t[0]),$("#tpTree").dynatree({checkbox:!0,selectMode:3,clickFolderMode:1,onCreate:function(e,t){$(t).contextMenu({menu:"tpTreeMenuOnTree"},function(e,t){var i=$.ui.dynatree.getNode(t);d(i.data.key,e)}),$("#tpTree").dynatree("getRoot").visit(function(e){e.select(!0),e.expand(!0)})},onClick:function(e){Bt(e.data.key)},onSelect:function(e,t){e?X.showObject(t.data.key):X.hideObject(t.data.key)},children:t}),$("#tpTree a").hover(function(){var e=$.ui.dynatree.getNode(this);X.setObjectHoverColor(e.data.key,Lt)},function(){var e=$.ui.dynatree.getNode(this);X.resetObjectHoverColor(e.data.key)}),qt("HOVER",function(e){if(Mt&&""!=Mt&&$(Mt).removeClass("tpHovered"),!e.objectPoint)return Mt="",void 0;var t=Ct.getNodeByKey(e.objectID);Mt=t.li,$(Mt).addClass("tpHovered")}),Ct=$("#tpTree").dynatree("getTree")}function p(e){if(void 0!==e){switch(e){case"x":gui_params.clip_direction=TPVIEWER.SECTION_DIR.POS_X;break;case"y":gui_params.clip_direction=TPVIEWER.SECTION_DIR.POS_Y;break;case"z":gui_params.clip_direction=TPVIEWER.SECTION_DIR.POS_Z}X.hideCustomObject(zt.x),X.hideCustomObject(zt.y),X.hideCustomObject(zt.z),X.showCustomObject(zt[e])}if(gui_params.clip_opposite)switch(gui_params.clip_direction){case TPVIEWER.SECTION_DIR.POS_X:gui_params.clip_direction=TPVIEWER.SECTION_DIR.NEG_X;break;case TPVIEWER.SECTION_DIR.POS_Y:gui_params.clip_direction=TPVIEWER.SECTION_DIR.NEG_Y;break;case TPVIEWER.SECTION_DIR.POS_Z:gui_params.clip_direction=TPVIEWER.SECTION_DIR.NEG_Z}else switch(gui_params.clip_direction){case TPVIEWER.SECTION_DIR.NEG_X:gui_params.clip_direction=TPVIEWER.SECTION_DIR.POS_X;break;case TPVIEWER.SECTION_DIR.NEG_Y:gui_params.clip_direction=TPVIEWER.SECTION_DIR.POS_Y;break;case TPVIEWER.SECTION_DIR.NEG_Z:gui_params.clip_direction=TPVIEWER.SECTION_DIR.POS_Z}X.clipView({mode:TPVIEWER.SECTION_MODE.ENABLED,direction:gui_params.clip_direction})}function f(){var e="x";$("#sectiondirx").is(":checked")?e="x":$("#sectiondiry").is(":checked")?e="y":$("#sectiondirz").is(":checked")&&(e="z"),$("#sectionmenus").show(),p(e),pause_tooltip=!0}function g(){pause_tooltip=!1,$("#sectionmenus").hide(),$("#sectionviewcheck").removeAttr("checked"),$("#sectionviewcheck").button("refresh"),X.hideCustomObject(zt.x),X.hideCustomObject(zt.y),X.hideCustomObject(zt.z),X.clipView({mode:TPVIEWER.SECTION_MODE.DISABLED})}function v(e){for(var t=0;t<unit_mm_conv.length;++t)if(-1!=e.indexOf(unit_mm_conv[t].name))return unit_mm_conv[t].mul;return 1}function E(e){for(var t=0;t<unit_mm_conv.length;++t)if(Math.abs(e-unit_mm_conv[t].mul)<st)return unit_mm_conv[t].name;return"mm"}function y(e){switch(e.eventType){case TPVIEWER.EVENT_TYPE.MOUSE_MOVE:Pt.length>0&&Pt[Pt.length-1](e);break;case TPVIEWER.EVENT_TYPE.LEFT_DOWN:St=!1,Ht=!0;break;case TPVIEWER.EVENT_TYPE.LEFT_UP:Ht=!1,At.length>0&&At[At.length-1](e),e.objectPoint?(Bt(e.objectID),_t++,Dt.length>0&&Dt[Dt.length-1](e)):St||Gt();break;case TPVIEWER.EVENT_TYPE.RIGHT_UP:e.objectPoint&&Bt(e.objectID),It.length>0&&It[It.length-1](e)}}function T(e,t){var i=Rt/wt;return 1==t&&(r=e*i),2==t&&(r=e*i*i),3==t&&(r=e*i*i*i),r}function b(e,t){var i="<span class='xvalue'>"+t+"x:"+T(e.x,1).toFixed(2)+"</span>  <span class='yvalue'>"+t+"y:"+T(e.y,1).toFixed(2)+"</span>  <span class='zvalue'>"+t+"z:"+T(e.z,1).toFixed(2)+"</span>";return i}function _(e,t,i){if(void 0===e||!e||void 0===t||!t)return null;var n={},r=(t.x-e.x)*i.x+(t.y-e.y)*i.y+(t.z-e.z)*i.z;return n.x=e.x+r*i.x,n.y=e.y+r*i.y,n.z=e.z+r*i.z,n}function R(){ei(),Gt(),Jt("LEFT_PICK"),Jt("HOVER"),Yt()}function w(e){var t,i,n;R(),ri(),Qt("Pick the first point on the model."),qt("LEFT_PICK",function(r){var o=Kt();1==o?(t=r.objectPoint,n=r.objectNormal,li(0,t),di(0),pi(0,t),Gt(),di(1),pi(1,t),e?Qt("Pick the second point on the opposite side."):Qt("Pick the second point on the model."),qt("HOVER",function(r){i=r.objectPoint,e&&(i=_(t,i,n)),ai(t,i),hi(0,i),pi(1,i)})):2==o&&R()})}function S(){var e,t,i;R(),ri(),qt("LEFT_PICK",function(n){var r=Kt();1==r?(e=n.objectPoint,li(0,e),di(0),pi(0,e),Gt(),di(1),pi(1,e),Qt("Pick the middle point on the model"),qt("HOVER",function(i){t=i.objectPoint,ai(e,t),hi(0,t),pi(1,t)})):2==r?(i=n.objectPoint,li(1,t),di(2),pi(2,t),Gt(),Qt("Pick the third point on the model"),Zt("HOVER"),qt("HOVER",function(n){i=n.objectPoint,si(e,t,i),hi(1,i),pi(2,i)})):3==r&&R()})}function H(e){var t=document.createElement("div");t.className="tp3DStandardView textdisable",t.id="tp3DStandardView"+e,t.style.top=10+40*Math.round(e/2)+"px",t.style.right=e%2==0?"20px":"60px";var i=document.createElement("div");i.href="#",i.className="tp3DStandardViewName",i.id="tp3DStandardViewName"+e;var n=document.createTextNode("");return i.appendChild(n),t.appendChild(i),document.getElementById("tpViewPoints").appendChild(t),i}function M(){function e(e,t,i){var n=document.createElement("input");return n.setAttribute("class","bluebutton"),n.setAttribute("type","button"),n.setAttribute("value",t),n.addEventListener("click",i,!1),e.appendChild(n),n}var t,i,n=[TPVIEWER.VIEW_DIR.ORTHO,TPVIEWER.VIEW_DIR.TOP,TPVIEWER.VIEW_DIR.BOTTOM,TPVIEWER.VIEW_DIR.FRONT,TPVIEWER.VIEW_DIR.BACK,TPVIEWER.VIEW_DIR.LEFT,TPVIEWER.VIEW_DIR.RIGHT];for(i=0;7>i;++i)t=H(num_standard_views),t.onclick=function(e){var t,i;e=e||window.event,t=e.target||e.srcElement,3==t.nodeType&&(t=t.parentNode),i=t.id[t.id.length-1],0==i?(s(),X.setCamera({viewDirection:n[i],animate:!0,numFrames:10})):X.setCamera({viewDirection:n[i]})},num_standard_views++;var r;r=e(document.getElementById("tpViewPoints"),"Save View",F),$(r).attr("id","saveviewbtn"),r=e(document.getElementById("tpViewPoints"),"Set File Icon",B),$(r).attr("id","setthmb"),custom_view_count=0;var o,a={};$.ajax({type:"GET",url:"/ufiles/"+K+"/get_annotation",dataType:"json",data:"version="+q,async:!1,success:function(e){if(e){for(var t=0;t<e.length;t++)"viewport3d"==e[t].type&&(o=new tpSavedView,o.annot_id=e[t].anot_id,content=$.parseJSON(e[t].content),a.fov=parseFloat(content.cam_fov),a.position=new THREE.Vector3(parseFloat(content.cam_position.x),parseFloat(content.cam_position.y),parseFloat(content.cam_position.z)),a.up=new THREE.Vector3(parseFloat(content.cam_up.x),parseFloat(content.cam_up.y),parseFloat(content.cam_up.z)),a.lookAt=new THREE.Vector3(parseFloat(content.cam_target.x),parseFloat(content.cam_target.y),parseFloat(content.cam_target.z)),o.cam=a,o.explode_ratio=parseFloat(content.explodeRatio),o.name=content.name,saved_views.push(o),custom_view_count++);L()}}})}function C(e){if("false"==mt)return ii("You are not authorized to update view"),void 0;var t=this.id.substring(17,this.id.length);return void 0==saved_views[t]||null==saved_views[t]?(ii("Failed to update view"),void 0):(annot_id=this.parentNode.parentNode.getAttribute("annot_id"),void 0==annot_id||null==annot_id||""==annot_id?(ii("Failed to update view"),void 0):(apprise("Input a new name of the view point.",{input:saved_views[t].name,textOk:"Save"},function(e){e&&(viewName=e,X.showProgressMessage("Updating view..."),0==viewName.replace(/\s/g,"").length&&(viewName="view "+custom_view_count),z(annot_id,t,viewName),X.hideProgressMessage())}),e.stopPropagation(),void 0))}function D(e){if("false"==mt)return ii("You are not authorized to delete view"),void 0;var t,i=this.id.substring(19,this.id.length);return void 0==saved_views[i]||null==saved_views[i]?(ii("Failed to delete view"),void 0):(t=this.parentNode.parentNode.getAttribute("annot_id"),void 0==t||null==t||""==t?(ii("Failed to delete view"),void 0):(apprise("Sure to delete the view point?",{verify:!0,textYes:"Yes",textNo:"Cancel"},function(e){e&&(X.showProgressMessage("Deleting a view point..."),O(t,i),X.hideProgressMessage())}),e.stopPropagation(),void 0))}function A(e,t,n){var r=document.createElement("div");r.className="tp3DSavedView textdisable",r.id="tp3DSavedView"+e,r.setAttribute("annot_id",n),r.style.top=98+num_standard_views/2*40+25*e+"px",r.style.right="20px",r.onmouseover=function(){var e=this.childNodes;if(void 0!=e&&null!=e)for(i=0;i<e.length;++i)"tp3DItemButtonWrapper"==e[i].className&&(e[i].style.visibility="visible")},r.onmouseout=function(){var e=this.childNodes;if(void 0!=e&&null!=e)for(i=0;i<e.length;++i)"tp3DItemButtonWrapper"==e[i].className&&(e[i].style.visibility="hidden")};var o=document.createElement("div");o.href="#",o.className="tp3DSavedViewName",o.id="tp3DSavedViewName"+e,o.onclick=function(){var e=this.id.substring(17,this.id.length);void 0!=saved_views[e]&&null!=saved_views[e]&&(ri(),X.explodeObjects(saved_views[e].explode_ratio),X.setCamera({viewDirection:TPVIEWER.VIEW_DIR.CUSTOM,camera:saved_views[e].cam,animate:!0,numFrames:12}))};var a=document.createTextNode(t);o.appendChild(a);var s=document.createElement("div");s.className="tp3DItemButtonWrapper";var l=document.createElement("img");l.src="/images/trash.png",l.onclick=D,l.id="tp3DSavedViewDelete"+e,l.className="tp3DItemButton",s.appendChild(l),l=document.createElement("img"),l.src="/images/pencil.png",l.onclick=C,l.id="tp3DSavedViewEdit"+e,l.className="tp3DItemButton",s.appendChild(l),r.appendChild(s),r.appendChild(o),s.style.visibility="hidden",document.getElementById("tpViewPoints").appendChild(r)}function I(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),r=new Uint8Array(n),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);var a,s;try{s=new Blob([r],{type:i}),a=s}catch(l){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==l.name&&window.BlobBuilder?(s=new BlobBuilder,s.append(n),a=s.getBlob(i)):"InvalidStateError"==l.name&&(a=new Blob([n],{type:i}))}return a}function P(){var e,t=(new Date).getTime().toString(32);for(e=0;5>e;e++)t+=Math.floor(65535*Math.random()).toString(32);return t}function L(){var e=saved_views.length;for(i=0;e>i;++i)A(i,saved_views[i].name,saved_views[i].annot_id)}function k(){var e=saved_views.length;for(i=0;e>i;++i){var t=document.getElementById("tp3DSavedView"+i);void 0!=t&&null!=t&&document.getElementById("tpViewPoints").removeChild(t)}}function O(e,t){$.ajax({type:"GET",url:"/annotations/"+e+"/destroy_3d",success:function(){ii("Deleted"),k();saved_views.splice(t,1);L()},error:function(){ii("Failed to delete view")}})}function N(e){var t={};t.cam_fov=e.cam.fov,t.cam_position=e.cam.position,t.cam_up=e.cam.up,t.cam_target=e.cam.lookAt,t.explodeRatio=e.explode_ratio,t.name=e.name;var i=$.ajax({type:"POST",async:!1,url:"/ufiles/"+K+"/save_annotation?version="+q,dataType:"script",data:{type:"viewport3d",content:$.toJSON(t)},success:function(){ii("Saved")},error:function(){ii("Failed to save a view point")}}).responseText;return i}function z(e,t,i){var n={};n.cam_fov=saved_views[t].cam.fov,n.cam_position=saved_views[t].cam.position,n.cam_up=saved_views[t].cam.up,n.cam_target=saved_views[t].cam.lookAt,n.explodeRatio=saved_views[t].explode_ratio,n.name=i,$.ajax({type:"GET",url:"/annotations/"+e+"/update_3d",data:{content:$.toJSON(n)},success:function(){ii("Updated");var e=document.getElementById("tp3DSavedViewName"+t);e.childNodes[0].nodeValue=viewName,saved_views[t].name=viewName},error:function(){ii("Failed to update view")}})}function V(e){var t,i,n=X.getCameraInfo();X.showProgressMessage("Saving a view point ..."),i=new tpSavedView,i.cam=n,i.explode_ratio=Wt()?Vt:0,i.name=e,t=N(i),"error"!=t&&(i.annot_id=t,custom_view_count++,A(saved_views.length,i.name,i.annot_id),saved_views.push(i)),X.hideProgressMessage()}function F(){if("false"==mt)return ii("Please log in to save a custom view."),void 0;var e="view "+custom_view_count;apprise("Save New View",{input:e,textOk:"Save"},function(e){e&&(0==e.replace(/\s/g,"").length&&(e="view "+custom_view_count),V(e))
})}function U(e,t){var i,n;i=X.captureScreen("png"),n=window.open("",gt),n.document.write("<body style='font-family:Lucida Grande, Lucida Sans Regular, Lucida Sans Unicode, Verdana, Helvetica, Arial;'>"),n.document.write("<p align='center'>Screen Captured Image</p>"),n.document.write("<h1 align='center'>"+gt+".png</h1>"),n.document.write("<div id='tpCapturedMsg'><p align='center' style='color:#aaa;'>This page will be redirected to the actual image file view page<br>in TeamPlatform as soon as the uploading is finished unless this file is attached to a discussion.</p></div>"),n.document.write("<div style='text-align:center;'><img style='border:1px solid black;' src=\""+i+'"</img></div>');var r=new FormData,o=I(i),a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&(200==a.status||0==a.status?(V(gt),n.location.href=a.responseText):(ii("Failed to upload the screen captured image"),X.hideProgressMessage()))},a.open("POST","/ufiles/upload_capture_3d?folder_id="+K+"&authenticity_token="+rails_authenticity_token,!0),r.append("file",o),r.append("size",o.size),r.append("guid",P()),r.append("name",gt+".png"),r.append("comment",t),a.send(r)}function B(){if("false"==mt)return ii("Please log in to set a thumbnail image."),void 0;var e=X.captureScreen("png"),t=new FormData,i=I(e),n=new XMLHttpRequest;X.showProgressMessage("Saving a new thumbnail image ..."),n.onreadystatechange=function(){4==n.readyState&&(200==n.status||0==n.status?ii("Successfully changed"):ii("Failed to set a thumbnail image"),X.hideProgressMessage())},n.open("POST","/ufiles/capture_thumbnail?folder_id="+K+"&authenticity_token="+rails_authenticity_token,!0),t.append("file",i),n.send(t)}function G(){if("false"==mt)return ii("Please, log in to save a screen image."),void 0;var e=""==gt?"":" - "+gt;defaultName="ScreenShot("+custom_view_count+")"+e,apprise("Save Screen Image<br><br>File will be saved to workspace & New View will be created.",{input:defaultName,textOk:"Save",memoTitle:"<br>(Optional) Leave a comment",memo:" "},function(e,t){e&&(fileName=e,X.showProgressMessage("Uploading the screen image ..."),0==fileName.replace(/\s/g,"").length&&(fileName="view "+custom_view_count),U(fileName,t))})}function W(){rt=document.createElement("div"),rt.id="tpMousePositionInfo",rt.className="textdisable",rt.style.visibility="hidden",document.body.appendChild(rt),ot=document.createElement("div"),ot.id="tpDimInfo",ot.className="textdisable",ot.style.visibility="hidden",document.body.appendChild(ot),at=document.createElement("div"),at.id="tpOpHelp",at.className="textdisable",at.style.visibility="hidden",document.body.appendChild(at)}function j(){var e,t,i,n=1.2;for(i=(tt.x-et.x)*(tt.x-et.x)+(tt.y-et.y)*(tt.y-et.y)+(tt.z-et.z)*(tt.z-et.z),i=Math.sqrt(i),clip_inc=i/20,e=0;2>e;e+=1)kt.push(t=X.addCustomLineObject({sx:0,sy:0,sz:0,ex:0,ey:0,ez:0,color:16711680,width:3,opacity:1})),X.hideCustomObject(t);for(e=0;3>e;e+=1)Ot.push(t=X.addCustomSphereObject({cx:0,cy:0,cz:0,rad:i/100,numSegments:6,color:16711680})),X.hideCustomObject(t);zt.x=X.addCustomAxisNormalPlaneObject({position:{x:(tt.x+et.x)/2,y:(tt.y+et.y)/2,z:(tt.z+et.z)/2},axis:"x",width:tt.z-et.z,height:tt.y-et.y,segW:5,segH:5,showWire:!1,clippable:!1,opacity:.1,doubleSide:!0,color:16426240}),X.hideCustomObject(zt.x),zt.y=X.addCustomAxisNormalPlaneObject({position:{x:(tt.x+et.x)/2,y:(tt.y+et.y)/2,z:(tt.z+et.z)/2},axis:"y",width:tt.x-et.x,height:tt.z-et.z,segW:5,segH:5,showWire:!1,clippable:!1,opacity:.1,doubleSide:!0,color:65280}),X.hideCustomObject(zt.y),zt.z=X.addCustomAxisNormalPlaneObject({position:{x:(tt.x+et.x)/2,y:(tt.y+et.y)/2,z:(tt.z+et.z)/2},axis:"z",width:tt.x-et.x,height:tt.y-et.y,segW:5,segH:5,showWire:!1,clippable:!1,opacity:.1,doubleSide:!0,color:42495}),X.hideCustomObject(zt.z),Nt.y=X.addCustomShadowFloorObject({position:{x:(tt.x+et.x)/2,y:et.y-i/3,z:(tt.z+et.z)/2},axis:"y",width:i*n,height:i*n,lightColor:16777215,darkness:.1}),X.enableShadowCast(it)}var X,Y,K,q,Z,J,Q,et,tt,it,nt,rt,ot,at,st=1e-10,lt=n.dataURL,ht=void 0===n.textureURL?"":n.textureURL,ct=void 0===n.mtlURL?"":n.mtlURL,dt=n.webGLContainerID,ut=n.width,pt=n.height,ft=!1,mt="",gt="",vt="",Et=!1,yt=void 0===n.imageList?"":n.imageList,xt="",Tt=0,bt="",_t=0,Rt=1,wt=1,St=!1,Ht=!1,Mt="",Ct=null,Dt=[],At=[],It=[],Pt=[],Lt=2236962,kt=[],Ot=[],Nt=[],zt=[],Vt=0,Ft=.6;num_standard_views=0,saved_views=[],custom_view_count=0,pause_tooltip=!1,unit_mm_conv=[{name:"mm",mul:1},{name:"cm",mul:10},{name:"meter",mul:1e3},{name:"km",mul:1e6},{name:"inch",mul:25.4},{name:"feet",mul:304.8},{name:"yard",mul:914.4},{name:"mile",mul:1609344},{name:"fathom",mul:1828},{name:"micron",mul:.001},{name:"thou",mul:.0254}],gui_params={material:1,pcdisplay:1,light:7,bleach:0,boundingbox:!1,rubberband:!0,transparency:0,pointsize:2,clip_direction:TPVIEWER.SECTION_DIR.POS_X,clip_opposite:!1,clip_pos_ratio:.5},this.start=function(e){if($("#tpDRHeader").hide(),$("#tpViewPoints").hide(),$("#tpModelInfo").hide(),$("#tpMousePositionInfo").hide(),l(lt),-1==K||-1==q)return alert("Error: Couldn't load the model. Unknown file ID or Version"),void 0;if(X=new TPVIEWER.player,X.init({containerID:dt,width:ut,height:pt}),ft=void 0!==e&&void 0!==e.pointCloudArgs?!0:!1){Y=e.pointCloudArgs.radius;var t=new THREE.DepthMapLoader;return X.showProgressMessage("Now, Computing Point Cloud ..."),t.load({colorMapURL:lt,depthViewArgs:e.pointCloudArgs,onLoadFinished:function(e){X.startScene({hoverOnObjects:!1,onMouseMove:y,onMouseDown:y,onMouseUp:y,onMouseWheel:y,boundingRadius:e.geometry.boundingSphere.radius}),X.addObject({geometry:e.geometry,scale:e.scaleFactor,type:e.modelType}),gt=e.fileName,J=TPVIEWER.MODEL_TYPE.POINTCLOUD,tt=e.max,et=e.min,Tt=e.geometry.vertices.length,Z=1e3,measure_unit=1e3,X.hideProgressMessage(),oi(),h()},onLoadFailed:function(e){X.hideProgressMessage(),-1!=e.indexOf("old version")&&K&&"true"==mt?file3dHelper.regenPreview(K,e):alert(e)}}),void 0}vt=Xt(lt),"OBJ"==vt&&ct&&yt&&(Et=!0,xt=JSON&&JSON.parse(yt)||$.parseJSON(yt),xt.forEach(function(e){e.filename=e.filename.toLowerCase()})),X.load({URL:lt,textureURL:ht,mtlURL:ct,imageURLlookup:Ut,format:vt,onLoadFinished:function(e){X.startScene({hoverOnObjects:!0,hoverHighlightColor:Lt,onMouseMove:y,onMouseDown:y,onMouseUp:y,onMouseWheel:y,postRenderCallback:function(){St=!0}}),Z=void 0===e.unit?"":e.unit,J=e.type,it=e.objectID,nt=X.getObjectInfo(it),Q=void 0===nt.name?"":nt.name,et=nt.min,tt=nt.max,tp_file_name=X.getFileName(),void 0!=tp_file_name&&(gt=tp_file_name),o(),Wt()&&u(),oi(),h()},onLoadFailed:function(e){X.hideProgressMessage(),-1!=e.indexOf("old version")&&K&&"true"==mt?file3dHelper.regenPreview(K,e):alert(e)}})};var Ut=this.imageLookup=function(e){if(!Et)return e;var t,i,n=e.toLowerCase();for(n=n.substring(n.lastIndexOf("/")+1,n.length),n=n.substring(n.lastIndexOf("\\")+1,n.length),t=0,i=xt.length;i>t;++t)if(xt[t].filename==n)return xt[t].download_url;return""};window.onresize=function(){if(void 0!==X){var e,t,i=$("#"+dt);e=i.parent().width(),t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,X.resizeScene({width:e,height:t})}};var Bt=this.selectObj=function(e){Gt(),bt=e,Wt()&&""!=e&&(X.setObjectEmissiveColor(e,153),Ct.activateKey(e))},Gt=this.unselect=function(){Wt()&&bt&&""!=bt&&(X.resetObjectEmissiveColor(bt),Ct.getNodeByKey(bt).deactivate(),bt="")},Wt=this.isAssembly=function(){return J==TPVIEWER.MODEL_TYPE.CAD_ASSEMBLY},jt=(this.getModelTypeString=function(e){switch(e){case TPVIEWER.MODEL_TYPE.CAD_ASSEMBLY:return"Assembly";case TPVIEWER.MODEL_TYPE.CAD_PART:return"Part";case TPVIEWER.MODEL_TYPE.MESH:return"Mesh"}},this.numberWithCommasFloat=function(e){return e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"",$t(x1)+x2.substr(0,3)}),$t=this.numberWithCommas=function(e){return e.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")},Xt=this.getFileFormat=function(e){if(t=e.indexOf("type=",0),-1==t)return"UNKNOWN";switch(parseInt(e.charAt(t+5))){case 1:return"CTM";case 2:return"TPTX";case 3:return"OBJ";default:return"UNKNOWN"}},Yt=this.resetNumPicked=function(){_t=0},Kt=this.getNumPicked=function(){return _t},qt=this.pushUICallback=function(e,t){if(void 0!==t)switch(e){case"LEFT_PICK":Dt.push(t);break;case"LEFT_PICK_ANY":At.push(t);break;case"RIGHT_UP":It.push(t);break;case"HOVER":Pt.push(t)}},Zt=this.popUICallback=function(e){switch(e){case"LEFT_PICK":Dt.pop();break;case"LEFT_PICK_ANY":At.pop();break;case"RIGHT_UP":It.pop();break;case"HOVER":Pt.pop()}},Jt=this.resetUICallback=function(e){switch(e){case"LEFT_PICK":Dt=[];break;case"LEFT_PICK_ANY":At=[];break;case"RIGHT_UP":It=[];break;case"HOVER":Pt=[]}},Qt=this.showGuide=function(e){at.style.visibility="visible",at.innerHTML=e},ei=this.hideGuide=function(){at.style.visibility="hidden"},ti=this.showGuide=function(e){ot.style.visibility="visible",ot.innerHTML=e},ii=this.systemMessage=function(e,t){$("#system_message").hide(),$("#system_message #msg_text").html(e);var i=$("#system_message").width(),n=$("body").width(),r=n/2-i/2;$("#system_message").attr("style","left:"+r+"px;"),$("#system_message").fadeIn(200,function(){1!=t&&setTimeout(function(){$("#system_message").fadeOut()},1e4)})},ni=this.hideDimInfo=function(){ot.style.visibility="hidden"},ri=this.hideMeasure=function(){ei(),ni(),ci(0),ci(1),ui(0),ui(1),ui(2)},oi=this.updateModelInfo=function(){var e=document.getElementById("tpModelInfo"),t="<table><tbody>",i="Mesh surface:",n="Mesh volume:";J==TPVIEWER.MODEL_TYPE.MESH&&(t+="<tr><td><span class='valueName right'>Facet count:</span></td><td><span class='numbervalue left'>"+$t(nt.facetCount)+"</span></td></tr>"),ft&&(t+="<tr><td><span class='valueName right'>Points Rendered:</span></td><td><span class='numbervalue left'>"+$t(Tt)+"</span></td></tr>"),t+="<tr><td><span class='xvalue right'>X-width:</td><td><span  class='xvalue left'>"+T(tt.x-et.x,1).toFixed(2)+"</span></td></tr>",t+="<tr><td><span class='yvalue right'>Y-height:</td><td><span class='yvalue left'>"+T(tt.y-et.y,1).toFixed(2)+"</span></td></tr>",t+="<tr><td><span class='zvalue right'>Z-depth:</td><td><span  class='zvalue left'>"+T(tt.z-et.z,1).toFixed(2)+"</span></td></tr>",ft?t+="<tr><td><span class='valueName right'>Rad of Scan</td><td><span class='numbervalue left'>"+Y+"</span></td></tr>":(area=T(nt.area,2).toFixed(2),volume=T(nt.volume,3).toFixed(2),t+="<tr><td><span class='valueName right'>"+i+"</td><td><span class='numbervalue left'>"+jt(area)+"</span></td></tr>",t+="<tr><td><span class='valueName right'>"+n+"</td><td><span class='numbervalue left'>"+jt(volume)+"</span></td></tr>"),t+="</tbody></table>",e.innerHTML=t},ai=this.printDistance=function(e,t){if(void 0!==e&&e&&void 0!==t&&t){var i,n,r,o,a;i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,o=Math.sqrt(i*i+n*n+r*r),a="Point 1 "+b(e,"")+"</br> Point 2 "+b(t,"")+"</br></br>Distance: <span class='numbervalue'>"+T(o,1).toFixed(2)+"</span></br>"+b({x:i,y:n,z:r},"dist "),ti(a)}},si=this.printAngle=function(e,t,i){var n,r,o,a,s,l,h,c={},d={};c.x=e.x-t.x,c.y=e.y-t.y,c.z=e.z-t.z,d.x=i.x-t.x,d.y=i.y-t.y,d.z=i.z-t.z,c.len=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z),c.x/=c.len,c.y/=c.len,c.z/=c.len,d.len=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z),d.x/=d.len,d.y/=d.len,d.z/=d.len,n=c.x*d.x+c.y*d.y+c.z*d.z,o=c.y*d.z-c.z*d.y,a=c.z*d.x-c.x*d.z,s=c.x*d.y-c.y*d.x,r=Math.sqrt(o*o+a*a+s*s),l=180*Math.atan2(r,n)/Math.PI,h="Point 1 "+b(e,"")+"</br> Point 2 "+b(t,"")+"</br> Point 3 "+b(i,"")+"</br>Angle:<span class='numbervalue'>"+l.toFixed(2)+"</span> degeree",ti(h)},li=this.startRubberband=function(e,t){X.updateCustomLineObject(kt[e],{sx:t.x,sy:t.y,sz:t.z,ex:t.x,ey:t.y,ez:t.z}),X.showCustomObject(kt[e])},hi=this.updateRubberband=function(e,t){void 0!==t&&t&&X.updateCustomLineObject(kt[e],{ex:t.x,ey:t.y,ez:t.z})},ci=this.endRubberband=function(e){X.hideCustomObject(kt[e])},di=this.showSphere=function(e){X.showCustomObject(Ot[e])},ui=this.hideSphere=function(e){X.hideCustomObject(Ot[e])},pi=this.moveSphere=function(e,t){void 0!==t&&t&&X.moveCustomObject(Ot[e],t.x,t.y,t.z)}},window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()),THREE.PartialSphereGeometry=function(e,t,i,n,r,o,a){THREE.Geometry.call(this);var s,l,e=e||50,h=t||8,c=i||6,d=(Math.PI,Math.max(3,h)),u=Math.max(2,c),p=[];for(l=0;u+1>l;l++){var f=(a-o)*l/u+o,m=e*Math.cos(f),g=e*Math.sin(f),v=[],E=0;for(s=0;d>s;s++){var y=(r-n)*s/d+n,x=g*Math.sin(y),T=g*Math.cos(y);(0==l||l==u)&&s>0||(E=this.vertices.push(new THREE.Vertex(new THREE.Vector3(T,m,x)))-1),v.push(E)}p.push(v)}var b,_,R,w=p.length;for(l=0;w>l;l++){var S=p[l].length;if(l>0)for(s=0;S>s;s++){var H=s==S-1,M=p[l][H?0:s+1],C=p[l][H?S-1:s],D=p[l-1][H?S-1:s],A=p[l-1][H?0:s+1],I=l/(w-1),P=(l-1)/(w-1),L=(s+1)/S,k=s/S,O=new THREE.UV(1-L,I),N=new THREE.UV(1-k,I),z=new THREE.UV(1-k,P),V=new THREE.UV(1-L,P);l<p.length-1&&(b=this.vertices[M].position.clone(),_=this.vertices[C].position.clone(),R=this.vertices[D].position.clone(),b.normalize(),_.normalize(),R.normalize(),this.faces.push(new THREE.Face3(M,C,D,[new THREE.Vector3(b.x,b.y,b.z),new THREE.Vector3(_.x,_.y,_.z),new THREE.Vector3(R.x,R.y,R.z)])),this.faceVertexUvs[0].push([O,N,z])),l>1&&(b=this.vertices[M].position.clone(),_=this.vertices[D].position.clone(),R=this.vertices[A].position.clone(),b.normalize(),_.normalize(),R.normalize(),this.faces.push(new THREE.Face3(M,D,A,[new THREE.Vector3(b.x,b.y,b.z),new THREE.Vector3(_.x,_.y,_.z),new THREE.Vector3(R.x,R.y,R.z)])),this.faceVertexUvs[0].push([O,z,V]))}}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals(),this.boundingSphere={radius:e}},THREE.PartialSphereGeometry.prototype=new THREE.Geometry,THREE.PartialSphereGeometry.prototype.constructor=THREE.PartialSphereGeometry,tpSphericalPan={init:function(e,t){window.onload=function(){function i(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}function n(){var t,i;t=document.getElementById("tpModelCanvasHolder"),y=new THREE.Camera(_,window.innerWidth/window.innerHeight,1,1100),x=new THREE.Scene,i=new THREE.Mesh(new THREE.PartialSphereGeometry(500,60,40,f,m,g,v),new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e,new THREE.UVMapping,function(){$("#tpModelLoadingProgress").hide()})})),i.overdraw=!0,i.scale.x=-1,x.addObject(i),T=Modernizr.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer,T.setSize(window.innerWidth,window.innerHeight),t.appendChild(T.domElement),b?($(t).bind("touchstart",a),$(t).bind("touchmove",s),$(t).bind("touchend",h)):(document.addEventListener("mousedown",a,!1),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",h,!1)),document.addEventListener("mousewheel",c,!1),document.addEventListener("DOMMouseScroll",c,!1)}function r(e){var t=0,i=0;return b?"touchend"==e.type?(t=e.originalEvent.changedTouches[0].pageX,i=e.originalEvent.changedTouches[0].pageY):(t=e.originalEvent.touches[0].pageX,i=e.originalEvent.touches[0].pageY):(t=e.clientX,i=e.clientY),{x:t,y:i}}function o(e,t){return b&&e.originalEvent.touches.length>1?(t&&(dx=e.originalEvent.touches[1].pageX-e.originalEvent.touches[0].pageX,dy=e.originalEvent.touches[1].pageY-e.originalEvent.touches[0].pageY,A=Math.sqrt(dx*dx+dy*dy)),!0):!1}function a(e){S=!0,o(e,!0)||(e.preventDefault(),pt=r(e),onPointerDownPointerX=pt.x,onPointerDownPointerY=pt.y,onPointerDownLon=lon,onPointerDownLat=lat)}function s(e){if(S){if(o(e,!1))return d(e),void 0;pt=r(e),lon=.1*(onPointerDownPointerX-pt.x)+onPointerDownLon,lat=.1*(pt.y-onPointerDownPointerY)+onPointerDownLat}}function h(){S=!1}function c(e){var t=_;return e.wheelDeltaY?_-=.05*e.wheelDeltaY:e.wheelDelta?_-=.05*e.wheelDelta:e.detail&&(_+=1*e.detail),_>R||w>_?(_=t,void 0):(y.projectionMatrix=THREE.Matrix4.makePerspective(_,window.innerWidth/window.innerHeight,1,1100),p(),void 0)}function d(e){if(A){e.preventDefault(),te=e.originalEvent,x1=te.touches[0].pageX,y1=te.touches[0].pageY,x2=te.touches[1].pageX,y2=te.touches[1].pageY,l=Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2)),cx=(x2-x1)/2+x1,cy=(y2-y1)/2+y1;var t=.1;zf=l>A?1+t*l/A:1-t*A/l,A=l;var i=_;if(_/=zf,_>R||w>_)return _=i,void 0;y.projectionMatrix=THREE.Matrix4.makePerspective(_,window.innerWidth/window.innerHeight,1,1100),p()}}function u(){requestAnimationFrame(u),p()}function p(){lat=Math.max(-85,Math.min(85,lat)),C=(90-lat)*Math.PI/180,D=lon*Math.PI/180,y.target.position.x=500*Math.sin(C)*Math.cos(D),y.target.position.y=500*Math.cos(C),y.target.position.z=500*Math.sin(C)*Math.sin(D),T.render(x,y)}if(!i())return $("#tpModelLoadingProgress").hide(),$("#tpCanvasDisabled").show(),void 0;var f,m,g,v;dm_info=JSON&&JSON.parse(t)||$.parseJSON(t),f=parseFloat(dm_info.Left),m=parseFloat(dm_info.Right),g=parseFloat(dm_info.Bottom),v=parseFloat(dm_info.Top);var E=.1;f="undefined"==typeof f?0:f,"undefined"==typeof m?m=2*Math.PI:E>m&&(m+=2*Math.PI),g="undefined"==typeof g?0:g,v="undefined"==typeof v?0:v,lon=H=180-90*(m+f)/Math.PI,lat=M=90*(v+g)/Math.PI,vsBackup=g,g=0==g?0:Math.PI/2-v,v=0==v?Math.PI:Math.PI/2-vsBackup,f=0==f?0:f,m=0==m?2*Math.PI:m;var y,x,T,b=Modernizr.touch,_=100,R=140,w=5,S=!1,H=0,M=0,C=0,D=0;$("#tpModelLoadingProgress").html("Loading the scan image ..."),n(),u();var A}}};